var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es6","es3");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
$jscomp.polyfill("Math.log2",function(a){return a?a:function(a){return Math.log(a)/Math.LN2}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6-impl","es3");var COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(a){return void 0!==a};
goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]));goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG;
goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1;goog.provide=function(a){if(goog.isInModuleLoader_())throw Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};
goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;
goog.module=function(a){if(!goog.isString(a)||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");
goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};goog.module.getInternal_=function(a){if(!COMPILED){if(a in goog.loadedModules_)return goog.loadedModules_[a];if(!goog.implicitNamespaces_[a])return a=goog.getObjectByName(a),null!=a?a:null}return null};goog.moduleLoaderState_=null;
goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};
goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");var f=goog.dependencies_;d&&"boolean"!==typeof d||(d=d?{module:"goog"}:{});for(var g=0;e=b[g];g++)f.nameToPath[e]=a,f.loadFlags[a]=d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};
goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(a);if(goog.isProvided_(a)){if(goog.isInModuleLoader_())return goog.module.getInternal_(a)}else if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)goog.writeScripts_(b);else throw a="goog.require could not find: "+a,goog.logToConsole_(a),Error(a);}return null}};goog.basePath="";goog.nullFunction=function(){};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.instance_=void 0;a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.TRANSPILE="detect";
goog.TRANSPILER="transpile.js";
goog.DEPENDENCIES_ENABLED&&(goog.dependencies_={loadFlags:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return null!=a&&"write"in a},goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("SCRIPT"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),d=-1==d?c.length:d;if("base.js"==
c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.importProcessedScript_=function(a,b,c){goog.importScript_("",'goog.retrieveAndExec_("'+a+'", '+b+", "+c+");")},goog.queuedModules_=[],goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?
"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(0<a){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;c<a;c++)goog.maybeProcessDeferredPath_(b[c])}},goog.maybeProcessDeferredDep_=function(a){goog.isDeferredModule_(a)&&goog.allDepsAreAvailable_(a)&&(a=goog.getPathFromDeps_(a),goog.maybeProcessDeferredPath_(goog.basePath+
a))},goog.isDeferredModule_=function(a){var b=(a=goog.getPathFromDeps_(a))&&goog.dependencies_.loadFlags[a]||{},c=b.lang||"es3";return a&&("goog"==b.module||goog.needsTranspile_(c))?goog.basePath+a in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(a){if((a=goog.getPathFromDeps_(a))&&a in goog.dependencies_.requires)for(var b in goog.dependencies_.requires[a])if(!goog.isProvided_(b)&&!goog.isDeferredModule_(b))return!1;return!0},goog.maybeProcessDeferredPath_=function(a){if(a in
goog.dependencies_.deferred){var b=goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}},goog.loadModuleFromUrl=function(a){goog.retrieveAndExec_(a,!0,!1)},goog.writeScriptSrcNode_=function(a){goog.global.document.write('<script type="text/javascript" src="'+a+'">\x3c/script>')},goog.appendScriptSrcNode_=function(a){var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.src=a;c.defer=!1;c.async=!1;b.head.appendChild(c)},goog.writeScriptTag_=
function(a,b){if(goog.inHtmlDocument_()){var c=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}if(void 0===b)if(goog.IS_OLD_IE_){var d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";c.write('<script type="text/javascript" src="'+a+'"'+d+">\x3c/script>")}else goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(a):
goog.writeScriptSrcNode_(a);else c.write('<script type="text/javascript">'+goog.protectScriptTag_(b)+"\x3c/script>");return!0}return!1},goog.protectScriptTag_=function(a){return a.replace(/<\/(SCRIPT)/ig,"\\x3c\\$1")},goog.needsTranspile_=function(a){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;goog.requiresTranspilation_||(goog.requiresTranspilation_=goog.createRequiresTranspilation_());if(a in goog.requiresTranspilation_)return goog.requiresTranspilation_[a];throw Error("Unknown language mode: "+
a);},goog.requiresTranspilation_=null,goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(a,b){"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(a){function b(a){if(!(a in e.written||a in e.visited)){e.visited[a]=!0;if(a in e.requires)for(var f in e.requires[a])if(!goog.isProvided_(f))if(f in e.nameToPath)b(e.nameToPath[f]);else throw Error("Undefined nameToPath for "+f);a in d||(d[a]=!0,c.push(a))}}var c=[],d={},
e=goog.dependencies_;b(a);for(a=0;a<c.length;a++){var f=c[a];goog.dependencies_.written[f]=!0}var g=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(a=0;a<c.length;a++)if(f=c[a]){var h=e.loadFlags[f]||{},m=goog.needsTranspile_(h.lang||"es3");"goog"==h.module||m?goog.importProcessedScript_(goog.basePath+f,"goog"==h.module,m):goog.importScript_(goog.basePath+f)}else throw goog.moduleLoaderState_=g,Error("Undefined script input");goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in
goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js"));
goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};var c;if(goog.isFunction(a))c=a.call(void 0,{});else if(goog.isString(a))c=goog.loadModuleFromSource_.call(void 0,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if(!goog.isString(d)||!d)throw Error('Invalid module name "'+d+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&
Object.seal&&goog.isObject(c)&&Object.seal(c);goog.loadedModules_[d]=c}finally{goog.moduleLoaderState_=b}};goog.loadModuleFromSource_=function(a){eval(a);return{}};goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")};
goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);try{var b=new goog.global.XMLHttpRequest;b.open("get",a,!1);b.send();return 0==b.status||200==b.status?b.responseText:null}catch(c){return null}};
goog.retrieveAndExec_=function(a,b,c){if(!COMPILED){var d=a;a=goog.normalizePath_(a);var e=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,f=goog.loadFileSync_(a);if(null==f)throw Error('Load of "'+a+'" failed');c&&(f=goog.transpile_.call(goog.global,f,a));f=b?goog.wrapModule_(a,f):f+("\n//# sourceURL="+a);goog.IS_OLD_IE_?(goog.dependencies_.deferred[d]=f,goog.queuedModules_.push(d)):e(a,f)}};
goog.transpile_=function(a,b){var c=goog.global.$jscomp;c||(goog.global.$jscomp=c={});var d=c.transpile;if(!d){var e=goog.basePath+goog.TRANSPILER,f=goog.loadFileSync_(e);if(f){eval(f+"\n//# sourceURL="+e);if(goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile;
c=goog.global.$jscomp;d=c.transpile}}d||(d=c.transpile=function(a,b){goog.logToConsole_(b+" requires transpilation but no transpiler was found.");return a});return d(a,b)};
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};
goog.removeUid=function(a){null!==a&&"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};
goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};
goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval){if(null==goog.evalWorksForGlobals_)if(goog.global.eval("var _evalTest_ = 1;"),"undefined"!=typeof goog.global._evalTest_){try{delete goog.global._evalTest_}catch(d){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1;if(goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("SCRIPT");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));
b.body.appendChild(c);b.body.removeChild(c)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;
goog.getCssName=function(a,b){if("."==String(a).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+a);var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a},d=b?a+"-"+d(b):d(a);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(d):d};
goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return null!=b&&d in b?b[d]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_){for(var e=Array(arguments.length-1),f=1;f<arguments.length;f++)e[f-1]=arguments[f];return d.superClass_.constructor.apply(a,e)}e=Array(arguments.length-2);for(f=2;f<arguments.length;f++)e[f-2]=arguments[f];for(var f=!1,g=a.constructor;g;g=
g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a goog.module.");a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return a;var c=!goog.defineClass.isUnsealable_(b),d=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===d&&c&&Object.seal instanceof Function&&Object.seal(b);return b};return d};goog.defineClass.isUnsealable_=function(a){return a&&a.prototype&&a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";
goog.createRequiresTranspilation_=function(){function a(a,b){d?c[a]=!0:b()?c[a]=!1:d=c[a]=!0}function b(a){try{return!!eval(a)}catch(f){return!1}}var c={es3:!1},d=!1;a("es5",function(){return b("[1,].length==1")});a("es6",function(){return b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')});
a("es6-impl",function(){return!0});a("es7",function(){return b("2 ** 2 == 4")});a("es8",function(){return b("async () => 1, true")});return c};var epiviz={deferred:{}};epiviz.deferred.Deferred=function(a){this._deferred=a||$.Deferred()};epiviz.deferred.Deferred.State={PENDING:"pending",RESOLVED:"resolved",REJECTED:"rejected"};epiviz.deferred.Deferred.prototype.then=function(a,b,c){return new epiviz.deferred.Promise(this._deferred.then(a,b,c))};epiviz.deferred.Deferred.prototype.done=function(a,b){return new epiviz.deferred.Deferred(this._deferred.done(a,b))};
epiviz.deferred.Deferred.prototype.fail=function(a,b){return new epiviz.deferred.Deferred(this._deferred.fail(a,b))};epiviz.deferred.Deferred.prototype.always=function(a,b){return new epiviz.deferred.Deferred(this._deferred.always(a,b))};epiviz.deferred.Deferred.prototype.state=function(){return this._deferred.state()};epiviz.deferred.Deferred.prototype.notify=function(a){return new epiviz.deferred.Deferred(this._deferred.notify(a))};
epiviz.deferred.Deferred.prototype.notifyWith=function(a,b){return new epiviz.deferred.Deferred(this._deferred.notifyWith(a,b))};epiviz.deferred.Deferred.prototype.progress=function(a,b){return new epiviz.deferred.Deferred(this._deferred.progress(a,b))};epiviz.deferred.Deferred.prototype.promise=function(a){return new epiviz.deferred.Promise(this._deferred.promise(a))};epiviz.deferred.Deferred.prototype.reject=function(a){return new epiviz.deferred.Deferred(this._deferred.reject(a))};
epiviz.deferred.Deferred.prototype.rejectWith=function(a,b){return new epiviz.deferred.Deferred(this._deferred.rejectWith(a,b))};epiviz.deferred.Deferred.prototype.resolve=function(a){return new epiviz.deferred.Deferred(this._deferred.resolve(a))};epiviz.deferred.Deferred.prototype.resolveWith=function(a,b){return new epiviz.deferred.Deferred(this._deferred.resolveWith(a,b))};epiviz.utils=function(){};epiviz.utils.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};epiviz.utils.stringContains=function(a,b){return-1!=a.indexOf(b)};epiviz.utils.stringStartsWith=function(a,b){return 0==a.indexOf(b)};epiviz.utils.stringEndsWith=function(a,b){return a.lastIndexOf(b)==a.length-b.length};epiviz.utils.fillArray=function(a,b){a=a||0;for(var c=Array(a),d=0;d<a;++d)c[d]=b;return c};
epiviz.utils.indexOf=function(a,b){for(var c=0;c<a.length;++c)if(b(a[c]))return c;return-1};epiviz.utils.arraysEqual=function(a,b){if(a==b)return!0;if(!a||!b||a.length!=b.length||a<b||b<a)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};epiviz.utils.elementsEqual=function(a,b){if(a==b)return!0;if(!a||!b||a.length!=b.length)return!1;var c={},d;for(d=0;d<a.length;++d)a[d]in c||(c[a[d]]=0),++c[a[d]];for(d=0;d<b.length;++d){if(!c[b[d]])return!1;--c[b[d]]}return!0};
epiviz.utils.range=function(a,b){b=b||0;a=a||0;for(var c=Array(a),d=0;d<a;++d)c[d]=d+b;return c};epiviz.utils.arrayAppend=function(a,b){a.push.apply(a,b)};epiviz.utils.arrayFlip=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=c;return b};epiviz.utils.indexOfMin=function(a,b){for(var c=null,d=null,e=0;e<a.length;++e)for(var f=b?e+1:0;f<a[e].length;++f)if(null==d||a[e][f]<d)d=a[e][f],c=[e,f];return{min:d,index:c}};
epiviz.utils.arrayIntersection=function(a,b){var c={};a.forEach(function(a){c[a]=a});var d=[];b.forEach(function(a){a in c&&d.push(a)});return d};epiviz.utils.asyncFor=function(a,b,c){if(a){var d=function(e){e>=a?c&&c():b(e,function(a){a?c&&c():d(e+1)})};d(0)}else c&&c()};
epiviz.utils.deferredFor=function(a,b){for(var c=new epiviz.deferred.Deferred,d=new epiviz.deferred.Deferred,e=c.promise(),f=0;f<a;++f)(function(c){e=e.then(function(){var e=b(c);c==a-1&&e.then(function(){d.resolve()});return e})})(f);c.resolve();return d};epiviz.utils.mapCopy=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};
epiviz.utils.mapEquals=function(a,b){if(a==b)return!0;if(!a||!b)return!1;for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!=b[c]))return!1;for(c in b)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(c))return!1;return!0};epiviz.utils.mapCombine=function(a,b,c){var d={},e;if(b)for(e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);if(a)for(e in a)a.hasOwnProperty(e)&&(c&&d[e]&&$.isArray(d[e])&&a[e]&&$.isArray(a[e])?d[e]=d[e].concat(a[e]):d[e]=a[e]);return d};
epiviz.utils.mapJoin=function(a,b,c){b||""===b||(b=":");c||""===c||(c=",");var d="",e;for(e in a)a.hasOwnProperty(e)&&(d&&(d+=c),d+=e+b+a[e]);return d};epiviz.utils.mapKeyIntersection=function(a,b){var c=[];if(!a||!b)return c;for(var d in a)a.hasOwnProperty(d)&&d in b&&c.push(d);return c};epiviz.utils.forEach=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b(a[c],c,a))break};
epiviz.utils.evaluateFullyQualifiedTypeName=function(a){try{for(var b=a.split("."),c=b.pop(),d=window,e=0;e<b.length;++e)d=d[b[e]];var f=d[c];return"function"!==typeof f?(console.error("Unknown type name: "+a),null):f}catch(g){return console.error("Unknown type name: "+a),null}};epiviz.utils.applyConstructor=function(a,b){var c;c=function(){};c.prototype=a.prototype;c=new c;c.constructor=a;a.apply(c,b);return c};epiviz.utils.RAD_TO_DEG=180/Math.PI;epiviz.utils.DEG_TO_RAD=Math.PI/180;
epiviz.utils.getInternetExplorerVersion=function(){var a=-1;if("Microsoft Internet Explorer"==navigator.appName){var b=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent);null!=b&&(a=parseFloat(b[1]))}return a};epiviz.utils.generatePseudoGUID=function(a){for(var b="",c=0;c<a;++c)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return b};epiviz.utils.colorize=function(a,b,c,d,e,f){return d3.scale.linear().domain([a,c,b]).range([d,f,e])};
epiviz.utils.colorizeBinary=function(a,b,c,d){return d3.scale.linear().domain([a,b]).range([c,d])};epiviz.utils.sign=function(a){return 0>a?-1:0==a?0:1};var caja={};epiviz.caja={};caja.initialize=function(){};epiviz.caja.cajole=function(a,b){var c=new epiviz.deferred.Deferred;setTimeout(function(){c.resolve(eval("("+a+")"))},0);return c};epiviz.caja.run=function(a,b){var c=new epiviz.deferred.Deferred;setTimeout(function(){var b=document.getElementsByTagName("head")[0],e=document.createElement("script");e.type="text/javascript";e.src=a;e.onreadystatechange=e.onload=function(){c.resolve()};b.appendChild(e)},0);return c};
epiviz.caja.chain=function(a,b){$.isArray(b)||(b=epiviz.utils.fillArray(a.length,b));return epiviz.utils.deferredFor(a.length,function(c){return epiviz.caja.run(a[c],b[c])})};
epiviz.caja.buildChartMethodContext=function(){return{epiviz:{ui:{charts:epiviz.ui.charts,controls:epiviz.ui.controls},utils:epiviz.utils,plugins:epiviz.plugins,measurements:epiviz.measurements,events:epiviz.events,deferred:epiviz.deferred,datatypes:epiviz.datatypes,data:{DataProvider:epiviz.data.DataProvider,Request:epiviz.data.Request,Response:epiviz.data.Response,WebServerDataProvider:{makeGetRequest:epiviz.data.WebServerDataProvider.makeGetRequest}},Config:epiviz.Config},d3:d3,$:$,sprintf:sprintf,
goog:goog}};epiviz.events={};epiviz.events.EventListener=function(a){this._id=epiviz.events.EventListener._nextId++;this._updateCallback=a};epiviz.events.EventListener._nextId=0;epiviz.events.EventListener.prototype.update=function(a){this._updateCallback(a)};epiviz.events.EventListener.prototype.id=function(){return this._id};epiviz.ui={};epiviz.ui.WebArgsManager=function(a,b){this._locationManager=a;this._workspaceManager=b;this._registerLocationChanged();this._registerActiveWorkspaceChanged()};epiviz.ui.WebArgsManager.WEB_ARGS=epiviz.ui.WebArgsManager.WEB_ARGS||{};
epiviz.ui.WebArgsManager.extractWindowLocationArgs=function(){var a={};(0<window.location.search.length?window.location.search.substr(1):"").split("&").forEach(function(b,c){if(0!=b.trim().length){var d=b.indexOf("[]");if(0!=d){var e,f;f=b.indexOf("=");0>f?(e=0>d?b:b.substr(0,d),f="true"):(e=0>d?b.substr(0,f):b.substr(0,d),f=b.substr(f+1));e=decodeURIComponent(e);f=decodeURIComponent(f);0>d?a[e]=f:(e in a||(a[e]=[]),a[e].push(f))}}});return a};
epiviz.ui.WebArgsManager.prototype._updateUrl=function(){var a="?",b=epiviz.ui.WebArgsManager.WEB_ARGS;!("ws"in b)&&"workspace"in b&&(b.ws=b.workspace,delete b.workspace);for(var c in b)if(b.hasOwnProperty(c))if(Array.isArray(b[c]))for(var d,e=0;e<b[c].length;++e)d=b[c][e],void 0==d&&(d="undefined"),a+=sprintf("%s[]=%s&",c,d);else d=b[c],void 0==d&&(d="undefined"),a+=sprintf("%s=%s&",c,d);b=epiviz.utils.getInternetExplorerVersion();if(0>b||10<=b)switch(window.location.protocol){case "http:":case "https:":history.replaceState(null,
"",a)}};epiviz.ui.WebArgsManager.prototype._registerLocationChanged=function(){var a=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(b){epiviz.ui.WebArgsManager.WEB_ARGS.seqName=b.newValue.seqName();epiviz.ui.WebArgsManager.WEB_ARGS.start=b.newValue.start();epiviz.ui.WebArgsManager.WEB_ARGS.end=b.newValue.end();epiviz.ui.WebArgsManager.WEB_ARGS.genome=b.newValue.genome();a._updateUrl()}))};
epiviz.ui.WebArgsManager.prototype._registerActiveWorkspaceChanged=function(){var a=this;this._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(b){epiviz.ui.WebArgsManager.WEB_ARGS.ws=b.workspaceId||"";delete epiviz.ui.WebArgsManager.WEB_ARGS.workspace;a._updateUrl()}))};epiviz.events.Event=function(){this._count=0;this._listeners={};this._firing=!1};epiviz.events.Event.prototype.addListener=function(a){this._listeners[a.id()]||++this._count;this._listeners[a.id()]=a};epiviz.events.Event.prototype.removeListener=function(a){this._listeners[a.id()]&&(delete this._listeners[a.id()],--this._count)};
epiviz.events.Event.prototype.notify=function(a){if(!this._firing&&0!=this._count){this._firing=!0;for(var b in this._listeners)this._listeners.hasOwnProperty(b)&&this._listeners[b].update(a);this._firing=!1}};epiviz.events.Event.prototype.isFiring=function(){return this._firing};epiviz.data={};epiviz.data.MessageType={REQUEST:"request",RESPONSE:"response"};epiviz.data.Response=function(a,b){this._id=a;this._data=b};epiviz.data.Response.prototype.id=function(){return this._id};epiviz.data.Response.prototype.data=function(){var a=this._data,b=Object.keys(a);0<b.length&&-1!=b.indexOf("success")&&(b.splice(b.indexOf("success"),1),delete a.success);return a};epiviz.data.Response.prototype.type=function(){return epiviz.data.MessageType.RESPONSE};epiviz.data.Response.prototype.raw=function(){return{requestId:this._id,type:this.type(),data:this._data}};
epiviz.data.Response.fromRawObject=function(a){return new epiviz.data.Response(a.requestId,a.data)};epiviz.data.DataProvider=function(a){this._id=a;this._requestAddSeqInfos=new epiviz.events.Event;this._requestRemoveSeqNames=new epiviz.events.Event;this._requestAddMeasurements=new epiviz.events.Event;this._requestRemoveMeasurements=new epiviz.events.Event;this._requestAddChart=new epiviz.events.Event;this._requestRemoveChart=new epiviz.events.Event;this._requestFlushCache=new epiviz.events.Event;this._requestClearDatasourceGroupCache=new epiviz.events.Event;this._requestNavigate=new epiviz.events.Event;
this._requestRedraw=new epiviz.events.Event;this._requestCurrentLocation=new epiviz.events.Event;this._requestPrintWorkspace=new epiviz.events.Event;this._requestSetChartSettings=new epiviz.events.Event;this._requestGetChartSettings=new epiviz.events.Event;this._requestGetAvailableCharts=new epiviz.events.Event;this._requestLoadWorkspace=new epiviz.events.Event;this._requestUiStatus=new epiviz.events.Event;this._requestLoadMeasurements=new epiviz.events.Event};
epiviz.data.DataProvider.prototype.id=function(){return this._id};epiviz.data.DataProvider.prototype.getData=function(a,b){b(epiviz.data.Response.fromRawObject({requestId:a.id(),data:null}))};epiviz.data.DataProvider.prototype.onRequestAddSeqInfos=function(){return this._requestAddSeqInfos};epiviz.data.DataProvider.prototype.onRequestRemoveSeqNames=function(){return this._requestRemoveSeqNames};epiviz.data.DataProvider.prototype.onRequestAddMeasurements=function(){return this._requestAddMeasurements};
epiviz.data.DataProvider.prototype.onRequestRemoveMeasurements=function(){return this._requestRemoveMeasurements};epiviz.data.DataProvider.prototype.onRequestLoadMeasurements=function(){return this._requestLoadMeasurements};epiviz.data.DataProvider.prototype.onRequestAddChart=function(){return this._requestAddChart};epiviz.data.DataProvider.prototype.onRequestRemoveChart=function(){return this._requestRemoveChart};epiviz.data.DataProvider.prototype.onRequestFlushCache=function(){return this._requestFlushCache};
epiviz.data.DataProvider.prototype.onRequestClearDatasourceGroupCache=function(){return this._requestClearDatasourceGroupCache};epiviz.data.DataProvider.prototype.onRequestNavigate=function(){return this._requestNavigate};epiviz.data.DataProvider.prototype.onRequestRedraw=function(){return this._requestRedraw};epiviz.data.DataProvider.prototype.onRequestCurrentLocation=function(){return this._requestCurrentLocation};epiviz.data.DataProvider.prototype.onRequestPrintWorkspace=function(){return this._requestPrintWorkspace};
epiviz.data.DataProvider.prototype.onRequestGetChartSettings=function(){return this._requestGetChartSettings};epiviz.data.DataProvider.prototype.onRequestSetChartSettings=function(){return this._requestSetChartSettings};epiviz.data.DataProvider.prototype.onRequestGetAvailableCharts=function(){return this._requestGetAvailableCharts};epiviz.data.DataProvider.prototype.onRequestLoadWorkspace=function(){return this._requestLoadWorkspace};epiviz.data.DataProvider.prototype.onRequestUiStatus=function(){return this._requestUiStatus};epiviz.data.Request=function(a,b,c){this._id=a;this._args=b;this._method=c};epiviz.data.Request.Method={GET:"get",POST:"post"};
epiviz.data.Request.Action={GET_ROWS:"getRows",GET_VALUES:"getValues",GET_COMBINED:"getCombined",GET_MEASUREMENTS:"getMeasurements",SEARCH:"search",GET_SEQINFOS:"getSeqInfos",SAVE_WORKSPACE:"saveWorkspace",DELETE_WORKSPACE:"deleteWorkspace",GET_WORKSPACES:"getWorkspaces",GET_HIERARCHY:"getHierarchy",PROPAGATE_HIERARCHY_CHANGES:"propagateHierarchyChanges",GET_PCA:"getPCA",GET_DIVERSITY:"getDiversity",GET_CHART_SETTINGS:"getChartSettings",SET_CHART_SETTINGS:"setChartSettings",GET_AVAILABLE_CHARTS:"getAvailableCharts",
ADD_MEASUREMENTS:"addMeasurements",REMOVE_MEASUREMENTS:"removeMeasurements",LOAD_MEASUREMENTS:"loadMeasurements",ADD_SEQINFOS:"addSeqInfos",REMOVE_SEQNAMES:"removeSeqNames",ADD_CHART:"addChart",REMOVE_CHART:"removeChart",CLEAR_DATASOURCE_GROUP_CACHE:"clearDatasourceGroupCache",FLUSH_CACHE:"flushCache",NAVIGATE:"navigate",REDRAW:"redraw",GET_CURRENT_LOCATION:"getCurrentLocation",WRITE_DEBUG_MSG:"writeMsg",PRINT_WORKSPACE:"printWorkspace",LOAD_WORKSPACE:"loadWorkspace",REGISTER_CHART_TYPES:"registerChartTypes",
UI_STATUS:"uiStatus"};epiviz.data.Request.createRequest=function(a,b){return new epiviz.data.Request(epiviz.data.Request._nextId++,a,b||epiviz.data.Request.Method.GET)};epiviz.data.Request.fromRawObject=function(a){return new epiviz.data.Request(a.requestId,a.data)};epiviz.data.Request._nextId=0;epiviz.data.Request.prototype.id=function(){return this._id};epiviz.data.Request.prototype.type=function(){return epiviz.data.MessageType.REQUEST};epiviz.data.Request.prototype.method=function(){return this._method};
epiviz.data.Request.prototype.joinArgs=function(a,b){a=a||"=";b=b||"&";var c=sprintf("requestId%s%s",a,this._id),d;for(d in this._args)if(this._args.hasOwnProperty(d))if(Array.isArray(this._args[d]))for(var e=0;e<this._args[d].length;++e)c+=sprintf("%s%s[]%s%s",b,d,a,this._args[d][e]);else c+=sprintf("%s%s%s%s",b,d,a,this._args[d]||"");return c};epiviz.data.Request.prototype.isEmpty=function(){for(var a in this._args)if(this._args.hasOwnProperty(a))return!1;return!0};
epiviz.data.Request.prototype.get=function(a){return a in this._args?this._args[a]:null};epiviz.data.Request.prototype.raw=function(){return{requestId:this._id,type:this.type(),data:epiviz.utils.mapCopy(this._args)}};epiviz.data.Request.emptyRequest=function(){return epiviz.data.Request.createRequest({})};
epiviz.data.Request.getRows=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_ROWS,datasourceGroup:a.dataprovider(),datasource:a.id(),seqName:b?b.seqName():void 0,start:b?b.start():void 0,end:b?b.end():void 0,genome:b?b.genome():void 0,metadata:a.metadata()})};
epiviz.data.Request.getValues=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_VALUES,datasourceGroup:a.dataprovider(),datasource:a.datasource().id(),measurement:a.id(),seqName:b?b.seqName():void 0,start:b?b.start():void 0,end:b?b.end():void 0,genome:b?b.genome():void 0,bins:window.innerWidth})};
epiviz.data.Request.getCombined=function(a,b){var c={},d="",e="",f,g;for(g in a)d=g,a.hasOwnProperty(g)&&(c[g]=function(){var b=[];a[g].foreach(function(a){"genes"==d&&(f=a);e=a.dataprovider();b.push(a.id())});return b}());return"genes"==d?epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_COMBINED,seqName:b?b.seqName():void 0,start:b?b.start():void 0,end:b?b.end():void 0,measurements:c[d],datasourceGroup:e,datasource:d,genome:b?b.genome():void 0,
metadata:f.metadata()}):epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_COMBINED,seqName:b?b.seqName():void 0,start:b?b.start():void 0,end:b?b.end():void 0,measurements:c[d],datasource:d,datasourceGroup:e,genome:b?b.genome():void 0,bins:window.innerWidth})};epiviz.data.Request.getMeasurements=function(a){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_MEASUREMENTS,datasourceGroup:a})};
epiviz.data.Request.search=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.SEARCH,q:a||"",maxResults:b})};epiviz.data.Request.getSeqInfos=function(a){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_SEQINFOS,datasourceGroup:a})};
epiviz.data.Request.saveWorkspace=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.SAVE_WORKSPACE,id:a.id(),name:a.name(),content:encodeURIComponent(JSON.stringify(a.raw(b).content))},epiviz.data.Request.Method.POST)};epiviz.data.Request.deleteWorkspace=function(a){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.DELETE_WORKSPACE,id:a.id()},epiviz.data.Request.Method.POST)};
epiviz.data.Request.getWorkspaces=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_WORKSPACES,q:a||"",ws:b})};epiviz.data.Request.getHierarchy=function(a,b){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_HIERARCHY,datasourceGroup:a,nodeId:b})};
epiviz.data.Request.propagateHierarchyChanges=function(a,b,c,d){return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.PROPAGATE_HIERARCHY_CHANGES,datasourceGroup:a,selection:b,order:c,selectedLevels:d})};
epiviz.data.Request.getPCA=function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=function(){var b=[];a[d].foreach(function(a){b.push(a.id())});return b}());return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_PCA,measurements:c})};
epiviz.data.Request.getDiversity=function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=function(){var b=[];a[d].foreach(function(a){b.push(a.id())});return b}());return epiviz.data.Request.createRequest({version:epiviz.EpiViz.VERSION,action:epiviz.data.Request.Action.GET_DIVERSITY,measurements:c})};epiviz.measurements={};epiviz.measurements.Measurement=function(a,b,c,d,e,f,g,h,m,l,p,n){var t=epiviz.measurements.Measurement.Type;this._id=a;this._name=b;this._type=c;this._datasource=c==t.RANGE?this:new epiviz.measurements.Measurement(d,d,t.RANGE,d,e,f,null,"Blocks Track",null,null,null,n);this._datasourceGroup=e;this._dataprovider=f;this._formula=g||null;this._defaultChartType=h||null;this._annotation=m||null;this._minValue=l||0===l?l:null;this._maxValue=p||0===p?p:null;this._metadata=n||null};
epiviz.measurements.Measurement.Type={FEATURE:"feature",RANGE:"range",UNORDERED:"unordered"};epiviz.measurements.Measurement.Type.isOrdered=function(a){return a==epiviz.measurements.Measurement.Type.FEATURE||a==epiviz.measurements.Measurement.Type.RANGE};epiviz.measurements.Measurement.Type.hasValues=function(a){return a==epiviz.measurements.Measurement.Type.FEATURE||a==epiviz.measurements.Measurement.Type.UNORDERED};epiviz.measurements.Measurement.prototype.id=function(){return this._id};
epiviz.measurements.Measurement.prototype.name=function(){return this._name};epiviz.measurements.Measurement.prototype.type=function(){return this._type};epiviz.measurements.Measurement.prototype.datasource=function(){return this._datasource};epiviz.measurements.Measurement.prototype.datasourceId=function(){return this._datasource.id()};epiviz.measurements.Measurement.prototype.datasourceGroup=function(){return this._datasourceGroup};epiviz.measurements.Measurement.prototype.dataprovider=function(){return this._dataprovider};
epiviz.measurements.Measurement.prototype.formula=function(){return this._formula};epiviz.measurements.Measurement.prototype.formulaStr=function(){if(!this._formula)return"";var a=this._formula.referredMeasurements,b=this._formula.expression.toString(),c;for(c in a)a.hasOwnProperty(c)&&(b=b.replace(new RegExp("\\{"+c+"\\}","g")," {"+a[c].name()+"} "));return b};
epiviz.measurements.Measurement.prototype.evaluate=function(a){var b={},c;for(c in this._formula.referredMeasurements)if(this._formula.referredMeasurements.hasOwnProperty(c)){var d=this._formula.referredMeasurements[c];b["{"+c+"}"]=d.isComputed()?d.evaluate(a):a.get(d)}return this._formula.expression.evaluate(b)};
epiviz.measurements.Measurement.prototype.evaluateArr=function(a){var b={},c;for(c in this._formula.referredMeasurements)if(this._formula.referredMeasurements.hasOwnProperty(c)){var d=this._formula.referredMeasurements[c];b["{"+c+"}"]=d.isComputed()?d.evaluateArr(a):a.get(d)}return this._formula.expression.evaluateArr(b)};epiviz.measurements.Measurement.prototype.defaultChartType=function(){return this._defaultChartType};epiviz.measurements.Measurement.prototype.annotation=function(){return this._annotation};
epiviz.measurements.Measurement.prototype.minValue=function(){return this._minValue};epiviz.measurements.Measurement.prototype.maxValue=function(){return this._maxValue};epiviz.measurements.Measurement.prototype.metadata=function(){return this._metadata||[]};
epiviz.measurements.Measurement.prototype.componentMeasurements=function(){var a=new epiviz.measurements.MeasurementSet;if(!this._formula)return a.add(this),a;for(var b in this._formula.referredMeasurements)this._formula.referredMeasurements.hasOwnProperty(b)&&a.addAll(this._formula.referredMeasurements[b].componentMeasurements());return a};epiviz.measurements.Measurement.prototype.isComputed=function(){return this._formula?!0:!1};
epiviz.measurements.Measurement.prototype.raw=function(a){if(this._formula){var b=this._formula.referredMeasurements,c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=a.get(b[d]))}return{id:this._id,name:this._name,type:this._type,datasourceId:this._datasource._id,datasourceGroup:this._datasourceGroup,dataprovider:this._dataprovider,formula:this._formula?{expression:this._formula.expression.toString(),referredMeasurements:c}:null,defaultChartType:this._defaultChartType,annotation:this._annotation,minValue:this._minValue,
maxValue:this._maxValue,metadata:this._metadata}};epiviz.measurements.Measurement.prototype.toString=function(){return this.name()};
epiviz.measurements.Measurement.fromRawObject=function(a,b){var c=null;if(a.formula){for(var c=epiviz.utils.ExpressionParser.parse(a.formula.expression),d={},e=c.variables(),f=0;f<e.length;++f)if(epiviz.utils.stringStartsWith(e[f],"{")&&epiviz.utils.stringEndsWith(e[f],"}")){var g=parseInt(e[f].substring(1,e[f].length-1));d[g]=b[a.formula.referredMeasurements[g]]}c={expression:c,referredMeasurements:d}}return new epiviz.measurements.Measurement(a.id,a.name,a.type,a.datasourceId,a.datasourceGroup,
a.dataprovider,c,a.defaultChartType,a.annotation,a.minValue,a.maxValue,a.metadata)};epiviz.utils.Iterable=function(){};epiviz.utils.Iterable.prototype.foreach=function(a){};epiviz.utils.Iterator=function(){};epiviz.utils.Iterator.prototype.first=function(){throw Error("unimplemented abstract method");};epiviz.utils.Iterator.prototype.next=function(){throw Error("unimplemented abstract method");};epiviz.measurements.MeasurementSet=function(a){this._measurementTree={};this._size=0;this._order=[];a&&this.addAll(a)};
epiviz.measurements.MeasurementSet.prototype.add=function(a){a.dataprovider()in this._measurementTree||(this._measurementTree[a.dataprovider()]={});a.type()in this._measurementTree[a.dataprovider()]||(this._measurementTree[a.dataprovider()][a.type()]={});a.datasourceGroup()in this._measurementTree[a.dataprovider()][a.type()]||(this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]={});a.datasource().id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]||(this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()]=
{});if(a.id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()])return!1;this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()]={measurement:a,index:this._order.length};this._order.push({measurement:a,contained:!0});++this._size;return!0};
epiviz.measurements.MeasurementSet.prototype.remove=function(a){if(!(a.dataprovider()in this._measurementTree&&a.type()in this._measurementTree[a.dataprovider()]&&a.datasourceGroup()in this._measurementTree[a.dataprovider()][a.type()]&&a.datasource().id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]&&a.id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()]))return!1;this._order[this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()].index].contained=
!1;delete this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()];--this._size;return!0};epiviz.measurements.MeasurementSet.prototype.addAll=function(a){if(!a||!a.size())return!1;var b=!1,c=this;a.foreach(function(a){c.add(a)&&(b=!0);return!1});return b};epiviz.measurements.MeasurementSet.prototype.removeAll=function(a){var b=!1,c=this;a.foreach(function(a){c.remove(a)&&(b=!0);return!1});return b};
epiviz.measurements.MeasurementSet.prototype.foreach=function(a,b){for(var c=this.iterator(),d=c.first(),e=0;null!==d&&(b&&!b(d)||!a(d,e));d=c.next(),++e);};epiviz.measurements.MeasurementSet.prototype.iterator=function(){return new epiviz.measurements.MeasurementSet.Iterator(this)};epiviz.measurements.MeasurementSet.prototype.subset=function(a){var b=new epiviz.measurements.MeasurementSet;this.foreach(function(a){b.add(a)},a);return b};
epiviz.measurements.MeasurementSet.prototype.map=function(a){var b=new epiviz.measurements.MeasurementSet;this.foreach(function(c){b.add(a(c))});return b};epiviz.measurements.MeasurementSet.prototype.size=function(){return this._size};
epiviz.measurements.MeasurementSet.prototype.contains=function(a){return a.dataprovider()in this._measurementTree&&a.type()in this._measurementTree[a.dataprovider()]&&a.datasourceGroup()in this._measurementTree[a.dataprovider()][a.type()]&&a.datasource().id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]?a.id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()]:!1};epiviz.measurements.MeasurementSet.prototype.first=function(){return this.iterator().first()};
epiviz.measurements.MeasurementSet.prototype.get=function(a){if(a>=this._size||0>a)return null;if(this._size==this._order.length)return this._order[a].measurement;var b=null;this.foreach(function(c,d){return d==a?(b=c,!0):!1});return b};epiviz.measurements.MeasurementSet.prototype.toArray=function(){var a=Array(this._size);this.foreach(function(b,c){a[c]=b});return a};
epiviz.measurements.MeasurementSet.prototype.sorted=function(a){a=this.toArray().sort(a);var b=new epiviz.measurements.MeasurementSet;a.forEach(function(a){b.add(a)});return b};epiviz.measurements.MeasurementSet.prototype.raw=function(){var a=Array(this._size);this.foreach(function(b,c){a[c]=b.raw()});return a};epiviz.measurements.MeasurementSet.prototype.remoteRaw=function(){var a=[];this.foreach(function(b,c){-1==b.dataprovider().indexOf("websocket")&&(a[c]=b.raw())});return a};
epiviz.measurements.MeasurementSet.prototype.split=function(a){var b={};this.foreach(function(c,d){var e=a(c),f=b[e];void 0==f&&(f=new epiviz.measurements.MeasurementSet,b[e]=f);f.add(c)});return b};epiviz.measurements.MeasurementSet.Iterator=function(a){this._parent=a;this._lastIndex=null};
epiviz.measurements.MeasurementSet.Iterator.prototype.first=function(){if(0==this._parent.size())return null;for(var a=0;a<this._parent._order.length;++a)if(this._parent._order[a].contained)return this._lastIndex=a,this._parent._order[a].measurement;throw Error("Inconsistent MeasurementSet with size() > 0 and no first element");};
epiviz.measurements.MeasurementSet.Iterator.prototype.next=function(){if(null===this._lastIndex)throw Error("Iterator.next() called before calling Iterator.first()");for(var a=this._lastIndex+1;a<this._parent._order.length;++a)if(this._parent._order[a].contained)return this._lastIndex=a,this._parent._order[a].measurement;this._lastIndex=this._parent._order.length;return null};epiviz.ui.controls={};epiviz.ui.controls.VisConfigSelection=function(a,b,c,d,e,f,g,h){this.measurements=a;this.datasource=b;this.datasourceGroup=c;this.dataprovider=d;this.annotation=e;this.defaultChartType=f;this.minSelectedMeasurements=g||1;this.customData=h};epiviz.events.EventResult=function(){this.value=this.errorMessage=this.success=null};epiviz.datatypes={};epiviz.datatypes.GenomicRange=function(a,b,c,d){void 0!=c&&0>c&&(c=-c,void 0!=b&&(b-=c));this._seqname=a;this._start=b;this._width=c;this._genome=d};epiviz.datatypes.GenomicRange.fromStartEnd=function(a,b,c,d){return new epiviz.datatypes.GenomicRange(a,b,void 0!=b&&void 0!=c?c-b:void 0,d)};epiviz.datatypes.GenomicRange.prototype.seqName=function(){return this._seqname};epiviz.datatypes.GenomicRange.prototype.genome=function(){return this._genome};
epiviz.datatypes.GenomicRange.prototype.start=function(){return this._start};epiviz.datatypes.GenomicRange.prototype.width=function(){return this._width};epiviz.datatypes.GenomicRange.prototype.end=function(){return void 0!=this._start&&void 0!=this._width?this._start+this._width:void 0};epiviz.datatypes.GenomicRange.prototype.isEmpty=function(){return 0>=this._width};
epiviz.datatypes.GenomicRange.prototype.subtract=function(a){return!a||a.genome()!=this._genome||a.seqName()!=this._seqname||a.isEmpty()||a.start()>=this.end()||this._start>=a.end()?[this]:a.start()<=this._start&&a.end()>=this.end()?[]:a.start()>this._start&&a.end()<this.end()?[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,this._start,a.start()),epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,a.end(),this.end())]:a.start()>this._start?[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,
this._start,a.start(),this._genome)]:[epiviz.datatypes.GenomicRange.fromStartEnd(this._seqname,a.end(),this.end(),this._genome)]};epiviz.datatypes.GenomicRange.prototype.equals=function(a){return a?a==this?!0:this._genome==a._genome&&this._seqname==a._seqname&&this._start==a._start&&this._width==a._width:!1};epiviz.datatypes.GenomicRange.prototype.overlapsWith=function(a){return a?this==a?!0:this.genome()!=a.genome()||this.seqName()!=a.seqName()?!1:this.start()<a.end()&&this.end()>a.start():!1};
epiviz.datatypes.GenomicRange.prototype.raw=function(){return{seqName:this._seqname,start:this._start,width:this._width,genome:this._genome}};epiviz.datatypes.GenomicRange.fromRawObject=function(a){return new epiviz.datatypes.GenomicRange(a.seqName,a.start,a.width,a.genome)};epiviz.ui.charts={};epiviz.ui.charts.ColorPalette=function(a,b,c,d){this._colors=a;this._id=c||epiviz.utils.generatePseudoGUID(6);this._name=b||"Custom ("+this._id+")";this._keyIndices=d||{};this._nKeys=0};epiviz.ui.charts.ColorPalette.prototype.id=function(){return this._id};epiviz.ui.charts.ColorPalette.prototype.name=function(){return this._name};epiviz.ui.charts.ColorPalette.prototype.get=function(a){return this._colors[a%this._colors.length]};
epiviz.ui.charts.ColorPalette.prototype.getByKey=function(a){var b=this._keyIndices[a];void 0==b&&(b=this._nKeys,this._keyIndices[a]=this._nKeys,++this._nKeys);return this.get(b)};epiviz.ui.charts.ColorPalette.prototype.keyColorIndex=function(a){a=this._keyIndices[a];return void 0==a?-1:a};epiviz.ui.charts.ColorPalette.prototype.keyIndices=function(){return this._keyIndices};epiviz.ui.charts.ColorPalette.prototype.size=function(){return this._colors.length};
epiviz.ui.charts.ColorPalette.prototype.equals=function(a){return this==a?!0:a?epiviz.utils.arraysEqual(this._colors,a._colors):!1};epiviz.ui.charts.ColorPalette.prototype.copy=function(){return new epiviz.ui.charts.ColorPalette(this._colors.slice(0))};epiviz.ui.charts.ColorPalette.prototype.raw=function(a){return a&&this._id in a.colorPalettesMap?{id:this._id}:{id:this._id,name:this._name,colors:this._colors}};
epiviz.ui.charts.ColorPalette.fromRawObject=function(a,b){if($.isArray(a))return new epiviz.ui.charts.ColorPalette(a);if(b&&a.id in b.colorPalettesMap)return b.colorPalettesMap[a.id];a.colors&&a.colors.length||(a.colors=epiviz.Config.COLORS_BRIGHT);return new epiviz.ui.charts.ColorPalette(a.colors,a.name,a.id)};epiviz.data.WebsocketDataProvider=function(a,b){epiviz.data.DataProvider.call(this,a||epiviz.data.WebsocketDataProvider.DEFAULT_ID);this._websocketHost=b;this._socket=null;this._useUI="true"!=epiviz.ui.WebArgsManager.WEB_ARGS.websocketNoUI;this._debug="true"==epiviz.ui.WebArgsManager.WEB_ARGS.debug;this._callbacks={};this._requestsStack=[];this._initialize()};epiviz.data.WebsocketDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype);
epiviz.data.WebsocketDataProvider.constructor=epiviz.data.WebsocketDataProvider;epiviz.data.WebsocketDataProvider.DEFAULT_ID="websocket";
epiviz.data.WebsocketDataProvider.prototype._initialize=function(){if(this._websocketHost&&"None"!=this._websocketHost)try{this._socket=new WebSocket(this._websocketHost);this._log("WebSocket - status "+this._socket.readyState);var a=this;this._socket.onopen=function(){a._onSocketOpen()};this._socket.onmessage=function(b){a._onSocketMessage(b)};this._socket.onclose=function(){a._onSocketClose()}}catch(b){this._log(b.toString())}};
epiviz.data.WebsocketDataProvider.prototype._onSocketOpen=function(){for(var a=0;a<this._requestsStack.length;++a)this._socket.send(this._requestsStack[a]);this._requestsStack=[];this._registerAvailableCharts()};epiviz.data.WebsocketDataProvider.prototype._onSocketClose=function(){this._socket=null};epiviz.data.WebsocketDataProvider.prototype._sendMessage=function(a){this.connected()&&this._socket.readyState?this._socket.send(a):this._requestsStack.push(a)};
epiviz.data.WebsocketDataProvider.prototype._onSocketMessage=function(a){this._log("Local Controller Received: "+a.data);var b=JSON.parse(a.data);b.data.dataprovidertype="websocket";if(b.type==epiviz.data.MessageType.RESPONSE)a=epiviz.data.Response.fromRawObject(b),b=this._callbacks[a.id()],delete this._callbacks[a.id()],b(a);else if(b.type==epiviz.data.MessageType.REQUEST)switch(a=epiviz.data.Request.Action,b=epiviz.data.Request.fromRawObject(b),b.get("action")){case a.ADD_MEASUREMENTS:this._addMeasurements(b);
break;case a.REMOVE_MEASUREMENTS:this._removeMeasurements(b);break;case a.ADD_SEQINFOS:this._addSeqInfos(b);break;case a.REMOVE_SEQNAMES:this._removeSeqNames(b);break;case a.ADD_CHART:this._addChart(b);break;case a.REMOVE_CHART:this._removeChart(b);break;case a.CLEAR_DATASOURCE_GROUP_CACHE:this._clearDatasourceGroupCache(b);break;case a.FLUSH_CACHE:this._flushCache(b);break;case a.NAVIGATE:this._navigate(b);break;case a.REDRAW:this._redraw(b);break;case a.GET_CURRENT_LOCATION:this._getCurrentLocation(b);
break;case a.WRITE_DEBUG_MSG:this._writeDebugMsg(b);break;case a.PRINT_WORKSPACE:this._printWorkspace(b);break;case a.SET_CHART_SETTINGS:this._setChartSettings(b);break;case a.GET_CHART_SETTINGS:this._getChartSettings(b);break;case a.GET_AVAILABLE_CHARTS:this._getAvailableCharts(b);break;case a.LOAD_WORKSPACE:this._loadWorkspace(b);break;case a.UI_STATUS:this._uiStatus(b);case a.LOAD_MEASUREMENTS:this._loadMeasurements(b)}};
epiviz.data.WebsocketDataProvider.prototype._log=function(a){this._debug&&console.log(a)};epiviz.data.WebsocketDataProvider.prototype._fireEvent=function(a,b){this._useUI?a.notify(b):b.result.success=!0};epiviz.data.WebsocketDataProvider.prototype.connected=function(){return null!=this._socket};epiviz.data.WebsocketDataProvider.prototype.getData=function(a,b){var c=JSON.stringify(a.raw());this._callbacks[a.id()]=b;this._sendMessage(c)};
epiviz.data.WebsocketDataProvider.prototype._addMeasurements=function(a){for(var b=new epiviz.events.EventResult,c=new epiviz.measurements.MeasurementSet,d=JSON.parse(a.get("measurements")),e=0;e<d.length;++e)c.add(new epiviz.measurements.Measurement(d[e].id,d[e].name,d[e].type,d[e].datasourceId,d[e].datasourceGroup,this.id(),null,d[e].defaultChartType,d[e].annotation,d[e].minValue,d[e].maxValue,d[e].metadata));this._fireEvent(this.onRequestAddMeasurements(),{measurements:c,result:b});a=new epiviz.data.Response(a.id(),
b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._removeMeasurements=function(a){for(var b=new epiviz.events.EventResult,c=new epiviz.measurements.MeasurementSet,d=JSON.parse(a.get("measurements")),e=0;e<d.length;++e)c.add(new epiviz.measurements.Measurement(d[e].id,d[e].name,d[e].type,d[e].datasourceId,d[e].datasourceGroup,this.id(),null,d[e].defaultChartType,d[e].annotation,d[e].minValue,d[e].maxValue,d[e].metadata));this._fireEvent(this.onRequestRemoveMeasurements(),{measurements:c,result:b});a=new epiviz.data.Response(a.id(),
b);this._sendMessage(JSON.stringify(a.raw()))};epiviz.data.WebsocketDataProvider.prototype._addSeqInfos=function(a){var b=new epiviz.events.EventResult,c=JSON.parse(a.get("seqInfos"));this._fireEvent(this.onRequestAddSeqInfos(),{seqInfos:c,result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._removeSeqNames=function(a){var b=new epiviz.events.EventResult,c=JSON.parse(a.get("seqNames"));this._fireEvent(this.onRequestRemoveSeqNames(),{seqNames:c,result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._addChart=function(a){var b=new epiviz.events.EventResult,c,d,e;d=this.id();if(void 0!=a.get("measurements")){c=new epiviz.measurements.MeasurementSet;e=JSON.parse(a.get("measurements"));for(var f=0;f<e.length;++f)null!=e[f].dataprovider&&0!=e[f].dataprovider.length&&(d=e[f].dataprovider),c.add(new epiviz.measurements.Measurement(e[f].id,e[f].name,e[f].type,e[f].datasourceId,e[f].datasourceGroup,d,null,e[f].defaultChartType,e[f].annotation,e[f].minValue,
e[f].maxValue,e[f].metadata))}d=a.get("datasource");e=a.get("datasourceGroup")||d;this._fireEvent(this.onRequestAddChart(),{type:a.get("type"),visConfigSelection:new epiviz.ui.controls.VisConfigSelection(c,d,e),result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._removeChart=function(a){var b=a.get("chartId"),c=new epiviz.events.EventResult;this._fireEvent(this.onRequestRemoveChart(),{id:b,result:c});a=new epiviz.data.Response(a.id(),c);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._clearDatasourceGroupCache=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestClearDatasourceGroupCache(),{datasourceGroup:a.get("datasourceGroup"),result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._flushCache=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestFlushCache(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._navigate=function(a){var b=JSON.parse(a.get("range")),c=new epiviz.events.EventResult;this._fireEvent(this.onRequestNavigate(),{range:epiviz.datatypes.GenomicRange.fromStartEnd(b.seqName,b.start,b.end),result:c});a=new epiviz.data.Response(a.id(),c);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._redraw=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestRedraw(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};epiviz.data.WebsocketDataProvider.prototype._getCurrentLocation=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestCurrentLocation(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._writeDebugMsg=function(a){var b=a.get("msg"),c=document.createElement("pre");c.innerHTML=b.replace(/&/g,"&amp;").replace(/\\</g,"&lt;");a=new epiviz.data.Response(a.id(),{msg:"that msg"});document.getElementById("chart-container").appendChild(c);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._printWorkspace=function(a){var b=a.get("chartId"),c=a.get("fileName"),d=a.get("fileType"),e=new epiviz.events.EventResult;this._fireEvent(this.onRequestPrintWorkspace(),{chartId:b,fileName:c,fileType:d,result:e});a=new epiviz.data.Response(a.id(),e);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._setChartSettings=function(a){var b=a.get("chartId"),c=a.get("settings"),d=a.get("colorMap"),d=new epiviz.ui.charts.ColorPalette(d),e=new epiviz.events.EventResult;this._fireEvent(this.onRequestSetChartSettings(),{chartId:b,settings:c,colorMap:d,result:e});a=new epiviz.data.Response(a.id(),e);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._getChartSettings=function(a){var b=a.get("chartId"),c=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{chartId:b,result:c});a=new epiviz.data.Response(a.id(),c);this._sendMessage(JSON.stringify(a.raw()))};epiviz.data.WebsocketDataProvider.prototype._getAvailableCharts=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._registerAvailableCharts=function(){var a=new epiviz.events.EventResult;this._fireEvent(this.onRequestGetChartSettings(),{result:a});request=epiviz.data.Request.createRequest({action:epiviz.data.Request.Action.REGISTER_CHART_TYPES,data:a.value});a=JSON.stringify(request.raw());this._callbacks[request.id()]=function(a){};this._sendMessage(a)};
epiviz.data.WebsocketDataProvider.prototype.updateChartSettings=function(a,b){var c=JSON.stringify(a.raw());this._callbacks[a.id()]=b;this._sendMessage(c)};epiviz.data.WebsocketDataProvider.prototype._loadWorkspace=function(a){var b=a.get("workspaceId"),c=new epiviz.events.EventResult;this._fireEvent(this.onRequestLoadWorkspace(),{workspace:b});a=new epiviz.data.Response(a.id(),c);this._sendMessage(JSON.stringify(a.raw()))};
epiviz.data.WebsocketDataProvider.prototype._uiStatus=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestUiStatus(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};epiviz.data.WebsocketDataProvider.prototype._loadMeasurements=function(a){var b=new epiviz.events.EventResult;this._fireEvent(this.onRequestLoadMeasurements(),{result:b});a=new epiviz.data.Response(a.id(),b);this._sendMessage(JSON.stringify(a.raw()))};epiviz.data.WebServerDataProvider=function(a,b){epiviz.data.DataProvider.call(this,a||epiviz.Config.DEFAULT_DATA_PROVIDER_ID);this._serverEndpoint=b||epiviz.data.WebServerDataProvider.DEFAULT_SERVER_ENDPOINT};epiviz.data.WebServerDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype);epiviz.data.WebServerDataProvider.constructor=epiviz.data.WebServerDataProvider;epiviz.data.WebServerDataProvider.DEFAULT_SERVER_ENDPOINT="data/main.php";
epiviz.data.WebServerDataProvider.prototype.getData=function(a,b,c){a.isEmpty()||(a.method()==epiviz.data.Request.Method.GET?(a=sprintf("%s?%s",this._serverEndpoint,a.joinArgs()),epiviz.data.WebServerDataProvider.makeGetRequest(a,function(a){b(epiviz.data.Response.fromRawObject(a))},function(a,b,f){c(a,b,f)})):epiviz.data.WebServerDataProvider.makePostRequest(this._serverEndpoint,a.joinArgs(),function(a){b(epiviz.data.Response.fromRawObject(a))},function(a,b,f){c(a,b,f)}))};
epiviz.data.WebServerDataProvider.makeGetRequest=function(a,b,c){a=$.ajax({type:"get",url:a,dataType:"json",async:!0,cache:!1,processData:!0});a.done(function(a){b(a)});a.fail(function(a,b,f){c(a,b,f)});a.always(function(){})};epiviz.data.WebServerDataProvider.makePostRequest=function(a,b,c,d){a=$.ajax({type:"post",url:a,data:b,dataType:"json",async:!0,cache:!1,processData:!0});a.done(function(a,b,d){c(a)});a.fail(function(a,b,c){console.error("The following error occured: "+b,c);d(a,b,c)});a.always(function(){})};epiviz.data.ShinyDataProvider=function(a){epiviz.data.DataProvider.call(this,a||epiviz.Config.DEFAULT_DATA_PROVIDER_ID);this._shinycallbacks={};this._requestQueue=[];this._registered=this._requestInProgress=!1;this.providerId=Date.now().toString();Shiny.onInputChange("registerProvider",{id:this.providerId,".nounce":Math.random()});Shiny.addCustomMessageHandler(this.providerId+".callback",this.callbackHandler.bind(this));Shiny.addCustomMessageHandler(this.providerId+".registration",this.registrationHandler.bind(this))};
epiviz.data.ShinyDataProvider.prototype._initialize=function(){Shiny.addCustomMessageHandler(this.providerId+".callback",this.callbackHandler.bind(this));Shiny.addCustomMessageHandler(this.providerId+".registration",this.registrationHandler.bind(this))};epiviz.data.ShinyDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype);epiviz.data.ShinyDataProvider.constructor=epiviz.data.ShinyDataProvider;
epiviz.data.ShinyDataProvider.prototype.getData=function(a,b){if(!a.isEmpty())if(0==Object.keys(this._shinycallbacks).length&&this._registered){var c=Date.now(),d=a.id();this._shinycallbacks[c]=[b,d];d={};d._method=a._args.action;d._reqid=c;d._args=a._args;d[".nounce"]=Math.random();Shiny.onInputChange(this.providerId,d)}else this._requestQueue.push([a,b])};
epiviz.data.ShinyDataProvider.prototype.registrationHandler=function(a){a.success&&(this._registered=!0,0<this._requestQueue.length&&(a=this._requestQueue.shift(),this.getData(a[0],a[1])))};
epiviz.data.ShinyDataProvider.prototype.callbackHandler=function(a){a.data=JSON.parse(a.data);"epivizr"==a.jsonType&&(a.data.values=JSON.parse(a.data.values),a.data.rows=JSON.parse(a.data.rows),null==a.data.rows.values.metadata&&(a.data.rows.values.metadata={}));a=epiviz.data.Response.fromRawObject(a);var b=a.id(),c=this._shinycallbacks[b][0];a._id=this._shinycallbacks[b][1];delete this._shinycallbacks[b];0<this._requestQueue.length&&(b=this._requestQueue.shift(),this.getData(b[0],b[1]));c(a)};epiviz.Config=function(a){this.workspacesDataProvider=this.dataProviders=this.defaultWorkspaceSettings=this.navigationDelay=this.navigationStepRatio=this.zoomoutRatio=this.zoominRatio=this.chartSaverLocation=this.dataServerLocation=null;this.useCache=!0;this.useCookie=null;this.cacheUpdateIntervalMilliseconds=3E4;this.colorPalettesMap=this.colorPalettes=this.clustering=this.chartCustomSettings=this.chartSettings=this.chartTypes=this.maxSearchResults=null;if(a){for(var b in a)a.hasOwnProperty(b)&&
(this[b]=a[b]);if("epivizr_standalone"!=a.configType&&(b=epiviz.ui.WebArgsManager.WEB_ARGS["websocket-host"])&&b.length)for(var c=0;c<b.length;++c)this.dataProviders.push(sprintf("epiviz.data.WebsocketDataProvider,%s,%s",epiviz.data.WebsocketDataProvider.DEFAULT_ID+"-"+c,b[c]))}var d={};this.colorPalettes.forEach(function(a){d[a.id()]=a});this.colorPalettesMap=d;"default"!=a.configType&&(this.useCookie=epiviz.ui.WebArgsManager.WEB_ARGS.useCookie)};epiviz.Config.SETTINGS={};
epiviz.Config.DEFAULT_DATA_PROVIDER_ID="umd";epiviz.Config.DEFAULT_WORKSPACE_NAME="Default Workspace";epiviz.Config.EPIVIZ_V1_COLORS="#025167 #e7003e #ffcd00 #057d9f #970026 #ffe373 #ff8100".split(" ");epiviz.Config.COLORS_BRIGHT="#1859a9 #ed2d2e #008c47 #010101 #f37d22 #662c91 #a11d20 #b33893".split(" ");epiviz.Config.COLORS_LIGHT="#b8d2eb #f2aeac #d8e4aa #cccccc #f2d1b0 #d4b2d3 #ddb8a9 #ebbfd9".split(" ");epiviz.Config.COLORS_MEDIUM="#599ad3 #f1595f #79c36a #727272 #f9a65a #9e66ab #cd7058 #d77fb3".split(" ");
epiviz.Config.COLORS_D3_CAT10="#1f77b4 #ff7f0e #2ca02c #d62728 #9467bd #8c564b #e377c2 #7f7f7f #bcbd22 #17becf".split(" ");epiviz.Config.COLORS_D3_CAT20="#1f77b4 #aec7e8 #ff7f0e #ffbb78 #2ca02c #98df8a #d62728 #ff9896 #9467bd #c5b0d5 #8c564b #c49c94 #e377c2 #f7b6d2 #7f7f7f #c7c7c7 #bcbd22 #dbdb8d #17becf #9edae5".split(" ");epiviz.Config.COLORS_D3_CAT20B="#393b79 #5254a3 #6b6ecf #9c9ede #637939 #8ca252 #b5cf6b #cedb9c #8c6d31 #bd9e39 #e7ba52 #e7cb94 #843c39 #ad494a #d6616b #e7969c #7b4173 #a55194 #ce6dbd #de9ed6".split(" ");
epiviz.Config.COLORS_D3_CAT20C="#3182bd #6baed6 #9ecae1 #c6dbef #e6550d #fd8d3c #fdae6b #fdd0a2 #31a354 #74c476 #a1d99b #c7e9c0 #756bb1 #9e9ac8 #bcbddc #dadaeb #636363 #969696 #bdbdbd #d9d9d9".split(" ");epiviz.Config.VisualizationPropertySettings={WIDTH:"width",HEIGHT:"height",MARGINS:"margins",COLORS:"colors",DECORATIONS:"decorations"};epiviz.data.RequestStack=function(){this._requests=[];this._callbacks={};this._dataMap={}};epiviz.data.RequestStack.prototype.pushRequest=function(a,b){this._requests.push(a);this._callbacks[a.id()]=b};
epiviz.data.RequestStack.prototype.serveData=function(a){if(this._callbacks[a.id()])if(0<this._requests.length&&this._requests[0].id()==a.id()){var b=this._callbacks[a.id()];delete this._callbacks[a.id()];this._requests=this._requests.slice(1);for(b(a.data());0<this._requests.length&&this._requests[0].id()in this._dataMap;)b=this._callbacks[this._requests[0].id()],a=this._dataMap[this._requests[0].id()],delete this._callbacks[this._requests[0].id()],delete this._dataMap[this._requests[0].id()],this._requests=
this._requests.slice(1),b(a)}else this._dataMap[a.id()]=a.data()};epiviz.data.RequestStack.prototype.clear=function(){this._requests=[];this._callbacks={};this._dataMap={}};epiviz.measurements.MeasurementHashtable=function(){this._size=0;this._measurementTree={};this._order=[]};
epiviz.measurements.MeasurementHashtable.prototype.put=function(a,b){if(this.contains(a)){var c=this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()];this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()]={key:a,value:b,index:c.index};this._order[c.index]={key:a,value:b,contained:!0}}else a.dataprovider()in this._measurementTree||(this._measurementTree[a.dataprovider()]={}),a.type()in this._measurementTree[a.dataprovider()]||
(this._measurementTree[a.dataprovider()][a.type()]={}),a.datasourceGroup()in this._measurementTree[a.dataprovider()][a.type()]||(this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]={}),a.datasource().id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]||(this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()]={}),this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()]={key:a,
value:b,index:this._order.length},this._order.push({key:a,value:b,contained:!0}),++this._size};epiviz.measurements.MeasurementHashtable.prototype.get=function(a){return this.contains(a)?this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()].value:null};
epiviz.measurements.MeasurementHashtable.prototype.remove=function(a){if(!this.contains(a))return!1;var b=this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()];delete this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()][a.id()];this._order[b.index].contained=!1;--this._size;return!0};
epiviz.measurements.MeasurementHashtable.prototype.contains=function(a){return a.dataprovider()in this._measurementTree&&a.type()in this._measurementTree[a.dataprovider()]&&a.datasourceGroup()in this._measurementTree[a.dataprovider()][a.type()]&&a.datasource().id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()]?a.id()in this._measurementTree[a.dataprovider()][a.type()][a.datasourceGroup()][a.datasource().id()]:!1};
epiviz.measurements.MeasurementHashtable.prototype.clear=function(){this._size=0;this._measurementTree={};this._order=[]};epiviz.measurements.MeasurementHashtable.prototype.isEmpty=function(){return 0==this._size};epiviz.measurements.MeasurementHashtable.prototype.size=function(){return this._size};epiviz.measurements.MeasurementHashtable.prototype.foreach=function(a,b){for(var c=this.iterator(),d=c.first(),e=0;null!==d&&(b&&!b(d.key)||!a(d.key,d.value,e));d=c.next(),++e);};
epiviz.measurements.MeasurementHashtable.prototype.first=function(){return this.iterator().first()};epiviz.measurements.MeasurementHashtable.prototype.sorted=function(a){var b=new epiviz.measurements.MeasurementHashtable,c=this._order.slice(0);c.sort(function(b,c){return a(b.key,c.key)});c.forEach(function(a){a.contained&&b.put(a.key,a.value)});return b};epiviz.measurements.MeasurementHashtable.prototype.keys=function(){var a=[];this._order.forEach(function(b){b.contained&&a.push(b.key)});return a};
epiviz.measurements.MeasurementHashtable.prototype.iterator=function(){return new epiviz.measurements.MeasurementHashtable.Iterator(this)};epiviz.measurements.MeasurementHashtable.prototype.toString=function(){var a={};this.foreach(function(b,c){for(var d=b.id(),e=2;d in a;)d=b.id()+" ("+e++ +")";a[d]=c});return JSON.stringify(a)};epiviz.measurements.MeasurementHashtable.Iterator=function(a){this._parent=a;this._lastIndex=null};
epiviz.measurements.MeasurementHashtable.Iterator.prototype.first=function(){if(0==this._parent.size())return null;for(var a=0;a<this._parent._order.length;++a)if(this._parent._order[a].contained)return this._lastIndex=a,{key:this._parent._order[a].key,value:this._parent._order[a].value};throw Error("Inconsistent MeasurementHashtable with size() > 0 and no first element");};
epiviz.measurements.MeasurementHashtable.Iterator.prototype.next=function(){if(null===this._lastIndex)throw Error("Iterator.next() called before calling Iterator.first()");for(var a=this._lastIndex+1;a<this._parent._order.length;++a)if(this._parent._order[a].contained)return this._lastIndex=a,{key:this._parent._order[a].key,value:this._parent._order[a].value};this._lastIndex=this._parent._order.length;return null};
epiviz.measurements.MeasurementHashtable.prototype.split=function(a){var b={};this.foreach(function(c,d){var e=a(c),f=b[e];void 0==f&&(f=new epiviz.measurements.MeasurementSet,b[e]=f);f.add(c)});return b};epiviz.datatypes.MeasurementGenomicData=function(){};epiviz.datatypes.MeasurementGenomicData.prototype.get=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.getRow=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.measurement=function(){throw Error("unimplemented abstract method");};
epiviz.datatypes.MeasurementGenomicData.prototype.globalStartIndex=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.globalEndIndex=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.size=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.getByGlobalIndex=function(a){throw Error("unimplemented abstract method");};
epiviz.datatypes.MeasurementGenomicData.prototype.getRowByGlobalIndex=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicData.prototype.binarySearchStarts=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.MeasurementGenomicDataArrayWrapper=function(a,b,c){this._measurement=a;this._items=b;this._itemsByGlobalIndex=c};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.get=function(a){return this._items&&0<=a&&a<this._items.length?this._items[a]:null};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getRow=function(a){return this._items&&0<=a&&a<this._items.length?this._items[a].rowItem:null};
epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.measurement=function(){return this._measurement};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.globalStartIndex=function(){return this._items&&this._items.length?this._items[0].globalIndex:null};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.globalEndIndex=function(){return this._items&&this._items.length?this._items[this._items.length-1].globalIndex+1:null};
epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.size=function(){return this._items?this._items.length:0};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getByGlobalIndex=function(a){return this._itemsByGlobalIndex&&a in this._itemsByGlobalIndex?this._itemsByGlobalIndex[a]:null};epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.getRowByGlobalIndex=function(a){return this._itemsByGlobalIndex&&a in this._itemsByGlobalIndex?this._itemsByGlobalIndex[a].rowItem:null};
epiviz.datatypes.MeasurementGenomicDataArrayWrapper.prototype.binarySearchStarts=function(a){if(!this._items||!this._items.length||this._items[0].rowItem.start()>a.end()||this._items[this._items.length-1].rowItem.start()<a.start())return{index:null,length:0};for(var b=0,c=this._items.length-1,d,e=null;b<=c;)d=Math.floor(.5*(b+c)),this._items[d].rowItem.start()==a.start()?(e=d,c=d-1):this._items[d].rowItem.start()<a.start()?b=d+1:c=d-1;null===e&&(e=b);for(var b=0,c=this._items.length-1,f=null;b<=c;)d=
Math.floor(.5*(b+c)),this._items[d].rowItem.start()==a.end()?(f=d,b=d+1):this._items[d].rowItem.start()<a.end()?b=d+1:c=d-1;null===f&&(f=b-1);return{index:e,length:f+1-e}};epiviz.datatypes.GenomicData=function(){};epiviz.datatypes.GenomicData.prototype.ready=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.isReady=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.firstSeries=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.getSeries=function(a){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicData.prototype.get=function(a,b){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.getRow=function(a,b){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.measurements=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.globalStartIndex=function(a){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicData.prototype.globalEndIndex=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.size=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.getByGlobalIndex=function(a,b){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.getRowByGlobalIndex=function(a,b){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicData.prototype.binarySearchStarts=function(a,b){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.prototype.foreach=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.ValueItem=function(a,b,c,d,e){this.globalIndex=a;this.rowItem=b;this.value=0===c||c?c:null;this.measurement=d;this.valueAnnotation=e};epiviz.datatypes.GenomicData.RowItem=function(){};
epiviz.datatypes.GenomicData.RowItem.prototype.id=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.seqName=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.start=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.end=function(){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicData.RowItem.prototype.globalIndex=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.strand=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.metadata=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicData.RowItem.prototype.rowMetadata=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.MapGenomicData=function(a){this._measurements=(this._map=a)?a.keys():null;this._mapLoaded=new epiviz.deferred.Deferred;this._map&&this._mapLoaded.resolve()};epiviz.datatypes.MapGenomicData.prototype.ready=function(a){this._mapLoaded.done(a)};epiviz.datatypes.MapGenomicData.prototype.isReady=function(){return this._mapLoaded.state()==epiviz.deferred.Deferred.State.RESOLVED};
epiviz.datatypes.MapGenomicData.prototype._setMap=function(a){if(this._map)throw Error("MapGenomicData is immutable");if(this._map=a)this._measurements=a.keys(),this._mapLoaded.resolve()};epiviz.datatypes.MapGenomicData.prototype.firstSeries=function(){return 0==this._map.size()?null:this._map.first().value};epiviz.datatypes.MapGenomicData.prototype.getSeries=function(a){return this._map.get(a)};epiviz.datatypes.MapGenomicData.prototype.get=function(a,b){var c=this._map.get(a);return c?c.get(b):null};
epiviz.datatypes.MapGenomicData.prototype.getRow=function(a,b){var c=this._map.get(a);return c?c.getRow(b):null};epiviz.datatypes.MapGenomicData.prototype.measurements=function(){return this._measurements};epiviz.datatypes.MapGenomicData.prototype.globalStartIndex=function(a){return(a=this._map.get(a))?a.globalStartIndex():null};epiviz.datatypes.MapGenomicData.prototype.globalEndIndex=function(a){return(a=this._map.get(a))?a.globalEndIndex():null};
epiviz.datatypes.MapGenomicData.prototype.size=function(a){return(a=this._map.get(a))?a.size():null};epiviz.datatypes.MapGenomicData.prototype.getByGlobalIndex=function(a,b){var c=this._map.get(a);return c?c.getByGlobalIndex(b):null};epiviz.datatypes.MapGenomicData.prototype.getRowByGlobalIndex=function(a,b){var c=this._map.get(a);return c?c.getRowByGlobalIndex(b):null};
epiviz.datatypes.MapGenomicData.prototype.binarySearchStarts=function(a,b){var c=this._map.get(a);return c?c.binarySearchStarts(b):{index:null,length:0}};epiviz.datatypes.MapGenomicData.prototype.foreach=function(a){this._map.foreach(function(b,c,d){a(b,c,d)})};epiviz.datatypes.PartialSummarizedExperiment=function(){this._rowData=null;this._values=new epiviz.measurements.MeasurementHashtable};epiviz.datatypes.PartialSummarizedExperiment.prototype.ranges=function(){return this.rowData()};epiviz.datatypes.PartialSummarizedExperiment.prototype.rowData=function(){return this._rowData};
epiviz.datatypes.PartialSummarizedExperiment.prototype.addRowData=function(a){a&&(!this._rowData||this._rowData.boundaries().seqName()!=a.boundaries().seqName()||this._rowData.boundaries().start()>a.boundaries().end()||this._rowData.boundaries().end()<a.boundaries().start()||a.measurement().type()==epiviz.measurements.Measurement.Type.UNORDERED?this._rowData=a:this._rowData=this._rowData.merge(a))};
epiviz.datatypes.PartialSummarizedExperiment.prototype.addValues=function(a){if(a){var b=this._values.get(a.measurement());!b||b.boundaries().seqName()!=a.boundaries().seqName()||b.boundaries().start()>a.boundaries().end()||b.boundaries().end()<a.boundaries().start()||a.measurement().type()==epiviz.measurements.Measurement.Type.UNORDERED?this._values.put(a.measurement(),a):this._values.put(a.measurement(),b.merge(a))}};
epiviz.datatypes.PartialSummarizedExperiment.prototype.trim=function(a){var b=new epiviz.datatypes.PartialSummarizedExperiment;this._rowData&&b.addRowData(this._rowData.trim(a));b.rowData()&&this._values.foreach(function(c,d){b.addValues(d.trim(a,b.rowData().globalStartIndex(),b.rowData().size()))});return b};epiviz.datatypes.PartialSummarizedExperiment.prototype.values=function(a){return this._values.get(a)};
epiviz.datatypes.PartialSummarizedExperiment.prototype.calcMinGlobalIndex=function(){var a=this._rowData?this._rowData.globalStartIndex():null;this._values&&this._values.foreach(function(b,c){c&&void 0!=c.globalStartIndex()&&(void 0==a||a>c.globalStartIndex())&&(a=c.globalStartIndex())});return a};
epiviz.datatypes.PartialSummarizedExperiment.prototype.calcMaxGlobalIndex=function(){var a=this._rowData&&void 0!=this._rowData.globalStartIndex()?this._rowData.globalStartIndex()+this._rowData.size():null;this._values&&this._values.foreach(function(b,c){c&&void 0!=c.globalStartIndex()&&(void 0==a||a<c.globalStartIndex()+c.size())&&(a=c.globalStartIndex()+c.size())});return a};
epiviz.datatypes.PartialSummarizedExperiment.prototype.toString=function(){var a="",b=this.calcMinGlobalIndex(),c=this.calcMaxGlobalIndex(),a=a+sprintf("%25s",this._rowData&&this._rowData.measurement()?this._rowData.measurement().name().substr(0,22):"[undefined datasource]"),d,e,f,g,h;this._rowData&&this._rowData.boundaries()?(d=this._rowData.boundaries().seqName(),e=this._rowData.boundaries().start(),f=this._rowData.boundaries().end(),g=void 0!=this._rowData.globalStartIndex()?this._rowData.globalStartIndex():
"*",h=this._rowData.size()):(d=e=f=g="*",h=0);var a=a+sprintf(" [%6s%10s%10s] [globalStartIndex: %10s] [size: %7s]\n",d,e,f,g,h),m=sprintf("%15s%15s%15s%15s%15s","id","idx","chr","start","end");this._values&&this._values.foreach(function(b,c){a+=sprintf("%25s",b.name().substr(0,22));c&&c.boundaries()?(d=c.boundaries().seqName(),e=c.boundaries().start(),f=c.boundaries().end()):d=e=f="*";a+=sprintf(" [%6s%10s%10s] [globalStartIndex: %10s] [size: %7s]\n",d,e,f,void 0!=c.globalStartIndex()?c.globalStartIndex():
"*",c.size());m+=sprintf("%25s",b.name().substr(0,22))});for(var a=a+(m+"\n"),l=b;l<c;++l)this._rowData&&void 0!=this._rowData.globalStartIndex()&&this._rowData.globalStartIndex()<=l&&this._rowData.globalStartIndex()+this._rowData.size()>l?(g=this._rowData.getByGlobalIndex(l),b=g.id(),d=g.seqName(),e=g.start(),f=g.end()):b=d=e=f="*",a+=sprintf("%15s%15s%15s%15s%15s",b,l,d,e,f),this._values&&this._values.foreach(function(b,c){a=c&&void 0!=c.globalStartIndex()&&c.globalStartIndex()<=l&&c.globalStartIndex()+
c.size()>l?a+sprintf("%25s",c.getByGlobalIndex(l)):a+sprintf("%25s","*")}),a+="\n";return a};epiviz.data.Cache=function(a,b){this._config=a;this._dataProviderFactory=b;this._data={};this._measurementRequestStackMap=new epiviz.measurements.MeasurementHashtable;this._measurementPendingRequestsMap=new epiviz.measurements.MeasurementHashtable;this._lastRequest=null;if(0<this._config.cacheUpdateIntervalMilliseconds){var c=this;this._intervalId=window.setTimeout(function(){c._clearUnneededData()},a.cacheUpdateIntervalMilliseconds)}};
epiviz.data.Cache.prototype.getData=function(a,b,c,d){var e=epiviz.measurements.Measurement.Type,f=this;this._lastRequest=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),a.start()-a.width(),a.end()+a.width(),a.genome());0<this._config.cacheUpdateIntervalMilliseconds&&(window.clearInterval(this._intervalId),this._intervalId=window.setTimeout(function(){f._clearUnneededData()},this._config.cacheUpdateIntervalMilliseconds));var g=this._extractComputedMeasurements(b);this._updateComputedMeasurementsData(g);
this._serveAvailableData(a,b,c);g=[new epiviz.datatypes.GenomicRange(a.seqName(),Math.max(a.start()-a.width(),0),a.end()+a.width()-Math.max(a.start()-a.width(),0),a.genome())];this._calcMeasurementNeededRanges(g,b).foreach(function(g,m){var h=f._measurementRequestStackMap.get(g);h||(h=new epiviz.data.RequestStack,f._measurementRequestStackMap.put(g,h));var p;if(0==m.length)p=epiviz.data.Request.emptyRequest(),h.pushRequest(p,function(){f._handleResponse(c,a,b,p,null,g,null)}),h.serveData(new epiviz.data.Response(p.id(),
{}));else for(var n=0;n<m.length;++n){p=g.type()==e.RANGE?epiviz.data.Request.getRows(g,m[n]):epiviz.data.Request.getValues(g,m[n]);(function(d,e){h.pushRequest(e,function(h){f._handleResponse(c,a,b,e,d,g,h)})})(m[n],p);var t=f._measurementPendingRequestsMap.get(g);t||(t={},f._measurementPendingRequestsMap.put(g,t));t[p.id()]=m[n];(f._dataProviderFactory.get(g.dataprovider())||f._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(p,function(a){h.serveData(a)},function(a,
b,c){d(a,b,c)})}})};
epiviz.data.Cache.prototype._handleResponse=function(a,b,c,d,e,f,g){if(e){if(f.type()==epiviz.measurements.Measurement.Type.RANGE)e=new epiviz.datatypes.GenomicRangeArray(f,e,g.globalStartIndex,g.values,g.useOffset);else{var h=f.datasource();0==Object.keys(g.rows.values.metadata).length&&delete g.rows.values.metadata;var m=new epiviz.datatypes.GenomicRangeArray(h,e,g.rows.globalStartIndex,g.rows.values,g.rows.useOffset);this._mergeData(h,m);h=[];0<Object.keys(g.values.values).length&&Object.keys(g.values.values).includes(f.id())&&
(h=g.values.values[f.id()]);e=new epiviz.datatypes.FeatureValueArray(f,e,g.values.globalStartIndex,h)}this._mergeData(f,e)}e=this._extractComputedMeasurements(c);this._updateComputedMeasurementsData(e);(f=this._measurementPendingRequestsMap.get(f))&&delete f[d.id()];this._serveAvailableData(b,c,a)};
epiviz.data.Cache.prototype._serveAvailableData=function(a,b,c){var d=epiviz.measurements.Measurement.Type,e=this,f=[],g;for(g in b)if(b.hasOwnProperty(g)){var h=b[g],m=!0,l=new epiviz.measurements.MeasurementHashtable;(function(b){h.foreach(function(c){var f=e._data[c.datasourceGroup()];if(!f||!f.rowData()||c.type()==d.FEATURE&&!f.values(c))return m=!1,!0;var g=f.rowData(),f=c.type()==d.FEATURE?f.values(c):null,g=a.subtract(g.boundaries());if(g.length||f&&(g=a.subtract(f.boundaries()),g.length))return m=
!1,!0;b.put(c,new epiviz.datatypes.MeasurementGenomicDataWrapper(c,e._data[c.datasourceGroup()]));return!1})})(l);m&&(c(g,new epiviz.datatypes.MapGenomicData(l)),f.push(g))}for(c=0;c<f.length;++c)delete b[f[c]]};
epiviz.data.Cache.prototype._calcMeasurementNeededRanges=function(a,b){var c=epiviz.measurements.Measurement.Type,d=this,e=new epiviz.measurements.MeasurementHashtable,f;for(f in b)if(b.hasOwnProperty(f)){var g=new epiviz.measurements.MeasurementSet;(function(a){b[f].foreach(function(b){b.componentMeasurements().foreach(function(b){a.add(b)})})})(g);g.foreach(function(b){var f;f=d._data[b.datasourceGroup()];if(!f||b.type()==c.FEATURE&&!f.values(b))f=a.slice(0);else{var g=b.type()==c.FEATURE?f.values(b):
f.rowData();if(g){f=[];for(var g=g.boundaries(),h=0;h<a.length;++h)f=f.concat(a[h].subtract(g))}else f=a.slice(0)}if(g=d._measurementPendingRequestsMap.get(b))for(h=0;h<f.length;++h)for(var n in g)if(g.hasOwnProperty(n)){var t=f[h].subtract(g[n]);Array.prototype.splice.apply(f,[h,1].concat(t));if(0==t.length){--h;break}if(h>=f.length)break}e.put(b,f)})}return e};
epiviz.data.Cache.prototype._extractComputedMeasurements=function(a){var b=new epiviz.measurements.MeasurementSet,c;for(c in a)a.hasOwnProperty(c)&&a[c].foreach(function(a){a.isComputed()&&b.add(a)});return b};epiviz.data.Cache.prototype._mergeData=function(a,b){var c=epiviz.measurements.Measurement.Type,d=this._data[a.datasourceGroup()];d||(d=new epiviz.datatypes.PartialSummarizedExperiment,this._data[a.datasourceGroup()]=d);a.type()==c.RANGE?d.addRowData(b):d.addValues(b)};
epiviz.data.Cache.prototype._clearUnneededData=function(){if(this._lastRequest){console.log(sprintf("Clearing data outside of range [%7s%10s%10s]",this._lastRequest.seqName(),this._lastRequest.start(),this._lastRequest.end()));var a={},b;for(b in this._data)this._data.hasOwnProperty(b)&&(a[b]=this._data[b].trim(this._lastRequest));this._data=a}};
epiviz.data.Cache.prototype._updateComputedMeasurementsData=function(a){var b=this,c=epiviz.datatypes.GenomicRange;a.foreach(function(a){var d=b._data[a.datasourceGroup()];if(!d)return!1;var f=a.componentMeasurements(),g=null,h=null,m=null;f.foreach(function(a){a=d.values(a);if(!a||!a.boundaries())return m=h=g=null,!0;if(null===m)return g=a.globalStartIndex(),h=a.size(),m=a.boundaries(),null===g;if(a.boundaries().seqName()!=m.seqName())return h=0,!0;if(g<a.globalStartIndex()){h-=a.globalStartIndex()-
g;if(0>h)return h=0,!0;g=a.globalStartIndex();var b=a.boundaries().start(),e=m.end();h>a.size()&&(h=a.size(),e=a.boundaries().end());m=c.fromStartEnd(m.seqName(),b,e,m.genome())}else if(b=a.size()-g+a.globalStartIndex(),h>b){h=b;if(0>=h)return h=0,!0;m=c.fromStartEnd(m.seqName(),m.start(),a.boundaries().end(),m.genome())}return 0==h?!0:!1});if(null===m)return!1;var l=d.values(a);if(l&&(null===g||l.globalStartIndex()<g&&l.globalStartIndex()+l.size()>g+h))return!1;var p=new epiviz.measurements.MeasurementHashtable,
n=null;if(l&&l.size())return f.foreach(function(a){var b=d.values(a),c=[];if(null!==g)for(var e=g;e<l.globalStartIndex();++e)c.push(b.getByGlobalIndex(e));p.put(a,c)}),n=new epiviz.datatypes.FeatureValueArray(a,c.fromStartEnd(m.seqName(),m.start(),l.boundaries().start()),g,a.evaluateArr(p),m.genome()),b._mergeData(a,n),p=new epiviz.measurements.MeasurementHashtable,f.foreach(function(a){var b=d.values(a),c=[];if(null!==g)for(var e=l.globalStartIndex()+l.size();e<g+h;++e)c.push(b.getByGlobalIndex(e));
p.put(a,c)}),n=new epiviz.datatypes.FeatureValueArray(a,c.fromStartEnd(m.seqName(),l.boundaries().end(),m.end(),m.genome()),l.globalStartIndex()+l.size(),a.evaluateArr(p)),b._mergeData(a,n),!1;p=new epiviz.measurements.MeasurementHashtable;f.foreach(function(a){var b=d.values(a),c=[];if(null!==g)for(var e=g;e<g+h;++e)c.push(b.getByGlobalIndex(e));p.put(a,c)});n=new epiviz.datatypes.FeatureValueArray(a,m,g,a.evaluateArr(p));b._mergeData(a,n);return!1})};
epiviz.data.Cache.prototype.flush=function(){this._data={};this._measurementRequestStackMap.foreach(function(a,b){b.clear()});this._measurementPendingRequestsMap.clear()};
epiviz.data.Cache.prototype.clearDatasourceGroupCache=function(a){delete this._data[a];this._measurementRequestStackMap.foreach(function(b,c){b.datasourceGroup()==a&&c.clear()});var b=[];this._measurementPendingRequestsMap.foreach(function(c,e){c.datasourceGroup()==a&&b.push(c)});for(var c=0;c<b.length;++c)this._measurementPendingRequestsMap.put(b[c],{})};epiviz.data.EmptyResponseDataProvider=function(){epiviz.data.DataProvider.call(this,epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)};epiviz.data.EmptyResponseDataProvider.prototype=epiviz.utils.mapCopy(epiviz.data.DataProvider.prototype);epiviz.data.EmptyResponseDataProvider.constructor=epiviz.data.EmptyResponseDataProvider;epiviz.data.EmptyResponseDataProvider.DEFAULT_ID="empty";
epiviz.data.EmptyResponseDataProvider.prototype.getData=function(a,b){var c=a.id();switch(a.get("action")){case epiviz.data.Request.Action.GET_ROWS:b(epiviz.data.Response.fromRawObject({data:{values:{id:null,start:[],end:[],strand:[],metadata:{my_metadata:[]}},globalStartIndex:null,useOffset:!1},requestId:c}));break;case epiviz.data.Request.Action.GET_VALUES:b(epiviz.data.Response.fromRawObject({data:{values:[],globalStartIndex:null},requestId:c}));break;case epiviz.data.Request.Action.GET_MEASUREMENTS:b(epiviz.data.Response.fromRawObject({requestId:a.id(),
data:{id:[],name:[],type:[],datasourceId:[],datasourceGroup:[],defaultChartType:[],annotation:[],minValue:[],maxValue:[],metadata:[]}}));break;case epiviz.data.Request.Action.GET_SEQINFOS:b(epiviz.data.Response.fromRawObject({requestId:a.id(),data:[]}));break;case epiviz.data.Request.Action.SEARCH:b(epiviz.data.Response.fromRawObject({requestId:a.id(),data:[]}));break;case epiviz.data.Request.Action.SAVE_WORKSPACE:b(epiviz.data.Response.fromRawObject({requestId:a.id(),data:[]}));break;case epiviz.data.Request.Action.DELETE_WORKSPACE:b(epiviz.data.Response.fromRawObject({requestId:a.id(),
data:[]}));break;case epiviz.data.Request.Action.GET_WORKSPACES:b(epiviz.data.Response.fromRawObject({requestId:a.id(),data:[]}));break;default:epiviz.data.DataProvider.prototype.getData.call(this,a,b)}};epiviz.data.DataProviderFactory=function(a){this._config=a;this._providers={};for(var b=this._size=0;b<this._config.dataProviders.length;++b){a=$.isArray(this._config.dataProviders[b])?this._config.dataProviders[b]:this._config.dataProviders[b].split(",");var c=epiviz.utils.evaluateFullyQualifiedTypeName(a[0]);c&&(a=epiviz.utils.applyConstructor(c,a.slice(1)),this._providers[a.id()]=a,++this._size)}a=new epiviz.data.EmptyResponseDataProvider;this._providers[a.id()]=a;++this._size;a=this._config.workspacesDataProvider.split(",");
b=epiviz.utils.evaluateFullyQualifiedTypeName(a[0]);this._workspacesDataProvider=epiviz.utils.applyConstructor(b,a.slice(1))};epiviz.data.DataProviderFactory.prototype.foreach=function(a){for(var b in this._providers)if(this._providers.hasOwnProperty(b)&&a(this._providers[b]))break};epiviz.data.DataProviderFactory.prototype.isEmpty=function(){return!this._size};epiviz.data.DataProviderFactory.prototype.size=function(){return this._size};
epiviz.data.DataProviderFactory.prototype.get=function(a){return a in this._providers?this._providers[a]:null};epiviz.data.DataProviderFactory.prototype.workspacesDataProvider=function(){return this._workspacesDataProvider};epiviz.datatypes.GenomicArray=function(a,b,c,d){this._measurement=a;this._boundaries=b;this._globalStartIndex=c;this._values=d};epiviz.datatypes.GenomicArray.prototype.boundaries=function(){return this._boundaries};epiviz.datatypes.GenomicArray.prototype.globalStartIndex=function(){return this._globalStartIndex};epiviz.datatypes.GenomicArray.prototype.measurement=function(){return this._measurement};
epiviz.datatypes.GenomicArray.prototype.get=function(a){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicArray.prototype.size=function(){throw Error("unimplemented abstract method");};epiviz.datatypes.GenomicArray.prototype.getByGlobalIndex=function(a){return this.get(a-this._globalStartIndex)};epiviz.datatypes.GenomicArray.prototype.concatValues=function(a,b){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicArray.prototype.createNew=function(a,b,c,d){throw Error("unimplemented abstract method");};
epiviz.datatypes.GenomicArray.prototype.merge=function(a){if(!a||void 0==a.boundaries())return this;if(this.boundaries().seqName()!=a.boundaries().seqName()||this.boundaries().start()>a.boundaries().end()||a.boundaries().start()>this.boundaries().end())throw Error("Two genomic arrays can only be merged if they overlap or are in continuation to one another");var b=this.boundaries().start()<a.boundaries().start()?this:a,c=b==this?a:this;if(b.boundaries().end()>=c.boundaries().end())return b;var d=void 0!=
b.globalStartIndex()&&void 0!=c.globalStartIndex()?b.globalStartIndex()+b.size()-c.globalStartIndex():0;a=b.measurement();var e=void 0!=b.globalStartIndex()?b.globalStartIndex():c.globalStartIndex(),f=epiviz.datatypes.GenomicRange.fromStartEnd(b.boundaries().seqName(),b.boundaries().start(),c.boundaries().end(),b.boundaries().genome()),b=b.concatValues(c,d);return this.createNew(a,f,e,b)};epiviz.datatypes.GenomicRangeArray=function(a,b,c,d,e){epiviz.datatypes.GenomicArray.call(this,a,b,c,d);this._id=d.id;this._seqName=d.chr;this._start=d.start;this._end=d.end;this._strand=d.strand||null;this._metadata=d.metadata;this._size=null;if(e)for(a=1;a<this._start.length;++a)this._start[a]+=this._start[a-1],this._end&&(this._end[a]+=this._end[a-1])};epiviz.datatypes.GenomicRangeArray.prototype=epiviz.utils.mapCopy(epiviz.datatypes.GenomicArray.prototype);
epiviz.datatypes.GenomicRangeArray.constructor=epiviz.datatypes.GenomicRangeArray;epiviz.datatypes.GenomicRangeArray.prototype.createNew=function(a,b,c,d){return new epiviz.datatypes.GenomicRangeArray(a,b,c,d)};epiviz.datatypes.GenomicRangeArray.prototype.get=function(a){return 0>a||a>=this.size()?null:new epiviz.datatypes.GenomicRangeArray.RowItemWrapper(this,a)};
epiviz.datatypes.GenomicRangeArray.prototype.size=function(){void 0==this._size&&(this._size=Math.max(this._id?this._id.length:0,this._start?this._start.length:0,this._end?this._end.length:0,this._metadata&&Object.keys(this._metadata).length?Math.max.apply(void 0,$.map(this._metadata,function(a){return a.length})):0));return this._size};
epiviz.datatypes.GenomicRangeArray.prototype.concatValues=function(a,b){var c;if(Array.isArray(this._strand)||Array.isArray(a._strand)||this._strand!=a._strand){c=Array.isArray(this._strand)?this._strand:epiviz.utils.fillArray(this.size(),this._strand);var d=Array.isArray(a._strand)?a._strand:epiviz.utils.fillArray(a.size(),a._strand);c=c.concat(d.slice(b))}else c=this._strand;var d=this._id?this._id.concat(a._id.slice(b)):null,e=this._start.concat(a._start.slice(b)),f=this._end?this._end.concat(a._end.slice(b)):
null,g=this._seqName?this._seqName.concat(a._seqName.slice(b)):null,h={},m;for(m in this._metadata)this._metadata.hasOwnProperty(m)&&(h[m]=this._metadata[m].concat(a._metadata[m].slice(b)));return{id:d,start:e,end:f,strand:c,metadata:h,chr:g}};
epiviz.datatypes.GenomicRangeArray.prototype.trim=function(a){if(void 0==this.globalStartIndex()||!this.size()||!a||!this.boundaries()||this.boundaries().seqName()!=a.seqName())return null;var b=Math.max(this.boundaries().start(),a.start()),c=Math.min(this.boundaries().end(),a.end());if(c<=b)return null;a=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),b,c,a.genome());for(var c=b=-1,d=0;d<this.size();++d)0>b&&this.end(d)>=a.start()&&(b=d),this._start[d]<a.end()&&(c=d+1);if(c<=b)return null;
var e;if(0<=b&&c>=b){d={id:this._id?this._id.slice(b,c):null,start:this._start.slice(b,c),end:this._end?this._end.slice(b,c):null,chr:this._seqName?this._seqName.slice(b,c):null,strand:Array.isArray(this._strand)?this._strand.slice(b,c):this._strand,metadata:{}};for(e in this._metadata)this._metadata.hasOwnProperty(e)&&(d.metadata[e]=this._metadata[e].slice(b,c));e=this.globalStartIndex()+b}else{d={id:this._id?[]:null,start:[],chr:this._seqName?[]:null,end:this._end?[]:null,strand:Array.isArray(this._strand)?
[]:this._strand,metadata:{}};for(e in this._metadata)this._metadata.hasOwnProperty(e)&&(d.metadata[e]=[]);e=null}return new epiviz.datatypes.GenomicRangeArray(this.measurement(),a,e,d)};epiviz.datatypes.GenomicRangeArray.prototype.ranges=function(){return this};epiviz.datatypes.GenomicRangeArray.prototype.foreach=function(a){for(var b=this.size(),c=0;c<b&&!a(this.get(c));++c);};
epiviz.datatypes.GenomicRangeArray.prototype.metadataColumns=function(){return this._metadata?Object.keys(this._metadata):[]};epiviz.datatypes.GenomicRangeArray.prototype.id=function(a){return this._id?this._id[a]:this.globalStartIndex()+a};epiviz.datatypes.GenomicRangeArray.prototype.seqName=function(a){return this._seqName?this._seqName[a]:void 0};epiviz.datatypes.GenomicRangeArray.prototype.start=function(a){return this._start?this._start[a]:void 0};
epiviz.datatypes.GenomicRangeArray.prototype.end=function(a){return this._end?this._end[a]:this.start(a)};epiviz.datatypes.GenomicRangeArray.prototype.strand=function(a){return Array.isArray(this._strand)?this._strand[a]:this._strand};epiviz.datatypes.GenomicRangeArray.prototype.metadata=function(a,b){return this._metadata&&this._metadata[a]?this._metadata[a][b]:null};
epiviz.datatypes.GenomicRangeArray.prototype.rowMetadata=function(a){var b={},c;for(c in this._metadata)this._metadata.hasOwnProperty(c)&&(b[c]=this._metadata[c][a]);return b};
epiviz.datatypes.GenomicRangeArray.prototype.toString=function(){var a,b,c;this.boundaries()?(this.boundaries().genome(),a=this.boundaries().seqName(),b=this.boundaries().start(),c=this.boundaries().end()):a=b=c="*";a=sprintf("%25s",this.measurement().name().substr(0,22))+sprintf(" [%6s%10s%10s]",a,b,c);b=sprintf("%10s:","id");c=sprintf("%10s:","idx");var d=sprintf("%10s:","chr"),e=sprintf("%10s:","start"),f=sprintf("%10s:","end");if(void 0!=this.globalStartIndex())for(var g=this.globalStartIndex();g<
this.globalStartIndex()+this.size();++g){var h=this.getByGlobalIndex(g);b+=sprintf("%10s",h.id());c+=sprintf("%10s",g);d+=sprintf("%10s",h.seqName());e+=sprintf("%10s",h.start());f+=sprintf("%10s",h.end())}return[a,b,c,d,e,f].join("\n")};epiviz.datatypes.GenomicRangeArray.RowItemWrapper=function(a,b){this._index=b;this._parent=a};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.parent=function(){return this._parent};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.id=function(){return this._parent.id(this._index)};
epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.seqName=function(){return this._parent.seqName(this._index)};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.start=function(){return this._parent.start(this._index)};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.end=function(){return this._parent.end(this._index)};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.index=function(){return this._index};
epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.globalIndex=function(){return this._index+this._parent.globalStartIndex()};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.equals=function(a){return a?this==a?!0:a.seqName()==this.seqName()&&a.start()==this.start()&&a.end()==this.end():!1};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.strand=function(){return this._parent.strand(this._index)};
epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.metadata=function(a){return this._parent.metadata(a,this._index)};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.rowMetadata=function(){return this._parent.rowMetadata(this._index)};epiviz.datatypes.GenomicRangeArray.RowItemWrapper.prototype.overlapsWith=function(a){return a?this==a?!0:this.seqName()!=a.seqName()?!1:this.start()<a.end()&&this.end()>a.start():!1};epiviz.datatypes.FeatureValueArray=function(a,b,c,d){var e;!d||$.isArray(d)?(e=d,d={values:d}):e=d.values;epiviz.datatypes.GenomicArray.call(this,a,b,c,e);this._valuesAnnotation=d};epiviz.datatypes.FeatureValueArray.prototype=epiviz.utils.mapCopy(epiviz.datatypes.GenomicArray.prototype);epiviz.datatypes.FeatureValueArray.constructor=epiviz.datatypes.FeatureValueArray;epiviz.datatypes.FeatureValueArray.prototype.createNew=function(a,b,c,d){return new epiviz.datatypes.FeatureValueArray(a,b,c,d)};
epiviz.datatypes.FeatureValueArray.prototype.get=function(a){return this._values[a]};epiviz.datatypes.FeatureValueArray.prototype.getAnnotation=function(a){if(void 0==this._valuesAnnotation)return null;var b={},c;for(c in this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(c)&&(b[c]=this._valuesAnnotation[c][a]);return b};epiviz.datatypes.FeatureValueArray.prototype.size=function(){return this._values?this._values.length:0};
epiviz.datatypes.FeatureValueArray.prototype.concatValues=function(a,b){if(!a||!a.size())return this._valuesAnnotation;this._valuesAnnotation&&this._valuesAnnotation.values||(this._valuesAnnotation={values:[]});var c={},d;for(d in this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(d)&&a._valuesAnnotation.hasOwnProperty(d)&&(c[d]=this._valuesAnnotation[d].concat(a._valuesAnnotation[d].slice(b)));return c};
epiviz.datatypes.FeatureValueArray.prototype.trim=function(a,b,c){if(void 0==this.globalStartIndex()||!this.size()||void 0==b||!a||!this.boundaries()||this.boundaries().seqName()!=a.seqName())return null;var d=Math.max(this.boundaries().start(),a.start()),e=Math.min(this.boundaries().end(),a.end());if(e<=d)return null;a=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),d,e,a.genome());d=Math.max(b,this.globalStartIndex())-this.globalStartIndex();b=Math.min(b+c,this.globalStartIndex()+this.size())-
this.globalStartIndex();if(b<=d)return null;c={};for(var f in this._valuesAnnotation)this._valuesAnnotation.hasOwnProperty(f)&&(c[f]=this._valuesAnnotation[f].slice(d,b));return new epiviz.datatypes.FeatureValueArray(this.measurement(),a,d+this.globalStartIndex(),c)};
epiviz.datatypes.FeatureValueArray.prototype.toString=function(){var a,b,c;this.boundaries()?(a=this.boundaries().seqName(),b=this.boundaries().start(),c=this.boundaries().end()):a=b=c="*";a=sprintf("%25s",this.measurement().name().substr(0,22))+sprintf(" [%6s%10s%10s]",a,b,c);b=sprintf("%10s:","idx");c=sprintf("%10s:","val");if(void 0!=this.globalStartIndex())for(var d=this.globalStartIndex();d<this.globalStartIndex()+this.size();++d){var e=this.getByGlobalIndex(d);b+=sprintf("%10s",d);c+=sprintf("%10s",
e)}return[a,b,c].join("\n")};epiviz.datatypes.MeasurementGenomicDataWrapper=function(a,b){this._measurement=a;this._container=b;this._globalStartIndex=this._size=null};
epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.get=function(a){var b=this._container.rowData(),c,d=this.globalStartIndex(),e=null,f=null,g=c=null,h=this.size();if(!h||a>=h||0>a)return new epiviz.datatypes.GenomicData.ValueItem(g,e,f,this._measurement,c);if(void 0!=d){if(this._measurement.type()==epiviz.measurements.Measurement.Type.FEATURE||this._measurement.type()==epiviz.measurements.Measurement.Type.UNORDERED)c=this._container.values(this._measurement),e=d-c.globalStartIndex()+a,f=c.get(e),
c=c.getAnnotation(e);e=d-b.globalStartIndex()+a;e=b.get(e);g=d+a}return new epiviz.datatypes.GenomicData.ValueItem(g,e,f,this._measurement,c)};epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getRow=function(a){var b=this._container.rowData(),c=this.globalStartIndex(),d=null,e=this.size();if(!e||a>=e||0>a)return d;void 0!=c&&(a=c-b.globalStartIndex()+a,d=b.get(a));return d};epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.measurement=function(){return this._measurement};
epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.globalStartIndex=function(){if(null!==this._globalStartIndex)return this._globalStartIndex;var a,b=this._container.rowData().globalStartIndex();if(null===b)return b;if(this._measurement.type()==epiviz.measurements.Measurement.Type.FEATURE||this._measurement.type()==epiviz.measurements.Measurement.Type.UNORDERED){a=this._container.values(this._measurement);if(!a.globalStartIndex())return a.globalStartIndex();b=Math.max(b,a.globalStartIndex())}return this._globalStartIndex=
b};epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.globalEndIndex=function(){var a=this.globalStartIndex();return null==a?null:a+this.size()};
epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.size=function(){if(null!==this._size)return this._size;var a=this.globalStartIndex();if(void 0==a)return 0;var b=this._container.rowData(),c=this._container.values(this._measurement),b=b.size()-a+b.globalStartIndex();if(this._measurement.type()==epiviz.measurements.Measurement.Type.FEATURE||this._measurement.type()==epiviz.measurements.Measurement.Type.UNORDERED)b=Math.min(b,c.size()-a+c.globalStartIndex());return this._size=Math.max(0,b)};
epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getByGlobalIndex=function(a){var b=this.globalStartIndex();return void 0==b?new epiviz.datatypes.GenomicData.ValueItem(null,null,null,this._measurement,null):this.get(a-b)};epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.getRowByGlobalIndex=function(a){var b=this.globalStartIndex();return void 0==b?null:this.getRow(a-b)};
epiviz.datatypes.MeasurementGenomicDataWrapper.prototype.binarySearchStarts=function(a){var b=this._container.rowData();if(0==this.size()||!b||0==b.size()||b.start(0)>=a.end()||b.start(b.size()-1)<=a.start())return{index:null,length:0};for(var c=0,d=b.size()-1,e,f=null;c<=d;)e=Math.floor(.5*(c+d)),b.start(e)==a.start()?(f=e,d=e-1):b.start(e)<a.start()?c=e+1:d=e-1;null===f&&(f=c);for(var c=0,d=b.size()-1,g=null;c<=d;)e=Math.floor(.5*(c+d)),b.start(e)==a.end()?(g=e,c=e+1):b.start(e)<a.end()?c=e+1:d=
e-1;null===g&&(g=c-1);a=Math.max(f+b.globalStartIndex(),this.globalStartIndex());b=Math.min(g+b.globalStartIndex(),this.globalStartIndex()+this.size()-1);return{index:a-this.globalStartIndex(),length:b-a+1}};epiviz.datatypes.SeqInfo=function(a,b,c,d){this.genome=d;this.seqName=a;this.min=b;this.max=c};epiviz.datatypes.SeqInfo.prototype.raw=function(){return[this.seqName,this.min,this.max,this.genome]};epiviz.datatypes.SeqInfo.fromRawObject=function(a){return new epiviz.datatypes.SeqInfo(a[0],parseFloat(a[1]),parseFloat(a[2]),a[3])};
epiviz.datatypes.SeqInfo.compare=function(a,b){if(a.genome==b.genome){if(a.seqName==b.seqName)return 0;if(void 0==a.seqName)return-1;if(void 0==b.seqName)return 1;var c=a.seqName.replace(/\D/g,""),d=b.seqName.replace(/\D/g,"");return""==c||""==d||!epiviz.utils.stringStartsWith(a.seqName,c)&&!epiviz.utils.stringEndsWith(a.seqName,c)||!epiviz.utils.stringStartsWith(b.seqName,d)&&!epiviz.utils.stringEndsWith(b.seqName,d)?a.seqName<b.seqName?-1:a.seqName>b.seqName?1:0:parseInt(c)-parseInt(d)}c=a.genome.replace(/\D/g,
"");d=b.genome.replace(/\D/g,"");return""==c||""==d||!epiviz.utils.stringStartsWith(a.genome,c)&&!epiviz.utils.stringEndsWith(a.genome,c)||!epiviz.utils.stringStartsWith(b.genome,d)&&!epiviz.utils.stringEndsWith(b.genome,d)?a.genome<b.genome?-1:a.genome>b.genome?1:0:parseInt(c)-parseInt(d)};epiviz.data.DataManager=function(a,b){this._config=a;this._measurements=new epiviz.measurements.MeasurementSet;this._dataProviderFactory=b;this._cache=new epiviz.data.Cache(a,b);this._combinedRequestsStacks={};this._requestAddMeasurements=new epiviz.events.Event;this._requestRemoveMeasurements=new epiviz.events.Event;this._requestAddChart=new epiviz.events.Event;this._requestRemoveChart=new epiviz.events.Event;this._requestPrintWorkspace=new epiviz.events.Event;this._requestLoadWorkspace=new epiviz.events.Event;
this._requestAddSeqInfos=new epiviz.events.Event;this._requestRemoveSeqNames=new epiviz.events.Event;this._requestNavigate=new epiviz.events.Event;this._requestRedraw=new epiviz.events.Event;this._flushCache=new epiviz.events.Event;this._clearDatasourceGroupCache=new epiviz.events.Event;this._requestCurrentLocation=new epiviz.events.Event;this._requestGetChartSettings=new epiviz.events.Event;this._requestSetChartSettings=new epiviz.events.Event;this._requestGetAvailableCharts=new epiviz.events.Event;
this._requestLoadMeasurements=new epiviz.events.Event;this._requestUiStatus=new epiviz.events.Event;this._registerProviderAddMeasurements();this._registerProviderRemoveMeasurements();this._registerProviderAddChart();this._registerProviderRemoveChart();this._registerProviderPrintWorkspace();this._registerProviderLoadWorkspace();this._registerProviderAddSeqInfos();this._registerProviderRemoveSeqNames();this._registerProviderNavigate();this._registerProviderRedraw();this._registerProviderFlushCache();
this._registerProviderClearDatasourceGroupCache();this._registerProviderGetCurrentLocation();this._registerProviderGetChartSettings();this._registerProviderSetChartSettings();this._registerProviderGetAvailableCharts();this._registerProviderUiStatus();this._registerProviderLoadMeasurements()};epiviz.data.DataManager.prototype.onRequestAddMeasurements=function(){return this._requestAddMeasurements};epiviz.data.DataManager.prototype.onRequestRemoveMeasurements=function(){return this._requestRemoveMeasurements};
epiviz.data.DataManager.prototype.onRequestLoadMeasurements=function(){return this._requestLoadMeasurements};epiviz.data.DataManager.prototype.onRequestAddChart=function(){return this._requestAddChart};epiviz.data.DataManager.prototype.onRequestRemoveChart=function(){return this._requestRemoveChart};epiviz.data.DataManager.prototype.onRequestPrintWorkspace=function(){return this._requestPrintWorkspace};epiviz.data.DataManager.prototype.onRequestLoadWorkspace=function(){return this._requestLoadWorkspace};
epiviz.data.DataManager.prototype.onRequestAddSeqInfos=function(){return this._requestAddSeqInfos};epiviz.data.DataManager.prototype.onRequestRemoveSeqNames=function(){return this._requestRemoveSeqNames};epiviz.data.DataManager.prototype.onRequestNavigate=function(){return this._requestNavigate};epiviz.data.DataManager.prototype.onRequestRedraw=function(){return this._requestRedraw};epiviz.data.DataManager.prototype.onClearDatasourceGroupCache=function(){return this._clearDatasourceGroupCache};
epiviz.data.DataManager.prototype.onFlushCache=function(){return this._flushCache};epiviz.data.DataManager.prototype.onRequestCurrentLocation=function(){return this._requestCurrentLocation};epiviz.data.DataManager.prototype.onRequestGetChartSettings=function(){return this._requestGetChartSettings};epiviz.data.DataManager.prototype.onRequestSetChartSettings=function(){return this._requestSetChartSettings};epiviz.data.DataManager.prototype.onRequestGetAvailableCharts=function(){return this._requestGetAvailableCharts};
epiviz.data.DataManager.prototype.onRequestUiStatus=function(){return this._requestUiStatus};
epiviz.data.DataManager.prototype.getSeqInfos=function(a,b){var c=this,d=0,e={},f=[];this._dataProviderFactory.foreach(function(g){g.getData(epiviz.data.Request.getSeqInfos(g.id()),function(b){b=b.data();if(5==epiviz.EpiViz.VERSION){if(b)if(Array.isArray(b))for(h=0;h<b.length;++h)b[h][0]in e||f.push(epiviz.datatypes.SeqInfo.fromRawObject(b[h]));else for(var g=Object.keys(b),h=0;h<g.length;h++)for(var p=0;p<b[g[h]].length;p++)f.push(epiviz.datatypes.SeqInfo.fromRawObject([b[g[h]][p][0],b[g[h]][p][1],
b[g[h]][p][2],g[h]]))}else if(b)if(Array.isArray(b))for(h=0;h<b.length;++h)b[h][0]in e||(f.push(epiviz.datatypes.SeqInfo.fromRawObject(b[h])),e[b[h][0]]=!0);else for(g=Object.keys(b),h=0;h<g.length;h++)g[h]in e||(f.push(epiviz.datatypes.SeqInfo.fromRawObject([g[h],b[g[h]][0],b[g[h]][1]])),e[g[h]]=!0);++d<c._dataProviderFactory.size()||a(f.sort(epiviz.datatypes.SeqInfo.compare))},function(a,c,d){b(a,c,d)})})};
epiviz.data.DataManager.prototype.updateChartSettings=function(a){this._dataProviderFactory.foreach(function(b){if(b.id().includes("websocket-")){var c=null;null!=a.colorMap&&(c=a.colorMap._colors);b.updateChartSettings(epiviz.data.Request.createRequest({action:epiviz.data.Request.Action.SET_CHART_SETTINGS,settings:a.settings,colorMap:c,chartId:a.chartId}),function(){})}})};
epiviz.data.DataManager.prototype.getMeasurements=function(a,b){var c=this,d=new epiviz.measurements.MeasurementSet,e=0;this._dataProviderFactory.foreach(function(f){f.getData(epiviz.data.Request.getMeasurements(f.id()),function(b){if(b=b.data())for(var g=b.id?b.id.length||0:0,m=0;m<g;++m)d.add(new epiviz.measurements.Measurement(b.id[m],b.name[m],$.isArray(b.type)?b.type[m]:b.type,$.isArray(b.datasourceId)?b.datasourceId[m]:b.datasourceId,$.isArray(b.datasourceGroup)?b.datasourceGroup[m]:b.datasourceGroup,
f.id(),null,$.isArray(b.defaultChartType)?b.defaultChartType[m]:b.defaultChartType,b.annotation[m],$.isArray(b.minValue)?b.minValue[m]:b.minValue,$.isArray(b.maxValue)?b.maxValue[m]:b.maxValue,eval(b.metadata[m])));++e<c._dataProviderFactory.size()||a(d)},function(a,c,d){b(a,c,d)})})};epiviz.data.DataManager.prototype.getData=function(a,b,c,d){this._config.useCache&&null!=a&&"all"!=a.seqName()&&null!=a.seqName()?this._cache.getData(a,b,c,d):this._getDataNoCache(a,b,c,d)};
epiviz.data.DataManager.prototype._getDataNoCache=function(a,b,c,d){var e=this,f={},g;for(g in b)if(b.hasOwnProperty(g)){var h=b[g].split(function(a){return a.dataprovider()}),m;for(m in h)if(h.hasOwnProperty(m)){var l=f[m];void 0==l?f[m]=h[m]:l.addAll(h[m])}}var p={};epiviz.utils.forEach(f,function(f,g){var h=f.split(function(a){return a.datasource().id()}),l=epiviz.data.Request.getCombined(h,a),m=e._combinedRequestsStacks[g];void 0==m&&(m=new epiviz.data.RequestStack,e._combinedRequestsStacks[g]=
m);m.pushRequest(l,function(d){var f={};epiviz.utils.forEach(h,function(b,c){var e=b.first().datasource(),g=new epiviz.datatypes.PartialSummarizedExperiment,h=d.rows.globalStartIndex,l=a;if(null==a||"all"==a.seqName()||null==a.seqName())l=new epiviz.datatypes.GenomicRange("all",d.rows.values.start[0],d.rows.values.start.length);isNaN(l._start)&&(l._start=h);isNaN(l._width)&&(l._width=d.rows.end[d.rows.end.length-1]-a._start);e=new epiviz.datatypes.GenomicRangeArray(e,l,h,d.rows.values,d.rows.useOffset);
g.addRowData(e);b.foreach(function(a){a=new epiviz.datatypes.FeatureValueArray(a,l,h,d.values.values[a.id()]);g.addValues(a)});f[c]=g});p[g]=f;e._serveAvailableData(a,b,c,p)});(e._dataProviderFactory.get(g)||e._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(l,function(a){m.serveData(a)},function(a,b,c){d(a,b,c)})})};
epiviz.data.DataManager.prototype._serveAvailableData=function(a,b,c,d){var e=[];epiviz.utils.forEach(b,function(a,b){var f=!0,g=new epiviz.measurements.MeasurementHashtable;a.foreach(function(a){if(!(a.dataprovider()in d))return f=!1,!0;var b=new epiviz.datatypes.MeasurementGenomicDataWrapper(a,d[a.dataprovider()][a.datasource().id()]);g.put(a,b)});if(f){var l=new epiviz.datatypes.MapGenomicData(g);c(b,l);e.push(b)}});e.forEach(function(a){delete b[a]})};
epiviz.data.DataManager.prototype.getPCA=function(a,b,c){var d=this,e={},f;for(f in b)if(b.hasOwnProperty(f)){var g=b[f].split(function(a){return a.dataprovider()}),h;for(h in g)if(g.hasOwnProperty(h)){var m=e[h];void 0==m?e[h]=g[h]:m.addAll(g[h])}}epiviz.utils.forEach(e,function(b,e){var g=b.split(function(a){return a.datasource().id()}),h=epiviz.data.Request.getPCA(g,a),l=Object.keys(g)[0];(d._dataProviderFactory.get(e)||d._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(h,
function(a){var b=a.data();"websocket"==a.data().dataprovidertype&&(b=b[l]);c(f,b)})})};
epiviz.data.DataManager.prototype.getDiversity=function(a,b,c){var d=this,e={},f;for(f in b)if(b.hasOwnProperty(f)){var g=b[f].split(function(a){return a.dataprovider()}),h;for(h in g)if(g.hasOwnProperty(h)){var m=e[h];void 0==m?e[h]=g[h]:m.addAll(g[h])}}epiviz.utils.forEach(e,function(b,e){var g=b.split(function(a){return a.datasource().id()}),h=epiviz.data.Request.getDiversity(g,a),l=Object.keys(g)[0];(d._dataProviderFactory.get(e)||d._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(h,
function(a){var b=a.data();"websocket"==a.data().dataprovidertype&&(b=b[l]);c(f,b)})})};
epiviz.data.DataManager.prototype.getHierarchy=function(a,b){for(var c in a)if(a.hasOwnProperty(c))var d=a[c];var e=d.dataprovider;e||d.measurements.foreach(function(a){return a.dataprovider()?(e=a.dataprovider(),!0):!1});var f=d.datasourceGroup;f||d.measurements.foreach(function(a){return a.datasourceGroup()?(f=a.datasourceGroup(),!0):!1});(this._dataProviderFactory.get(e)||this._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID)).getData(epiviz.data.Request.getHierarchy(f,d.customData),
function(a){b(c,a.data())})};
epiviz.data.DataManager.prototype.propagateHierarchyChanges=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c],e=d.dataprovider;e||d.measurements.foreach(function(a){return a.dataprovider()?(e=a.dataprovider(),!0):!1});var f=this._dataProviderFactory.get(e)||this._dataProviderFactory.get(epiviz.data.EmptyResponseDataProvider.DEFAULT_ID);(function(a,c,d){c.getData(epiviz.data.Request.propagateHierarchyChanges(d.datasourceGroup,d.customData.selection,d.customData.order,d.customData.selectedLevels),
function(e){setTimeout(function(){c.onRequestClearDatasourceGroupCache().notify({datasourceGroup:d.datasourceGroup,result:new epiviz.events.EventResult});c.onRequestRedraw().notify({result:new epiviz.events.EventResult});b(a,e.data())},0)})})(c,f,d)}};
epiviz.data.DataManager.prototype.getWorkspaces=function(a,b,c){var d=this._dataProviderFactory.workspacesDataProvider();if(!d)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");d.getData(epiviz.data.Request.getWorkspaces(b,c),function(b){b=b.data();var c=[];if(b&&b.length)for(var d=0;d<b.length;++d)c.push({id:b[d].id,name:b[d].name,content:JSON.parse(b[d].content)});a(c)})};
epiviz.data.DataManager.prototype.saveWorkspace=function(a,b,c){var d=this._dataProviderFactory.workspacesDataProvider();if(!d)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");d.getData(epiviz.data.Request.saveWorkspace(a,b),function(a){a=a.data();c(a)})};
epiviz.data.DataManager.prototype.deleteWorkspace=function(a){var b=this._dataProviderFactory.workspacesDataProvider();if(!b)throw Error("Invalid data provider for workspaces (see Config.workspaceDataProvider)");b.getData(epiviz.data.Request.deleteWorkspace(a),function(a){a.data()})};
epiviz.data.DataManager.prototype.search=function(a,b){var c=this,d=this._dataProviderFactory.size(),e=[];this._dataProviderFactory.foreach(function(f){f.getData(epiviz.data.Request.search(b,c._config.maxSearchResults),function(b){(b=b.data())&&epiviz.utils.arrayAppend(e,b);--d;d||a(e)})})};epiviz.data.DataManager.prototype.flushCache=function(){this._cache.flush();this._flushCache.notify()};
epiviz.data.DataManager.prototype.clearDatasourceGroupCache=function(a){this._cache.clearDatasourceGroupCache(a);this._clearDatasourceGroupCache.notify({datasourceGroup:a})};epiviz.data.DataManager.prototype._registerProviderAddMeasurements=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestAddMeasurements().addListener(new epiviz.events.EventListener(function(b){a._requestAddMeasurements.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderRemoveMeasurements=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestRemoveMeasurements().addListener(new epiviz.events.EventListener(function(b){a._requestRemoveMeasurements.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderLoadMeasurements=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestLoadMeasurements().addListener(new epiviz.events.EventListener(function(b){a._requestLoadMeasurements.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderAddChart=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestAddChart().addListener(new epiviz.events.EventListener(function(b){a._requestAddChart.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderRemoveChart=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestRemoveChart().addListener(new epiviz.events.EventListener(function(b){a._requestRemoveChart.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderPrintWorkspace=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestPrintWorkspace().addListener(new epiviz.events.EventListener(function(b){a._requestPrintWorkspace.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderLoadWorkspace=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestLoadWorkspace().addListener(new epiviz.events.EventListener(function(b){a._requestLoadWorkspace.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderAddSeqInfos=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestAddSeqInfos().addListener(new epiviz.events.EventListener(function(b){for(var c=[],e=0;e<b.seqInfos.length;++e)c.push(epiviz.datatypes.SeqInfo.fromRawObject(b.seqInfos[e]));a._requestAddSeqInfos.notify({seqInfos:c,result:b.result})}))})};epiviz.data.DataManager.prototype._registerProviderRemoveSeqNames=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestRemoveSeqNames().addListener(new epiviz.events.EventListener(function(b){a._requestRemoveSeqNames.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderNavigate=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestNavigate().addListener(new epiviz.events.EventListener(function(b){a._requestNavigate.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderRedraw=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestRedraw().addListener(new epiviz.events.EventListener(function(b){a._requestRedraw.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderClearDatasourceGroupCache=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestClearDatasourceGroupCache().addListener(new epiviz.events.EventListener(function(b){a.clearDatasourceGroupCache(b.datasourceGroup);b.result.success=!0}))})};
epiviz.data.DataManager.prototype._registerProviderFlushCache=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestFlushCache().addListener(new epiviz.events.EventListener(function(b){a.flushCache();b.result.success=!0}))})};epiviz.data.DataManager.prototype._registerProviderGetCurrentLocation=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestCurrentLocation().addListener(new epiviz.events.EventListener(function(b){a._requestCurrentLocation.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderSetChartSettings=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestSetChartSettings().addListener(new epiviz.events.EventListener(function(b){a._requestSetChartSettings.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderGetChartSettings=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(b){a._requestGetChartSettings.notify(b)}))})};
epiviz.data.DataManager.prototype._registerProviderGetAvailableCharts=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(b){a._requestGetAvailableCharts.notify(b)}))})};epiviz.data.DataManager.prototype._registerProviderUiStatus=function(){var a=this;this._dataProviderFactory.foreach(function(b){b.onRequestUiStatus().addListener(new epiviz.events.EventListener(function(b){a._requestUiStatus.notify(b)}))})};epiviz.datatypes.ItemFilteredGenomicData=function(a,b){epiviz.datatypes.MapGenomicData.call(this);this._data=a;this._filter=b;this._deferredInit=null;this._initialize()};epiviz.datatypes.ItemFilteredGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype);epiviz.datatypes.ItemFilteredGenomicData.constructor=epiviz.datatypes.ItemFilteredGenomicData;
epiviz.datatypes.ItemFilteredGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var a=this,b=this._filter,c=this._data;c.ready(function(){b.preMark()(c).done(function(d){var e=new epiviz.measurements.MeasurementHashtable,f=c.measurements();epiviz.utils.deferredFor(f.length,function(a){var g=new epiviz.deferred.Deferred,m=f[a],l=[],p={};epiviz.utils.deferredFor(c.size(m),function(a){var e=new epiviz.deferred.Deferred,
f=c.get(m,a);b.mark()(f,c,d).done(function(a){a&&(l.push(f),p[f.globalIndex]=f);e.resolve()});return e}).done(function(){e.put(m,new epiviz.datatypes.MeasurementGenomicDataArrayWrapper(m,l,p));g.resolve()});return g}).done(function(){a._setMap(e);a._deferredInit.resolve()})})});return this._deferredInit};epiviz.datatypes.RowItemImpl=function(a,b,c,d,e,f,g){this._id=a;this._seqName=b;this._start=c;this._end=d;this._globalIndex=e;this._strand=f;this._rowMetadata=g};epiviz.datatypes.RowItemImpl.prototype.id=function(){return this._id};epiviz.datatypes.RowItemImpl.prototype.seqName=function(){return this._seqName};epiviz.datatypes.RowItemImpl.prototype.start=function(){return this._start};epiviz.datatypes.RowItemImpl.prototype.end=function(){return this._end};
epiviz.datatypes.RowItemImpl.prototype.globalIndex=function(){return this._globalIndex};epiviz.datatypes.RowItemImpl.prototype.strand=function(){return this._strand};epiviz.datatypes.RowItemImpl.prototype.metadata=function(a){a=this._rowMetadata[a];return void 0==a?null:a};epiviz.datatypes.RowItemImpl.prototype.rowMetadata=function(){return this._rowMetadata};epiviz.datatypes.MeasurementAggregatedGenomicData=function(a,b,c){epiviz.datatypes.MapGenomicData.call(this);this._data=a;this._groupByMarker=b;this._aggregator=c;this._deferredInit=null;this._initialize()};epiviz.datatypes.MeasurementAggregatedGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype);epiviz.datatypes.MeasurementAggregatedGenomicData.constructor=epiviz.datatypes.MeasurementAggregatedGenomicData;
epiviz.datatypes.MeasurementAggregatedGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var a=this,b=this._groupByMarker,c=this._data;c.ready(function(){b.preMark()(c).done(function(d){var e=new epiviz.measurements.MeasurementHashtable,f={},g=c.measurements();epiviz.utils.deferredFor(g.length,function(a){var e=new epiviz.deferred.Deferred,h=g[a];b.mark()(h,c,d).done(function(a){a in f||(f[a]=[]);f[a].push(h);
e.resolve()});return e}).done(function(){var b={},d,g;for(d in f)if(f.hasOwnProperty(d)){g=f[d];var p=d+"-group",n=d,t=g[0].type(),v=g[0].datasourceId(),q=g[0].datasourceGroup(),u=g[0].dataprovider(),w=g[0].defaultChartType(),r=epiviz.utils.mapCopy(g[0].annotation()),A=g[0].minValue(),x=g[0].maxValue(),z=g[0].metadata(),C={};z.forEach(function(a){C[a]=a});f[d].forEach(function(a){v!=a.datasourceId()&&(v="*");q!=a.datasourceGroup()&&(q="*");u!=a.dataprovider()&&(u="*");w!=a.defaultChartType()&&(w=
"*");var b=a.annotation();if(r!=b)if(void 0==r)r=epiviz.utils.mapCopy(b);else if(void 0!=b)for(var c in b)b.hasOwnProperty(c)&&(c in r?r[c]!=b[c]&&(r[c]="*"):r[c]=b[c]);A=Math.min(A,a.minValue());x=Math.max(x,a.maxValue());a.metadata().forEach(function(a){a in C||(C[a]=a,z.push(a))})});b[d]=new epiviz.measurements.Measurement(p,n,t,v,q,u,null,w,r,A,x,z)}for(d in f)if(f.hasOwnProperty(d)){p=b[d];n=[];t={};g=f[d];for(var E=Math.min.apply(void 0,g.map(function(a){return c.globalStartIndex(a)})),D=Math.max.apply(void 0,
g.map(function(a){return c.globalEndIndex(a)})),G=E;G<D;++G){var B=g.map(function(a){return c.getByGlobalIndex(a,G)}).filter(function(a){return a});B.length&&(E=B.map(function(a){return a.value}),E=a._aggregator.aggregate(d,g,E),B=B[0].rowItem,B=new epiviz.datatypes.RowItemImpl(B.id(),B.seqName(),B.start(),B.end(),B.globalIndex(),B.strand(),B.rowMetadata()||{}),E=new epiviz.datatypes.GenomicData.ValueItem(G,B,E.value,p,{errMinus:E.errMinus,errPlus:E.errPlus}),n.push(E),t[G]=E)}g=new epiviz.datatypes.MeasurementGenomicDataArrayWrapper(p,
n,t);e.put(p,g)}a._setMap(e);a._deferredInit.resolve()})})});return this._deferredInit};epiviz.datatypes.MeasurementOrderedGenomicData=function(a,b){epiviz.datatypes.MapGenomicData.call(this);this._data=a;this._order=b;this._deferredInit=null;this._initialize()};epiviz.datatypes.MeasurementOrderedGenomicData.prototype=epiviz.utils.mapCopy(epiviz.datatypes.MapGenomicData.prototype);epiviz.datatypes.MeasurementOrderedGenomicData.constructor=epiviz.datatypes.MeasurementOrderedGenomicData;
epiviz.datatypes.MeasurementOrderedGenomicData.prototype._initialize=function(){if(this._deferredInit)return this._deferredInit;this._deferredInit=new epiviz.deferred.Deferred;var a=this,b=this._data,c=this._order;b.ready(function(){c.preMark()(b).done(function(d){var e=new epiviz.measurements.MeasurementHashtable,f=b.measurements(),g=new epiviz.measurements.MeasurementHashtable;epiviz.utils.deferredFor(f.length,function(a){var e=new epiviz.deferred.Deferred,h=f[a];c.mark()(h,b,d).done(function(a){g.put(h,
a);e.resolve()});return e}).done(function(){f.sort(function(a,b){var c=g.get(a),d=g.get(b);return c==d?0:c<d?-1:1});f.forEach(function(a){e.put(a,b.getSeries(a))});a._setMap(e);a._deferredInit.resolve()})})});return this._deferredInit};epiviz.deferred.Promise=function(a){this._promise=a};epiviz.deferred.Promise.prototype.then=function(a,b,c){return new epiviz.deferred.Promise(this._promise.then(a,b,c))};epiviz.deferred.Promise.prototype.done=function(a,b){return new epiviz.deferred.Deferred(this._promise.done(a,b))};epiviz.deferred.Promise.prototype.fail=function(a,b){return new epiviz.deferred.Deferred(this._promise.fail(a,b))};
epiviz.deferred.Promise.prototype.always=function(a,b){return new epiviz.deferred.Deferred(this._promise.always(a,b))};epiviz.deferred.Promise.prototype.state=function(){return this._promise.state()};epiviz.ui.charts.CustomSetting=function(a,b,c,d,e){this.id=a;this.type=b;this.defaultValue=c;this.label=d||a;this.possibleValues=e||null};epiviz.ui.charts.CustomSetting.Type={NUMBER:"number",STRING:"string",ARRAY:"array",BOOLEAN:"boolean",CATEGORICAL:"categorical",MEASUREMENTS_METADATA:"measurementsMetadata",MEASUREMENTS_ANNOTATION:"measurementsAnnotation"};epiviz.ui.charts.CustomSetting.DEFAULT="default";epiviz.ui.charts.VisEventArgs=function(a,b){this.id=a;this.args=b};epiviz.ui.charts.Axis={X:"x",Y:"y"};epiviz.ui.charts.Margins=function(a,b,c,d){this._top=a;this._left=b;this._bottom=c;this._right=d};epiviz.ui.charts.Margins.ZERO_MARGIN=new epiviz.ui.charts.Margins(0,0,0,0);epiviz.ui.charts.Margins.prototype.top=function(){return this._top};epiviz.ui.charts.Margins.prototype.left=function(){return this._left};epiviz.ui.charts.Margins.prototype.bottom=function(){return this._bottom};epiviz.ui.charts.Margins.prototype.right=function(){return this._right};
epiviz.ui.charts.Margins.prototype.sumAxis=function(a){switch(a){case epiviz.ui.charts.Axis.X:return this._left+this._right;case epiviz.ui.charts.Axis.Y:return this._top+this._bottom;default:throw Error("Invalid argument: "+a);}};epiviz.ui.charts.Margins.prototype.raw=function(){return{top:this._top,left:this._left,bottom:this._bottom,right:this._right}};epiviz.ui.charts.Margins.fromRawObject=function(a){return new epiviz.ui.charts.Margins(a.top,a.left,a.bottom,a.right)};
epiviz.ui.charts.Margins.prototype.copy=function(){return new epiviz.ui.charts.Margins(this._top,this._left,this._bottom,this._right)};epiviz.ui.charts.Margins.prototype.equals=function(a){return a?this==a?!0:this._top==a._top&&this._left==a._left&&this._bottom==a._bottom&&this._right==a._right:!1};epiviz.ui.charts.Visualization=function(a,b,c){this._id=a;this._container=b;this._properties=c;this._originalMethods={};this._hasModifiedMethods=!1;this._lastModifiedMethod="draw";var d=this;if(c.modifiedMethods){var e=new epiviz.deferred.Deferred,f=c.modifiedMethods,g=Object.keys(f),h={},m=0,l;for(l in f)f.hasOwnProperty(l)&&"_setModifiedMethods"!=l&&function(a){epiviz.caja.cajole(f[a],epiviz.caja.buildChartMethodContext()).done(function(b){b&&(h[a]=b,m+=1,m>=g.length&&e.resolve())})}(l);e.done(function(){for(var a in h)h.hasOwnProperty(a)&&
(d._originalMethods[a]=d[a],d[a]=h[a],d._lastModifiedMethod=a);d._hasModifiedMethods=!0;d.draw()})}this._customSettingsValues={};for(a=0;a<c.customSettingsDefs.length;++a)switch(b=c.customSettingsDefs[a],l=c.customSettingsValues[b.id],b.type){case epiviz.ui.charts.CustomSetting.Type.BOOLEAN:this._customSettingsValues[b.id]=!1===l||l?l:b.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.NUMBER:this._customSettingsValues[b.id]=0===l||l?l:b.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.STRING:this._customSettingsValues[b.id]=
""===l||l?l:b.defaultValue;break;case epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA:var p={};c.visConfigSelection.measurements.foreach(function(a){a.metadata().forEach(function(a){p[a]=a})});b.possibleValues=Object.keys(p);b.possibleValues.sort();l=l||b.defaultValue;this._customSettingsValues[b.id]=l in p?l:b.possibleValues.length?b.possibleValues[0]:"";break;case epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION:p={name:"name"};c.visConfigSelection.measurements.foreach(function(a){(a=
a.annotation())&&Object.keys(a).forEach(function(a){p[a]=a})});b.possibleValues=Object.keys(p);b.possibleValues.sort();l=l||b.defaultValue;this._customSettingsValues[b.id]=l in p?l:b.possibleValues.length?b.possibleValues[0]:"";break;default:this._customSettingsValues[b.id]=l||b.defaultValue}this._svgId=sprintf("%s-svg",this._id);this._lastRange=this._lastData=this._unalteredData=this._svg=null;this._slide=0;this._zoom=1;this._markers=c.chartMarkers;this._markersMap={};this._markersIndices={};this._markers.forEach(function(a,
b){a&&(d._markersMap[a.id()]=a,d._markersIndices[a.id()]=b)});this._autoPropagateChanges=!0;this._hover=new epiviz.events.Event;this._unhover=new epiviz.events.Event;this._select=new epiviz.events.Event;this._deselect=new epiviz.events.Event;this._save=new epiviz.events.Event;this._remove=new epiviz.events.Event;this._colorsChanged=new epiviz.events.Event;this._methodsModified=new epiviz.events.Event;this._methodsReset=new epiviz.events.Event;this._markersModified=new epiviz.events.Event;this._customSettingsChanged=
new epiviz.events.Event;this._sizeChanged=new epiviz.events.Event;this._marginsChanged=new epiviz.events.Event;this._dataWaitStart=new epiviz.events.Event;this._dataWaitEnd=new epiviz.events.Event};epiviz.ui.charts.Visualization.SVG_MARGIN=20;
epiviz.ui.charts.Visualization.prototype._initialize=function(){"100%"==this._properties.height&&(this._properties.height=this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN);"100%"==this._properties.width&&(this._properties.width=this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN);var a=this.width(),b=this.height();this._container.addClass("visualization-container");this._container.append(sprintf('<svg id="%s" class="visualization" width="%s" height="%s"><style type="text/css"></style><defs></defs></svg>',
this._svgId,a,b));this._svg=d3.select(this._container.find("#"+this._svgId)[0]);this._widthDif=$(this._container.find("#"+this._svgId)[0]).width()-(this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN);this._heightDif=b-(this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN);this._properties.width=a;this._properties.height=b;var c=this;this._container.click(function(){c._deselect.notify(new epiviz.ui.charts.VisEventArgs(c._id))})};
epiviz.ui.charts.Visualization.prototype._clearAxes=function(a){a=a||this._svg;a.selectAll(".xAxis").remove();a.selectAll(".yAxis").remove()};
epiviz.ui.charts.Visualization.prototype._drawAxesCanvas=function(a,b,c,d,e,f,g,h,m,l,p,n,t,v){e=e||this._canvas;h=h||this.margins();g=g||this.height();f=f||this.width();var q=e.getContext("2d");q.lineWidth=1;if(a){q.beginPath();q.strokeStyle="black";q.moveTo(h.left(),g-h.bottom());q.lineTo(f-h.right(),g-h.bottom());q.stroke();var u=a.ticks(c);u.forEach(function(b){q.beginPath();q.moveTo(h.left()+a(b),g-h.bottom());q.lineTo(h.left()+a(b),g-h.bottom()+6);q.strokeStyle="#565656";q.stroke();q.moveTo(h.left()+
a(b),g-h.bottom());q.lineTo(h.left()+a(b),h.top());q.strokeStyle="#dcdcdc";q.stroke()});q.beginPath();q.textAlign="center";q.textBaseline="top";u.map(m||(p?function(a){return p[a]||""}:function(a){return d3.format("s")(Math.round(1E3*a)/1E3)})).forEach(function(b,c){q.fillText(b,h.left()+a(u[c]),g-h.bottom()+8)})}q.stroke();if(b){q.beginPath();q.strokeStyle="black";q.moveTo(h.left(),g-h.bottom());q.lineTo(h.left(),h.top());q.stroke();var w=b.ticks(d-1);w.forEach(function(a){q.beginPath();q.moveTo(h.left(),
b(a)+h.top());q.lineTo(h.left()-6,b(a)+h.top());q.strokeStyle="#565656";q.stroke();q.moveTo(h.left(),b(a)+h.top());q.lineTo(f-h.right(),b(a)+h.top());q.strokeStyle="#dcdcdc";q.stroke()});q.stroke();q.beginPath();q.textAlign="right";q.textBaseline="middle";w.map(n?function(a){return n[a]}:function(a){return d3.format("s")(Math.round(1E3*a)/1E3)}).forEach(function(a,c){q.fillText(a,h.left()-8,b(w[c])+h.top())});q.stroke()}};
epiviz.ui.charts.Visualization.prototype._drawAxes=function(a,b,c,d,e,f,g,h,m,l,p,n,t,v){e=e||this._svg;h=h||this.margins();g=g||this.height();f=f||this.width();var q=e.select(".axes"),u=q.select(".xAxis-grid");v=q.select(".yAxis-grid");var w=q.select(".xAxis-line");l=q.select(".yAxis-line");q.empty()&&(q=e.append("g").attr("class","axes"));u.empty()&&(u=q.append("g").attr("class","xAxis xAxis-grid"));v.empty()&&(v=q.append("g").attr("class","yAxis yAxis-grid"));w.empty()&&(w=q.append("g").attr("class",
"xAxis xAxis-line"));l.empty()&&(l=q.append("g").attr("class","yAxis yAxis-line"));a&&(u.attr("transform","translate("+h.left()+", "+h.top()+")").selectAll("line.x").data(a.ticks(c)).enter().append("line").attr("x1",a).attr("x2",a).attr("y1",0).attr("y2",g-h.top()-h.bottom()).style("stroke","#eeeeee").style("shape-rendering","crispEdges"),e=m||(p?function(a){return p[a]}:function(a){return d3.format("s")(Math.round(1E3*a)/1E3)}),c=d3.svg.axis().scale(a).orient("bottom").ticks(c).tickFormat(e),w.attr("transform",
"translate("+h.left()+", "+(g-h.bottom())+")").call(c),p&&(g="rotate(-90)",t&&(g+="translate(0,"+(a(.5)-a(0))+")"),w.selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-0.5em").attr("transform",g)));b&&(v.attr("transform","translate("+h.left()+", "+h.top()+")").selectAll("line.y").data(b.ticks(d-1)).enter().append("line").attr("x1",0).attr("x2",f-h.left()-h.right()).attr("y1",b).attr("y2",b).style("stroke","#eeeeee").style("shape-rendering","crispEdges"),a=n?function(a){return n[a]}:
function(a){var b=d3.formatPrefix(a);return"m"==b.scale?a:b.scale(a)+b.symbol},b=d3.svg.axis().ticks(d-1).scale(b).orient("left").tickFormat(a),l.attr("transform","translate("+h.left()+", "+h.top()+")").call(b))};epiviz.ui.charts.Visualization.prototype.getDataMinMax=function(a){var b=1E5,c=-1E5;a.foreach(function(a,e){var d=e._container.values(a)._values,g=Math.min.apply(null,d),d=Math.max.apply(null,d);g<b&&(b=g);d>c&&(c=d)});return[b,c]};
epiviz.ui.charts.Visualization.prototype._drawTitle=function(){var a=this._svg.selectAll(".visualization-title"),b=epiviz.ui.charts.Visualization.CustomSettings;(b=this.customSettingsValues()[b.TITLE])&&""!=b.trim()?(a.empty()&&(a=this._svg.append("text").attr("class","visualization-title").attr("text-anchor","middle")),a.attr("x",.5*this.width()).attr("y",25).text(b)):a.empty()||a.remove()};
epiviz.ui.charts.Visualization.prototype.resize=function(a,b){a&&(this._properties.width=a);b&&(this._properties.height=b);this.draw();this._sizeChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,{width:this._properties.width,height:this._properties.height}))};epiviz.ui.charts.Visualization.prototype.updateSize=function(){this.resize(this._widthDif+this._container.width()-epiviz.ui.charts.Visualization.SVG_MARGIN,this._heightDif+this._container.height()-epiviz.ui.charts.Visualization.SVG_MARGIN)};
epiviz.ui.charts.Visualization.prototype.draw=function(a,b){void 0!=a&&(this._lastRange=a);void 0!=b&&(this._unalteredData=this._lastData=b,this._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(this._id)));this._svg.attr("width",this.width()).attr("height",this.height());this._drawTitle();return[]};epiviz.ui.charts.Visualization.prototype.container=function(){return this._container};epiviz.ui.charts.Visualization.prototype.id=function(){return this._id};
epiviz.ui.charts.Visualization.prototype.properties=function(){return this._properties};epiviz.ui.charts.Visualization.prototype.height=function(){return this._properties.height};epiviz.ui.charts.Visualization.prototype.width=function(){return this._properties.width};epiviz.ui.charts.Visualization.prototype.margins=function(){return this._properties.margins};epiviz.ui.charts.Visualization.prototype.colors=function(){return this._properties.colors};
epiviz.ui.charts.Visualization.prototype.setColors=function(a){a&&!a.equals(this._properties.colors)&&(this._properties.colors=a,this.draw(),this._colorsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._properties.colors)))};epiviz.ui.charts.Visualization.prototype.colorLabels=function(){var a=Array(this.measurements().size());this.measurements().foreach(function(b,c){a[c]=b.name()});return a};epiviz.ui.charts.Visualization.prototype.measurements=function(){return this.properties().visConfigSelection.measurements};
epiviz.ui.charts.Visualization.prototype.customSettingsValues=function(){return this._customSettingsValues};
epiviz.ui.charts.Visualization.prototype.setCustomSettingsValues=function(a){if(this._customSettingsValues!=a&&a&&!epiviz.utils.mapEquals(this._customSettingsValues,a)){var b=epiviz.ui.charts.Visualization.CustomSettings,c=a[b.TITLE]||"",d=(this._customSettingsValues[b.TITLE]||"").trim().length,c=c.trim().length;if(!(d*c)&&d+c){var d=20*epiviz.utils.sign(c-d),c=a[b.MARGIN_TOP]||this._properties.margins.top(),e=a[b.MARGIN_LEFT]||this._properties.margins.left(),f=a[b.MARGIN_RIGHT]||this._properties.margins.right(),
g=a[b.MARGIN_BOTTOM]||this._properties.margins.bottom();a[b.MARGIN_TOP]=c+d;a[b.MARGIN_LEFT]=e;a[b.MARGIN_RIGHT]=f;a[b.MARGIN_BOTTOM]=g}d=this._customSettingsValues[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR];c=a[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR];this._customSettingsValues=a;b.MARGIN_TOP in a&&b.MARGIN_BOTTOM in a&&b.MARGIN_LEFT in a&&b.MARGIN_RIGHT in a&&(this._properties.margins=new epiviz.ui.charts.Margins(a[b.MARGIN_TOP],a[b.MARGIN_LEFT],
a[b.MARGIN_BOTTOM],a[b.MARGIN_RIGHT]),this._marginsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._properties.margins)));if(d!=c){var h=this;this.transformData(this._lastRange,this._unalteredData).done(function(){h.draw()})}else this.draw();this._customSettingsChanged.notify(new epiviz.ui.charts.VisEventArgs(this._id,a))}};
epiviz.ui.charts.Visualization.prototype.setModifiedMethods=function(a){var b=this,c=!1;if(a){var d=Object.keys(a),e=new epiviz.deferred.Deferred,f=0,g={},h;for(h in a)a.hasOwnProperty(h)&&"_setModifiedMethods"!=h&&this[h].toString()!=a[h]&&(h in this._originalMethods||(this._originalMethods[h]=this[h]),function(b){epiviz.caja.cajole(a[b],epiviz.caja.buildChartMethodContext()).done(function(a){a&&(g[b]=a,c=!0,f+=1,f>=d.length&&e.resolve())})}(h));e.done(function(){if(c){for(var d in g)g.hasOwnProperty(d)&&
(b[d]=g[d],b._lastModifiedMethod=d);b._hasModifiedMethods=!0;b.draw();b._methodsModified.notify(new epiviz.ui.charts.VisEventArgs(b._id,a))}})}};epiviz.ui.charts.Visualization.prototype.hasModifiedMethods=function(){return this._hasModifiedMethods};epiviz.ui.charts.Visualization.prototype.lastModifiedMethod=function(){return this._lastModifiedMethod};
epiviz.ui.charts.Visualization.prototype.resetModifiedMethods=function(){if(this._hasModifiedMethods){for(var a in this._originalMethods)this._originalMethods.hasOwnProperty(a)&&(this[a]=this._originalMethods[a]);this._hasModifiedMethods=!1;this.draw();this._methodsReset.notify(new epiviz.ui.charts.VisEventArgs(this._id))}};
epiviz.ui.charts.Visualization.prototype.putMarker=function(a){if(a){var b;if(a.id()in this._markersMap){b=this._markersIndices[a.id()];var c=this._markers[b];if(c==a||c.type()==a.type()&&c.preMarkStr()==a.preMarkStr()&&c.markStr()==a.markStr())return;this._markers[b]=a}else b=this._markers.length,this._markers.push(a),this._markersIndices[a.id()]=b;this._markersMap[a.id()]=a;var d=this;this.transformData(this._lastRange,this._unalteredData).done(function(){d.draw()});this._markersModified.notify(new epiviz.ui.charts.VisEventArgs(this._id,
this._markers))}};epiviz.ui.charts.Visualization.prototype.removeMarker=function(a){if(a in this._markersMap){this._markers[this._markersIndices[a]]=null;delete this._markersMap[a];delete this._markersIndices[a];var b=this;this.transformData(this._lastRange,this._unalteredData).done(function(){b.draw()});this._markersModified.notify(new epiviz.ui.charts.VisEventArgs(this._id,this._markers))}};
epiviz.ui.charts.Visualization.prototype.getMarker=function(a){return a&&a in this._markersMap?this._markersMap[a]:null};epiviz.ui.charts.Visualization.prototype.displayType=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.Visualization.prototype.autoPropagateChanges=function(){return this._autoPropagateChanges};epiviz.ui.charts.Visualization.prototype.setAutoPropagateChanges=function(a){this._autoPropagateChanges=a};
epiviz.ui.charts.Visualization.prototype.transformData=function(a,b){var c=this._lastRange;void 0!=a&&(this._lastRange=a);void 0!=b&&(this._unalteredData=this._lastData=b);c&&a&&c.overlapsWith(a)&&c.width()==a.width()&&(this._slide=a.start()-c.start());c&&a&&c.overlapsWith(a)&&c.width()!=a.width()&&(this._zoom=c.width()/a.width());c=new epiviz.deferred.Deferred;c.resolve();return c};epiviz.ui.charts.Visualization.prototype.onHover=function(){return this._hover};
epiviz.ui.charts.Visualization.prototype.onUnhover=function(){return this._unhover};epiviz.ui.charts.Visualization.prototype.onSelect=function(){return this._select};epiviz.ui.charts.Visualization.prototype.onDeselect=function(){return this._deselect};
epiviz.ui.charts.Visualization.prototype.doHover=function(a){if("canvas"==this.chartDrawType)this._canvasHoverObject=a;else{var b=this._container.find(".items"),c=b.find("> .hovered"),d=b.find("> .selected"),e=d.find("> .hovered"),f=function(){if(Array.isArray(a)){for(var b=!1,c=0;c<a.length;c++)a[c].overlapsWith(d3.select(this).data()[0])&&(b=!0);return b}return a.overlapsWith(d3.select(this).data()[0])},b=b.find("> .item").filter(f);c.append(b);b=d.find("> .item").filter(f);e.append(b)}};
epiviz.ui.charts.Visualization.prototype.doUnhover=function(){if("canvas"==this.chartDrawType)this._canvasHoverObject=null,this.hoverCanvas.getContext("2d").clearRect(0,0,this.hoverCanvas.width,this.hoverCanvas.height);else{var a=this._container.find(".items"),b=a.find("> .hovered"),c=a.find("> .selected"),d=c.find("> .hovered");a.prepend(b.children());c.prepend(d.children())}};
epiviz.ui.charts.Visualization.prototype.doSelect=function(a){var b=this._container.find(".items"),c=b.find("> .hovered"),d=b.find("> .selected"),e=d.find("> .hovered"),f=function(){return a.overlapsWith(d3.select(this).data()[0])},b=b.find("> .item").filter(f);d.append(b);b=c.find("> .item").filter(f);e.append(b)};
epiviz.ui.charts.Visualization.prototype.doDeselect=function(){var a=this._container.find(".items"),b=a.find("> .hovered"),c=a.find("> .selected"),d=c.find("> .hovered");a.prepend(c.find("> .item"));b.prepend(d.children())};epiviz.ui.charts.Visualization.prototype.onSave=function(){return this._save};epiviz.ui.charts.Visualization.prototype.onRemove=function(){return this._remove};epiviz.ui.charts.Visualization.prototype.onColorsChanged=function(){return this._colorsChanged};
epiviz.ui.charts.Visualization.prototype.onMethodsModified=function(){return this._methodsModified};epiviz.ui.charts.Visualization.prototype.onMethodsReset=function(){return this._methodsReset};epiviz.ui.charts.Visualization.prototype.onMarkersModified=function(){return this._markersModified};epiviz.ui.charts.Visualization.prototype.onCustomSettingsChanged=function(){return this._customSettingsChanged};epiviz.ui.charts.Visualization.prototype.onSizeChanged=function(){return this._sizeChanged};
epiviz.ui.charts.Visualization.prototype.onMarginsChanged=function(){return this._marginsChanged};epiviz.ui.charts.Visualization.prototype.onDataWaitStart=function(){return this._dataWaitStart};epiviz.ui.charts.Visualization.prototype.onDataWaitEnd=function(){return this._dataWaitEnd};
epiviz.ui.charts.Visualization.CustomSettings={TITLE:"title",MARGIN_LEFT:"marginLeft",MARGIN_RIGHT:"marginRight",MARGIN_TOP:"marginTop",MARGIN_BOTTOM:"marginBottom",X_MIN:"xMin",X_MAX:"xMax",Y_MIN:"yMin",Y_MAX:"yMax",COL_LABEL:"colLabel",ROW_LABEL:"rowLabel"};epiviz.ui.charts.VisualizationType=function(a){var b=epiviz.Config.VisualizationPropertySettings;this._config=a;this._defaultSettings=epiviz.utils.mapCombine(epiviz.utils.mapCombine(a.chartSettings[this.typeName()],a.chartSettings[this.chartDisplayType()],!0),a.chartSettings["default"],!0);this._defaultWidth=this._defaultSettings[b.WIDTH];this._defaultHeight=this._defaultSettings[b.HEIGHT];this._defaultMargins=this._defaultSettings[b.MARGINS];this._defaultColors=a.colorPalettesMap[this._defaultSettings[b.COLORS]];
this._decorations=this._defaultSettings[b.DECORATIONS];this._customSettingsValues=a.chartCustomSettings[this.typeName()]||null};epiviz.ui.charts.VisualizationType.DisplayType={PLOT:"plot",TRACK:"track",DATA_STRUCTURE:"data-structure"};epiviz.ui.charts.VisualizationType.prototype.createNew=function(a,b,c){throw Error("unimplemented abstract method");};epiviz.ui.charts.VisualizationType.prototype.typeName=function(){throw Error("unimplemented abstract method");};
epiviz.ui.charts.VisualizationType.prototype.chartName=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.VisualizationType.prototype.chartHtmlAttributeName=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.VisualizationType.prototype.chartDisplayType=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.VisualizationType.prototype.measurementsFilter=function(){return function(a){return!0}};
epiviz.ui.charts.VisualizationType.prototype.isRestrictedToSameDatasourceGroup=function(){return!1};epiviz.ui.charts.VisualizationType.prototype.isRestrictedToRangeMeasurements=function(){return!1};epiviz.ui.charts.VisualizationType.prototype.isRestrictedToFeatureMeasurements=function(){return!this.isRestrictedToRangeMeasurements()};epiviz.ui.charts.VisualizationType.prototype.minSelectedMeasurements=function(){return 1};epiviz.ui.charts.VisualizationType.prototype.chartContainer=function(){return epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS[this.chartDisplayType()]};
epiviz.ui.charts.VisualizationType.prototype.cssClass=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.VisualizationType.prototype.defaultWidth=function(){return this._defaultWidth};epiviz.ui.charts.VisualizationType.prototype.defaultHeight=function(){return this._defaultHeight};epiviz.ui.charts.VisualizationType.prototype.defaultMargins=function(){return this._defaultMargins};epiviz.ui.charts.VisualizationType.prototype.defaultColors=function(){return this._defaultColors};
epiviz.ui.charts.VisualizationType.prototype.decorations=function(){return this._decorations};epiviz.ui.charts.VisualizationType.prototype.customSettingsValues=function(){return this._customSettingsValues};
epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs=function(){return[new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.TITLE,epiviz.ui.charts.CustomSetting.Type.STRING,"","Title"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_TOP,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.top(),"Top margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_BOTTOM,epiviz.ui.charts.CustomSetting.Type.NUMBER,
this._defaultMargins.bottom(),"Bottom margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_LEFT,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.left(),"Left margin"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.MARGIN_RIGHT,epiviz.ui.charts.CustomSetting.Type.NUMBER,this._defaultMargins.right(),"Right margin")]};epiviz.ui.charts.markers={};
epiviz.ui.charts.markers.VisualizationMarker=function(a,b,c,d,e){this._type=a;this._id=b||epiviz.utils.generatePseudoGUID(6);this._name=c||"Custom Marker "+this._id;this._preMarkStr=d||"";this._markStr=e||"";var f=new epiviz.deferred.Deferred,g=null;epiviz.caja.cajole(this._preMarkStr).done(function(a){g=a;f.resolve()});this._preMark=function(a){var b=new epiviz.deferred.Deferred;f.done(function(){var c=g(a);b.resolve(c)});return b};var h=new epiviz.deferred.Deferred,m=null;epiviz.caja.cajole(this._markStr).done(function(a){m=
a;h.resolve()});this._mark=function(a,b,c){var d=new epiviz.deferred.Deferred;h.done(function(){var e=m(a,b,c);d.resolve(e)});return d}};epiviz.ui.charts.markers.VisualizationMarker.prototype.type=function(){return this._type};epiviz.ui.charts.markers.VisualizationMarker.prototype.id=function(){return this._id};epiviz.ui.charts.markers.VisualizationMarker.prototype.name=function(){return this._name};epiviz.ui.charts.markers.VisualizationMarker.prototype.preMark=function(){return this._preMark};
epiviz.ui.charts.markers.VisualizationMarker.prototype.mark=function(){return this._mark};epiviz.ui.charts.markers.VisualizationMarker.prototype.preMarkStr=function(){return this._preMarkStr};epiviz.ui.charts.markers.VisualizationMarker.prototype.markStr=function(){return this._markStr};epiviz.ui.charts.markers.VisualizationMarker.Type={FILTER:"filter",COLOR_BY_ROW:"colorByRow",ORDER_BY_MEASUREMENTS:"orderByMeasurements",COLOR_BY_MEASUREMENTS:"colorByMeasurements",GROUP_BY_MEASUREMENTS:"groupByMeasurements"};
epiviz.ui.charts.markers.VisualizationMarker.prototype.raw=function(){return{type:this._type,id:this._id,name:this._name,preMark:this._preMarkStr,mark:this._markStr}};epiviz.ui.charts.markers.VisualizationMarker.fromRawObject=function(a){return new epiviz.ui.charts.markers.VisualizationMarker(a.type,a.id,a.name,a.preMark,a.mark)};epiviz.ui.charts.VisualizationProperties=function(a,b,c,d,e,f,g,h,m){this.width=a;this.height=b;this.margins=c;this.visConfigSelection=d;this.colors=e;this.modifiedMethods=f;this.customSettingsValues=g||{};this.customSettingsDefs=h||[];this.chartMarkers=m||[]};
epiviz.ui.charts.VisualizationProperties.prototype.copy=function(){var a=new epiviz.ui.controls.VisConfigSelection(this.visConfigSelection.measurements?new epiviz.measurements.MeasurementSet(this.visConfigSelection.measurements):void 0,this.visConfigSelection.datasource,this.visConfigSelection.datasourceGroup,this.visConfigSelection.dataprovider,epiviz.utils.mapCopy(this.visConfigSelection.annotation),this.visConfigSelection.defaultChartType,this.visConfigSelection.minSelectedMeasurements);return new epiviz.ui.charts.VisualizationProperties(this.width,
this.height,this.margins?this.margins.copy():this.margins,a,this.colors,this.modifiedMethods?epiviz.utils.mapCopy(this.modifiedMethods):this.modifiedMethods,this.customSettingsValues?epiviz.utils.mapCopy(this.customSettingsValues):this.customSettingsValues,this.customSettingsDefs?this.customSettingsDefs.slice(0):this.customSettingsDefs,this.chartMarkers.slice(0))};epiviz.workspaces={};epiviz.workspaces.Workspace=function(a,b,c){this._id=a;this._name=b;this._range=c.range;this._chartsOrder={};this._chartsById={};for(var d in c.charts)if(c.charts.hasOwnProperty(d))for(this._chartsOrder[d]=[],a=0;a<c.charts[d].length;++a)this._chartsById[c.charts[d][a].id]=c.charts[d][a],this._chartsOrder[d].push(c.charts[d][a].id);this._computedMeasurements=c.computedMeasurements||new epiviz.measurements.MeasurementSet;this._changed=!1;this._contentChanged=new epiviz.events.Event};
epiviz.workspaces.Workspace.DEFAULT_WORKSPACE_NAME=epiviz.Config.DEFAULT_WORKSPACE_NAME;epiviz.workspaces.Workspace.prototype.id=function(){return this._id};epiviz.workspaces.Workspace.prototype.name=function(){return this._name};epiviz.workspaces.Workspace.prototype.range=function(){return this._range};epiviz.workspaces.Workspace.prototype.charts=function(){var a={},b;for(b in this._chartsOrder)if(this._chartsOrder.hasOwnProperty(b)){a[b]=[];for(var c=0;c<this._chartsOrder[b].length;++c)a[b].push(this._chartsById[this._chartsOrder[b][c]])}return a};
epiviz.workspaces.Workspace.prototype.chartsOrder=function(){return this._chartsOrder};epiviz.workspaces.Workspace.prototype.computedMeasurements=function(){return this._computedMeasurements};epiviz.workspaces.Workspace.prototype.chartAdded=function(a,b,c,d){this._chartsById[a]={id:a,type:b,properties:c.copy()};this._chartsOrder=d;this._setChanged()};epiviz.workspaces.Workspace.prototype.chartRemoved=function(a,b){this._chartsById[a]&&(delete this._chartsById[a],this._chartsOrder=b,this._setChanged())};
epiviz.workspaces.Workspace.prototype.chartSizeChanged=function(a,b,c){!this._chartsById[a]||this._chartsById[a].properties.width==b&&this._chartsById[a].properties.height==c||(this._chartsById[a].properties.width=b,this._chartsById[a].properties.height=c,this._setChanged())};epiviz.workspaces.Workspace.prototype.chartMarginsChanged=function(a,b){this._chartsById[a].properties.margins.equals(b)||(this._chartsById[a].properties.margins=b?b.copy():b,this._setChanged())};
epiviz.workspaces.Workspace.prototype.chartColorsChanged=function(a,b){this._chartsById[a].properties.colors.equals(b)||(this._chartsById[a].properties.colors=b,this._setChanged())};epiviz.workspaces.Workspace.prototype.chartMethodsModified=function(a,b){epiviz.utils.mapEquals(this._chartsById[a].properties.modifiedMethods,b)||(this._chartsById[a].properties.modifiedMethods=epiviz.utils.mapCombine(b,this._chartsById[a].properties.modifiedMethods),this._setChanged())};
epiviz.workspaces.Workspace.prototype.chartMethodsReset=function(a){this._chartsById[a].properties.modifiedMethods&&0!=Object.keys(this._chartsById[a].properties.modifiedMethods).length&&(this._chartsById[a].properties.modifiedMethods={},this._setChanged())};epiviz.workspaces.Workspace.prototype.chartMarkersModified=function(a,b){epiviz.utils.arraysEqual(this._chartsById[a].properties.chartMarkers,b)||(this._chartsById[a].properties.chartMarkers=b.filter(function(a){return null!=a}),this._setChanged())};
epiviz.workspaces.Workspace.prototype.chartCustomSettingsChanged=function(a,b){epiviz.utils.mapEquals(this._chartsById[a].properties.customSettingsValues,b)||(this._chartsById[a].properties.customSettingsValues=b?epiviz.utils.mapCopy(b):b,this._setChanged())};epiviz.workspaces.Workspace.prototype.locationChanged=function(a){this._range.equals(a)||(this._range=a,this._setChanged())};
epiviz.workspaces.Workspace.prototype.computedMeasurementsAdded=function(a){var b=this._computedMeasurements.size();this._computedMeasurements.addAll(a);b!=this._computedMeasurements.size()&&this._setChanged()};epiviz.workspaces.Workspace.prototype.computedMeasurementsRemoved=function(a){var b=this._computedMeasurements.size();this._computedMeasurements.removeAll(a);b!=this._computedMeasurements.size()&&this._setChanged()};
epiviz.workspaces.Workspace.prototype.chartsOrderChanged=function(a){this._chartsOrder=a;this._setChanged()};epiviz.workspaces.Workspace.prototype.changed=function(){return this._changed};epiviz.workspaces.Workspace.prototype.resetChanged=function(){this._changed=!1};epiviz.workspaces.Workspace.prototype._setChanged=function(){this._changed=!0;this._contentChanged.notify(this)};
epiviz.workspaces.Workspace.prototype.copy=function(a,b){var c=this.charts();return new epiviz.workspaces.Workspace(b||null,a,{range:this._range,computedMeasurements:new epiviz.measurements.MeasurementSet(this._computedMeasurements),charts:c})};
epiviz.workspaces.Workspace.prototype.raw=function(a){var b=new epiviz.measurements.MeasurementHashtable,c={};this._computedMeasurements.foreach(function(a){var c;a.componentMeasurements().foreach(function(a){var c=b.get(a);null===c&&(c=b.size(),b.put(a,c))});var d=a.formula().referredMeasurements,e;for(e in d)d.hasOwnProperty(e)&&(c=b.get(d[e]),null===c&&(c=b.size(),b.put(d[e],c)));c=b.get(a);null===c&&(c=b.size(),b.put(a,c))});for(var d in this._chartsOrder)if(this._chartsOrder.hasOwnProperty(d)){c[d]=
[];for(var e=0;e<this._chartsOrder[d].length;++e){var f=this._chartsById[this._chartsOrder[d][e]],g=f.properties,h=[];(function(a){g.visConfigSelection.measurements.foreach(function(c){var d=b.get(c);null===d&&(d=b.size(),b.put(c,d));a.push(d)})})(h);c[d].push({id:f.id,type:f.type.typeName(),properties:{width:g.width,height:g.height,margins:g.margins.raw(),visConfigSelection:{measurements:h,datasource:g.visConfigSelection.datasource,datasourceGroup:g.visConfigSelection.datasourceGroup,dataprovider:g.visConfigSelection.dataprovider,
annotation:g.visConfigSelection.annotation,defaultChartType:g.visConfigSelection.defaultChartType,minSelectedMeasurements:g.visConfigSelection.minSelectedMeasurements,customData:g.visConfigSelection.customData},colors:g.colors.raw(a),modifiedMethods:epiviz.utils.mapCopy(g.modifiedMethods),customSettings:g.customSettingsValues||null,chartMarkers:g.chartMarkers.map(function(a){return a.raw()})}})}}var m=Array(b.size());b.foreach(function(a,c){m[c]=a.raw(b)});return{id:this._id,name:this._name,content:{range:this._range.raw(),
measurements:m,charts:c}}};
epiviz.workspaces.Workspace.fromRawObject=function(a,b,c){var d,e=Array(a.content.measurements.length),f=new epiviz.measurements.MeasurementSet;for(d=0;d<a.content.measurements.length;++d)a.content.measurements[d].formula||(e[d]=epiviz.measurements.Measurement.fromRawObject(a.content.measurements[d]));for(d=0;d<a.content.measurements.length;++d)a.content.measurements[d].formula&&(e[d]=epiviz.measurements.Measurement.fromRawObject(a.content.measurements[d],e),f.add(e[d]));var g={},h;for(h in a.content.charts)if(a.content.charts.hasOwnProperty(h))for(g[h]=
[],d=0;d<a.content.charts[h].length;++d){var m=a.content.charts[h][d],l,p=m.properties.visConfigSelection,n=p?p.measurements:m.properties.measurements;if(n){l=new epiviz.measurements.MeasurementSet;for(var t=0;t<n.length;++t)l.add(e[n[t]])}p=p?new epiviz.ui.controls.VisConfigSelection(l,p.datasource,p.datasourceGroup,p.dataprovider,p.annotation,p.defaultChartType,p.minSelectedMeasurements,p.customData):new epiviz.ui.controls.VisConfigSelection(l);(n=b.get(m.type))&&g[h].push({id:m.id,type:n,properties:new epiviz.ui.charts.VisualizationProperties(m.properties.width,
m.properties.height,epiviz.ui.charts.Margins.fromRawObject(m.properties.margins),p,epiviz.ui.charts.ColorPalette.fromRawObject(m.properties.colors,c),m.properties.modifiedMethods,m.properties.customSettings,n.customSettingsDefs(),m.properties.chartMarkers?m.properties.chartMarkers.map(function(a){return epiviz.ui.charts.markers.VisualizationMarker.fromRawObject(a)}):[])})}return new epiviz.workspaces.Workspace(a.id,a.name,{range:epiviz.datatypes.GenomicRange.fromRawObject(a.content.range),computedMeasurements:f,
charts:g})};epiviz.workspaces.Workspace.prototype.onContentChanged=function(){return this._contentChanged};epiviz.ui.controls.Dialog=function(a,b){this._container=$("#dialogs");this._title=a;this._id=epiviz.ui.controls.Dialog.generateId();this._handlers=b;this._container.append(sprintf('<div id="%s" title="%s" style="display: none;"></div>',this._id,this._title));this._dialog=null};epiviz.ui.controls.Dialog._nextIdIndex=0;epiviz.ui.controls.Dialog.generateId=function(){return sprintf("dialog-%s",epiviz.utils.generatePseudoGUID(5))};epiviz.ui.controls.Dialog.prototype.show=function(){};epiviz.ui.controls.MessageDialog=function(a,b,c,d){epiviz.ui.controls.Dialog.call(this,a,b);this._message=c;this._icon=d||epiviz.ui.controls.MessageDialog.Icon.INFO};epiviz.ui.controls.MessageDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.MessageDialog.constructor=epiviz.ui.controls.MessageDialog;epiviz.ui.controls.MessageDialog.Icon={INFO:"info",ERROR:"error",QUESTION:"question"};
epiviz.ui.controls.MessageDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var a=epiviz.ui.controls.MessageDialog.Icon;if(!this._dialog){var b=this;this._dialog=$("#"+this._id);this._dialog.css("display","inline");this._dialog.append(sprintf('<div class="ui-state-%s ui-corner-all" style="margin: 5px; padding: 5px; height: auto;"><div class="ui-icon ui-icon-%s" style="float: left; margin-right: 5px;"></div><div class="dialog-text">%s</div></div>',this._icon==a.ERROR?
"error":"highlight",this._icon==a.ERROR?"alert":"info",this._message));var c={},d;for(d in this._handlers)this._handlers.hasOwnProperty(d)&&function(a){c[a]=function(){b._handlers[a]();$(this).dialog("close")}}(d);this._dialog.dialog({autoOpen:!1,resizable:!1,buttons:c,modal:!0});this._dialog.dialog({close:function(a,c){$(this).remove();b._dialog=null}})}this._dialog.dialog("open");this._dialog.dialog("option","position","center")};epiviz.EpiViz=function(a,b,c,d,e,f,g,h,m,l,p){this._config=a;this._locationManager=b;this._measurementsManager=c;this._controlManager=d;this._dataManager=e;this._chartFactory=f;this._chartManager=g;this._workspaceManager=h;this._userManager=m;this._webArgsManager=l;this._cookieManager=p;this._registerRequestSeqInfos();this._registerRequestMeasurements();this._registerUiAddChart();this._registerUiSaveWorkspace();this._registerUiDeleteActiveWorkspace();this._registerUiRevertActiveWorkspace();this._registerUiLoginLinkClicked();
this._registerUiSearchWorkspaces();this._registerUiActiveWorkspaceChanged();this._registerUiSearch();this._registerChartRequestHierarchy();this._registerChartPropagateHierarchySelection();this._registerChartPropogateIcicleLocationChange();this._registerChartPropagateNavigationChanges();this._registerUiSettingsChanged();this._registerDataAddMeasurements();this._registerDataLoadMeasurements();this._registerDataRemoveMeasurements();this._registerDataAddChart();this._registerDataRemoveChart();this._registerDataAddSeqInfos();
this._registerDataRemoveSeqNames();this._registerDataNavigate();this._registerDataRedraw();this._registerDataGetCurrentLocation();this._registerPrintWorkspace();this._registerLoadWorkspace();this._registerDataSetChartSettings();this._registerDataGetChartSettings();this._registerDataGetAvailableCharts();this._registerDataUiStatus();this._registerRequestWorkspaces();this._registerWorkspacesLoaded();this._registerActiveWorkspaceChanged();this._registerActiveWorkspaceContentChanged();this._registerLocationChanged()};
epiviz.EpiViz.VERSION="5";epiviz.EpiViz.prototype.start=function(){this._cookieManager.initialize();this._controlManager.initialize();this._workspaceManager.initialize();this._measurementsManager.initialize();this._locationManager.initialize()};epiviz.EpiViz.prototype.config=function(){return this._config};
epiviz.EpiViz.prototype._addChart=function(a,b,c,d){c=this._chartManager.addChart(a,b,c,d);var e=this;if("epiviz.plugins.charts.CustomScatterPlot"==a.typeName()){var f=null;a={};a[c]=b.measurements;this._dataManager.getPCA(f,a,function(a,b){e._chartManager.updateCharts(f,b,[a])})}else"epiviz.plugins.charts.DiversityScatterPlot"==a.typeName()?(f=null,a={},a[c]=b.measurements,this._dataManager.getDiversity(f,a,function(a,b){e._chartManager.updateCharts(f,b,[a])})):a.chartDisplayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE?
(a={},a[c]=b,f=this._workspaceManager.activeWorkspace().range(),this._dataManager.getHierarchy(a,function(a,b){e._chartManager.updateCharts(f,b,[a])})):(f=this._workspaceManager.activeWorkspace().range(),this._chartManager.dataWaitStart(c),a={},a[c]=b.measurements,this._dataManager.getData(f,a,function(a,b){e._chartManager.updateCharts(f,b,[a])}));return c};
epiviz.EpiViz.prototype._registerRequestSeqInfos=function(){var a=this;this._locationManager.onRequestSeqInfos().addListener(new epiviz.events.EventListener(function(){a._dataManager.getSeqInfos(function(b){a._locationManager.updateSeqInfos(b)},function(a,c,d){console.log("error")})}))};
epiviz.EpiViz.prototype._registerRequestMeasurements=function(){var a=this;this._measurementsManager.onRequestMeasurements().addListener(new epiviz.events.EventListener(function(){a._dataManager.getMeasurements(function(b){a._measurementsManager.addMeasurements(b)},function(a,c,d){console.log("error")})}))};
epiviz.EpiViz.prototype._registerRequestWorkspaces=function(){var a=this;this._workspaceManager.onRequestWorkspaces().addListener(new epiviz.events.EventListener(function(b){var c=a._cookieManager.getWorkspace(a._chartFactory,a._config);a._dataManager.getWorkspaces(function(d){for(var e=[],f=null,g=null,h=0;h<d.length;++h){var m=epiviz.workspaces.Workspace.fromRawObject(d[h],a._chartFactory,a._config);null===m.id()?f=m:(m.id()==b.activeWorkspaceId&&(c&&c.id()==b.activeWorkspaceId&&(g=m,m=c),f=m),
e.push(m))}a._workspaceManager.updateWorkspaces(e,f,b.activeWorkspaceId,g);c||a._workspaceManager.activeWorkspace().resetChanged()},"",b.activeWorkspaceId)}))};epiviz.EpiViz.prototype._registerUiAddChart=function(){var a=this;this._controlManager.onAddChart().addListener(new epiviz.events.EventListener(function(b){a._addChart(b.type,b.visConfigSelection)}))};
epiviz.EpiViz.prototype._registerUiSaveWorkspace=function(){var a=this;this._controlManager.onSaveWorkspace().addListener(new epiviz.events.EventListener(function(b){var c=a._workspaceManager.getByName(b.name),c=c?a._workspaceManager.activeWorkspace().copy(b.name,c.id()):a._workspaceManager.activeWorkspace().copy(b.name);a._dataManager.saveWorkspace(c,a._config,function(b){c=c.copy(c.name(),b);c.resetChanged();a._workspaceManager.updateWorkspace(c);a._workspaceManager.changeActiveWorkspace(b)})}))};
epiviz.EpiViz.prototype._registerUiDeleteActiveWorkspace=function(){var a=this;this._controlManager.onDeleteActiveWorkspace().addListener(new epiviz.events.EventListener(function(){a._dataManager.deleteWorkspace(a._workspaceManager.activeWorkspace());a._workspaceManager.deleteActiveWorkspace()}))};epiviz.EpiViz.prototype._registerUiRevertActiveWorkspace=function(){var a=this;this._controlManager.onRevertActiveWorkspace().addListener(new epiviz.events.EventListener(function(){a._workspaceManager.revertActiveWorkspace()}))};
epiviz.EpiViz.prototype._registerUiLoginLinkClicked=function(){var a=this;this._controlManager.onLoginLinkClicked().addListener(new epiviz.events.EventListener(function(){a._userManager.toggleLogin()}))};epiviz.EpiViz.prototype._registerUiSearchWorkspaces=function(){var a=this;this._controlManager.onSearchWorkspaces().addListener(new epiviz.events.EventListener(function(b){a._dataManager.getWorkspaces(function(a){b.callback(a)},b.searchTerm,b.searchTerm)}))};
epiviz.EpiViz.prototype._registerUiActiveWorkspaceChanged=function(){var a=this;this._controlManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(b){var c=function(){b.newValue.id&&!a._workspaceManager.get(b.newValue.id)?a._dataManager.getWorkspaces(function(c){for(var d=null,f=0;f<c.length;++f){var g=epiviz.workspaces.Workspace.fromRawObject(c[f],a._chartFactory,a._config);if(null===g.id()){d=g;break}}d&&a._workspaceManager.changeActiveWorkspace(b.newValue.id,d)},
b.newValue.name,b.newValue.id):a._workspaceManager.changeActiveWorkspace(b.newValue.id)};epiviz.workspaces.UserManager.USER_STATUS.loggedIn&&!a._workspaceManager.activeWorkspaceChanging()&&a._workspaceManager.activeWorkspace().changed()?(new epiviz.ui.controls.MessageDialog("Discard workspace changes",{Yes:function(){c()},No:function(){b.cancel()}},"There are unsaved changes in the current workspace. Do you wish to discard them?",epiviz.ui.controls.MessageDialog.Icon.QUESTION)).show():c()}))};
epiviz.EpiViz.prototype._registerUiSearch=function(){var a=this;this._controlManager.onSearch().addListener(new epiviz.events.EventListener(function(b){a._dataManager.search(function(a){b.callback(a)},b.searchTerm)}))};
epiviz.EpiViz.prototype._registerChartRequestHierarchy=function(){var a=this;this._chartManager.onChartRequestHierarchy().addListener(new epiviz.events.EventListener(function(b){var c={};c[b.id]=b.args;a._dataManager.getHierarchy(c,function(b,c){a._chartManager.updateCharts(void 0,c,[b])})}))};
epiviz.EpiViz.prototype._registerChartPropagateHierarchySelection=function(){var a=this;this._chartManager.onChartPropagateHierarchyChanges().addListener(new epiviz.events.EventListener(function(b){var c={};c[b.id]=b.args;a._dataManager.propagateHierarchyChanges(c,function(b,c){a._chartManager.updateCharts(void 0,c,[b])})}))};epiviz.EpiViz.prototype._registerChartPropagateNavigationChanges=function(){var a=this;this._chartManager.onChartPropagateNavigationChanges().addListener(new epiviz.events.EventListener(function(b){a._locationManager.changeCurrentLocation(b.range)}))};
epiviz.EpiViz.prototype._registerUiSettingsChanged=function(){var a=this;this._workspaceManager.onUiChartSettingsChanged().addListener(new epiviz.events.EventListener(function(b){a._dataManager.updateChartSettings(b)}))};
epiviz.EpiViz.prototype._registerDataAddMeasurements=function(){var a=this;this._dataManager.onRequestAddMeasurements().addListener(new epiviz.events.EventListener(function(b){try{a._measurementsManager.addMeasurements(b.measurements),b.result.success=!0}catch(c){b.result.success=!1,b.result.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataRemoveMeasurements=function(){var a=this;this._dataManager.onRequestRemoveMeasurements().addListener(new epiviz.events.EventListener(function(b){try{a._measurementsManager.removeMeasurements(b.measurements),b.result.success=!0}catch(c){b.result.success=!1,b.result.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataLoadMeasurements=function(){var a=this;this._dataManager.onRequestLoadMeasurements().addListener(new epiviz.events.EventListener(function(b){try{var c=a._measurementsManager.getRemoteMeasurements();b.result.success=!0;b.result.measurements=c}catch(d){b.result.success=!1,b.result.errorMessage=d.toString()}}))};
epiviz.EpiViz.prototype._registerDataAddChart=function(){var a=this;this._dataManager.onRequestAddChart().addListener(new epiviz.events.EventListener(function(b){try{var c=a._chartFactory.get(b.type),d=a._addChart(c,b.visConfigSelection);b.result.success=!0;b.result.value={id:d}}catch(e){b.result.success=!1,b.result.errorMessage=e.toString()}}))};
epiviz.EpiViz.prototype._registerDataRemoveChart=function(){var a=this;this._dataManager.onRequestRemoveChart().addListener(new epiviz.events.EventListener(function(b){try{a._chartManager.removeChart(b.id),b.result.success=!0}catch(c){b.result.success=!1,b.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerPrintWorkspace=function(){this._dataManager.onRequestPrintWorkspace().addListener(new epiviz.events.EventListener(function(a){try{(new epiviz.ui.PrintManager(a.chartId,a.fileName,a.fileType)).print(),a.result.success=!0}catch(b){a.result.success=!1,a.errorMessage=b.toString()}}))};
epiviz.EpiViz.prototype._registerLoadWorkspace=function(){var a=this;this._dataManager.onRequestLoadWorkspace().addListener(new epiviz.events.EventListener(function(b){try{a._workspaceManager._requestWorkspaces.notify({activeWorkspaceId:b.workspace})}catch(c){b.result.success=!1,b.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataSetChartSettings=function(){var a=this;this._dataManager.onRequestSetChartSettings().addListener(new epiviz.events.EventListener(function(b){try{a._chartManager.setChartSettings(b.chartId,b.settings,b.colorMap),b.result.success=!0}catch(c){b.result.success=!1,b.result.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataGetChartSettings=function(){var a=this;this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(b){try{a._chartManager.getChartSettings(b.chartId),b.result.success=!0}catch(c){b.result.success=!1,b.result.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataGetAvailableCharts=function(){var a=this;this._dataManager.onRequestGetChartSettings().addListener(new epiviz.events.EventListener(function(b){try{b.result.value=[],a._chartFactory.foreach(function(a,d){b.result.value.push({chartName:a,customSettings:d.customSettingsDefs(),colorMap:d.defaultColors()._colors})}),b.result.success=!0}catch(c){b.result.success=!1,b.result.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataAddSeqInfos=function(){var a=this;this._dataManager.onRequestAddSeqInfos().addListener(new epiviz.events.EventListener(function(b){try{a._locationManager.addSeqInfos(b.seqInfos),b.result.success=!0}catch(c){b.result.success=!1,b.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataRemoveSeqNames=function(){var a=this;this._dataManager.onRequestRemoveSeqNames().addListener(new epiviz.events.EventListener(function(b){try{a._locationManager.removeSeqNames(b.seqNames),b.result.success=!0}catch(c){b.result.success=!1,b.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataNavigate=function(){var a=this;this._dataManager.onRequestNavigate().addListener(new epiviz.events.EventListener(function(b){try{a._locationManager.changeCurrentLocation(b.range),b.result.success=!0}catch(c){b.result.success=!1,b.errorMessage=c.toString()}}))};
epiviz.EpiViz.prototype._registerDataRedraw=function(){var a=this;this._dataManager.onRequestRedraw().addListener(new epiviz.events.EventListener(function(b){try{var c=a._locationManager.currentLocation();a._locationManager.changeCurrentLocation(c);b.result.success=!0;a._chartManager.updateDataStructureCharts()}catch(d){b.result.success=!1,b.errorMessage=d.toString()}}))};
epiviz.EpiViz.prototype._registerDataGetCurrentLocation=function(){var a=this;this._dataManager.onRequestCurrentLocation().addListener(new epiviz.events.EventListener(function(b){try{var c=a._locationManager.currentLocation();b.result.value={seqName:c.seqName(),start:c.start(),end:c.end()};b.result.success=!0}catch(d){b.result.success=!1,b.errorMessage=d.toString()}}))};epiviz.EpiViz.prototype._registerWorkspacesLoaded=function(){this._workspaceManager.onWorkspacesLoaded().addListener(new epiviz.events.EventListener(function(a){}))};
epiviz.EpiViz.prototype._registerActiveWorkspaceChanged=function(){var a=this;this._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(b){a._workspaceManager.startChangingActiveWorkspace();a._controlManager.updateSelectedWorkspace({id:b.newValue.id(),name:b.newValue.name()});a._locationManager.changeCurrentLocation(b.newValue.range());a._measurementsManager.removeMeasurements(a._measurementsManager.computedMeasurements());a._measurementsManager.addMeasurements(b.newValue.computedMeasurements());
a._chartManager.clear();b=b.newValue.charts();for(var c in b)if(b.hasOwnProperty(c))for(var d=0;d<b[c].length;++d)a._addChart(b[c][d].type,b[c][d].properties.visConfigSelection,b[c][d].id,b[c][d].properties.copy());a._workspaceManager.endChangingActiveWorkspace()}))};epiviz.EpiViz.prototype._registerActiveWorkspaceContentChanged=function(){var a=this;this._workspaceManager.onActiveWorkspaceContentChanged().addListener(new epiviz.events.EventListener(function(b){a._cookieManager.saveWorkspace(b,a._config)}))};
epiviz.EpiViz.prototype._registerLocationChanged=function(){var a=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(b){a._chartManager.dataWaitStart(void 0,function(a){return a.displayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE});var c=a._chartManager.chartsMeasurements(),d;for(d in c)-1==d.indexOf("pca_scatter")&&-1==d.indexOf("diversity_scatter")||delete c[d];a._dataManager.getData(b.newValue,c,function(c,d){a._chartManager.updateCharts(b.newValue,
d,[c])});a._chartManager.onChartPropogateIcicleLocationChanges().isFiring()||a._chartManager.onChartIcicleLocationChanges().notify()}))};epiviz.EpiViz.prototype._registerChartPropogateIcicleLocationChange=function(){var a=this;a._chartManager.onChartPropogateIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(b){var c=a._locationManager.currentLocation();null!=c&&a._locationManager.changeCurrentLocation(new epiviz.datatypes.GenomicRange(c.seqName(),b.start,b.width))}))};
epiviz.EpiViz.prototype._registerDataUiStatus=function(){var a=this;this._dataManager.onRequestUiStatus().addListener(new epiviz.events.EventListener(function(b){null==a._workspaceManager._activeWorkspace?a._workspaceManager.onActiveWorkspaceChanged().addListener(new epiviz.events.EventListener(function(a){b.result.success=!0})):b.result.success=!0}))};epiviz.localstorage={};epiviz.localstorage.LocalStorageManager=function(a){this._workspace=a;this._availStorage="undefined"===typeof Storage||null==localStorage?!1:!0};epiviz.localstorage.LocalStorageManager.MODE={INCOGNITO_MODE:"incognito_workspace",COOKIE_MODE:"workspace"};epiviz.localstorage.LocalStorageManager.prototype.initialize=function(){};
epiviz.localstorage.LocalStorageManager.prototype.getWorkspace=function(a,b){if(this._availStorage){var c=localStorage.getItem(this._workspace);return c?epiviz.workspaces.Workspace.fromRawObject(JSON.parse(c),a,b):null}};epiviz.localstorage.LocalStorageManager.prototype.saveWorkspace=function(a,b){if(this._availStorage){var c=a.raw(b);localStorage.setItem(this._workspace,JSON.stringify(c))}};epiviz.localstorage.LocalStorageManager.prototype.clearWorkspace=function(){this._availStorage&&localStorage.removeItem(this._workspace)};
epiviz.localstorage.LocalStorageManager.prototype.clearAll=function(){this._availStorage&&localStorage.clear()};epiviz.ui.LocationManager=function(a){this._seqInfos={};this._timeout=this._lastUnfilledRequest=this._currentLocation=null;this._navigationDelay=a.navigationDelay;this._currentLocationChanged=new epiviz.events.Event;this._seqInfosUpdated=new epiviz.events.Event;this._requestSeqInfos=new epiviz.events.Event};epiviz.ui.LocationManager.prototype.initialize=function(){this._requestSeqInfos.notify()};
epiviz.ui.LocationManager.prototype.changeCurrentLocation=function(a){if(!this._currentLocationChanged.isFiring()){this._lastUnfilledRequest=a;null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null);var b=this;a=function(){var a=b._lastUnfilledRequest;null!==a&&b._doChangeCurrentLocation(a)};this._navigationDelay?this._timeout=window.setTimeout(a,this._navigationDelay):a()}};
epiviz.ui.LocationManager.prototype._doChangeCurrentLocation=function(a){var b=this._currentLocation,c=a.genome(),d=a.seqName();if(!(a.seqName()in this._seqInfos)){if(!b)return;d=b.seqName()}var e=void 0,f=void 0;this._seqInfos[d]&&void 0!=this._seqInfos[d].min&&void 0!=this._seqInfos[d].max&&(e=void 0!=a.start()&&a.start()>=this._seqInfos[d].min?a.start():this._seqInfos[d].min,f=void 0!=a.width()?e+a.width():e+9999);void 0!=e&&void 0!=f&&f>this._seqInfos[d].max&&(e=Math.max(this._seqInfos[d].min,
this._seqInfos[d].max-f+e),f=this._seqInfos[d].max);this._lastUnfilledRequest=null;this._currentLocation=epiviz.datatypes.GenomicRange.fromStartEnd(d,e,f,c);this._currentLocationChanged.notify({oldValue:b,newValue:this._currentLocation})};epiviz.ui.LocationManager.prototype.currentLocation=function(){return this._currentLocation};epiviz.ui.LocationManager.prototype.lastUnfilledLocationChangeRequest=function(){return this._lastUnfilledRequest};
epiviz.ui.LocationManager.prototype.updateSeqInfos=function(a){this._seqInfos={};for(var b=0;b<a.length;++b)this._seqInfos[a[b].seqName]=a[b];this._seqInfosUpdated.notify(a);null!==this._lastUnfilledRequest&&(this._lastUnfilledRequest.seqName()in this._seqInfos?this._doChangeCurrentLocation(this._lastUnfilledRequest):0<a.length&&(a=new epiviz.datatypes.GenomicRange(a[0].seqName,this._lastUnfilledRequest.start(),this._lastUnfilledRequest.width(),a[0].genome),this._doChangeCurrentLocation(a)))};
epiviz.ui.LocationManager.prototype.addSeqInfos=function(a){for(var b=0;b<a.length;++b)this._seqInfos[a[b].seqName]||(this._seqInfos[a[b].seqName]=a[b]);a=[];for(var c in this._seqInfos)this._seqInfos.hasOwnProperty(c)&&a.push(this._seqInfos[c]);this._seqInfosUpdated.notify(a)};
epiviz.ui.LocationManager.prototype.removeSeqNames=function(a){for(var b=0;b<a.length;++b)delete this._seqInfos[a[b]];a=[];for(var c in this._seqInfos)this._seqInfos.hasOwnProperty(c)&&a.push(this._seqInfos[c]);this._seqInfosUpdated.notify(a);this._currentLocation.seqName()in this._seqInfos||this.changeCurrentLocation(new epiviz.datatypes.GenomicRange(a[0].seqName,this._currentLocation.start(),this._currentLocation.width(),a[0].genome))};epiviz.ui.LocationManager.prototype.seqInfos=function(){return this._seqInfos};
epiviz.ui.LocationManager.prototype.onCurrentLocationChanged=function(){return this._currentLocationChanged};epiviz.ui.LocationManager.prototype.onSeqInfosUpdated=function(){return this._seqInfosUpdated};epiviz.ui.LocationManager.prototype.onRequestSeqInfos=function(){return this._requestSeqInfos};epiviz.measurements.MeasurementsManager=function(){this._requestMeasurements=new epiviz.events.Event;this._measurementsAdded=new epiviz.events.Event;this._measurementsRemoved=new epiviz.events.Event;this._computedMeasurementsAdded=new epiviz.events.Event;this._computedMeasurementsRemoved=new epiviz.events.Event;this._measurements=new epiviz.measurements.MeasurementSet;this._computedMeasurements=new epiviz.measurements.MeasurementSet};epiviz.measurements.MeasurementsManager.prototype.initialize=function(){this._requestMeasurements.notify()};
epiviz.measurements.MeasurementsManager.prototype.onRequestMeasurements=function(){return this._requestMeasurements};epiviz.measurements.MeasurementsManager.prototype.onMeasurementsAdded=function(){return this._measurementsAdded};epiviz.measurements.MeasurementsManager.prototype.onMeasurementsRemoved=function(){return this._measurementsRemoved};epiviz.measurements.MeasurementsManager.prototype.onComputedMeasurementsAdded=function(){return this._computedMeasurementsAdded};
epiviz.measurements.MeasurementsManager.prototype.onComputedMeasurementsRemoved=function(){return this._computedMeasurementsRemoved};epiviz.measurements.MeasurementsManager.prototype.measurements=function(){return this._measurements};epiviz.measurements.MeasurementsManager.prototype.computedMeasurements=function(){return this._computedMeasurements};
epiviz.measurements.MeasurementsManager.prototype.addMeasurements=function(a){if(a&&a.size()){var b=this;this._measurements.addAll(a);var c=new epiviz.measurements.MeasurementSet;a.foreach(function(a){a.isComputed()&&(c.add(a),b._computedMeasurements.add(a))});this._measurementsAdded.notify(a);0<c.size()&&this._computedMeasurementsAdded.notify(c)}};
epiviz.measurements.MeasurementsManager.prototype.removeMeasurements=function(a){var b=this;this._measurements.removeAll(a);var c=new epiviz.measurements.MeasurementSet;a.foreach(function(a){a.isComputed()&&(c.add(a),b._computedMeasurements.remove(a))});this._measurementsRemoved.notify(a);0<c.size()&&this._computedMeasurementsRemoved.notify(c)};epiviz.measurements.MeasurementsManager.prototype.addMeasurement=function(a){var b=new epiviz.measurements.MeasurementSet;b.add(a);this.addMeasurements(b)};
epiviz.measurements.MeasurementsManager.prototype.removeMeasurement=function(a){var b=new epiviz.measurements.MeasurementSet;b.add(a);this.removeMeasurements(b)};epiviz.measurements.MeasurementsManager.prototype.getRemoteMeasurements=function(){return this._measurements.remoteRaw()};epiviz.ui.charts.markers.MeasurementAggregator=function(a,b){this._id=a;this._aggregator=b};epiviz.ui.charts.markers.MeasurementAggregator.prototype.aggregate=function(a,b,c){return this._aggregator(a,b,c)};epiviz.ui.charts.markers.MeasurementAggregator.prototype.id=function(){return this._id};
epiviz.ui.charts.markers.MeasurementAggregators={"mean-stdev":new epiviz.ui.charts.markers.MeasurementAggregator("mean-stdev",function(a,b,c){if(!c||0==c.length)return null;var d=c.reduce(function(a,b){return a+b})/c.length;a=c.map(function(a){return(a-d)*(a-d)}).reduce(function(a,b){return a+b})/c.length;a=Math.sqrt(a);return{value:d,errMinus:d-a,errPlus:d+a}}),quartiles:new epiviz.ui.charts.markers.MeasurementAggregator("quartiles",function(a,b,c){if(!c||0==c.length)return null;c=c.slice(0).sort(function(a,
b){return a-b});a=c.length;b=Math.floor(.5*a);var d=Math.ceil(.5*a);return{value:.5*(c[Math.floor(.5*(a-1))]+c[b]),errMinus:.5*(c[Math.floor(.5*(b-1))]+c[Math.floor(.5*b)]),errPlus:.5*(c[d+Math.floor(.5*(a-d-1))]+c[d+Math.floor(.5*(a-d))])}}),count:new epiviz.ui.charts.markers.MeasurementAggregator("count",function(a,b,c){return c&&0!=c.length?{value:c.length}:0}),min:new epiviz.ui.charts.markers.MeasurementAggregator("min",function(a,b,c){return c&&0!=c.length?{value:Math.min.apply(void 0,c)}:null}),
max:new epiviz.ui.charts.markers.MeasurementAggregator("max",function(a,b,c){return c&&0!=c.length?{value:Math.max.apply(void 0,c)}:null}),sum:new epiviz.ui.charts.markers.MeasurementAggregator("sum",function(a,b,c){return c&&0!=c.length?{value:c.reduce(function(a,b){return a+b})}:null}),log:new epiviz.ui.charts.markers.MeasurementAggregator("log",function(a,b,c){return c&&0!=c.length?{value:c.reduce(function(a,b){return Math.log2((a+1)/(b+1))})}:null}),negate:new epiviz.ui.charts.markers.MeasurementAggregator("negate",
function(a,b,c){return c&&0!=c.length?{value:c.reduce(function(a,b){return a+b})/c.length,errMinus:c.reduce(function(a,b){return a}),errPlus:c.reduce(function(a,b){return-1*b})}:null})};epiviz.ui.charts.ChartType=function(a){epiviz.ui.charts.VisualizationType.call(this,a)};epiviz.ui.charts.ChartType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisualizationType.prototype);epiviz.ui.charts.ChartType.constructor=epiviz.ui.charts.ChartType;epiviz.ui.charts.ChartType.prototype.createNew=function(a,b,c){throw Error("unimplemented abstract method");};
epiviz.ui.charts.ChartType.prototype.customSettingsDefs=function(){var a=epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs.call(this);if(this.isRestrictedToRangeMeasurements())return a;var b=Object.keys(epiviz.ui.charts.markers.MeasurementAggregators);return a.concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,b[0],"Aggregator for measurement groups",b)])};
epiviz.ui.charts.ChartType.CustomSettings={MEASUREMENT_GROUPS_AGGREGATOR:"measurementGroupsAggregator"};epiviz.ui.charts.Chart=function(a,b,c){epiviz.ui.charts.Visualization.call(this,a,b,c);this._nBins=100;this._globalIndexColorLabels=this._measurementColorLabels=this._binSize=null};epiviz.ui.charts.Chart.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Visualization.prototype);epiviz.ui.charts.Chart.constructor=epiviz.ui.charts.Chart;epiviz.ui.charts.Chart.prototype._initialize=function(){epiviz.ui.charts.Visualization.prototype._initialize.call(this);this._svg.classed("base-chart",!0)};
epiviz.ui.charts.Chart.prototype._addFilters=function(){var a=this._svg.append("defs"),b=a.append("filter").attr("id",this.id()+"-glow");b.append("feGaussianBlur").attr("id","gaussianBlur").attr("stdDeviation","2").attr("result","blurResult");b.append("feComposite").attr("id","composite").attr("in","SourceGraphic").attr("in2","blurResult").attr("operator","over");b=a.append("filter").attr("id",this.id()+"-contour");b.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation","1").attr("result",
"blur");b.append("feColorMatrix").attr("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 10 -1 ").attr("result","colorMatrix");b.append("feFlood").attr("result","fillColor").attr("flood-color","#800000").attr("in","blur");b.append("feComposite").attr("result","composite").attr("in","fillColor").attr("in2","colorMatrix").attr("operator","atop");b.append("feComposite").attr("in","SourceGraphic").attr("in2","composite").attr("operator","atop");a=a.append("filter").attr("id",this.id()+"-dropshadow").attr("filterUnits",
"userSpaceOnUse").attr("color-interpolation-filters","sRGB");b=a.append("feComponentTransfer").attr("in","SourceAlpha");b.append("feFuncR").attr("type","discrete").attr("tableValues","1");b.append("feFuncG").attr("type","discrete").attr("tableValues",198/255);b.append("feFuncB").attr("type","discrete").attr("tableValues","0");a.append("feGaussianBlur").attr("stdDeviation","2");a.append("feOffset").attr("dx","0").attr("dy","0").attr("result","shadow");a.append("feComposite").attr("in","SourceGraphic").attr("in2",
"shadow").attr("operator","over")};epiviz.ui.charts.Chart.prototype.draw=function(a,b){epiviz.ui.charts.Visualization.prototype.draw.call(this,a,b);a&&(this._binSize=Math.ceil((a.end()-a.start())/this._nBins));return[]};
epiviz.ui.charts.Chart.prototype.transformData=function(a,b){var c=new epiviz.deferred.Deferred,d=this;epiviz.ui.charts.Visualization.prototype.transformData.call(this,a,b).done(function(){d._lastData?d._lastData.ready(function(){var a=!1;d._lastData.measurements().every(function(b){a=b.type()!==epiviz.measurements.Measurement.Type.RANGE;return!a});if(a){var b;d._markers.every(function(a){a&&a.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS&&(b=a);return!b});if(b){var g=
epiviz.ui.charts.markers.MeasurementAggregators[d.customSettingsValues()[epiviz.ui.charts.ChartType.CustomSettings.MEASUREMENT_GROUPS_AGGREGATOR]];d._lastData=new epiviz.datatypes.MeasurementAggregatedGenomicData(d._lastData,b,g)}}var h;d._markers.every(function(a){a&&a.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER&&(h=a);return!h});h&&(d._lastData=new epiviz.datatypes.ItemFilteredGenomicData(d._lastData,h));var m;d._markers.every(function(a){a&&a.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.ORDER_BY_MEASUREMENTS&&
(m=a);return!m});m&&(d._lastData=new epiviz.datatypes.MeasurementOrderedGenomicData(d._lastData,m));d._lastData.ready(function(){var a=d._lastData;if(a.isReady()){var b=new epiviz.deferred.Deferred,e;d._markers.every(function(a){a&&a.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_MEASUREMENTS&&(e=a);return!e});d._measurementColorLabels=null;if(e){var f=new epiviz.measurements.MeasurementHashtable;e.preMark()(a).done(function(c){var g=a.measurements();epiviz.utils.deferredFor(g.length,
function(b){var d=new epiviz.deferred.Deferred;e.mark()(g[b],a,c).done(function(a){f.put(g[b],a);d.resolve()});return d}).done(function(){d._measurementColorLabels=f;b.resolve()})})}else b.resolve();var g=new epiviz.deferred.Deferred,h;d._markers.every(function(a){a&&a.type()==epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_ROW&&(h=a);return!h});d._globalIndexColorLabels=null;if(h){var m={};h.preMark()(a).done(function(b){var c=a.firstSeries();epiviz.utils.deferredFor(c.size(),function(d){var e=
new epiviz.deferred.Deferred;h.mark()(c.getRow(d),a,b).done(function(a){m[d+c.globalStartIndex()]=a;e.resolve()});return e}).done(function(){d._globalIndexColorLabels=m;g.resolve()})})}else g.resolve();b.done(function(){g.state()==epiviz.deferred.Deferred.State.RESOLVED&&(d._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(d.id())),c.resolve())});g.done(function(){b.state()==epiviz.deferred.Deferred.State.RESOLVED&&(d._dataWaitEnd.notify(new epiviz.ui.charts.VisEventArgs(d.id())),c.resolve())})}})}):
c.resolve()});return c};epiviz.ui.charts.Chart.prototype.properties=function(){return epiviz.ui.charts.Visualization.prototype.properties.call(this)};epiviz.ui.charts.VisObject=function(){};epiviz.ui.charts.VisObject.prototype.regionStart=function(){return null};epiviz.ui.charts.VisObject.prototype.regionEnd=function(){return null};epiviz.ui.charts.VisObject.prototype.regionSeqName=function(){return null};epiviz.ui.charts.VisObject.prototype.getMetadata=function(a,b,c){return null};epiviz.ui.charts.VisObject.prototype.getSeqName=function(a,b){return null};epiviz.ui.charts.VisObject.prototype.getStart=function(a,b){return null};
epiviz.ui.charts.VisObject.prototype.getEnd=function(a,b){return null};epiviz.ui.charts.VisObject.prototype.metadataColumns=function(){return null};epiviz.ui.charts.VisObject.prototype.dimensions=function(){return[0,0]};epiviz.ui.charts.VisObject.prototype.metadataLooseCompare=function(){return!1};
epiviz.ui.charts.VisObject.prototype.overlapsWith=function(a){if(!a)return!1;if(this===a)return!0;var b,c,d;if(this.regionSeqName()!=a.regionSeqName())return!1;var e=this.dimensions(),f=a.dimensions();if(!(e[0]&&f[0]||void 0!=this.regionStart()&&void 0!=a.regionStart()&&void 0!=this.regionEnd()&&void 0!=a.regionEnd()))return!1;if(!e[0]){if(!f[0])return this.regionStart()<a.regionEnd()&&this.regionEnd()>a.regionStart();for(c=0;c<f[1];++c)if(b=a.getStart(0,c),d=a.getEnd(0,c),void 0!=b&&void 0!=d&&this.regionStart()<
d&&this.regionEnd()>b)return!0;return!1}var g=epiviz.utils.arrayIntersection(this.metadataColumns(),a.metadataColumns());if(g.length){for(b=0;b<e[1];++b)for(c=0;c<f[1];++c){var h=!0;for(d=0;d<g.length;++d){var m=this.metadataLooseCompare()||a.metadataLooseCompare(),l=this.getMetadata(0,b,g[d]),p=a.getMetadata(0,c,g[d]);if(l!=p){if(!m){h=!1;break}l.length<=p.length?(m=l,l=p):m=p;if(!(new RegExp("^(.+,)?"+m+"(,.+)?$")).test(l)){h=!1;break}}}if(h)return!0}return!1}for(b=0;b<e[1];++b)for(c=0;c<f[1];++c)if(this.getStart(0,
b)<a.getEnd(0,c)&&this.getEnd(0,b)>a.getStart(0,c))return!0;return!1};epiviz.ui.charts.ChartObject=function(a,b,c,d,e,f,g,h,m){epiviz.ui.charts.VisObject.call(this);this.id=a;this.seqName=m;this.start=b;this.end=c;this.values=d;this.seriesIndex=e;this.valueItems=f;this.measurements=g;this.cssClasses=h};epiviz.ui.charts.ChartObject.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisObject.prototype);epiviz.ui.charts.ChartObject.constructor=epiviz.ui.charts.ChartObject;epiviz.ui.charts.ChartObject.prototype.regionStart=function(){return this.start};
epiviz.ui.charts.ChartObject.prototype.regionEnd=function(){return this.end};epiviz.ui.charts.ChartObject.prototype.regionSeqName=function(){return this.seqName};epiviz.ui.charts.ChartObject.prototype.getMetadata=function(a,b,c){return this.valueItems?this.valueItems[a][b].rowItem.metadata(c):null};epiviz.ui.charts.ChartObject.prototype.getStart=function(a,b){return this.valueItems[a][b].rowItem.start()};epiviz.ui.charts.ChartObject.prototype.getSeqName=function(a,b){return this.seqName|this.valueItems[a][b].rowItem.seqName()};
epiviz.ui.charts.ChartObject.prototype.getEnd=function(a,b){return this.valueItems[a][b].rowItem.end()};epiviz.ui.charts.ChartObject.prototype.metadataColumns=function(){return this.valueItems&&this.valueItems[0]&&this.valueItems[0][0]?Object.keys(this.valueItems[0][0].rowItem.rowMetadata()):[]};epiviz.ui.charts.ChartObject.prototype.dimensions=function(){var a=[];return this.valueItems?(a.push(this.valueItems.length),this.valueItems.length?a.push(this.valueItems[0].length):a.push(0),a):[0,0]};epiviz.ui.charts.Track=function(a,b,c){epiviz.ui.charts.Chart.call(this,a,b,c);this._highlightGroup=this._background=null;this._propagateNavigationChanges=new epiviz.events.Event};epiviz.ui.charts.Track.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Chart.prototype);epiviz.ui.charts.Track.constructor=epiviz.ui.charts.Track;
epiviz.ui.charts.Track.prototype._initialize=function(){this._properties.width="100%";epiviz.ui.charts.Chart.prototype._initialize.call(this);var a=this;this._highlightGroup=this._svg.append("g").attr("class","track-highlight");this._background=this._svg.append("rect").attr("class","chart-background").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","#ffffff").attr("fill-opacity","0");this._background.on("mouseover",function(){a._captureMouseHover()}).on("mousemove",
function(){a._captureMouseHover()}).on("mouseout",function(){a._unhover.notify(new epiviz.ui.charts.VisEventArgs(a.id()))})};epiviz.ui.charts.Track.prototype.draw=function(a,b,c,d){a=epiviz.ui.charts.Chart.prototype.draw.call(this,a,b);this._drawLegend();return a};epiviz.ui.charts.Track.prototype.displayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.TRACK};
epiviz.ui.charts.Track.prototype.doHover=function(a){epiviz.ui.charts.Chart.prototype.doHover.call(this,a);var b=this;if(void 0!=a.start&&void 0!=a.end&&this._lastRange){this._highlightGroup.selectAll("rect").remove();this._highlightGroup.attr("transform","translate("+this.margins().left()+", 0)");var c=epiviz.ui.charts.Axis,d=d3.scale.linear().domain([this._lastRange.start(),this._lastRange.end()]).range([0,this.width()-this.margins().sumAxis(c.X)]),c=[];if(a.measurements&&a.measurements.length)for(var e=
0;e<a.valueItems[0].length;++e){var f=a.valueItems[0][e].rowItem;c.push({start:f.start(),end:f.end()})}else c.push({start:a.start,end:a.end});if("canvas"==b.chartDrawType){var g=b.hoverCanvas.getContext("2d");g.clearRect(0,0,b.hoverCanvas.width,b.hoverCanvas.height);c.forEach(function(a){g.beginPath();g.fillStyle=b.colors().get(0);g.globalAlpha=.1;var c=d(a.end+1)-d(a.start),e=Math.max(5,c),c=d(a.start)+.5*c-.5*e;g.fillRect(c,0,Math.max(5,d(a.end+1)-d(a.start)),b.height())})}else this._highlightGroup.selectAll("rect").data(c,
function(a){return sprintf("%s-%s",a.start,a.end)}).enter().append("rect").style("fill",this.colors().get(0)).style("fill-opacity","0.1").attr("x",function(a){var b=d(a.end+1)-d(a.start),c=Math.max(5,b);return d(a.start)+.5*b-.5*c}).attr("width",function(a){return Math.max(5,d(a.end+1)-d(a.start))}).attr("y",0).attr("height",this.height())}};epiviz.ui.charts.Track.prototype.doUnhover=function(){epiviz.ui.charts.Chart.prototype.doUnhover.call(this);this._highlightGroup.selectAll("rect").remove()};
epiviz.ui.charts.Track.prototype._captureMouseHover=function(){if(this._lastRange){this._unhover.notify(new epiviz.ui.charts.VisEventArgs(this.id()));var a=d3.scale.linear().domain([0,this.width()]).range([this._lastRange.start(),this._lastRange.end()])(d3.mouse(this._background[0][0])[0])-this._binSize/2,b=a+this._binSize,c=this._lastRange.seqName(),a=new epiviz.ui.charts.ChartObject(sprintf("%s-highlight",this.id()),a,b,null,null,null,null,null,c);this._hover.notify(new epiviz.ui.charts.VisEventArgs(this.id(),
a))}};
epiviz.ui.charts.Track.prototype._drawLegend=function(){var a=this;this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();if(this._lastData&&this._lastData.isReady()){var b=this._lastData.measurements();if("canvas"==this.chartDrawType){var c=a.canvas.getContext("2d"),d=0;b.forEach(function(b,e){var f;f=a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(e);c.strokeStyle=f;c.fillStyle=f;c.beginPath();c.arc(a.margins().left()+d-
2,-9,4,0,2*Math.PI);c.stroke();c.fill();c.font="9px";c.beginPath();c.textAlign="start";c.fillText(b.name(),a.margins().left()+d+8,-14);f=c.measureText(b.name()).width;d=d+8+f+10})}else if(-1!=a._id.indexOf("stacked"))var e=(a.height()-a.margins().sumAxis(epiviz.ui.charts.Axis.Y))/a.measurements().size(),f=this._svg.selectAll(".chart-title").data(b).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):
a.colors().get(c)}).attr("x",0).attr("y",function(a,b){return b*e+10}).text(function(a,b){return a.name()}).attr("transform","translate("+a.margins().left()+", "+a.margins().top()+")");else{var f=this._svg.selectAll(".chart-title").data(b).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(c)}).attr("y",a.margins().top()-5).text(function(a,b){return a.name()}),
g=0,h=[];this._container.find(" .chart-title").each(function(a){h.push(g);g+=this.getBBox().width+15});f.attr("x",function(b,c){return a.margins().left()+10+h[c]});this._svg.selectAll(".chart-title-color").data(b).enter().append("circle").attr("class","chart-title-color").attr("cx",function(b,c){return a.margins().left()+4+h[c]}).attr("cy",a.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):
a.colors().get(c)})}}};
epiviz.ui.charts.Track.prototype.addCanvasEvents=function(a,b,c,d){var e=this,f=b.getContext("2d");e.hoverCanvasObjects=c;b.addEventListener("click",function(a){b.getBoundingClientRect();e.margins().left();e.margins().right()});b.addEventListener("mousemove",function(a){b.getBoundingClientRect();a=a.offsetX-e.margins().left()-e.margins().right();var f=d.invert(a),g=null;c?c.forEach(function(a){a.regionStart()<=f&&a.regionEnd()>=f&&(g=a)}):g=new epiviz.ui.charts.ChartObject(sprintf("%s-highlight",e.id()),
f,f+e._binSize);g||(g=new epiviz.ui.charts.ChartObject(sprintf("%s-highlight",e.id()),f,f+e._binSize));g&&e._hover.notify(new epiviz.ui.charts.VisEventArgs(e.id(),g))});b.addEventListener("mouseout",function(a){console.log("mouseout");e._canvasHoverObject=null;f.clearRect(0,0,b.width,b.height);e._unhover.notify(new epiviz.ui.charts.VisEventArgs(e.id()))})};epiviz.plugins={};epiviz.plugins.charts={};epiviz.plugins.charts.BlocksTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.BlocksTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.BlocksTrack.constructor=epiviz.plugins.charts.BlocksTrack;epiviz.plugins.charts.BlocksTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this);this._svg.classed("blocks-track",!0)};
epiviz.plugins.charts.BlocksTrack.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;return b&&a&&b.isReady()?this._drawBlocks(a,b,c||0,d||1):[]};epiviz.plugins.charts.BlocksTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;return b&&a&&b.isReady()?this._drawBlocksCanvas(a,b,c||0,d||1):[]};
epiviz.plugins.charts.BlocksTrack.prototype._drawBlocks=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=a.start(),g=a.end(),h=this.width(),m=this.height(),l=this.margins();this.measurements();var p=this.colors(),n=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],t=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_COLOR_BY],v=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY],
q=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_SCALE_BY],u=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_SCALE_BY],w=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],A=d3.scale.linear().domain([f,g]).range([0,h-l.sumAxis(e.X)]),x=c*(h-l.sumAxis(e.X))/(g-f);this._clearAxes();this._drawAxes(A,null,10,5);var z=
this,C=[],E=0;b.foreach(function(b,c,d){d=[];for(var e=0;e<c.size();++e){var f=c.get(e);if(!(f.rowItem.start()>a.end()||f.rowItem.end()<a.start())){var g=sprintf("item data-series-%s",E);if(null!==n&&0<d.length){var h=d[d.length-1],m=A(f.rowItem.start()),l=A(h.end);if(m-l<n){v?h.values==f.rowItem.metadata(t)&&(h.end=Math.max(h.end,f.rowItem.end())):h.end=Math.max(h.end,f.rowItem.end());h.valueItems[0].push(f);h.id=sprintf("b-%s-%s-%s",E,h.start,h.end);continue}}d.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",
E,f.rowItem.start(),f.rowItem.end()),f.rowItem.start(),f.rowItem.end(),f.rowItem.metadata(t),E,[[f]],[b],g,f.rowItem.seqName()))}}C=C.concat(d);++E});b=this._svg.select(".items");c=b.select(".selected");c=this._svg.select("#clip-"+this.id());b.empty()&&(c.empty()&&this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("class","clip-path-rect"),b=this._svg.append("g").attr("class","items").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+
")"),c=b.append("g").attr("class","selected"),b.append("g").attr("class","hovered"),c.append("g").attr("class","hovered"));b.attr("transform","translate("+l.left()+", "+l.top()+")");this._svg.select(".clip-path-rect").attr("x",0).attr("y",0).attr("width",h-l.sumAxis(e.X)).attr("height",m-l.sumAxis(e.Y));b.selectAll(".item").remove();h=b.selectAll(".item").data(C,function(a){return a.id});h.enter().insert("rect",":first-child").attr("class",function(a){return a.cssClasses}).style("fill",function(a){return v?
p.getByKey(a.values):p.get(a.seriesIndex)}).attr("x",function(a){return A(a.start)/d+x}).attr("width",function(a){return d*(A(a.end+1)-A(a.start))}).on("mouseout",function(){z._unhover.notify(new epiviz.ui.charts.VisEventArgs(z.id()))}).on("mouseover",function(a){z._hover.notify(new epiviz.ui.charts.VisEventArgs(z.id(),a))}).on("click",function(a){z._deselect.notify(new epiviz.ui.charts.VisEventArgs(z.id()));z._select.notify(new epiviz.ui.charts.VisEventArgs(z.id(),a));d3.event.stopPropagation()});
h.attr("class",function(a){return a.cssClasses}).attr("height",function(a){return u?(a.valueItems[0][0].rowItem.metadata(q)-w)/(r-w)*(m-l.sumAxis(e.Y)):m-l.sumAxis(e.Y)}).attr("y",function(a){return u?(1-(a.valueItems[0][0].rowItem.metadata(q)-w)/(r-w))*(m-l.sumAxis(e.Y)):0}).transition().duration(500).attr("x",function(a){return A(a.start)}).attr("width",function(a){return A(a.end+1)-A(a.start)});h.exit().transition().duration(500).attr("x",function(a){return A(a.start)}).remove();z._drawLegend();
return C};
epiviz.plugins.charts.BlocksTrack.prototype._drawBlocksCanvas=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=a.start(),g=a.end(),h=this.width(),m=this.height(),l=this.margins();this.measurements();var p=this.colors(),n=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],t=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_COLOR_BY],v=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY],q=
this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_SCALE_BY],u=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_SCALE_BY],w=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],A=d3.scale.linear().domain([f,g]).range([0,h-l.sumAxis(e.X)]),x=c*(h-l.sumAxis(e.X))/(g-f);this._container.find("svg").remove();this._container.find("#"+
this.id()+"-canvas").remove();c=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=c;c.id=this.id()+"-canvas";this._container.append(c);c.width=this.width();c.height=this.height();c.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();this.hoverCanvas=f=document.createElement("canvas");f.id=this.id()+"-hoverCanvas";this._container.append(f);f.width=this.width();f.height=this.height();f.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";
this._drawAxesCanvas(A,null,10,5,c);var z=[],C=0;b.foreach(function(b,c,d){d=[];for(var e=0;e<c.size();++e){var f=c.get(e);if(!(f.rowItem.start()>a.end()||f.rowItem.end()<a.start())){var g=sprintf("item data-series-%s",C);if(null!==n&&0<d.length){var h=d[d.length-1],m=A(f.rowItem.start()),l=A(h.end);if(m-l<n){v?h.values==f.rowItem.metadata(t)&&(h.end=Math.max(h.end,f.rowItem.end())):h.end=Math.max(h.end,f.rowItem.end());h.valueItems[0].push(f);h.id=sprintf("b-%s-%s-%s",C,h.start,h.end);continue}}d.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",
C,f.rowItem.start(),f.rowItem.end()),f.rowItem.start(),f.rowItem.end(),f.rowItem.metadata(t),C,[[f]],[b],g,f.rowItem.seqName()))}}z=z.concat(d);++C});var E=c.getContext("2d");E.globalAlpha=.6;E.translate(l.left(),l.top());f.getContext("2d").translate(l.left(),l.top());z.forEach(function(a){E.beginPath();var b=(a.valueItems[0][0].rowItem.metadata(q)-w)/(r-w);cheight=m-l.sumAxis(e.Y);cypos=0;u&&(cheight=b*(m-l.sumAxis(e.Y)),cypos=(1-b)*(m-l.sumAxis(e.Y)));b=v?p.getByKey(a.values):p.get(a.seriesIndex);
E.fillStyle=b;E.strokeStyle="black";E.rect(A(a.start)/d+x,cypos,d*(A(a.end+1)-A(a.start)),cheight);E.fill();E.stroke()});this.addCanvasEvents(c,f,z,A);this._drawLegend();return z};
epiviz.plugins.charts.BlocksTrack.prototype._drawLegend=function(){var a=this;this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();if(this._lastData&&this._lastData.isReady()){this.customSettingsValues();var b=this.customSettingsValues()[epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY],c=this._lastData.measurements();if("canvas"==this.chartDrawType){var d=a.canvas.getContext("2d"),e=0;c.forEach(function(b,c){var f;f=a._measurementColorLabels?
a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(c);d.strokeStyle=f;d.fillStyle=f;d.beginPath();d.arc(a.margins().left()+e-2,-9,4,0,2*Math.PI);d.stroke();d.fill();d.font="9px";d.beginPath();d.textAlign="start";d.fillText(b.name(),a.margins().left()+e+8,-14);f=d.measureText(b.name()).width;e=e+8+f+10})}else{b&&(c=Object.keys(a.colors()._keyIndices));var f=this._svg.selectAll(".chart-title").data(c).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",
function(c,d){return b?a.colors().getByKey(c):a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(c)):a.colors().get(d)}).attr("y",a.margins().top()-5).text(function(a,c){return b?a:a.name()}),g=0,h=[];this._container.find(" .chart-title").each(function(a){h.push(g);g+=this.getBBox().width+15});f.attr("x",function(b,c){return a.margins().left()+10+h[c]});this._svg.selectAll(".chart-title-color").data(c).enter().append("circle").attr("class","chart-title-color").attr("cx",function(b,
c){return a.margins().left()+4+h[c]}).attr("cy",a.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(c,d){return b?a.colors().getByKey(c):a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(c)):a.colors().get(d)})}}};epiviz.plugins.charts.BlocksTrack.prototype.setColors=function(a){this.container().find(".items").remove();epiviz.ui.charts.Visualization.prototype.setColors.call(this,a)};epiviz.ui.charts.TrackType=function(a){epiviz.ui.charts.ChartType.call(this,a)};epiviz.ui.charts.TrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.ChartType.prototype);epiviz.ui.charts.TrackType.constructor=epiviz.ui.charts.TrackType;epiviz.ui.charts.TrackType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.TRACK};epiviz.ui.charts.TrackType.prototype.cssClass=function(){return"track-container ui-widget-content"};epiviz.plugins.charts.BlocksTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.BlocksTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.BlocksTrackType.constructor=epiviz.plugins.charts.BlocksTrackType;epiviz.plugins.charts.BlocksTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.BlocksTrack(a,b,c)};epiviz.plugins.charts.BlocksTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.BlocksTrack"};
epiviz.plugins.charts.BlocksTrackType.prototype.chartName=function(){return"Blocks Track"};epiviz.plugins.charts.BlocksTrackType.prototype.chartHtmlAttributeName=function(){return"blocks"};epiviz.plugins.charts.BlocksTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0};epiviz.plugins.charts.BlocksTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.RANGE}};
epiviz.plugins.charts.BlocksTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE,epiviz.ui.charts.CustomSetting.Type.NUMBER,5,"Minimum block distance"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Block Color by"),
new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Block color by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.USE_SCALE_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Block scale by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.BlocksTrackType.CustomSettings.BLOCK_SCALE_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,
"colLabel","Block scale by"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y")])};
epiviz.plugins.charts.BlocksTrackType.CustomSettings={MIN_BLOCK_DISTANCE:"minBlockDistance",BLOCK_COLOR_BY:"blockColorBy",USE_COLOR_BY:"useColorBy",BLOCK_SCALE_BY:"blockScaleBy",USE_SCALE_BY:"useScaleBy"};epiviz.plugins.charts.StackedBlocksTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.StackedBlocksTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.StackedBlocksTrack.constructor=epiviz.plugins.charts.StackedBlocksTrack;epiviz.plugins.charts.StackedBlocksTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this);this._svg.classed("blocks-track",!0)};
epiviz.plugins.charts.StackedBlocksTrack.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;return b&&a&&b.isReady()?this._drawBlocks(a,b,c||0,d||1):[]};epiviz.plugins.charts.StackedBlocksTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;return b&&a&&b.isReady()?this._drawBlocksCanvas(a,b,c||0,d||1):[]};
epiviz.plugins.charts.StackedBlocksTrack.prototype._drawBlocks=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=a.start(),g=a.end(),h=this.width(),m=this.height(),l=this.margins();this.measurements();var p=this.colors(),n=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],t=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.BLOCK_COLOR_BY],v=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.USE_COLOR_BY],
q=d3.scale.linear().domain([f,g]).range([0,h-l.sumAxis(e.X)]),u=c*(h-l.sumAxis(e.X))/(g-f);this._clearAxes();this._drawAxes(q,null,10,5);var w=this,r=[],A=0;b.foreach(function(b,c,d){d=[];for(var e=0;e<c.size();++e){var f=c.get(e);if(!(f.rowItem.start()>a.end()||f.rowItem.end()<a.start())){var g=sprintf("item data-series-%s",A);if(null!==n&&0<d.length){var h=d[d.length-1],l=q(f.rowItem.start()),m=q(h.end);if(l-m<n){v?h.values==f.rowItem.metadata(t)&&(h.end=Math.max(h.end,f.rowItem.end())):h.end=Math.max(h.end,
f.rowItem.end());h.valueItems[0].push(f);h.id=sprintf("b-%s-%s-%s",A,h.start,h.end);continue}}d.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",A,f.rowItem.start(),f.rowItem.end()),f.rowItem.start(),f.rowItem.end(),f.rowItem.metadata(t),A,[[f]],[b],g))}}r=r.concat(d);++A});b=this._svg.select(".items");c=b.select(".selected");c=this._svg.select("#clip-"+this.id());b.empty()&&(c.empty()&&this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("class",
"clip-path-rect"),b=this._svg.append("g").attr("class","items").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")"),c=b.append("g").attr("class","selected"),b.append("g").attr("class","hovered"),c.append("g").attr("class","hovered"));b.attr("transform","translate("+l.left()+", "+l.top()+")");this._svg.select(".clip-path-rect").attr("x",0).attr("y",0).attr("width",h-l.sumAxis(e.X)).attr("height",m-l.sumAxis(e.Y));b.selectAll(".item").remove();var h=b.selectAll(".item").data(r,
function(a){return a.id}),x=(m-l.sumAxis(e.Y))/A;h.enter().insert("rect",":first-child").attr("class",function(a){return a.cssClasses}).style("fill",function(a){return v?p.getByKey(a.values):p.get(a.seriesIndex)}).attr("x",function(a){return q(a.start)/d+u}).attr("y",function(a){return a.seriesIndex*x+0}).attr("width",function(a){return d*(q(a.end+1)-q(a.start))}).attr("height",function(a){return x-0}).on("mouseout",function(){w._unhover.notify(new epiviz.ui.charts.VisEventArgs(w.id()))}).on("mouseover",
function(a){w._hover.notify(new epiviz.ui.charts.VisEventArgs(w.id(),a))}).on("click",function(a){w._deselect.notify(new epiviz.ui.charts.VisEventArgs(w.id()));w._select.notify(new epiviz.ui.charts.VisEventArgs(w.id(),a));d3.event.stopPropagation()});h.attr("class",function(a){return a.cssClasses}).transition().duration(500).attr("x",function(a){return q(a.start)}).attr("y",function(a){return a.seriesIndex*x+0}).attr("width",function(a){return q(a.end+1)-q(a.start)}).attr("height",function(a){return x-
0});h.exit().transition().duration(500).attr("x",function(a){return q(a.start)}).attr("y",function(a){return a.seriesIndex*x+0}).attr("width",function(a){return q(a.end+1)-q(a.start)}).attr("height",function(a){return x-0}).remove();return r};
epiviz.plugins.charts.StackedBlocksTrack.prototype._drawBlocksCanvas=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=a.start(),g=a.end(),h=this.width(),m=this.height(),l=this.margins();this.measurements();var p=this.colors(),n=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE],t=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.BLOCK_COLOR_BY],v=this.customSettingsValues()[epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.USE_COLOR_BY],
q=d3.scale.linear().domain([f,g]).range([0,h-l.sumAxis(e.X)]),u=c*(h-l.sumAxis(e.X))/(g-f);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();c=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=c;c.id=this.id()+"-canvas";this._container.append(c);c.width=this.width();c.height=this.height();c.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();this.hoverCanvas=f=document.createElement("canvas");
f.id=this.id()+"-hoverCanvas";this._container.append(f);f.width=this.width();f.height=this.height();f.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(q,null,10,5,c);var w=[],r=0;b.foreach(function(b,c,d){d=[];for(var e=0;e<c.size();++e){var f=c.get(e);if(!(f.rowItem.start()>a.end()||f.rowItem.end()<a.start())){var g=sprintf("item data-series-%s",r);if(null!==n&&0<d.length){var h=d[d.length-1],l=q(f.rowItem.start()),m=q(h.end);if(l-m<n){v?h.values==f.rowItem.metadata(t)&&
(h.end=Math.max(h.end,f.rowItem.end())):h.end=Math.max(h.end,f.rowItem.end());h.valueItems[0].push(f);h.id=sprintf("b-%s-%s-%s",r,h.start,h.end);continue}}d.push(new epiviz.ui.charts.ChartObject(sprintf("b-%s-%s-%s",r,f.rowItem.start(),f.rowItem.end()),f.rowItem.start(),f.rowItem.end(),f.rowItem.metadata(t),r,[[f]],[b],g))}}w=w.concat(d);++r});var g=this._svg.select(".items"),A=g.select(".selected"),A=this._svg.select("#clip-"+this.id());g.empty()&&(A.empty()&&this._svg.select("defs").append("clipPath").attr("id",
"clip-"+this.id()).append("rect").attr("class","clip-path-rect"),g=this._svg.append("g").attr("class","items").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")"),A=g.append("g").attr("class","selected"),g.append("g").attr("class","hovered"),A.append("g").attr("class","hovered"));g.attr("transform","translate("+l.left()+", "+l.top()+")");this._svg.select(".clip-path-rect").attr("x",0).attr("y",0).attr("width",h-l.sumAxis(e.X)).attr("height",m-l.sumAxis(e.Y));g.selectAll(".item").remove();
g.selectAll(".item").data(w,function(a){return a.id});var x=(m-l.sumAxis(e.Y))/r,z=c.getContext("2d");z.globalAlpha=.6;z.translate(l.left(),l.top());f.getContext("2d").translate(l.left(),l.top());w.forEach(function(a){z.beginPath();var c;c=1<b.measurements().length?p.get(a.seriesIndex):v?p.getByKey(a.values):p.get(a.seriesIndex);z.fillStyle=c;z.strokeStyle="black";z.rect(q(a.start)/d+u,a.seriesIndex*x,d*(q(a.end+1)-q(a.start)),x);z.fill();z.stroke()});this.addCanvasEvents(c,f,w,q);this._drawLegend();
return w};epiviz.plugins.charts.StackedBlocksTrack.prototype.setColors=function(a){this.container().find(".items").remove();epiviz.ui.charts.Visualization.prototype.setColors.call(this,a)};epiviz.plugins.charts.StackedBlocksTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.StackedBlocksTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.StackedBlocksTrackType.constructor=epiviz.plugins.charts.StackedBlocksTrackType;epiviz.plugins.charts.StackedBlocksTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.StackedBlocksTrack(a,b,c)};
epiviz.plugins.charts.StackedBlocksTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedBlocksTrack"};epiviz.plugins.charts.StackedBlocksTrackType.prototype.chartName=function(){return"Stacked Blocks Track"};epiviz.plugins.charts.StackedBlocksTrackType.prototype.chartHtmlAttributeName=function(){return"stacked-blocks"};epiviz.plugins.charts.StackedBlocksTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0};
epiviz.plugins.charts.StackedBlocksTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.RANGE}};
epiviz.plugins.charts.StackedBlocksTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.MIN_BLOCK_DISTANCE,epiviz.ui.charts.CustomSetting.Type.NUMBER,5,"Minimum block distance"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.USE_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,
!1,"Use Block Color by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings.BLOCK_COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Block color by")])};epiviz.plugins.charts.StackedBlocksTrackType.CustomSettings={MIN_BLOCK_DISTANCE:"minBlockDistance",BLOCK_COLOR_BY:"blockColorBy",USE_COLOR_BY:"useColorBy"};epiviz.plugins.charts.LineTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.LineTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.LineTrack.constructor=epiviz.plugins.charts.LineTrack;epiviz.plugins.charts.LineTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this)};
epiviz.plugins.charts.LineTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide||0;d=d||this._zoom||1;this._slide=0;this._zoom=1;if(!b||!a)return[];var e=epiviz.ui.charts.CustomSetting,f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],h=this.getDataMinMax(b);f==e.DEFAULT&&(f=h[0]);g==
e.DEFAULT&&(g=h[1]);null===f&&null===g&&(f=-1,g=1);null===f&&(f=g-1);null===g&&(g=f+1);var m=epiviz.ui.charts.Axis,e=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(m.X)]),f=d3.scale.linear().domain([f,g]).range([this.height()-this.margins().sumAxis(m.Y),0]);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();g=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=g;g.id=this.id()+"-canvas";this._container.append(g);
g.width=this.width();g.height=this.height();g.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();this.hoverCanvas=h=document.createElement("canvas");h.id=this.id()+"-hoverCanvas";this._container.append(h);h.width=this.width();h.height=this.height();h.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(e,f,10,5,g);g.getContext("2d").translate(this.margins().left(),this.margins().top());h.getContext("2d").translate(this.margins().left(),
this.margins().top());c=c*(this.width()-this.margins().sumAxis(m.X))/a.width();var l=this._svg.selectAll(".lines");l.empty()&&(l=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"));b.measurements().forEach(function(a,b){var c=l.selectAll(".line-series-index-"+b),d=l.selectAll(".point-series-index-"+b);c.empty()&&l.append("g").attr("class","line-series-index-"+b);d.empty()&&l.append("g").attr("class","point-series-index-"+
b)});for(m=b.measurements().length;;++m){var p=l.selectAll(".line-series-index-"+m),n=l.selectAll(".point-series-index-"+m);if(p.empty())break;p.remove();n.remove()}this.addCanvasEvents(g,h,null,e);this._drawLegend();return this._drawLinesCanvas(a,b,c,d,e,f,g)};
epiviz.plugins.charts.LineTrack.prototype.draw=function(a,b,c,d,e){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide||0;d=d||this._zoom||1;this._slide=0;this._zoom=1;if(!b||!a)return[];var f=epiviz.ui.charts.CustomSetting,g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],h=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],m=this.getDataMinMax(b);g==f.DEFAULT&&(g=m[0]);h==f.DEFAULT&&
(h=m[1]);null===g&&null===h&&(g=-1,h=1);null===g&&(g=h-1);null===h&&(h=g+1);m=epiviz.ui.charts.Axis;f=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(m.X)]);g=d3.scale.linear().domain([g,h]).range([this.height()-this.margins().sumAxis(m.Y),0]);this._clearAxes();e&&(g=d3.scale.linear().domain([-1*h,h]).range([this.height()-this.margins().sumAxis(m.Y),0]));this._drawAxes(f,g,10,5);c=c*(this.width()-this.margins().sumAxis(m.X))/a.width();var l=this._svg.selectAll(".lines");
l.empty()&&(l=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"));b.measurements().forEach(function(a,b){var c=l.selectAll(".line-series-index-"+b),d=l.selectAll(".point-series-index-"+b);c.empty()&&l.append("g").attr("class","line-series-index-"+b);d.empty()&&l.append("g").attr("class","point-series-index-"+b)});for(e=b.measurements().length;;++e){h=l.selectAll(".line-series-index-"+e);m=l.selectAll(".point-series-index-"+
e);if(h.empty())break;h.remove();m.remove()}return this._drawLines(a,b,c,d,f,g)};
epiviz.plugins.charts.LineTrack.prototype._drawLines=function(a,b,c,d,e,f){var g=this.colors(),h=parseInt(this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.STEP]),m=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_POINTS],l=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_LINES],p=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_ERROR_BARS],n=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.POINT_RADIUS],
t=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.LINE_THICKNESS],v=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.INTERPOLATION];d=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.ABS_LINE_VAL];var q=this,u=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X)]).range([a.start(),a.end()])(c)-a.start(),w=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),
a.start()+u),Math.max(a.end(),a.end()+u),a.genome()),r=this._svg.select(".lines"),A=[];b.foreach(function(a,b,d){var x=q._measurementColorLabels?g.getByKey(q._measurementColorLabels.get(a)):g.get(d),u=b.binarySearchStarts(w);if(0!=u.length){var z=Math.ceil(u.index/h)*h;u.length=Math.max(0,u.length-z+u.index);u.index=z;for(var z=epiviz.utils.range(u.length,u.index).filter(function(a){return!h||1>=h||0==(a-u.index)%h}),B=0;B<z.length;++B){var C=b.get(z[B]);A.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",
d,C.globalIndex),C.rowItem.start(),C.rowItem.end(),[C.value],d,[[C]],[a],sprintf("item data-series-%s",d),C.rowItem.seqName()))}var y=function(a){a=b.get(a);return e(a.rowItem.start())};a=function(a){a=b.get(a);return f(a.value)};l?(B=d3.svg.line().x(y).y(a).interpolate(v),C=r.select(".line-series-index-"+d).selectAll("path").data([z]),C.enter().append("path").attr("d",B).style("shape-rendering","auto").style("stroke-opacity","0.8").on("mouseover",function(){q._captureMouseHover()}).on("mousemove",
function(){q._captureMouseHover()}).on("mouseout",function(){q._unhover.notify(new epiviz.ui.charts.VisEventArgs(q.id()))}),C.attr("d",B).style("stroke",x).style("stroke-width",t).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)")):r.select(".line-series-index-"+d).selectAll("path").remove();r.select(".point-series-index-"+d).selectAll("circle").remove();r.select(".point-series-index-"+d).selectAll(".error-bar").remove();m&&(B=r.select(".point-series-index-"+
d).selectAll("circle").data(z),B.enter().append("circle").attr("class","point-series-index-"+d).attr("r",n).attr("cx",y).attr("cy",a).attr("fill",x).attr("stroke",x).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)"),B.on("mouseover",function(){q._captureMouseHover()}).on("mousemove",function(){q._captureMouseHover()}).on("mouseout",function(){q._unhover.notify(new epiviz.ui.charts.VisEventArgs(q.id()))}),B.exit().transition().duration(500).style("opacity",
0).remove(),p&&(d=r.select(".point-series-index-"+d).selectAll(".error-bar").data(z),d.enter().append("g").attr("class","error-bar").each(function(a){var c;c=b.get(a);c=c.valueAnnotation?c.valueAnnotation.errMinus:null;c=void 0!=c?f(c):null;var d;d=b.get(a);d=d.valueAnnotation?d.valueAnnotation.errPlus:null;d=void 0!=d?f(d):null;null!=c&&null!=d&&(d3.select(this).append("line").attr("x1",y(a)).attr("x2",y(a)).attr("y1",c).attr("y2",d).style("stroke",x).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",
y(a)-2).attr("x2",y(a)+2).attr("y1",c).attr("y2",c).style("stroke",x).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",y(a)-2).attr("x2",y(a)+2).attr("y1",d).attr("y2",d).style("stroke",x).style("shape-rendering","auto"))}).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)"),d.on("mouseover",function(){q._captureMouseHover()}).on("mousemove",function(){q._captureMouseHover()}).on("mouseout",function(){q._unhover.notify(new epiviz.ui.charts.VisEventArgs(q.id()))}),
d.exit().transition().duration(500).style("opacity",0).remove()))}});d!=epiviz.ui.charts.CustomSetting.DEFAULT&&(r.selectAll(".abLine").remove(),r.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",q.width()-q.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",f(d)).attr("y2",f(d)).style("stroke","black").style("stroke-dasharray","5, 5"));return A};
epiviz.plugins.charts.LineTrack.prototype._drawLinesCanvas=function(a,b,c,d,e,f,g){var h=this.colors(),m=parseInt(this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.STEP]),l=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_POINTS],p=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_LINES],n=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_ERROR_BARS],t=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.POINT_RADIUS],
v=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.LINE_THICKNESS],q=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.INTERPOLATION];d=this.customSettingsValues()[epiviz.plugins.charts.LineTrackType.CustomSettings.ABS_LINE_VAL];var u=this;c=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X)]).range([a.start(),a.end()])(c)-a.start();var w=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),
a.start()+c),Math.max(a.end(),a.end()+c),a.genome()),r=g.getContext("2d"),A=[];b.foreach(function(a,b,c){var d=u._measurementColorLabels?h.getByKey(u._measurementColorLabels.get(a)):h.get(c),g=b.binarySearchStarts(w);if(0!=g.length){var x=Math.ceil(g.index/m)*m;g.length=Math.max(0,g.length-x+g.index);g.index=x;for(var x=epiviz.utils.range(g.length,g.index).filter(function(a){return!m||1>=m||0==(a-g.index)%m}),B=0;B<x.length;++B){var z=b.get(x[B]);A.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",
c,z.globalIndex),z.rowItem.start(),z.rowItem.end(),[z.value],c,[[z]],[a],sprintf("item data-series-%s",c),z.rowItem.seqName()))}var y=function(a){a=b.get(a);return e(a.rowItem.start())},C=function(a){a=b.get(a);return f(a.value)};p&&(a=d3.svg.line().x(y).y(C).interpolate(q),r.globalAlpha=.8,r.beginPath(),a=new Path2D(a(x)),r.strokeStyle=d,r.lineWidth=v,r.stroke(a),r.beginPath());l&&(x.forEach(function(a){var b=y(a);a=C(a);r.beginPath();r.arc(b,a,t,0,2*Math.PI);r.strokeStyle=d;r.stroke();r.fillStyle=
d;r.fill()}),n&&x.forEach(function(a){var c;c=b.get(a);c=c.valueAnnotation?c.valueAnnotation.errMinus:null;c=void 0!=c?f(c):null;var e;e=b.get(a);e=e.valueAnnotation?e.valueAnnotation.errPlus:null;e=void 0!=e?f(e):null;null!=c&&null!=e&&(r.beginPath(),r.moveTo(y(a),C(a)),r.lineTo(c,e),r.strokeStyle=d,r.stroke(),r.beginPath(),r.globalAlpha=.7,r.moveTo(y(a)-2,C(a)+2),r.lineTo(c,c),r.strokeStyle=d,r.stroke(),r.beginPath(),r.globalAlpha=.7,r.moveTo(y(a)-2,C(a)+2),r.lineTo(e,e),r.strokeStyle=d,r.stroke(),
r.beginPath())}))}});d!=epiviz.ui.charts.CustomSetting.DEFAULT&&(r.beginPath(),r.globalAlpha=.7,r.moveTo(0,f(d)),r.lineTo(u.width()-u.margins().sumAxis(epiviz.ui.charts.Axis.X),f(d)),r.strokeStyle=color,r.stroke());return A};epiviz.plugins.charts.LineTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.LineTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.LineTrackType.constructor=epiviz.plugins.charts.LineTrackType;epiviz.plugins.charts.LineTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.LineTrack(a,b,c)};epiviz.plugins.charts.LineTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.LineTrack"};
epiviz.plugins.charts.LineTrackType.prototype.chartName=function(){return"Line Track"};epiviz.plugins.charts.LineTrackType.prototype.chartHtmlAttributeName=function(){return"lines"};epiviz.plugins.charts.LineTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.FEATURE}};
epiviz.plugins.charts.LineTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.STEP,epiviz.ui.charts.CustomSetting.Type.NUMBER,50,"Step"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_POINTS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Show points"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_LINES,
epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show lines"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.SHOW_ERROR_BARS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show error bars"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.POINT_RADIUS,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Point radius"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.LINE_THICKNESS,epiviz.ui.charts.CustomSetting.Type.NUMBER,
1,"Line thickness"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,
"linear","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LineTrackType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])};
epiviz.plugins.charts.LineTrackType.CustomSettings={STEP:"step",SHOW_POINTS:"showPoints",SHOW_ERROR_BARS:"showErrorBars",SHOW_LINES:"showLines",POINT_RADIUS:"pointRadius",LINE_THICKNESS:"lineThickness",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"};epiviz.plugins.charts.StackedLineTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.StackedLineTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.StackedLineTrack.constructor=epiviz.plugins.charts.StackedLineTrack;epiviz.plugins.charts.StackedLineTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this)};
epiviz.plugins.charts.StackedLineTrack.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide;d=d||this._zoom;this._slide=0;this._zoom=1;if(!b||!a)return[];var e=epiviz.ui.charts.Axis;c=(c||0)*(this.width()-this.margins().sumAxis(e.X))/a.width();return this._drawLines(a,b,c,d||1)};
epiviz.plugins.charts.StackedLineTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide;d=d||this._zoom;this._slide=0;this._zoom=1;if(!b||!a)return[];var e=epiviz.ui.charts.Axis;c=(c||0)*(this.width()-this.margins().sumAxis(e.X))/a.width();return this._drawLinesCanvas(a,b,c,d||1)};
epiviz.plugins.charts.StackedLineTrack.prototype._drawLines=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=this.colors(),g=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.STEP],h=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.INTERPOLATION],m=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.OFFSET];d=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.ABS_LINE_VAL];
var l=this,p=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(e.X)]).range([a.start(),a.end()])(c)-a.start();epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),a.start()+p),Math.max(a.end(),a.end()+p));var n=[],t=[],v=b.firstSeries().globalStartIndex(),q=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>v&&(v=c);d<q&&(q=d)});var v=Math.ceil(v/g)*g,q=Math.floor(q/g)*g,u;b.foreach(function(a,b,c){for(var d=
epiviz.utils.range((q-v)/g).map(function(a){return a*g+v}).filter(function(a){return b.getByGlobalIndex(a)}),e=0;e<d.length;++e){var f=b.getByGlobalIndex(d[e]);n.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",c,f.globalIndex),f.rowItem.start(),f.rowItem.end(),[f.value],c,[[f]],[a],sprintf("item data-series-%s",c),f.rowItem.seqName()))}var h=[];d.forEach(function(a){h.push({x:b.getByGlobalIndex(a).rowItem.start(),y:b.getByGlobalIndex(a).value})});t.push(h);u||(u=[],d.forEach(function(a){a=
b.getByGlobalIndex(a);u.push(a.rowItem.metadata("bacteria"))}))});var w=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(e.X)]);this._clearAxes();this._drawAxes(w,void 0,10);a=this._svg.select(".lines");a.empty()&&(a=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"));b=d3.layout.stack().offset(m)(t);var r=d3.scale.linear().domain([Math.min(0,d3.min(b,function(a){return d3.min(a,function(a){return a.y0+
a.y})})),d3.max(b,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height()-this.margins().sumAxis(e.Y),0]),e=d3.svg.area().x(function(a){return w(a.x)}).y0(function(a){return r(a.y0)}).y1(function(a){return r(a.y0+a.y)}).interpolate(h),h=a.selectAll("path").data(b);h.enter().append("path").attr("d",e).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a,b){return f.get(b)}).on("mouseover",function(){l._captureMouseHover()}).on("mousemove",function(){l._captureMouseHover()}).on("mouseout",
function(){l._unhover.notify(new epiviz.ui.charts.VisEventArgs(l.id()))});h.attr("d",e).style("fill",function(a,b){return f.get(b)}).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)");d!=epiviz.ui.charts.CustomSetting.DEFAULT&&(a.selectAll(".abLine").remove(),a.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",l.width()-l.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",r(d)).attr("y2",r(d)).style("stroke","black").style("stroke-dasharray",
"5, 5"));return n};
epiviz.plugins.charts.StackedLineTrack.prototype._drawLinesCanvas=function(a,b,c,d){d=epiviz.ui.charts.Axis;var e=this.colors(),f=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.STEP],g=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.INTERPOLATION],h=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.OFFSET],m=this.customSettingsValues()[epiviz.plugins.charts.StackedLineTrackType.CustomSettings.ABS_LINE_VAL];c=
d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(d.X)]).range([a.start(),a.end()])(c)-a.start();epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),a.start()+c),Math.max(a.end(),a.end()+c));var l=[],p=[],n=b.firstSeries().globalStartIndex(),t=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>n&&(n=c);d<t&&(t=d)});var n=Math.ceil(n/f)*f,t=Math.floor(t/f)*f,v;b.foreach(function(a,b,c){for(var d=epiviz.utils.range((t-
n)/f).map(function(a){return a*f+n}).filter(function(a){return b.getByGlobalIndex(a)}),e=0;e<d.length;++e){var g=b.getByGlobalIndex(d[e]);l.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",c,g.globalIndex),g.rowItem.start(),g.rowItem.end(),[g.value],c,[[g]],[a],sprintf("item data-series-%s",c),g.rowItem.seqName()))}var h=[];d.forEach(function(a){h.push({x:b.getByGlobalIndex(a).rowItem.start(),y:b.getByGlobalIndex(a).value})});p.push(h);v||(v=[],d.forEach(function(a){a=b.getByGlobalIndex(a);
v.push(a.rowItem.metadata("bacteria"))}))});var q=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(d.X)]);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();a=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=a;a.id=this.id()+"-canvas";this._container.append(a);a.width=this.width();a.height=this.height();a.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+
this.id()+"-hoverCanvas").remove();this.hoverCanvas=b=document.createElement("canvas");b.id=this.id()+"-hoverCanvas";this._container.append(b);b.width=this.width();b.height=this.height();b.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(q,null,10,0,a);c=this._svg.select(".lines");c.empty()&&(c=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"));var h=d3.layout.stack().offset(h)(p),
u=d3.scale.linear().domain([Math.min(0,d3.min(h,function(a){return d3.min(a,function(a){return a.y0+a.y})})),d3.max(h,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height()-this.margins().sumAxis(d.Y),0]),w=d3.svg.area().x(function(a){return q(a.x)}).y0(function(a){return u(a.y0)}).y1(function(a){return u(a.y0+a.y)}).interpolate(g),r=a.getContext("2d");r.translate(this.margins().left(),this.margins().top());b.getContext("2d").translate(this.margins().left(),this.margins().top());
h.forEach(function(a,b){r.globalAlpha=.8;r.beginPath();var c=new Path2D(w(a));r.strokeStyle=e.get(b);r.lineWidth=1;r.fillStyle=e.get(b);r.fill(c);r.stroke()});m!=epiviz.ui.charts.CustomSetting.DEFAULT&&(r.beginPath(),r.globalAlpha=.7,r.moveTo(0,u(m)),r.lineTo(this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X),u(m)),r.strokeStyle=color,r.stroke());this.addCanvasEvents(a,b,null,q);this._drawLegend();return l};epiviz.plugins.charts.StackedLineTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.StackedLineTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.StackedLineTrackType.constructor=epiviz.plugins.charts.StackedLineTrackType;epiviz.plugins.charts.StackedLineTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.StackedLineTrack(a,b,c)};
epiviz.plugins.charts.StackedLineTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedLineTrack"};epiviz.plugins.charts.StackedLineTrackType.prototype.chartName=function(){return"Stacked Track"};epiviz.plugins.charts.StackedLineTrackType.prototype.chartHtmlAttributeName=function(){return"stacked-lines"};epiviz.plugins.charts.StackedLineTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.FEATURE}};
epiviz.plugins.charts.StackedLineTrackType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};
epiviz.plugins.charts.StackedLineTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.STEP,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Step"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.OFFSET,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"zero","Offset",["zero","wiggle"]),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.INTERPOLATION,
epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"basis","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLineTrackType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])};
epiviz.plugins.charts.StackedLineTrackType.CustomSettings={STEP:"step",OFFSET:"offset",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"};epiviz.plugins.charts.MultiStackedLineTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.MultiStackedLineTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.MultiStackedLineTrack.constructor=epiviz.plugins.charts.MultiStackedLineTrack;epiviz.plugins.charts.MultiStackedLineTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this)};
epiviz.plugins.charts.MultiStackedLineTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide||0;d=d||this._zoom||1;this._slide=0;this._zoom=1;if(!b||!a)return[];var e=epiviz.ui.charts.CustomSetting,f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],h=this.getDataMinMax(b);f==e.DEFAULT&&
(f=h[0]);g==e.DEFAULT&&(g=h[1]);null===f&&null===g&&(f=-1,g=1);null===f&&(f=g-1);null===g&&(g=f+1);var m=epiviz.ui.charts.Axis,e=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(m.X)]),f=d3.scale.linear().domain([f,g]).range([this.height()-this.margins().sumAxis(m.Y),0]);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();g=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=g;g.id=this.id()+"-canvas";
this._container.append(g);g.width=this.width();g.height=this.height();g.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();this.hoverCanvas=h=document.createElement("canvas");h.id=this.id()+"-hoverCanvas";this._container.append(h);h.width=this.width();h.height=this.height();h.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(e,null,10,5,g);g.getContext("2d").translate(this.margins().left(),
this.margins().top());h.getContext("2d").translate(this.margins().left(),this.margins().top());c=c*(this.width()-this.margins().sumAxis(m.X))/a.width();var l=this._svg.selectAll(".lines");l.empty()&&(l=this._svg.append("g").attr("class","lines").attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")"));b.measurements().forEach(function(a,b){var c=l.selectAll(".line-series-index-"+b),d=l.selectAll(".point-series-index-"+b);c.empty()&&l.append("g").attr("class","line-series-index-"+
b);d.empty()&&l.append("g").attr("class","point-series-index-"+b)});for(m=b.measurements().length;;++m){var p=l.selectAll(".line-series-index-"+m),n=l.selectAll(".point-series-index-"+m);if(p.empty())break;p.remove();n.remove()}this.addCanvasEvents(g,h,null,e);this._drawLegend();return this._drawLinesCanvas(a,b,c,d,e,f,g)};
epiviz.plugins.charts.MultiStackedLineTrack.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;c=c||this._slide||0;d=d||this._zoom||1;this._slide=0;this._zoom=1;if(!b||!a)return[];var e=epiviz.ui.charts.CustomSetting,f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],h=this.getDataMinMax(b);f==e.DEFAULT&&(f=h[0]);
g==e.DEFAULT&&(g=h[1]);null===f&&null===g&&(f=-1,g=1);null===f&&--f;null===g&&(g+=1);var m=epiviz.ui.charts.Axis,e=d3.scale.linear().domain([a.start(),a.end()]).range([0,this.width()-this.margins().sumAxis(m.X)]),h=d3.scale.linear().domain([f,g]).range([this.height()-this.margins().sumAxis(m.Y),0]);this._clearAxes();this._drawAxes(e,null,10,5);c=c*(this.width()-this.margins().sumAxis(m.X))/a.width();var l=this._svg.selectAll(".lines");l.empty()&&(l=this._svg.append("g").attr("class","lines").attr("transform",
"translate("+this.margins().left()+", "+this.margins().top()+")"));b.measurements().forEach(function(a,b){var c=l.selectAll(".line-series-index-"+b),d=l.selectAll(".point-series-index-"+b);c.empty()&&l.append("g").attr("class","line-series-index-"+b);d.empty()&&l.append("g").attr("class","point-series-index-"+b)});for(m=b.measurements().length;;++m){var p=l.selectAll(".line-series-index-"+m),n=l.selectAll(".point-series-index-"+m);if(p.empty())break;p.remove();n.remove()}return this._drawLines(a,
b,c,d,e,h,f,g)};
epiviz.plugins.charts.MultiStackedLineTrack.prototype._drawLines=function(a,b,c,d,e,f,g,h){var m=this.colors(),l=parseInt(this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.STEP]),p=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_POINTS],n=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_LINES],t=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_FILL],v=
this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_ERROR_BARS],q=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.POINT_RADIUS],u=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.LINE_THICKNESS],w=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.INTERPOLATION],r=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.ABS_LINE_VAL],
A=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_Y_AXIS],x=this;d=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X)]).range([a.start(),a.end()])(c)-a.start();var z=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),a.start()+d),Math.max(a.end(),a.end()+d),a.genome()),C=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_TRACKS],E=(x.height()-x.margins().sumAxis(epiviz.ui.charts.Axis.Y))/
b.measurements().length;"default"!=C&&(d=C.split(","),E=(x.height()-x.margins().sumAxis(epiviz.ui.charts.Axis.Y))/d.length);var D=0,G=this._svg.select(".lines"),B=[],I=1E3;smaxY=-1E3;for(b.foreach(function(b,d,f){f=!1;"default"!=C&&(C.split(",").includes(b.id())||(f=!0));if(!f){var g=x._measurementColorLabels?m.getByKey(x._measurementColorLabels.get(b)):m.get(D),h=d.binarySearchStarts(z);if(0!=h.length){f=Math.ceil(h.index/l)*l;h.length=Math.max(0,h.length-f+h.index);h.index=f;f=epiviz.utils.range(h.length,
h.index).filter(function(a){return!l||1>=l||0==(a-h.index)%l});for(var J=0;J<f.length;++J){var y=d.get(f[J]);B.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",D,y.globalIndex),y.rowItem.start(),y.rowItem.end(),[y.value],D,[[y]],[b],sprintf("item data-series-%s",D),y.rowItem.seqName()));y.value<I&&(I=y.value);y.value>smaxY&&(smaxY=y.value)}b=epiviz.ui.charts.CustomSetting;J=x.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN];y=x.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX];
J==b.DEFAULT&&(J=I);y==b.DEFAULT&&(y=smaxY);var F=d3.scale.linear().domain([J,y]).range([(D+1)*E,D*E]),L=function(a){a=d.get(a);return e(a.rowItem.start())};b=function(a){a=d.get(a);return F(a.value)};if(A){var H=x._svg.select(".axes"),R=H.select(".yAxis-grid"),P=H.select(".yAxis-line");R.empty()&&(R=H.append("g").attr("class","yAxis yAxis-grid"));P.empty()&&(P=H.append("g").attr("class","yAxis yAxis-line"));d3.svg.line().x([a.start(),a.start()]).y([(D+1)*E,D*E]);P.append("line").attr("x1",e(a.start())).attr("y1",
F(J)).attr("x2",e(a.start())).attr("y2",F(.8*y)).attr("class","yAxis-line-series-"+D).style("shape-rendering","auto").style("stroke-opacity","0.6").attr("transform","translate("+x.margins().left()+", "+x.margins().top()+")");P.append("text").attr("class","yAxis-line-minlabel-series"+D).attr("x",e(a.start())-17).attr("y",F(.8*y)).text(d3.format(".2g")(y)).style("opacity","0.6").attr("transform","translate("+x.margins().left()+", "+x.margins().top()+")");P.append("text").attr("class","yAxis-line-maxlabel-series"+
D).attr("x",e(a.start())-17).attr("y",F(J)).text(d3.format(".2g")(J)).style("opacity","0.6").attr("transform","translate("+x.margins().left()+", "+x.margins().top()+")")}else G.select(".line-series-index-"+D).selectAll("text").remove(),G.select(".line-series-index-"+D).append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(a,b){return x._measurementColorLabels?x.colors().getByKey(x._measurementColorLabels.get(a)):x.colors().get(D)}).attr("x",0).attr("y",D*E+20).text("max: "+
d3.format(".2g")(y));n?(y=d3.svg.line().x(L).y(b).interpolate(w),J=G.select(".line-series-index-"+D).selectAll("path").data([f]),J.enter().append("path").attr("d",y).style("shape-rendering","auto").style("stroke-opacity","0.8").on("mouseover",function(){x._captureMouseHover()}).on("mousemove",function(){x._captureMouseHover()}).on("mouseout",function(){x._unhover.notify(new epiviz.ui.charts.VisEventArgs(x.id()))}),J.attr("d",y).style("stroke",g).style("stroke-width",u).attr("transform","translate("+
+c+")").transition().duration(500).attr("transform","translate(0)")):G.select(".line-series-index-"+D).selectAll("path").remove();t&&(y=d3.svg.area().x1(L).y1(b).x0(L).y0(F(0)).interpolate(w),J=G.select(".line-series-index-"+D).selectAll("path").data([f]),J.enter().append("path").attr("d",y).style("shape-rendering","auto").style("stroke-opacity","0.8").on("mouseover",function(){x._captureMouseHover()}).on("mousemove",function(){x._captureMouseHover()}).on("mouseout",function(){x._unhover.notify(new epiviz.ui.charts.VisEventArgs(x.id()))}),
J.attr("d",y).style("fill",g).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)"));G.select(".point-series-index-"+D).selectAll("circle").remove();G.select(".point-series-index-"+D).selectAll(".error-bar").remove();p&&(J=G.select(".point-series-index-"+D).selectAll("circle").data(f),J.enter().append("circle").attr("class","point-series-index-"+D).attr("r",q).attr("cx",L).attr("cy",b).attr("fill",g).attr("stroke",g).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform",
"translate(0)"),J.on("mouseover",function(){x._captureMouseHover()}).on("mousemove",function(){x._captureMouseHover()}).on("mouseout",function(){x._unhover.notify(new epiviz.ui.charts.VisEventArgs(x.id()))}),J.exit().transition().duration(500).style("opacity",0).remove(),v&&(f=G.select(".point-series-index-"+D).selectAll(".error-bar").data(f),f.enter().append("g").attr("class","error-bar").each(function(a){var b;b=d.get(a);b=b.valueAnnotation?b.valueAnnotation.errMinus:null;b=void 0!=b?F(b):null;
var c;c=d.get(a);c=c.valueAnnotation?c.valueAnnotation.errPlus:null;c=void 0!=c?F(c):null;null!=b&&null!=c&&(d3.select(this).append("line").attr("x1",L(a)).attr("x2",L(a)).attr("y1",b).attr("y2",c).style("stroke",g).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",L(a)-2).attr("x2",L(a)+2).attr("y1",b).attr("y2",b).style("stroke",g).style("shape-rendering","auto"),d3.select(this).append("line").attr("x1",L(a)-2).attr("x2",L(a)+2).attr("y1",c).attr("y2",c).style("stroke",g).style("shape-rendering",
"auto"))}).attr("transform","translate("+ +c+")").transition().duration(500).attr("transform","translate(0)"),f.on("mouseover",function(){x._captureMouseHover()}).on("mousemove",function(){x._captureMouseHover()}).on("mouseout",function(){x._unhover.notify(new epiviz.ui.charts.VisEventArgs(x.id()))}),f.exit().transition().duration(500).style("opacity",0).remove()),r!=epiviz.ui.charts.CustomSetting.DEFAULT&&(G.selectAll(".abLine").remove(),G.append("svg:line").attr("class","abLine").attr("x1",0).attr("x2",
x.width()-x.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",F(r)).attr("y2",F(r)).style("stroke","black").style("stroke-dasharray","5, 5")));D++}}});D<b.measurements().length;D++)G.select(".line-series-index-"+D).remove(),G.select(".point-series-index-"+D).remove();return B};
epiviz.plugins.charts.MultiStackedLineTrack.prototype._drawLinesCanvas=function(a,b,c,d,e,f,g){var h=this.colors(),m=parseInt(this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.STEP]),l=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_POINTS],p=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_LINES],n=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_ERROR_BARS],
t=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.POINT_RADIUS],v=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.LINE_THICKNESS],q=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.INTERPOLATION];d=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.ABS_LINE_VAL];var u=this;c=d3.scale.linear().domain([0,this.width()-this.margins().sumAxis(epiviz.ui.charts.Axis.X)]).range([a.start(),
a.end()])(c)-a.start();var w=epiviz.datatypes.GenomicRange.fromStartEnd(a.seqName(),Math.min(a.start(),a.start()+c),Math.max(a.end(),a.end()+c),a.genome()),r=g.getContext("2d"),A=[];b.foreach(function(a,b,c){var d=u._measurementColorLabels?h.getByKey(u._measurementColorLabels.get(a)):h.get(c),g=b.binarySearchStarts(w);if(0!=g.length){var x=Math.ceil(g.index/m)*m;g.length=Math.max(0,g.length-x+g.index);g.index=x;for(var x=epiviz.utils.range(g.length,g.index).filter(function(a){return!m||1>=m||0==(a-
g.index)%m}),B=0;B<x.length;++B){var z=b.get(x[B]);A.push(new epiviz.ui.charts.ChartObject(sprintf("line_%s_%s",c,z.globalIndex),z.rowItem.start(),z.rowItem.end(),[z.value],c,[[z]],[a],sprintf("item data-series-%s",c),z.rowItem.seqName()))}var y=function(a){a=b.get(a);return e(a.rowItem.start())},C=function(a){a=b.get(a);return f(a.value)};p&&(a=d3.svg.line().x(y).y(C).interpolate(q),r.globalAlpha=.8,r.beginPath(),a=new Path2D(a(x)),r.strokeStyle=d,r.lineWidth=v,r.stroke(a),r.beginPath());l&&(x.forEach(function(a){var b=
y(a);a=C(a);r.beginPath();r.arc(b,a,t,0,2*Math.PI);r.strokeStyle=d;r.stroke();r.fillStyle=d;r.fill()}),n&&x.forEach(function(a){var c;c=b.get(a);c=c.valueAnnotation?c.valueAnnotation.errMinus:null;c=void 0!=c?f(c):null;var e;e=b.get(a);e=e.valueAnnotation?e.valueAnnotation.errPlus:null;e=void 0!=e?f(e):null;null!=c&&null!=e&&(r.beginPath(),r.moveTo(y(a),C(a)),r.lineTo(c,e),r.strokeStyle=d,r.stroke(),r.beginPath(),r.globalAlpha=.7,r.moveTo(y(a)-2,C(a)+2),r.lineTo(c,c),r.strokeStyle=d,r.stroke(),r.beginPath(),
r.globalAlpha=.7,r.moveTo(y(a)-2,C(a)+2),r.lineTo(e,e),r.strokeStyle=d,r.stroke(),r.beginPath())}))}});d!=epiviz.ui.charts.CustomSetting.DEFAULT&&(r.beginPath(),r.globalAlpha=.7,r.moveTo(0,f(d)),r.lineTo(u.width()-u.margins().sumAxis(epiviz.ui.charts.Axis.X),f(d)),r.strokeStyle=color,r.stroke());return A};
epiviz.plugins.charts.MultiStackedLineTrack.prototype._drawLegend=function(){var a=this;this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();if(this._lastData&&this._lastData.isReady()){var b=this._lastData.measurements();if("canvas"==this.chartDrawType){var c=a.canvas.getContext("2d"),d=0;b.forEach(function(b,e){var f;f=a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(e);c.strokeStyle=f;c.fillStyle=f;c.beginPath();
c.arc(a.margins().left()+d-2,-9,4,0,2*Math.PI);c.stroke();c.fill();c.font="9px";c.beginPath();c.textAlign="start";c.fillText(b.name(),a.margins().left()+d+8,-14);f=c.measureText(b.name()).width;d=d+8+f+10})}else if(-1!=a._id.indexOf("stacked")){var e=(a.height()-a.margins().sumAxis(epiviz.ui.charts.Axis.Y))/a.measurements().size(),f=b,g=this.customSettingsValues()[epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_TRACKS];if("default"!=g){var h=g.split(","),e=(a.height()-a.margins().sumAxis(epiviz.ui.charts.Axis.Y))/
h.length,f=[];b.forEach(function(a){h.includes(a.id())&&f.push(a)})}g=this._svg.selectAll(".chart-title").data(f).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(c)}).attr("x",0).attr("y",function(a,b){return b*e+10}).text(function(a,b){return a.name()}).attr("transform","translate("+a.margins().left()+", "+a.margins().top()+")")}else{var g=
this._svg.selectAll(".chart-title").data(b).enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(c)}).attr("y",a.margins().top()-5).text(function(a,b){return a.name()}),m=0,l=[];this._container.find(" .chart-title").each(function(a){l.push(m);m+=this.getBBox().width+15});g.attr("x",function(b,c){return a.margins().left()+10+l[c]});this._svg.selectAll(".chart-title-color").data(b).enter().append("circle").attr("class",
"chart-title-color").attr("cx",function(b,c){return a.margins().left()+4+l[c]}).attr("cy",a.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(b,c){return a._measurementColorLabels?a.colors().getByKey(a._measurementColorLabels.get(b)):a.colors().get(c)})}}};epiviz.plugins.charts.MultiStackedLineTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.MultiStackedLineTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.MultiStackedLineTrackType.constructor=epiviz.plugins.charts.MultiStackedLineTrackType;epiviz.plugins.charts.MultiStackedLineTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.MultiStackedLineTrack(a,b,c)};
epiviz.plugins.charts.MultiStackedLineTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.MultiStackedLineTrackType"};epiviz.plugins.charts.MultiStackedLineTrackType.prototype.chartName=function(){return"Multi Stacked Line Track"};epiviz.plugins.charts.MultiStackedLineTrackType.prototype.chartHtmlAttributeName=function(){return"MULTI-stacked-lines"};epiviz.plugins.charts.MultiStackedLineTrackType.prototype.isRestrictedToSameDatasourceGroup=function(){return!1};
epiviz.plugins.charts.MultiStackedLineTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.FEATURE}};
epiviz.plugins.charts.MultiStackedLineTrackType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.TrackType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.STEP,epiviz.ui.charts.CustomSetting.Type.NUMBER,50,"Step"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_POINTS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Show points"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_LINES,
epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show lines"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_FILL,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"fill"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_ERROR_BARS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show error bars"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.POINT_RADIUS,
epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Point radius"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.LINE_THICKNESS,epiviz.ui.charts.CustomSetting.Type.NUMBER,1,"Line thickness"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,
epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"linear","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,
epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_TRACKS,epiviz.ui.charts.CustomSetting.Type.STRING,epiviz.ui.charts.CustomSetting.DEFAULT,"Hide/Show Tracks"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings.SHOW_Y_AXIS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show y-axis")])};
epiviz.plugins.charts.MultiStackedLineTrackType.CustomSettings={STEP:"step",SHOW_POINTS:"showPoints",SHOW_ERROR_BARS:"showErrorBars",SHOW_LINES:"showLines",POINT_RADIUS:"pointRadius",LINE_THICKNESS:"lineThickness",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine",SHOW_FILL:"showFill",SHOW_TRACKS:"showTracks",SHOW_Y_AXIS:"showYAxis"};epiviz.ui.charts.Plot=function(a,b,c){epiviz.ui.charts.Chart.call(this,a,b,c)};epiviz.ui.charts.Plot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Chart.prototype);epiviz.ui.charts.Plot.constructor=epiviz.ui.charts.Plot;epiviz.ui.charts.Plot.prototype.displayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.PLOT};epiviz.plugins.charts.ScatterPlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._legend=this._chartContent=null;this._measurementsX=[];this._measurementsY=[];var d=this;this.measurements().foreach(function(a,b){0==b%2?d._measurementsX.push(a):d._measurementsY.push(a)});this._yLabel=this._xLabel="";for(a=0;a<Math.min(this._measurementsX.length,this._measurementsY.length);++a)0<a&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=this._measurementsX[a].name(),this._yLabel+=this._measurementsY[a].name();
this._colorLabels=[];this._initialize()};epiviz.plugins.charts.ScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);epiviz.plugins.charts.ScatterPlot.constructor=epiviz.plugins.charts.ScatterPlot;epiviz.plugins.charts.ScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("scatter-plot",!0);this._chartContent=this._svg.append("g").attr("class","chart-content");this._legend=this._svg.append("g").attr("class","chart-legend")};
epiviz.plugins.charts.ScatterPlot.prototype.draw=function(a,b){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b);b=this._lastData;a=this._lastRange;return b&&a?this._drawCircles(a,b):[]};epiviz.plugins.charts.ScatterPlot.prototype.drawCanvas=function(a,b){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b);b=this._lastData;a=this._lastRange;return b&&a?this._drawCirclesCanvas(a,b):[]};
epiviz.plugins.charts.ScatterPlot.prototype._drawCirclesCanvas=function(a,b){var c=this,d=epiviz.ui.charts.Axis,e=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),f=Math.max(Math.floor(e),1),g=Math.min(this._measurementsX.length,this._measurementsY.length),h=this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.ABS_LINE_VAL],m=b.firstSeries().globalStartIndex(),l=b.firstSeries().globalEndIndex();
b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>m&&(m=c);d<l&&(l=d)});var p=l-m,n=this.margins(),t=this.width(),v=this.height(),q=epiviz.ui.charts.CustomSetting,u=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],w=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],A=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];
r==q.DEFAULT&&(r=this._measurementsX[0].minValue());u==q.DEFAULT&&(u=this._measurementsY[0].minValue());A==q.DEFAULT&&(A=this._measurementsX[0].maxValue());w==q.DEFAULT&&(w=this._measurementsY[0].maxValue());var x=epiviz.measurements.Measurement.Type.isOrdered(this._measurementsX[0].type()),q=d3.scale.linear().domain([r,A]).range([0,t-n.sumAxis(d.X)]),z=d3.scale.linear().domain([u,w]).range([v-n.sumAxis(d.Y),0]);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();
var C=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=C;C.id=this.id()+"-canvas";this._container.append(C);C.width=t;C.height=v;this._container.find("#"+this.id()+"-hoverCanvas").remove();var E=document.createElement("canvas");this.hoverCanvas=E;E.id=this.id()+"-hoverCanvas";this._container.append(E);E.width=this.width();E.height=this.height();E.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(q,z,15,15,C);var D=C.getContext("2d");
this.renderQueue=renderQueue(function(a){D.beginPath();D.arc(n.left()+(a.values[0]-r)*(t-n.sumAxis(d.X))/(A-r),v-n.bottom()-(a.values[1]-u)*(v-n.sumAxis(d.Y))/(w-u),e,0,2*Math.PI);a=c.colors().get(a.seriesIndex);D.strokeStyle=a;D.stroke();D.fillStyle=a;D.fill()});var G,B,I=[];for(G=0;G<p;++G){B=G+m;var y=b.getSeries(this._measurementsX[0]).getRowByGlobalIndex(B);if(y&&(!x||void 0==a.start()||void 0==a.end()||y.start()<a.end()&&y.end()>a.start()))for(y=0;y<g;++y)I.push(y*p+G)}y={};g=[];x=1;for(G=0;G<
I.length;++G){B=I[G]%p;var H=B+m;B=Math.floor(I[G]/p);var F=c._measurementsX[B],M=c._measurementsY[B],K=b.getSeries(F).getByGlobalIndex(H),H=b.getSeries(M).getByGlobalIndex(H);if(K&&H){var J=sprintf("item data-series-%s",B),N=q(K.value),O=z(H.value),N=Math.floor(N/f)*f,O=Math.floor(O/f)*f,L=null;y[O]&&y[O][N]?(L=y[O][N],L.id+="_"+K.globalIndex,L.start=Math.min(L.start,K.rowItem.start()),L.end=Math.max(L.end,K.rowItem.end()),L.values[0]=(L.values[0]*L.valueItems[0].length+K.value)/(L.valueItems[0].length+
1),L.values[1]=(L.values[1]*L.valueItems[1].length+H.value)/(L.valueItems[1].length+1),L.valueItems[0].push(K),L.valueItems[1].push(H),L.valueItems[0].length>x&&(x=L.valueItems[0].length)):(L=new epiviz.ui.charts.ChartObject(sprintf("scatter_%s_%s",B,K.globalIndex),K.rowItem.start(),K.rowItem.end(),[K.value,H.value],B,[[K],[H]],[F,M],J,K.rowItem.seqName()),y[O]||(y[O]={}),y[O][N]=L,g.push(L))}}f=this._chartContent.select(".items");f.empty()&&(f=this._chartContent.append("g").attr("class","items"),
p=f.append("g").attr("class","selected"),f.append("g").attr("class","hovered"),p.append("g").attr("class","hovered"));D.globalAlpha=.7;c.renderQueue(g);if(this._globalIndexColorLabels){f={};for(y=m;y<l;++y)f[this._globalIndexColorLabels[y]]=this._globalIndexColorLabels[y];this._colorLabels=Object.keys(f);var Q=0;this._colorLabels.forEach(function(a,b){var d=c.colors().getByKey(a);D.strokeStyle=d;D.fillStyle=d;D.beginPath();D.arc(c.margins().left()+Q-2,-9,4,0,2*Math.PI);D.stroke();D.fill();D.font=
"9px";D.beginPath();D.textAlign="start";D.fillText(a,c.margins().left()+Q+8,c.margins().top()-5);d=D.measureText(a).width;Q=Q+8+d+10})}else{f=Math.min(this._measurementsX.length,this._measurementsY.length);p=Array(f);for(y=0;y<f;++y)p[y]=sprintf("%s vs %s",this._measurementsX[y].name(),this._measurementsY[y].name());this._colorLabels=p}h!=epiviz.ui.charts.CustomSetting.DEFAULT&&(D.beginPath(),D.globalAlpha=.7,D.moveTo(n.left(),z(h)),D.lineTo(n.left()+(A-r)*(t-n.sumAxis(d.X))/(A-r),z(h)),D.strokeStyle=
black,D.stroke());this.addCanvasEvents(C,E,g,q,z,n,r,A,u,w,e);return g};
epiviz.plugins.charts.ScatterPlot.prototype._drawCircles=function(a,b){var c=this,d=epiviz.ui.charts.Axis,e=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),f=Math.max(Math.floor(e),1),g=Math.min(this._measurementsX.length,this._measurementsY.length),h=this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.ABS_LINE_VAL],m=b.firstSeries().globalStartIndex(),l=b.firstSeries().globalEndIndex();
b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>m&&(m=c);d<l&&(l=d)});var p=l-m,n=this.margins(),t=this.width(),v=this.height(),q=epiviz.ui.charts.CustomSetting,u=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],w=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],r=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],A=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];
r==q.DEFAULT&&(r=this._measurementsX[0].minValue());u==q.DEFAULT&&(u=this._measurementsY[0].minValue());A==q.DEFAULT&&(A=this._measurementsX[0].maxValue());w==q.DEFAULT&&(w=this._measurementsY[0].maxValue());var x=epiviz.measurements.Measurement.Type.isOrdered(this._measurementsX[0].type()),q=d3.scale.linear().domain([r,A]).range([0,t-n.sumAxis(d.X)]),z=d3.scale.linear().domain([u,w]).range([v-n.sumAxis(d.Y),0]);this._clearAxes(this._chartContent);this._drawAxes(q,z,15,15,this._chartContent);var C,
E,D=[];for(C=0;C<p;++C){E=C+m;var G=b.getSeries(this._measurementsX[0]).getRowByGlobalIndex(E);if(G&&(!x||void 0==a.start()||void 0==a.end()||G.start()<a.end()&&G.end()>a.start()))for(G=0;G<g;++G)D.push(G*p+C)}var G={},g=[],B=1;for(C=0;C<D.length;++C){E=D[C]%p;var I=E+m,x=Math.floor(D[C]/p);E=c._measurementsX[x];var y=c._measurementsY[x],H=b.getSeries(E).getByGlobalIndex(I),I=b.getSeries(y).getByGlobalIndex(I);if(H&&I){var F=sprintf("item data-series-%s",x),M=q(H.value),K=z(I.value),M=Math.floor(M/
f)*f,K=Math.floor(K/f)*f,J=null;G[K]&&G[K][M]?(J=G[K][M],J.id+="_"+H.globalIndex,J.start=Math.min(J.start,H.rowItem.start()),J.end=Math.max(J.end,H.rowItem.end()),J.values[0]=(J.values[0]*J.valueItems[0].length+H.value)/(J.valueItems[0].length+1),J.values[1]=(J.values[1]*J.valueItems[1].length+I.value)/(J.valueItems[1].length+1),J.valueItems[0].push(H),J.valueItems[1].push(I),J.valueItems[0].length>B&&(B=J.valueItems[0].length)):(J=new epiviz.ui.charts.ChartObject(sprintf("scatter_%s_%s",x,H.globalIndex),
H.rowItem.start(),H.rowItem.end(),[H.value,I.value],x,[[H],[I]],[E,y],F,H.rowItem.seqName()),G[K]||(G[K]={}),G[K][M]=J,g.push(J))}}f=this._chartContent.select(".items");f.empty()&&(f=this._chartContent.append("g").attr("class","items"),p=f.append("g").attr("class","selected"),f.append("g").attr("class","hovered"),p.append("g").attr("class","hovered"));p=f.selectAll("circle").data(g,function(a){return a.id});p.enter().insert("circle",":first-child").attr("id",function(a){return sprintf("%s-item-%s-%s",
c.id(),a.seriesIndex,a.valueItems[0][0].globalIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0);p.each(function(a){var b=d3.select(this),e;e=c._globalIndexColorLabels?c.colors().getByKey(c._globalIndexColorLabels[a.valueItems[0][0].globalIndex]):c.colors().get(a.seriesIndex);b.attr("cx",n.left()+(a.values[0]-r)*(t-n.sumAxis(d.X))/(A-r)).attr("cy",v-n.bottom()-(a.values[1]-u)*(v-n.sumAxis(d.Y))/(w-u)).attr("class",a.cssClasses).style("fill",e)});p.transition().duration(1E3).style("fill-opacity",
function(a){return Math.max(.6,a.valueItems[0].length/B)}).style("opacity",null).attr("r",e);p.exit().transition().duration(1E3).style("opacity",0).attr("r",0).remove();p.on("mouseover",function(a){c._hover.notify(new epiviz.ui.charts.VisEventArgs(c.id(),a))}).on("mouseout",function(){c._unhover.notify(new epiviz.ui.charts.VisEventArgs(c.id()))}).on("click",function(a){c._deselect.notify(new epiviz.ui.charts.VisEventArgs(c.id()));c._select.notify(new epiviz.ui.charts.VisEventArgs(c.id(),a));d3.event.stopPropagation()});
if(this._globalIndexColorLabels){e={};for(G=m;G<l;++G)e[this._globalIndexColorLabels[G]]=this._globalIndexColorLabels[G];this._colorLabels=Object.keys(e);this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();e=this._svg.selectAll(".chart-title").data(this._colorLabels);e.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",c.margins().top()-5);e.attr("fill",function(a,b){return c.colors().getByKey(a)}).text(function(a){return a});
var N=0,O=[];this._container.find(" .chart-title").each(function(a){O.push(N);N+=this.getBBox().width+15});e.attr("x",function(a,b){return c.margins().left()+10+O[b]});this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(a,b){return c.margins().left()+4+O[b]}).attr("cy",c.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a,b){return c.colors().getByKey(a)}).style("stroke-width",
0)}else{e=Math.min(this._measurementsX.length,this._measurementsY.length);p=Array(e);for(G=0;G<e;++G)p[G]=sprintf("%s vs %s",this._measurementsX[G].name(),this._measurementsY[G].name());this._colorLabels=p}h!=epiviz.ui.charts.CustomSetting.DEFAULT&&(f.selectAll(".abLine").remove(),f.append("svg:line").attr("class","abLine").attr("x1",n.left()+(r-r)*(t-n.sumAxis(d.X))/(A-r)).attr("x2",n.left()+(A-r)*(t-n.sumAxis(d.X))/(A-r)).attr("y1",v-n.bottom()-(h-u)*(v-n.sumAxis(d.Y))/(w-u)).attr("y2",v-n.bottom()-
(h-u)*(v-n.sumAxis(d.Y))/(w-u)).style("stroke","black").style("stroke-dasharray","5, 5"));return g};epiviz.plugins.charts.ScatterPlot.prototype.colorLabels=function(){return this._colorLabels};
epiviz.plugins.charts.ScatterPlot.prototype._drawAxes=function(a,b,c,d,e,f,g,h){epiviz.ui.charts.Plot.prototype._drawAxes.call(this,a,b,c,d,e,f,g,h);this._legend.selectAll("text").remove();a=this._measurementsX;var m=this;this._legend.selectAll(".x-measurement").remove();this._legend.selectAll(".x-measurement-color").remove();b=this._legend.selectAll(".x-measurement").data(a).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",function(a,b){return m._globalIndexColorLabels?
"#000000":m.colors().get(b)}).attr("y",this.height()-this.margins().bottom()+35).text(function(a,b){return a.name()});var l=0,p=[];this._container.find(" .x-measurement").each(function(a){p.push(l);l+=this.getBBox().width+15});b.attr("x",function(a,b){return.5*(m.width()-l)+7+p[b]});this._legend.selectAll(".x-measurement-color").data(a).enter().append("circle").attr("class","x-measurement-color").attr("cx",function(a,b){return.5*(m.width()-l)+1+p[b]}).attr("cy",this.height()-this.margins().bottom()+
31).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a,b){return m._globalIndexColorLabels?"#ffffff":m.colors().get(b)});a=this._measurementsY;this._legend.selectAll(".y-measurement").remove();this._legend.selectAll(".y-measurement-color").remove();b=this._legend.selectAll(".y-measurement").data(a).enter().append("text").attr("class","y-measurement").attr("font-weight","bold").attr("fill",function(a,b){return m._globalIndexColorLabels?"#000000":m.colors().get(b)}).attr("y",
this.margins().left()-35).attr("transform","rotate(-90)").text(function(a,b){return a.name()});var n=0,t=[];this._container.find(" .y-measurement").each(function(a){t.push(n);n+=this.getBBox().width+15});b.attr("x",function(a,b){return-m.height()+.5*(m.height()-n)+12+m.margins().top()+t[b]});this._legend.selectAll(".y-measurement-color").data(a).enter().append("circle").attr("class","y-measurement-color").attr("cx",function(a,b){return-m.height()+.5*(m.height()-n)+6+m.margins().top()+t[b]}).attr("cy",
this.margins().left()-39).attr("transform","rotate(-90)").attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a,b){return m._globalIndexColorLabels?"#ffffff":m.colors().get(b)})};
epiviz.plugins.charts.ScatterPlot.prototype._drawAxesCanvas=function(a,b,c,d,e,f,g,h){epiviz.ui.charts.Plot.prototype._drawAxesCanvas.call(this,a,b,c,d,e,f,g,h);var m=this;a=this._measurementsX;var l=e.getContext("2d"),p=0;a.forEach(function(a,b){var c=m._globalIndexColorLabels?"#000000":m.colors().get(b);l.strokeStyle=c;l.fillStyle=c;l.beginPath();l.arc(m.margins().left()+p-2,m.height()-m.margins().bottom()+35,4,0,2*Math.PI);l.stroke();l.fill();l.font="9px";l.beginPath();l.textAlign="start";l.fillText(a.name(),
m.margins().left()+p+8,m.height()-m.margins().bottom()+35);c=l.measureText(a.name()).width;p=p+8+c+10});e=this._measurementsY;p=0;e.forEach(function(a,b){l.save();l.translate(15,m.height()-m.margins().bottom()-p);l.rotate(-Math.PI/2);var c=m._globalIndexColorLabels?"#000000":m.colors().get(b);l.strokeStyle=c;l.fillStyle=c;l.beginPath();l.arc(0,0,4,0,2*Math.PI);l.stroke();l.fill();l.font="9px";l.beginPath();l.textAlign="start";l.fillText(a.name(),10,0);l.restore();c=l.measureText(a.name()).width;p=
p+8+c+10})};
epiviz.plugins.charts.ScatterPlot.prototype.addCanvasEvents=function(a,b,c,d,e,f,g,h,m,l,p){var n=this,t=b.getContext("2d");n.hoverCanvasObjects=c;var v=n.width(),q=n.height(),u=epiviz.ui.charts.Axis;b.addEventListener("click",function(a){});b.addEventListener("mousemove",function(a){b.getBoundingClientRect();var d=a.offsetX;a=a.offsetY;var e=(d-p-f.left())*(h-g)/(v-f.sumAxis(u.X))+g,t=(-a-p+(q-f.bottom()))*(l-m)/(q-f.sumAxis(u.Y))+m,w=(d+p-f.left())*(h-g)/(v-f.sumAxis(u.X))+g,C=(-a+p+(q-f.bottom()))*
(l-m)/(q-f.sumAxis(u.Y))+m,E=null;c&&c.forEach(function(a){Math.floor(a.values[0])<=Math.floor(w)&&Math.floor(a.values[0])>=Math.floor(e)&&Math.floor(a.values[1])<=Math.floor(C)&&Math.floor(a.values[1])>=Math.floor(t)&&(E=a)});E&&n._hover.notify(new epiviz.ui.charts.VisEventArgs(n.id(),E))});b.addEventListener("mouseout",function(a){n._canvasHoverObject=null;t.clearRect(0,0,b.width,b.height);n._unhover.notify(new epiviz.ui.charts.VisEventArgs(n.id()))})};
epiviz.plugins.charts.ScatterPlot.prototype.doHover=function(a){epiviz.ui.charts.Plot.prototype.doHover.call(this,a);var b=this;if("canvas"==this.chartDrawType){var c=this.hoverCanvas.getContext("2d");c.clearRect(0,0,this.hoverCanvas.width,this.hoverCanvas.height);var d=epiviz.ui.charts.CustomSetting,e=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),f=epiviz.ui.charts.Axis,g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],
h=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],m=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],l=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];m==d.DEFAULT&&(m=this._measurementsX[0].minValue());g==d.DEFAULT&&(g=this._measurementsY[0].minValue());l==d.DEFAULT&&(l=this._measurementsX[0].maxValue());h==d.DEFAULT&&(h=this._measurementsY[0].maxValue());this._canvasHoverObject=a;this.hoverCanvasObjects.forEach(function(d){d.overlapsWith(a)&&
(c.beginPath(),c.arc(b.margins().left()+(d.values[0]-m)*(b.width()-b.margins().sumAxis(f.X))/(l-m),b.height()-b.margins().bottom()-(d.values[1]-g)*(b.height()-b.margins().sumAxis(f.Y))/(h-g),e,0,2*Math.PI),b.colors().get(d.seriesIndex),c.strokeStyle="yellow",c.stroke())})}else{var p=this._container.find(".items"),d=p.find("> .hovered"),n=p.find("> .selected"),t=n.find("> .hovered"),v=function(){if(Array.isArray(a)){for(var b=!1,c=0;c<a.length;c++)a[c].overlapsWith(d3.select(this).data()[0])&&(b=!0);
return b}return a.overlapsWith(d3.select(this).data()[0])},p=p.find("> .item").filter(v);d.append(p);p=n.find("> .item").filter(v);t.append(p)}};epiviz.ui.charts.PlotType=function(a){epiviz.ui.charts.ChartType.call(this,a)};epiviz.ui.charts.PlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.ChartType.prototype);epiviz.ui.charts.PlotType.constructor=epiviz.ui.charts.PlotType;epiviz.ui.charts.PlotType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.PLOT};epiviz.ui.charts.PlotType.prototype.cssClass=function(){return"plot-container ui-widget-content"};epiviz.plugins.charts.ScatterPlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.ScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.ScatterPlotType.constructor=epiviz.plugins.charts.ScatterPlotType;epiviz.plugins.charts.ScatterPlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.ScatterPlot(a,b,c)};epiviz.plugins.charts.ScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.ScatterPlot"};
epiviz.plugins.charts.ScatterPlotType.prototype.chartName=function(){return"Scatter Plot"};epiviz.plugins.charts.ScatterPlotType.prototype.chartHtmlAttributeName=function(){return"scatter"};epiviz.plugins.charts.ScatterPlotType.prototype.measurementsFilter=function(){return function(a){return epiviz.measurements.Measurement.Type.hasValues(a.type())}};epiviz.plugins.charts.ScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};
epiviz.plugins.charts.ScatterPlotType.prototype.minSelectedMeasurements=function(){return 2};
epiviz.plugins.charts.ScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.ScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,
"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,
"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.ScatterPlotType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Draw abline")])};epiviz.plugins.charts.ScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio",ABS_LINE_VAL:"abLine"};epiviz.plugins.charts.GenesTrack=function(a,b,c){epiviz.ui.charts.Track.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.GenesTrack.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Track.prototype);epiviz.plugins.charts.GenesTrack.constructor=epiviz.plugins.charts.GenesTrack;epiviz.plugins.charts.GenesTrack.prototype._initialize=function(){epiviz.ui.charts.Track.prototype._initialize.call(this);this._svg.classed("genes-track",!0)};
epiviz.plugins.charts.GenesTrack.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];c=c||this._slide;d=d||this._zoom;this._slide=0;this._zoom=1;return this._drawGenes(a,b,c||0,d||1)};
epiviz.plugins.charts.GenesTrack.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Track.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];c=c||this._slide;d=d||this._zoom;this._slide=0;this._zoom=1;return this._drawGenesCanvas(a,b,c||0,d||1)};
epiviz.plugins.charts.GenesTrack.prototype._drawGenes=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=a.start(),g=a.end(),h=this.width(),m=this.height(),l=this.margins(),p=d3.scale.linear().domain([f,g]).range([0,h-l.sumAxis(e.X)]),n=c*(h-l.sumAxis(e.X))/(g-f);this._clearAxes();this._drawAxes(p,null,10,5);var t=this,v=b.firstSeries();b=epiviz.utils.range(v.size()).map(function(a){a=v.get(a);var b=a.rowItem,c=sprintf("item gene-%s",b.metadata("gene"));return new epiviz.ui.charts.ChartObject(b.metadata("gene"),
b.start(),b.end(),null,0,[[a]],[v.measurement()],c,b.seqName())});d&&(this._svg.select(".items").remove(),this._svg.select("defs").select("#clip-"+this.id()).remove());d=this._svg.select(".items");c=d.select(".selected");d.empty()&&(this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("x",0).attr("y",0).attr("width",h-l.sumAxis(e.X)).attr("height",m-l.sumAxis(e.Y)),d=this._svg.append("g").attr("class","items").attr("transform","translate("+l.left()+", "+l.top()+
")").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")"),c=d.append("g").attr("class","selected"),d.append("g").attr("class","hovered"),c.append("g").attr("class","hovered"));var q=d.selectAll(".item").data(b,function(a){return a.id});q.enter().insert("g",":first-child").on("mouseout",function(){t._unhover.notify(new epiviz.ui.charts.VisEventArgs(t.id()))}).on("mouseover",function(a){t._hover.notify(new epiviz.ui.charts.VisEventArgs(t.id(),a))}).on("click",function(a){t._deselect.notify(new epiviz.ui.charts.VisEventArgs(t.id()));
t._select.notify(new epiviz.ui.charts.VisEventArgs(t.id(),a));d3.event.stopPropagation()}).attr("transform","translate("+n+", 0) scale(1, 1)").each(function(a){t._drawGene(this,a,p)});var u=0,w=f,r=g,m=d3.behavior.drag().on("drag",function(a){console.log(d3.event.dx);u+=d3.event.dx;0!=d3.event.dx&&(a=Math.round(Math.abs(p.invert(0)-p.invert(Math.abs(u)))),0<u?(w=f-a,r=g-a):0>u&&(w=f+a,r=g+a),a=d3.scale.linear().domain([w,r]).range([0,h-l.sumAxis(e.X)]),q.each(function(a){d3.select(this).attr("transform",
function(a,b){return"translate("+[u,0]+")"})}),t._clearAxes(),t._drawAxes(a,null,10,5))}).on("dragend",function(b){b=new epiviz.datatypes.GenomicRange(a.seqName(),w,r-w,a.genome());t._propagateNavigationChanges.notify({id:t.id(),range:b})});t._svg.call(m);n&&q.each(function(a){t._translateGene(this,a,n)});q.exit().transition().duration(500).style("opacity",0).remove();return b};
epiviz.plugins.charts.GenesTrack.prototype._drawGenesCanvas=function(a,b,c,d){c=epiviz.ui.charts.Axis;var e=a.start(),f=a.end();a=this.width();var g=this.height(),h=this.margins(),m=d3.scale.linear().domain([e,f]).range([0,a-h.sumAxis(c.X)]);h.sumAxis(c.X);this._container.find("svg").remove();this._container.find("#"+this.id()+"-canvas").remove();var l=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=l;l.id=this.id()+"-canvas";this._container.append(l);l.width=this.width();
l.height=this.height();l.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();this.hoverCanvas=e=document.createElement("canvas");e.id=this.id()+"-hoverCanvas";this._container.append(e);e.width=this.width();e.height=this.height();e.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";this._drawAxesCanvas(m,null,10,5,l);var p=this,n=b.firstSeries();b=epiviz.utils.range(n.size()).map(function(a){a=n.get(a);var b=
a.rowItem,c=sprintf("item gene-%s",b.metadata("gene"));return new epiviz.ui.charts.ChartObject(b.metadata("gene"),b.start(),b.end(),null,0,[[a]],[n.measurement()],c,b.seqName())});d&&(this._svg.select(".items").remove(),this._svg.select("defs").select("#clip-"+this.id()).remove());d=this._svg.select(".items");f=d.select(".selected");d.empty()&&(this._svg.select("defs").append("clipPath").attr("id","clip-"+this.id()).append("rect").attr("x",0).attr("y",0).attr("width",a-h.sumAxis(c.X)).attr("height",
g-h.sumAxis(c.Y)),d=this._svg.append("g").attr("class","items").attr("transform","translate("+h.left()+", "+h.top()+")").attr("id",this.id()+"-gene-content").attr("clip-path","url(#clip-"+this.id()+")"),f=d.append("g").attr("class","selected"),d.append("g").attr("class","hovered"),f.append("g").attr("class","hovered"));l.getContext("2d").translate(h.left(),h.top());e.getContext("2d").translate(h.left(),0);b.forEach(function(a){p._drawGeneCanvas(this,a,m,l)});this.addCanvasEvents(l,e,b,m);this._drawLegend();
return b};epiviz.plugins.charts.GenesTrack.prototype._translateGene=function(a,b,c){a=d3.select(a);b=a.attr("transform");var d=RegExp("translate\\([\\d\\.\\-]+[\\,\\s]+[\\d\\.\\-]+\\)","g"),e=RegExp("[\\d\\.\\-]+","g"),f=b.match(d)[0],e=parseFloat(f.match(e)[0]);b=b.replace(d,"translate("+(e-c)+", 0)");a.transition().duration(500).attr("transform",b)};
epiviz.plugins.charts.GenesTrack.prototype._drawGene=function(a,b,c){var d=epiviz.ui.charts.Axis,e=this,f=b.valueItems[0][0].rowItem,g=c(b.start),h=c(b.end),m="+"==f.strand()?1:-1,l=-m*(this.height()-this.margins().sumAxis(d.Y))*.25,p=f.metadata("exon_starts").split(",").map(function(a){return parseInt(a)}),n=f.metadata("exon_ends").split(",").map(function(a){return parseInt(a)}),t=d3.range(0,p.length),v=.08*this.height(),q=.16*this.height(),u=v*Math.sqrt(3)*.5;a=d3.select(a);a.attr("class",b.cssClasses);
a.append("polygon").attr("class","gene-body").style("fill",this.colors().get(0)).attr("points",function(){var a,b;a=.5*(e.height()-e.margins().sumAxis(d.Y)-v)+l;b=[a,a,a+.5*v,a+v,a+v];a="+"==f.strand()?[g,h,h+u,h,g]:[h,g,g-u,g,h];return sprintf("%s,%s %s,%s %s,%s %s,%s %s,%s",a[0],b[0],a[1],b[1],a[2],b[2],a[3],b[3],a[4],b[4])});a.append("g").attr("class","exons").style("fill",this.colors().get(1)).selectAll("rect").data(t).enter().append("rect").attr("x",function(a){return c(p[a])}).attr("y",.5*(e.height()-
q-e.margins().sumAxis(d.Y))+l).attr("width",function(a){return c(n[a])-c(p[a])}).attr("height",q);a.append("text").attr("class","gene-name").attr("x",g+2).attr("y",.5*(e.height()-e.margins().sumAxis(d.Y))+l-m*(v+2)).style("dominant-baseline","central").text(b.id)};
epiviz.plugins.charts.GenesTrack.prototype._drawGeneCanvas=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=this;a=b.valueItems[0][0].rowItem;var g=c(b.start);b=c(b.end);var h=-("+"==a.strand()?1:-1)*(this.height()-this.margins().sumAxis(e.Y))*.25,m=a.metadata("exon_starts").split(",").map(function(a){return parseInt(a)}),l=a.metadata("exon_ends").split(",").map(function(a){return parseInt(a)}),p=d3.range(0,m.length),n=.08*this.height(),t=.16*this.height(),v=n*Math.sqrt(3)*.5,q=null,q=.5*(f.height()-
f.margins().sumAxis(e.Y)-n)+h,n=[q,q,q+.5*n,q+n,q+n],q="+"==a.strand()?[g,b,b+v,b,g]:[b,g,g-v,g,b],u=d.getContext("2d");u.beginPath();u.strokeStyle="black";u.moveTo(q[0],n[0]);u.lineTo(q[1],n[1]);u.lineTo(q[2],n[2]);u.lineTo(q[3],n[3]);u.lineTo(q[4],n[4]);u.lineTo(q[0],n[0]);u.fillStyle=this.colors().get(0);u.fill();u.lineWidth=1;u.stroke();u.beginPath();p.forEach(function(a,b){u.fillStyle=f.colors().get(1);u.rect(c(m[b]),.5*(f.height()-t-f.margins().sumAxis(e.Y))+h,c(l[b])-c(m[b]),t);u.fill()})};
epiviz.plugins.charts.GenesTrack.prototype.colorLabels=function(){return["Genes","Exons"]};
epiviz.plugins.charts.GenesTrack.prototype.doHover=function(a){epiviz.ui.charts.Track.prototype.doHover.call(this,a);var b=this;if("canvas"==b.chartDrawType){var c=epiviz.ui.charts.Axis,d=d3.scale.linear().domain([this._lastRange.start(),this._lastRange.end()]).range([0,this.width()-b.margins().sumAxis(c.X)]);b.hoverCanvasObjects&&b.hoverCanvasObjects.forEach(function(e){if(e.overlapsWith(a)){var f=d(e.start),g="+"==e.valueItems[0][0].rowItem.strand()?1:-1,h=-g*(b.height()-b.margins().sumAxis(c.Y))*
.25,m=.08*b.height(),l=b.hoverCanvas.getContext("2d");l.globalAlpha=.8;l.strokeStyle="black";l.fillStyle="black";l.lineWidth=4;l.stroke();l.fillText(e.id,f+2,.5*(b.height()-b.margins().sumAxis(c.Y))+h-g*(m+2))}})}};epiviz.plugins.charts.GenesTrackType=function(a){epiviz.ui.charts.TrackType.call(this,a)};epiviz.plugins.charts.GenesTrackType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.TrackType.prototype);epiviz.plugins.charts.GenesTrackType.constructor=epiviz.plugins.charts.GenesTrackType;epiviz.plugins.charts.GenesTrackType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.GenesTrack(a,b,c)};epiviz.plugins.charts.GenesTrackType.prototype.typeName=function(){return"epiviz.plugins.charts.GenesTrack"};
epiviz.plugins.charts.GenesTrackType.prototype.chartName=function(){return"Genes Track"};epiviz.plugins.charts.GenesTrackType.prototype.chartHtmlAttributeName=function(){return"genes"};epiviz.plugins.charts.GenesTrackType.prototype.isRestrictedToRangeMeasurements=function(){return!0};epiviz.plugins.charts.GenesTrackType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.RANGE}};epiviz.ui.charts.transform={};epiviz.ui.charts.transform.clustering={};epiviz.ui.charts.transform.clustering.ClusterSubtree=function(a,b){this._children=a;this._weight=null;this._distance=b;this._sorted=!1};epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.weight=function(){if(void 0==this._weight){for(var a=0,b=0;b<this._children.length;++b)a+=this._children[b].weight();this._weight=a}return this._weight};epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.children=function(){return this._children};
epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.data=function(){for(var a=[],b=0;b<this._children.length;++b)a=a.concat(this._children[b].data());return a};epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.sort=function(a){if(!this.sorted()&&(this._children.sort(function(a,b){return a.weight()-b.weight()}),a)){for(var b=0;b<this._children.length;++b)this._children[b].sort(a);this._sorted=!0}};
epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.copy=function(){for(var a=[],b=0;b<this._children.length;++b)a.push(this._children[b].copy());return new epiviz.ui.charts.transform.clustering.ClusterSubtree(a)};epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.distance=function(){return this._distance};epiviz.ui.charts.transform.clustering.ClusterSubtree.prototype.sorted=function(){return this._sorted};epiviz.ui.charts.transform.clustering.ClusterLeaf=function(a){this._dataIndex=a};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.weight=function(){return 1};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.children=function(){return[]};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.data=function(){return[this._dataIndex]};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.sort=function(){};
epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.copy=function(){return new epiviz.ui.charts.transform.clustering.ClusterLeaf(this._dataIndex)};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.distance=function(){return 0};epiviz.ui.charts.transform.clustering.ClusterLeaf.prototype.sorted=function(){return!0};epiviz.ui.charts.transform.clustering.ClusterTree=function(a,b){this._root=a;this._data=b};epiviz.ui.charts.transform.clustering.ClusterTree.prototype.root=function(){return this._root};epiviz.ui.charts.transform.clustering.ClusterTree.prototype.orderedData=function(){this._root.sorted()||this._root.sort(!0);for(var a=this._root.data(),b=[],c=0;c<a.length;++c)b.push(this._data[a[c]]);return b};epiviz.ui.charts.transform.clustering.NoneClustering=function(){};epiviz.ui.charts.transform.clustering.NoneClustering.prototype.cluster=function(a,b,c){b=[];for(c=0;c<a.length;++c)b.push(new epiviz.ui.charts.transform.clustering.ClusterLeaf(c));b=new epiviz.ui.charts.transform.clustering.ClusterSubtree(b,0);return new epiviz.ui.charts.transform.clustering.ClusterTree(b,a)};epiviz.ui.charts.transform.clustering.NoneClustering.prototype.id=function(){return"none"};epiviz.ui.charts.transform.clustering.AgglomerativeClustering=function(){};
epiviz.ui.charts.transform.clustering.AgglomerativeClustering.prototype.cluster=function(a,b,c){var d,e,f=Array(a.length);for(d=0;d<a.length;++d)for(f[d]=Array(a.length),e=d+1;e<a.length;++e)f[d][e]=b.distance(a[d],a[e]);b=[];for(d=0;d<a.length;++d)b.push(new epiviz.ui.charts.transform.clustering.ClusterLeaf(d));for(;1<b.length;){e=epiviz.utils.indexOfMin(f,!0);d=e.index;e=new epiviz.ui.charts.transform.clustering.ClusterSubtree([b[d[0]],b[d[1]]],e.min);if(d[0]<d[1]){var g=d[0];d[0]=d[1];d[1]=g}b.splice(d[0],
1);b.splice(d[1],1);b.push(e);f=c.link(f,d)}return new epiviz.ui.charts.transform.clustering.ClusterTree(b[0],a)};epiviz.ui.charts.transform.clustering.AgglomerativeClustering.prototype.id=function(){return"agglomerative"};epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm=function(){};epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.prototype.cluster=function(a,b,c){};epiviz.ui.charts.transform.clustering.HierarchicalClusteringAlgorithm.prototype.id=function(){};epiviz.ui.charts.transform.clustering.EuclideanMetric=function(){};epiviz.ui.charts.transform.clustering.EuclideanMetric.prototype.distance=function(a,b){if(void 0==a||void 0==b)return null;var c=a.length,d=0,e=0,f=0,g;for(g=0;g<c;++g)if(void 0!=a[g]&&void 0!=b[g]){++d;var h=a[g]-b[g],e=e+h,f=f+h*h}0<d&&(e/=d);return f+(c-d)*e*e};epiviz.ui.charts.transform.clustering.EuclideanMetric.prototype.id=function(){return"euclidean"};epiviz.ui.charts.transform.clustering.CompleteLinkage=function(){};epiviz.ui.charts.transform.clustering.CompleteLinkage.prototype.link=function(a,b){var c=Array(a.length-1);if(b[0]<b[1]){var d=b[0];b[0]=b[1];b[1]=d}for(var e=d=0;d<a.length;++d,++e)if(d==b[0]||d==b[1])--e;else{c[e]=a[d].slice(0);c[e].splice(b[0],1);c[e].splice(b[1],1);var f=[d<b[0]?a[d][b[0]]:a[b[0]][d],d<b[1]?a[d][b[1]]:a[b[1]][d]];c[e].push(Math.max(f[0],f[1]))}c[c.length-1]=Array(c.length);return c};
epiviz.ui.charts.transform.clustering.CompleteLinkage.prototype.id=function(){return"complete"};epiviz.ui.charts.transform.clustering.ClusteringLinkage=function(){};epiviz.ui.charts.transform.clustering.ClusteringLinkage.prototype.link=function(a,b){};epiviz.ui.charts.transform.clustering.ClusteringLinkage.prototype.id=function(){};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory=function(a){this._config=a;this._algorithms={};this._metrics={};this._linkages={};var b;for(b=0;b<a.clustering.algorithms.length;++b){var c=epiviz.utils.evaluateFullyQualifiedTypeName(a.clustering.algorithms[b]),c=epiviz.utils.applyConstructor(c);this._algorithms[c.id()]=c}for(b=0;b<a.clustering.metrics.length;++b)c=epiviz.utils.evaluateFullyQualifiedTypeName(a.clustering.metrics[b]),c=epiviz.utils.applyConstructor(c),this._metrics[c.id()]=
c;for(b=0;b<a.clustering.linkages.length;++b)c=epiviz.utils.evaluateFullyQualifiedTypeName(a.clustering.linkages[b]),c=epiviz.utils.applyConstructor(c),this._linkages[c.id()]=c};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance=null;epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance=function(){return epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance};
epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.initialize=function(a){epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory._instance=new epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory(a)};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.algorithm=function(a){return this._algorithms[a]};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.metric=function(a){return this._metrics[a]};
epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.linkage=function(a){return this._linkages[a]};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.algorithms=function(){return Object.keys(this._algorithms)};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.metrics=function(){return Object.keys(this._metrics)};epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.prototype.linkages=function(){return Object.keys(this._linkages)};epiviz.plugins.charts.HeatmapPlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._chartContent=null;this._min=this.measurements().first().minValue();this._max=this.measurements().first().maxValue();this._colorScale=epiviz.utils.colorizeBinary(this._min,this._max,"#ffffff",this.colors().getByKey("Max"));this._colorLabels=[];this._dendrogramRatio=.1;this._initialize()};epiviz.plugins.charts.HeatmapPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);
epiviz.plugins.charts.HeatmapPlot.constructor=epiviz.plugins.charts.HeatmapPlot;epiviz.plugins.charts.HeatmapPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("heatmap-plot",!0);this._chartContent=this._svg.append("g").attr("class","chart-content")};
epiviz.plugins.charts.HeatmapPlot.prototype.draw=function(a,b){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b);b=this._lastData;a=this._lastRange;if(!b||!a)return[];this.customSettingsValues();var c=this._applyClustering(a,b);return this._drawCells(a,c.data,c.columnOrder)};
epiviz.plugins.charts.HeatmapPlot.prototype.drawCanvas=function(a,b){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b);b=this._lastData;a=this._lastRange;if(!b||!a)return[];this.customSettingsValues();this._container.find("#"+this.id()+"-canvas").remove();var c=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=c;c.id=this.id()+"-canvas";this._container.append(c);c.width=this.width();c.height=this.height();c.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+
this.id()+"-hoverCanvas").remove();var d=document.createElement("canvas");this.hoverCanvas=d;d.id=this.id()+"-hoverCanvas";this._container.append(d);d.width=this.width();d.height=this.height();d.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";c=this._applyClustering(a,b,c);return this._drawCellsCanvas(a,c.data,c.columnOrder)};
epiviz.plugins.charts.HeatmapPlot.prototype._applyClustering=function(a,b,c){var d=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type()),e=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER],f=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM],g=epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance(),h=g.algorithm(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_ALG]),
m=g.metric(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_METRIC]),l=g.linkage(this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_LINKAGE]),p=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS],n=b.firstSeries().globalStartIndex(),t=b.firstSeries().size()+n;b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>n&&(n=c);d<t&&(t=d)});var v=t-n,g=e==epiviz.plugins.charts.HeatmapPlotType.Cluster.ROWS||
e==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,q=e==epiviz.plugins.charts.HeatmapPlotType.Cluster.COLS||e==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,e=f*this._dendrogramRatio,p=f&&q&&p>=v,u,w,r,A,x,z,C=this._svg;["dendrogram-horizontal","dendrogram-vertical"].forEach(function(a){C.select("."+a).remove()});var E=b;if(g){u=[];b.foreach(function(b,c){for(var e=[],f=0;f<v;++f){var g=c.getByGlobalIndex(f+n),h=g.rowItem;(!d||void 0==a.start()||void 0==a.end()||h.start()<a.end()&&h.end()>=
a.start())&&e.push(g.value)}u.push(e)});f=h.cluster(u,m,l);w=f.root().data();var D=[];b.foreach(function(a){D.push(a)});r=[];for(A=0;A<w.length;++A)r[A]=D[w[A]];w=new epiviz.measurements.MeasurementHashtable;for(A=0;A<r.length;++A)w.put(r[A],b.getSeries(r[A]));E=new epiviz.datatypes.MapGenomicData(w);e&&(z=this.width()*e,x=this.height()*(1-e*p)-this.margins().sumAxis(epiviz.ui.charts.Axis.Y),r=this.margins().top(),A=this.width()-z-this.margins().right(),c?this._drawDendrogramCanvas(f,r,A,x,z):this._drawDendrogram(f,
r,A,x,z))}w=null;if(q){u=[];b.foreach(function(b,c){for(var e=0,f=0;e<v;++e){var g=c.getByGlobalIndex(e+n),h=g.rowItem;if(!d||void 0==a.start()||void 0==a.end()||h.start()<a.end()&&h.end()>=a.start())u.length<=f&&u.push([]),u[f].push(g.value),++f}});if(0==u.length)return{data:E,columnOrder:[]};f=h.cluster(u,m,l);w=f.root().data();p&&(b=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS]?20:0,A=this.margins().left(),r=this.height()*(1-e)-this.margins().bottom(),
z=this.height()*e,x=this.width()*(1-e*g)-this.margins().left()-this.margins().right()-b,c?this._drawDendrogramCanvas(f,r,A,x,z,!0):this._drawDendrogram(f,r,A,x,z,!0))}return{data:E,columnOrder:w}};
epiviz.plugins.charts.HeatmapPlot.prototype._drawCells=function(a,b,c){var d=this,e=epiviz.ui.charts.Axis,f=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS],g=b.firstSeries().globalStartIndex(),h=b.firstSeries().size()+g,m=[],l=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type());b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>g&&(g=c);d<h&&(h=d);m.push(a)});for(var p=h-g,n=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],
t=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER],v=t==epiviz.plugins.charts.HeatmapPlotType.Cluster.ROWS||t==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,t=(t==epiviz.plugins.charts.HeatmapPlotType.Cluster.COLS||t==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH)&&f>=p,q=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM]*this._dendrogramRatio,u=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS]?
20:0,v=this.width()*(1-q*v)-u,t=this.height()*(1-q*t),w=[],r=[],A,q=0;q<p;++q){A=q+g;var x;b.foreach(function(a,b){return x=b.getRowByGlobalIndex(A)});x&&(!l||void 0==a.start()||void 0==a.end()||x.start()<a.end()&&x.end()>=a.start())&&(w.push(A),u=x.metadata(n)||""+x.id(),r.push(u))}if(c)for(a=w,l=r,w=Array(w.length),r=Array(r.length),q=0;q<w.length;++q)w[q]=a[c[q]],r[q]=l[c[q]];var z=[],C={};b.foreach(function(a,b,c){for(var d,e=0,g=f,h=0;h<r.length;++h)if(A=w[h],d=b.getByGlobalIndex(A)){var l;0==
e?(e=sprintf("item data-series-%s",c),l=new epiviz.ui.charts.ChartObject(sprintf("heatmap_%s_%s",c,A),d.rowItem.start(),d.rowItem.end(),[d.value],c,[[d]],[a],e,d.rowItem.seqName()),z.push(l),e=d=Math.ceil((r.length-h)/g),--g):(l=z[z.length-1],l.id+="_"+A,epiviz.measurements.Measurement.Type.isOrdered(b.measurement().type())&&(l.start=Math.min(l.start,d.rowItem.start()),l.end=Math.max(l.end,d.rowItem.end())),l.values[0]=(l.values[0]*l.valueItems[0].length+d.value)/(l.valueItems[0].length+1),l.valueItems[0].push(d));
0==c&&(C[A]=z.length-1);--e}});var E;this._min=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN];this._max=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX];c=epiviz.ui.charts.CustomSetting;this._min==c.DEFAULT&&(this._min=b.measurements()[0].minValue());this._max==c.DEFAULT&&(this._max=b.measurements()[0].maxValue());if(this._globalIndexColorLabels){c={};for(a=g;a<h;++a)c[this._globalIndexColorLabels[a]]=this._globalIndexColorLabels[a];
this._colorLabels=Object.keys(c);E={};this._colorLabels.forEach(function(a,b){var c=d.colors().getByKey(a);E[a]=epiviz.utils.colorizeBinary(d._min,d._max,"#ffffff",c)})}else this._colorLabels=[sprintf("Max",b.firstSeries().measurement().maxValue())],this._colorScale=epiviz.utils.colorizeBinary(this._min,this._max,"#ffffff",this.colors().getByKey("Max"));var D=(c=Math.min(r.length,f))?(v-this.margins().sumAxis(e.X))/c:0,G=(t-this.margins().sumAxis(e.Y))/b.measurements().length;b=this._chartContent.select(".items");
b.empty()&&(b=this._chartContent.append("g").attr("class","items"),e=b.append("g").attr("class","selected"),b.append("g").attr("class","hovered"),e.append("g").attr("class","hovered"));b.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")");e=b.selectAll("rect").data(z,function(a){return a.id});e.enter().append("rect").attr("id",function(a){return sprintf("%s-item-%s-%s",d.id(),a.seriesIndex,a.valueItems[0][0].globalIndex)}).attr("class",function(a){return a.cssClasses}).style("opacity",
0).style("fill-opacity",0).attr("x",function(a){return D*C[a.valueItems[0][0].globalIndex]}).attr("y",function(a){return G*a.seriesIndex}).attr("width",D).attr("height",G).style("fill",function(a,b){return d._globalIndexColorLabels?E[d._globalIndexColorLabels[a.valueItems[0][0].globalIndex]](a.values[0]):d._colorScale(a.values[0])});e.transition().duration(1E3).style("fill-opacity",null).style("opacity",null).attr("x",function(a){return D*C[a.valueItems[0][0].globalIndex]}).attr("y",function(a){return G*
a.seriesIndex}).attr("width",D).attr("height",G).style("fill",function(a){return d._globalIndexColorLabels?E[d._globalIndexColorLabels[a.valueItems[0][0].globalIndex]](a.values[0]):d._colorScale(a.values[0])});e.exit().transition().duration(1E3).style("opacity",0).remove();e.on("mouseover",function(a){d._hover.notify(new epiviz.ui.charts.VisEventArgs(d.id(),a))}).on("mouseout",function(){d._unhover.notify(new epiviz.ui.charts.VisEventArgs(d.id()))}).on("click",function(a){d._deselect.notify(new epiviz.ui.charts.VisEventArgs(d.id()));
d._select.notify(new epiviz.ui.charts.VisEventArgs(d.id(),a));d3.event.stopPropagation()});this._drawLabels(b,r,w,c,m,D,G,g,v);return z};
epiviz.plugins.charts.HeatmapPlot.prototype._drawCellsCanvas=function(a,b,c){var d=this,e=epiviz.ui.charts.Axis,f=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS],g=b.firstSeries().globalStartIndex(),h=b.firstSeries().size()+g,m=[],l=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type());b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>g&&(g=c);d<h&&(h=d);m.push(a)});for(var p=h-g,n=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],
t=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER],v=t==epiviz.plugins.charts.HeatmapPlotType.Cluster.ROWS||t==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH,t=(t==epiviz.plugins.charts.HeatmapPlotType.Cluster.COLS||t==epiviz.plugins.charts.HeatmapPlotType.Cluster.BOTH)&&f>=p,q=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM]*this._dendrogramRatio,u=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS]?
20:0,v=this.width()*(1-q*v)-u,t=this.height()*(1-q*t),w=[],r=[],A,q=0;q<p;++q){A=q+g;var x;b.foreach(function(a,b){return x=b.getRowByGlobalIndex(A)});x&&(!l||void 0==a.start()||void 0==a.end()||x.start()<a.end()&&x.end()>=a.start())&&(w.push(A),u=x.metadata(n)||""+x.id(),r.push(u))}if(c)for(a=w,l=r,w=Array(w.length),r=Array(r.length),q=0;q<w.length;++q)w[q]=a[c[q]],r[q]=l[c[q]];var z=[],C={};b.foreach(function(a,b,c){for(var d,e=0,g=f,h=0;h<r.length;++h)if(A=w[h],d=b.getByGlobalIndex(A)){var l;0==
e?(e=sprintf("item data-series-%s",c),l=new epiviz.ui.charts.ChartObject(sprintf("heatmap_%s_%s",c,A),d.rowItem.start(),d.rowItem.end(),[d.value],c,[[d]],[a],e,d.rowItem.seqName()),z.push(l),e=d=Math.ceil((r.length-h)/g),--g):(l=z[z.length-1],l.id+="_"+A,epiviz.measurements.Measurement.Type.isOrdered(b.measurement().type())&&(l.start=Math.min(l.start,d.rowItem.start()),l.end=Math.max(l.end,d.rowItem.end())),l.values[0]=(l.values[0]*l.valueItems[0].length+d.value)/(l.valueItems[0].length+1),l.valueItems[0].push(d));
0==c&&(C[A]=z.length-1);--e}});var E;this._min=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN];this._max=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX];c=epiviz.ui.charts.CustomSetting;this._min==c.DEFAULT&&(this._min=b.measurements()[0].minValue());this._max==c.DEFAULT&&(this._max=b.measurements()[0].maxValue());if(this._globalIndexColorLabels){c={};for(a=g;a<h;++a)c[this._globalIndexColorLabels[a]]=this._globalIndexColorLabels[a];
this._colorLabels=Object.keys(c);E={};this._colorLabels.forEach(function(a,b){var c=d.colors().getByKey(a);E[a]=epiviz.utils.colorizeBinary(d._min,d._max,"#ffffff",c)})}else this._colorLabels=[sprintf("Max",b.firstSeries().measurement().maxValue())],this._colorScale=epiviz.utils.colorizeBinary(this._min,this._max,"#ffffff",this.colors().getByKey("Max"));var D=(c=Math.min(r.length,f))?(v-this.margins().sumAxis(e.X))/c:0,G=(t-this.margins().sumAxis(e.Y))/b.measurements().length;b=this._chartContent.select(".items");
b.empty()&&(b=this._chartContent.append("g").attr("class","items"),e=b.append("g").attr("class","selected"),b.append("g").attr("class","hovered"),e.append("g").attr("class","hovered"));b.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")");b.selectAll("rect").data(z,function(a){return a.id});this._container.find("svg").remove();var e=this.canvas,t=this.hoverCanvas,B=e.getContext("2d");B.globalAlpha=.6;B.translate(this.margins().left(),this.margins().top());t.getContext("2d").translate(this.margins().left(),
this.margins().top());this.renderQueue=renderQueue(function(a){B.beginPath();var b=d._globalIndexColorLabels?E[d._globalIndexColorLabels[a.valueItems[0][0].globalIndex]](a.values[0]):d._colorScale(a.values[0]);B.fillStyle=b;B.strokeStyle="black";B.rect(D*C[a.valueItems[0][0].globalIndex],G*a.seriesIndex,D,G);B.fill();B.stroke()});this.renderQueue(z);this._canvasHoverOptions={colIndex:C,cellWidth:D,cellHeight:G};this.addCanvasEvents(e,t,z,null,D,C);this._drawLabelsCanvas(b,r,w,c,m,D,G,g,v);return z};
epiviz.plugins.charts.HeatmapPlot.prototype._drawDendrogram=function(a,b,c,d,e,f){var g=f?"dendrogram-horizontal":"dendrogram-vertical",h=this._svg.append("g").attr("class",g);f?h.attr("transform","translate("+c+","+b+")scale(-1, 1)rotate(90, 0, 0)"):h.attr("transform","translate("+c+","+b+")");this._drawSubDendrogram(this._svg.select("."+g),a.root(),0,0,e,d,!1)};
epiviz.plugins.charts.HeatmapPlot.prototype._drawDendrogramCanvas=function(a,b,c,d,e,f){var g=this.canvas,h=g.getContext("2d");f?(h.save(),h.translate(c,b),h.scale(-1,1),h.rotate(Math.PI/2)):(h.save(),h.translate(c,b));this._drawSubDendrogramCanvas(g,a.root(),0,0,e,d,!1);h.restore()};
epiviz.plugins.charts.HeatmapPlot.prototype._drawSubDendrogramCanvas=function(a,b,c,d,e,f,g){var h=b.children();if(0==h.length)return c+.5*f;for(var m=a.getContext("2d"),l=d3.scale.linear().domain([0,b.distance()]).range([0,e]),p=0,n,t,v=0;v<h.length;++v){var q=c+p,u=f/b.weight()*h[v].weight(),w=l(h[v].distance()),q=this._drawSubDendrogramCanvas(a,h[v],q,d,w,u,g);m.beginPath();m.moveTo(d+w,q);m.lineTo(d+e,q);m.strokeStyle="#555555";m.stroke();0==v&&g&&(m.font="9px",m.beginPath(),m.textAlign="center",
m.fillText(Globalize.format(b.distance(),"n2"),Math.max(d+10,d+.5*(w+e)),q-10));if(void 0==n||n>q)n=q;if(void 0==t||t<q)t=q;p+=f/b.weight()*h[v].weight()}m.beginPath();m.moveTo(d+e,n);m.lineTo(d+e,t);m.strokeStyle="#555555";m.stroke();return.5*(n+t)};
epiviz.plugins.charts.HeatmapPlot.prototype._drawSubDendrogram=function(a,b,c,d,e,f,g){var h=b.children();if(0==h.length)return c+.5*f;for(var m=d3.scale.linear().domain([0,b.distance()]).range([0,e]),l=0,p,n,t=0;t<h.length;++t){var v=c+l,q=f/b.weight()*h[t].weight(),u=m(h[t].distance()),v=this._drawSubDendrogram(a,h[t],v,d,u,q,g);a.append("line").attr("x1",d+u).attr("x2",d+e).attr("y1",v).attr("y2",v).style("stroke","#555555").style("stroke-width",1).style("shape-rendering","auto");0==t&&g&&a.append("text").attr("class",
"row-text").attr("x",Math.max(d+10,d+.5*(u+e))).attr("y",v-10).style("text-anchor","middle").text(Globalize.format(b.distance(),"n2"));if(void 0==p||p>v)p=v;if(void 0==n||n<v)n=v;l+=f/b.weight()*h[t].weight()}a.append("line").attr("x1",d+e).attr("x2",d+e).attr("y1",p).attr("y2",n).style("stroke","#555555").style("stroke-width",1).style("shape-rendering","auto");return.5*(p+n)};
epiviz.plugins.charts.HeatmapPlot.prototype._drawLabels=function(a,b,c,d,e,f,g,h,m){var l=this,p=function(a){a="name"==v?a.name():(a=a.annotation())&&v in a?a[v]:"<NA>";return u[a]=a},n=a.selectAll(".col-text"),t=0;b.length>d?n.transition().duration(500).style("opacity",0).remove():(n=n.data(b,function(a,b){return a+c[b]}),n.enter().append("text").attr("class","col-text").style("opacity","0").attr("x",0).attr("y",0).attr("transform",function(a,b){return"translate("+(b*f+.5*f)+",-5)rotate(-60)"}).text(function(a){return a}),
n.transition().duration(500).attr("x",0).attr("y",0).attr("transform",function(a,b){return"translate("+(b*f+.5*f)+",-5)rotate(-60)"}).style("opacity",null).attr("fill",function(a,b){var c=b+h;return l._globalIndexColorLabels?l.colors().getByKey(l._globalIndexColorLabels[c]):"#000000"}),n.exit().transition().duration(500).style("opacity",0).remove(),this._container.find(" .col-text").each(function(a){a=this.getBBox().width;t<a&&(t=a)}));var v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];
b=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS];b||(a.selectAll(".row-color-label").remove(),d=a.selectAll(".row-text").data(e,function(a){return a.id()}),d.enter().append("text").attr("class","row-text").attr("x",0).attr("y",0).attr("transform",function(a,b){return"translate(-5,"+(b*g+.5*g)+")rotate(30)"}),d.text(function(a){return"name"==v?a.name():(a=a.annotation())&&v in a?a[v]:"<NA>"}),d.transition().duration(500).attr("x",0).attr("y",
0).attr("transform",function(a,b){return"translate(-5,"+(b*g+.5*g)+")rotate(30)"}),d.exit().remove());var q;if(b){a.selectAll(".row-text").remove();var u={};e.forEach(function(a){a=p(a);u[a]=a});q=Object.keys(u);a=a.selectAll(".row-color-label").data(e,function(a){return a.id()});a.enter().append("rect").attr("class","row-color-label").attr("x",m-l.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y",.5*-g).attr("width",20).attr("height",g).attr("transform",function(a,b){return"translate(0,"+(b*g+
.5*g)+")"});a.style("fill",function(a){a=p(a);return l.colors().getByKey(a)});a.transition().duration(500).attr("x",m-l.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y",.5*-g).attr("height",g).attr("transform",function(a,b){return"translate(0,"+(b*g+.5*g)+")"});a.exit().remove()}this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();m=this._svg.selectAll(".chart-title").data(["Min"].concat(this._colorLabels));m.enter().append("text").attr("class","chart-title").attr("font-weight",
"bold").attr("y",l.margins().top()-5-t);m.attr("fill",function(a,b){return 0==b?"#000000":l.colors().getByKey(a)}).text(function(a){return a});var w=0,r=[];this._container.find(" .chart-title").each(function(a){r.push(w);w+=this.getBBox().width+15});m.attr("x",function(a,b){return l.margins().left()+10+r[b]});this._svg.selectAll(".chart-title-color").data(["Min"].concat(this._colorLabels)).enter().append("circle").attr("class","chart-title-color").attr("cx",function(a,b){return l.margins().left()+
4+r[b]}).attr("cy",l.margins().top()-9-t).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a,b){return 0==b?"#ffffff":l.colors().getByKey(a)}).style("stroke-width",function(a,b){return b?0:1}).style("stroke","#000000");this._svg.selectAll(".row-legend").remove();this._svg.selectAll(".row-legend-color").remove();b&&(m=this._svg.selectAll(".row-legend").data(q),m.enter().append("text").attr("class","row-legend").attr("font-weight","bold").attr("x",-20),m.attr("fill",
function(a){return l.colors().getByKey(a)}).text(function(a){return a}).attr("transform",function(a,b){return"translate("+l.margins().left()+","+l.margins().top()+")"}),m.attr("y",function(a,b){return 10+15*b}),this._svg.selectAll(".row-legend-color").data(q).enter().append("rect").attr("class","chart-title-color").attr("x",-18).attr("y",function(a,b){return 2+15*b}).attr("width",10).attr("height",10).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a){return l.colors().getByKey(a)}).style("stroke-width",
0).attr("transform",function(a,b){return"translate("+l.margins().left()+","+l.margins().top()+")"}),this._colorLabels=this._colorLabels.concat(q))};
epiviz.plugins.charts.HeatmapPlot.prototype._drawLabelsCanvas=function(a,b,c,d,e,f,g,h,m){var l=this,p=function(a){a="name"==t?a.name():(a=a.annotation())&&t in a?a[t]:"<NA>";return q[a]=a},n=l.canvas.getContext("2d");b.forEach(function(a,b){var d=a+c[b];n.save();n.translate(b*f+.5*f,-5);n.rotate(-Math.PI/4);var e="#000000";l._globalIndexColorLabels&&(e=b+h,e=l.colors().getByKey(l._globalIndexColorLabels[e]));n.strokeStyle=e;n.fillStyle=e;n.font="9px";n.beginPath();n.textAlign="start";n.fillText(d,
0,0);n.restore()});var t=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];(b=this.customSettingsValues()[epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS])||e.forEach(function(a,b){var c;a.id();c="name"==t?a.name():(c=a.annotation())&&t in c?c[t]:"<NA>";n.save();n.translate(-8,b*g+.5*g);n.rotate(Math.PI/3);n.strokeStyle="black";n.fillStyle="black";n.font="9px";n.beginPath();n.textAlign="right";n.fillText(c,0,0);n.restore()});var v;
if(b){a.selectAll(".row-text").remove();var q={};e.forEach(function(a){a=p(a);q[a]=a});v=Object.keys(q);e.forEach(function(a,b){n.beginPath();var c=p(a),c=l.colors().getByKey(c);n.strokeStyle=c;n.fillStyle=c;n.fillRect(m-l.margins().sumAxis(epiviz.ui.charts.Axis.X),b*g+.5*g-.5*g,20,g)})}var u=0;["Min"].concat(this._colorLabels).forEach(function(a,b){var c=0==b?"#000000":l.colors().getByKey(a);n.strokeStyle=c;n.fillStyle=c;n.beginPath();n.arc(u-2,-l.margins().top()-0,4,0,2*Math.PI);n.fill();n.stroke();
n.font="9px";n.beginPath();n.textAlign="start";n.fillText(a,u+8,-l.margins().top()-0+4);c=n.measureText(a).width;u=u+8+c+10});b&&(n.globalAlpha=1,v.forEach(function(a,b){var c=l.colors().getByKey(a);n.strokeStyle=c;n.fillStyle=c;n.beginPath();n.fillRect(-13,55-l.margins().top()+15*(2+b),10,10);n.font="9px";n.beginPath();n.textAlign="right";n.fillText(a,-18,60-l.margins().top()+15*(2+b));n.measureText(a)}),this._colorLabels=this._colorLabels.concat(v))};
epiviz.plugins.charts.HeatmapPlot.prototype.colorLabels=function(){return this._colorLabels};
epiviz.plugins.charts.HeatmapPlot.prototype.addCanvasEvents=function(a,b,c,d,e,f){var g=this,h=b.getContext("2d");g.hoverCanvasObjects=c;g.width();g.height();b.addEventListener("click",function(a){});b.addEventListener("mousemove",function(a){b.getBoundingClientRect();var d=a.offsetX-g.margins().left(),h=null;c&&c.forEach(function(a){var b=e*f[a.valueItems[0][0].globalIndex];d>=b&&d<=b+e&&(h=a)});h&&g._hover.notify(new epiviz.ui.charts.VisEventArgs(g.id(),h))});b.addEventListener("mouseout",function(a){g._canvasHoverObject=
null;h.clearRect(0,0,b.width,b.height);g._unhover.notify(new epiviz.ui.charts.VisEventArgs(g.id()))})};
epiviz.plugins.charts.HeatmapPlot.prototype.doHover=function(a){epiviz.ui.charts.Plot.prototype.doHover.call(this,a);if("canvas"==this.chartDrawType){var b=this.hoverCanvas.getContext("2d");b.clearRect(0,0,this.hoverCanvas.width,this.hoverCanvas.height);var c=this._canvasHoverOptions.cellWidth,d=this._canvasHoverOptions.colIndex,e=this._canvasHoverOptions.cellHeight;this._canvasHoverObject=a;this.hoverCanvasObjects.forEach(function(f){f.overlapsWith(a)&&(b.strokeStyle="yellow",b.strokeRect(c*d[f.valueItems[0][0].globalIndex],
e*f.seriesIndex,c,e))})}else{var f=this._container.find(".items"),g=f.find("> .hovered"),h=f.find("> .selected"),m=h.find("> .hovered"),l=function(){if(Array.isArray(a)){for(var b=!1,c=0;c<a.length;c++)a[c].overlapsWith(d3.select(this).data()[0])&&(b=!0);return b}return a.overlapsWith(d3.select(this).data()[0])},f=f.find("> .item").filter(l);g.append(f);f=h.find("> .item").filter(l);m.append(f)}};epiviz.plugins.charts.HeatmapPlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.HeatmapPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.HeatmapPlotType.constructor=epiviz.plugins.charts.HeatmapPlotType;epiviz.plugins.charts.HeatmapPlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.HeatmapPlot(a,b,c)};epiviz.plugins.charts.HeatmapPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.HeatmapPlot"};
epiviz.plugins.charts.HeatmapPlotType.prototype.chartName=function(){return"Heatmap"};epiviz.plugins.charts.HeatmapPlotType.prototype.chartHtmlAttributeName=function(){return"heatmap"};epiviz.plugins.charts.HeatmapPlotType.prototype.measurementsFilter=function(){return function(a){return epiviz.measurements.Measurement.Type.hasValues(a.type())}};epiviz.plugins.charts.HeatmapPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};
epiviz.plugins.charts.HeatmapPlotType.prototype.customSettingsDefs=function(){var a=epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.instance();return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Columns labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,
epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Row labels"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_COLORS_FOR_ROW_LABELS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Row labels as colors"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.MAX_COLUMNS,epiviz.ui.charts.CustomSetting.Type.NUMBER,40,"Max columns"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,
epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Value"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Value"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTER,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"rows","Cluster",Object.keys(epiviz.plugins.charts.HeatmapPlotType.Cluster).map(function(a){return epiviz.plugins.charts.HeatmapPlotType.Cluster[a]})),
new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_ALG,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,a.algorithms()[0],"Clustering Algorithm",a.algorithms()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_METRIC,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,a.metrics()[0],"Clustering Metric",a.metrics()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.CLUSTERING_LINKAGE,
epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,a.linkages()[0],"Clustering Linkage",a.linkages()),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.HeatmapPlotType.CustomSettings.SHOW_DENDROGRAM,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show Dendrogram")])};epiviz.plugins.charts.HeatmapPlotType.Cluster={NONE:"none",ROWS:"rows",COLS:"columns",BOTH:"both"};
epiviz.plugins.charts.HeatmapPlotType.CustomSettings={MAX_COLUMNS:"maxColumns",CLUSTER:"cluster",CLUSTERING_ALG:"clusteringAlg",CLUSTERING_METRIC:"clusteringMetric",CLUSTERING_LINKAGE:"clusteringLinkage",SHOW_DENDROGRAM:"showDendrogram",SHOW_COLORS_FOR_ROW_LABELS:"showColorsForRowLabels"};epiviz.plugins.charts.LinePlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.LinePlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);epiviz.plugins.charts.LinePlot.constructor=epiviz.plugins.charts.LinePlot;epiviz.plugins.charts.LinePlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("line-plot",!0)};
epiviz.plugins.charts.LinePlot.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];c=epiviz.ui.charts.CustomSetting;d=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN];var e=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL],g=this.getDataMinMax(b);d==c.DEFAULT&&
(d=g[0]);e==c.DEFAULT&&(e=g[1]);null===d&&null===e&&(d=-1,e=1);null===d&&(d=e-1);null===e&&(e=d+1);g=epiviz.ui.charts.Axis;c=d3.scale.linear().domain([0,b.measurements().length-1]).range([0,this.width()-this.margins().sumAxis(g.X)]);d=d3.scale.linear().domain([d,e]).range([this.height()-this.margins().sumAxis(g.Y),0]);this._clearAxes();this._drawAxes(c,d,b.measurements().length,5,void 0,void 0,void 0,void 0,void 0,void 0,b.measurements().map(function(a){return"name"==f?a.name():(a=a.annotation())&&
f in a?a[f]:"<NA>"}));e=this._svg.selectAll(".lines");e.empty()&&(e=this._svg.append("g").attr("class","lines items"),g=e.append("g").attr("class","selected"),e.append("g").attr("class","hovered"),g.append("g").attr("class","hovered"));e.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")");return this._drawLines(a,b,c,d)};
epiviz.plugins.charts.LinePlot.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];c=epiviz.ui.charts.CustomSetting;var e=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],f=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];e==c.DEFAULT&&(e=null,b.measurements().forEach(function(a){null!==
a&&(null===e||a.minValue()<e)&&(e=a.minValue())}));f==c.DEFAULT&&(f=null,b.measurements().forEach(function(a){null!==a&&(null===f||a.maxValue()>f)&&(f=a.maxValue())}));null===e&&null===f&&(e=-1,f=1);null===e&&(e=f-1);null===f&&(f=e+1);d=epiviz.ui.charts.Axis;c=d3.scale.linear().domain([0,b.measurements().length-1]).range([0,this.width()-this.margins().sumAxis(d.X)]);d=d3.scale.linear().domain([e,f]).range([this.height()-this.margins().sumAxis(d.Y),0]);this._container.find("svg").remove();this._container.find("#"+
this.id()+"-canvas").remove();var h=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=h;h.id=this.id()+"-canvas";this._container.append(h);h.width=this.width();h.height=this.height();h.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();var m=document.createElement("canvas");this.hoverCanvas=m;m.id=this.id()+"-hoverCanvas";this._container.append(m);m.width=this.width();m.height=this.height();m.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";
this._drawAxesCanvas(c,d,b.measurements().length,5,h,void 0,void 0,void 0,void 0,void 0,b.measurements().map(function(a){return"name"==g?a.name():(a=a.annotation())&&g in a?a[g]:"<NA>"}));h.getContext("2d").translate(this.margins().left(),this.margins().top());m.getContext("2d").translate(this.margins().left(),this.margins().top());return this._drawLinesCanvas(a,b,c,d,h,m)};
epiviz.plugins.charts.LinePlot.prototype._drawLines=function(a,b,c,d){var e=this.colors(),f=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_POINTS],g=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_LINES],h=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_ERROR_BARS],m=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.POINT_RADIUS],l=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.LINE_THICKNESS],
p=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.INTERPOLATION],n=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],t=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.ABS_LINE_VAL],v=this,q=this._svg.select(".lines"),u=b.firstSeries().globalStartIndex(),w=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>u&&(u=c);d<w&&(w=d)});for(var r=w-u,A=epiviz.measurements.Measurement.Type.isOrdered(b.measurements()[0].type()),
x,z,C=0;C<r;++C){var E=C+u,D=b.firstSeries().getRowByGlobalIndex(E);if(!A||void 0==a.start()||void 0==a.end()||D.start()<a.end()&&D.end()>=a.start())void 0==x&&(x=E),z=E+1}u=x;w=z;r=z-x;this.width();var G=d3.svg.line().x(function(a){return c(a.x)}).y(function(a){return d(a.y)}).interpolate(p),B=function(a){return v._globalIndexColorLabels?v._globalIndexColorLabels[a.globalIndex()]:a.metadata(n)},I=function(a){return b.measurements().map(function(c,d){var e=b.getByGlobalIndex(c,a);return{x:d,y:e?e.value:
null,errMinus:e&&e.valueAnnotation?e.valueAnnotation.errMinus:null,errPlus:e&&e.valueAnnotation?e.valueAnnotation.errPlus:null}}).filter(function(a){return null!==a.y})};a=epiviz.utils.range(r,u);var y;g?(y=a.map(function(a){var c=b.firstSeries().getRowByGlobalIndex(a);return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",a),c.start(),c.end(),I(a),a,b.measurements().map(function(c,d){return[b.getByGlobalIndex(c,a)]}),b.measurements(),"",c.seqName())}),g=q.selectAll(".line-series").data(y,
function(a){return a.id}),g.enter().insert("g",":first-child").attr("class","line-series item").style("opacity","0").on("mouseover",function(a){v._hover.notify(new epiviz.ui.charts.VisEventArgs(v.id(),a))}).on("mouseout",function(){v._unhover.notify(new epiviz.ui.charts.VisEventArgs(v.id()))}).each(function(a){d3.select(this).append("path").attr("class","bg-line").attr("d",G(a.values)).style("shape-rendering","auto").style("stroke-width",10).style("stroke","#dddddd").style("stroke-opacity","0.1");
d3.select(this).append("path").attr("class","main-line").attr("d",G(a.values)).style("shape-rendering","auto")}),g.transition().duration(500).style("opacity","0.7").each(function(a){var c=e.getByKey(B(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)));d3.select(this).selectAll(".bg-line").attr("d",G(a.values));d3.select(this).selectAll(".main-line").attr("d",G(a.values)).style("stroke",c).style("stroke-width",l)}),g.exit().transition().duration(500).style("opacity","0").remove()):q.selectAll(".line-series").remove();
f?(f=q.selectAll(".points").data(y,function(a){return a.id}),f.enter().append("g").attr("class","points").style("opacity","0"),f.each(function(a){d3.select(this).selectAll(".data-point").remove();var f=d3.select(this).selectAll(".data-point").data(a.values);f.enter().append("g").attr("class","data-point").each(function(f){d3.select(this).append("circle").attr("cx",function(a){return c(a.x)}).attr("cy",function(a){return d(a.y)}).attr("r",m).style("stroke-width",2).attr("fill","none").attr("stroke",
e.getByKey(B(b.firstSeries().getRowByGlobalIndex(a.seriesIndex))));d3.select(this).selectAll(".error-bar").remove();h&&void 0!=f.errMinus&&void 0!=f.errPlus&&(d3.select(this).append("line").attr("x1",c(f.x)).attr("x2",c(f.x)).attr("y1",d(f.errMinus)).attr("y2",d(f.errPlus)).style("stroke",e.getByKey(B(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"),d3.select(this).append("line").attr("x1",c(f.x)-4).attr("x2",c(f.x)+4).attr("y1",d(f.errMinus)).attr("y2",
d(f.errMinus)).style("stroke",e.getByKey(B(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"),d3.select(this).append("line").attr("x1",c(f.x)-4).attr("x2",c(f.x)+4).attr("y1",d(f.errPlus)).attr("y2",d(f.errPlus)).style("stroke",e.getByKey(B(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)))).style("stroke-width",2).attr("class","error-bar"))});f.exit().remove()}).transition().duration(500).style("opacity","1"),f.exit().transition().duration(500).style("opacity",
"0").remove()):q.selectAll(".points").remove();var H={};a.forEach(function(a){a=B(b.firstSeries().getRowByGlobalIndex(a));H[a]=a});this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color").remove();f=this._svg.selectAll(".chart-title").data(Object.keys(H));f.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",v.margins().top()-5);f.attr("fill",function(a){return e.getByKey(a)}).text(function(a){return a});var F=0,M=[];this._container.find(" .chart-title").each(function(a){M.push(F);
F+=this.getBBox().width+15});f.attr("x",function(a,b){return v.margins().left()+10+M[b]});this._svg.selectAll(".chart-title-color").data(Object.keys(H)).enter().append("circle").attr("class","chart-title-color").attr("cx",function(a,b){return v.margins().left()+4+M[b]}).attr("cy",v.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a){return e.getByKey(a)});t!=epiviz.ui.charts.CustomSetting.DEFAULT&&(q.selectAll(".abLine").remove(),q.append("svg:line").attr("class",
"abLine").attr("x1",0).attr("x2",v.width()-v.margins().sumAxis(epiviz.ui.charts.Axis.X)).attr("y1",d(t)).attr("y2",d(t)).style("stroke","black").style("stroke-dasharray","5, 5"));return y};
epiviz.plugins.charts.LinePlot.prototype._drawLinesCanvas=function(a,b,c,d,e,f){var g=this.colors(),h=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_POINTS],m=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_LINES],l=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_ERROR_BARS],p=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.POINT_RADIUS],n=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.LINE_THICKNESS],
t=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.INTERPOLATION],v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],q=this.customSettingsValues()[epiviz.plugins.charts.LinePlotType.CustomSettings.ABS_LINE_VAL],u=this;this._svg.select(".lines");var w=b.firstSeries().globalStartIndex(),r=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>w&&(w=c);d<r&&(r=d)});for(var A=r-w,x=epiviz.measurements.Measurement.Type.isOrdered(b.measurements()[0].type()),
z,C,E=0;E<A;++E){var D=E+w,G=b.firstSeries().getRowByGlobalIndex(D);if(!x||void 0==a.start()||void 0==a.end()||G.start()<a.end()&&G.end()>=a.start())void 0==z&&(z=D),C=D+1}w=z;r=C;A=C-z;this.width();var B=d3.svg.line().x(function(a){return c(a.x)}).y(function(a){return d(a.y)}).interpolate(t),I=function(a){return u._globalIndexColorLabels?u._globalIndexColorLabels[a.globalIndex()]:a.metadata(v)},y=function(a){return b.measurements().map(function(c,d){var e=b.getByGlobalIndex(c,a);return{x:d,y:e?e.value:
null,errMinus:e&&e.valueAnnotation?e.valueAnnotation.errMinus:null,errPlus:e&&e.valueAnnotation?e.valueAnnotation.errPlus:null}}).filter(function(a){return null!==a.y})};a=epiviz.utils.range(A,w);var H,F=e.getContext("2d");m&&(H=a.map(function(a){var c=b.firstSeries().getRowByGlobalIndex(a);return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",a),c.start(),c.end(),y(a),a,b.measurements().map(function(c,d){return[b.getByGlobalIndex(c,a)]}),b.measurements(),"",c.seqName())}),H.forEach(function(a){F.globalAlpha=
.8;F.beginPath();var c=new Path2D(B(a.values));F.strokeStyle=g.getByKey(I(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)));F.lineWidth=n;F.stroke(c);F.beginPath()}));h&&H.forEach(function(a){a.values.forEach(function(e){var f=c(e.x),h=d(e.y);F.beginPath();F.arc(f,h,p,0,2*Math.PI);h=g.getByKey(I(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)));F.strokeStyle=h;F.lineWidth=2;F.stroke();F.fillStyle=h;F.fill();if(l){var m=d(e.errMinus);e=d(e.errPlus);null!=m&&null!=e&&(F.beginPath(),F.moveTo(f,
m),F.lineTo(f,e),F.strokeStyle=h,F.stroke(),F.beginPath(),F.globalAlpha=.7,F.moveTo(f-4,m),F.lineTo(f+4,m),F.strokeStyle=h,F.stroke(),F.beginPath(),F.globalAlpha=.7,F.moveTo(f-4,e),F.lineTo(f+4,e),F.strokeStyle=h,F.stroke(),F.beginPath())}})});var M={};a.forEach(function(a){a=I(b.firstSeries().getRowByGlobalIndex(a));M[a]=a});var K=0;Object.keys(M).forEach(function(a,b){var c=g.getByKey(a);F.strokeStyle=c;F.fillStyle=c;F.beginPath();F.arc(u.margins().left()+K-2,-9,4,0,2*Math.PI);F.stroke();F.fill();
F.font="9px";F.beginPath();F.textAlign="start";F.fillText(a,u.margins().left()+K+8,-12);c=F.measureText(a).width;K=K+8+c+10});q!=epiviz.ui.charts.CustomSetting.DEFAULT&&(F.beginPath(),F.globalAlpha=.7,F.moveTo(0,d(q)),F.lineTo(u.width()-u.margins().sumAxis(epiviz.ui.charts.Axis.X),d(q)),F.strokeStyle=black,F.stroke());this.addCanvasEvents(e,f,H,c,d,B);return H};
epiviz.plugins.charts.LinePlot.prototype.colorLabels=function(){for(var a=[],b=0;b<this.colors().size()&&20>b;++b)a.push("Color "+(b+1));return a};
epiviz.plugins.charts.LinePlot.prototype.addCanvasEvents=function(a,b,c,d,e,f){var g=this,h=b.getContext("2d");g.hoverCanvasObjects=c;g.width();g.height();b.addEventListener("click",function(a){});b.addEventListener("mousemove",function(a){b.getBoundingClientRect();var d=a.offsetX,e=a.offsetY,m=null;h.clearRect(0,0,b.width,b.height);c&&c.forEach(function(a){var b=new Path2D(f(a.values));h.isPointInPath(b,d,e)&&(m=a)});m&&g._hover.notify(new epiviz.ui.charts.VisEventArgs(g.id(),m))});b.addEventListener("mouseout",
function(a){g._canvasHoverObject=null;h.clearRect(0,0,b.width,b.height);g._unhover.notify(new epiviz.ui.charts.VisEventArgs(g.id()))})};epiviz.plugins.charts.LinePlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.LinePlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.LinePlotType.constructor=epiviz.plugins.charts.LinePlotType;epiviz.plugins.charts.LinePlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.LinePlot(a,b,c)};epiviz.plugins.charts.LinePlotType.prototype.typeName=function(){return"epiviz.plugins.charts.LinePlot"};
epiviz.plugins.charts.LinePlotType.prototype.chartName=function(){return"Line Plot"};epiviz.plugins.charts.LinePlotType.prototype.chartHtmlAttributeName=function(){return"line-plot"};epiviz.plugins.charts.LinePlotType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.FEATURE}};epiviz.plugins.charts.LinePlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};
epiviz.plugins.charts.LinePlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Columns labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Row labels"),
new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_POINTS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Show points"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_LINES,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show lines"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.SHOW_ERROR_BARS,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Show error bars"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.POINT_RADIUS,
epiviz.ui.charts.CustomSetting.Type.NUMBER,4,"Point radius"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.LINE_THICKNESS,epiviz.ui.charts.CustomSetting.Type.NUMBER,3,"Line thickness"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,
epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"basis","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.LinePlotType.CustomSettings.ABS_LINE_VAL,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,
"Draw abline")])};epiviz.plugins.charts.LinePlotType.CustomSettings={SHOW_POINTS:"showPoints",SHOW_ERROR_BARS:"showErrorBars",SHOW_LINES:"showLines",POINT_RADIUS:"pointRadius",LINE_THICKNESS:"lineThickness",INTERPOLATION:"interpolation",ABS_LINE_VAL:"abLine"};epiviz.plugins.charts.StackedLinePlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._initialize()};epiviz.plugins.charts.StackedLinePlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);epiviz.plugins.charts.StackedLinePlot.constructor=epiviz.plugins.charts.StackedLinePlot;epiviz.plugins.charts.StackedLinePlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("stacked-line-plot",!0)};
epiviz.plugins.charts.StackedLinePlot.prototype.drawCanvas=function(a,b,c,d){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];b=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.ROW_GROUP_BY];var e=this,f=function(){for(var a=0;a<e._markers.length;a++)if(e._markers[a]._type==epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS){var b=e._markers[a].id();delete e._markersMap[b];delete e._markersIndices[b];
delete e._markers[a];e._markers.length--}};a=function(a){if(!a)return null;var b;if(a.id()in e._markersMap){b=e._markersIndices[a.id()];var c=e._markers[b];if(c==a||c.type()==a.type()&&c.preMarkStr()==a.preMarkStr()&&c.markStr()==a.markStr())return null;e._markers[b]=a}else f(),b=e._markers.length,e._markers.push(a),e._markersIndices[a.id()]=b;e._markersMap[a.id()]=a};this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.USE_GROUP_BY]?(b=new epiviz.ui.charts.markers.VisualizationMarker(epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS,
null,null,"function(data){return null}","function(m, data, preMarkResult) {return m.annotation()['"+b+"'];}"),a(b)):f();(function(){e.transformData(e._lastRange,e._unalteredData).done(function(){e._drawPlotCanvas(e._lastRange,e._lastData,c,d)});e._markersModified.notify(new epiviz.ui.charts.VisEventArgs(e._id,e._markers))})()};
epiviz.plugins.charts.StackedLinePlot.prototype.draw=function(a,b,c,d){epiviz.ui.charts.Plot.prototype.draw.call(this,a,b,c,d);b=this._lastData;a=this._lastRange;if(!b||!a)return[];b=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.ROW_GROUP_BY];var e=this,f=function(){for(var a=0;a<e._markers.length;a++)if(e._markers[a]._type==epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS){var b=e._markers[a].id();delete e._markersMap[b];delete e._markersIndices[b];
delete e._markers[a];e._markers.length--}};a=function(a){if(!a)return null;var b;if(a.id()in e._markersMap){b=e._markersIndices[a.id()];var c=e._markers[b];if(c==a||c.type()==a.type()&&c.preMarkStr()==a.preMarkStr()&&c.markStr()==a.markStr())return null;e._markers[b]=a}else f(),b=e._markers.length,e._markers.push(a),e._markersIndices[a.id()]=b;e._markersMap[a.id()]=a};this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.USE_GROUP_BY]?(b=new epiviz.ui.charts.markers.VisualizationMarker(epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS,
null,null,"function(data){return null}","function(m, data, preMarkResult) {return m.annotation()['"+b+"'];}"),a(b)):f();(function(){e.transformData(e._lastRange,e._unalteredData).done(function(){e._drawPlot(e._lastRange,e._lastData,c,d)});e._markersModified.notify(new epiviz.ui.charts.VisEventArgs(e._id,e._markers))})()};
epiviz.plugins.charts.StackedLinePlot.prototype._drawPlot=function(a,b,c,d){var e=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];c=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION];d=0==c.indexOf("step")?b.measurements().length:b.measurements().length-1;var f=epiviz.ui.charts.Axis;d=d3.scale.linear().domain([0,d]).range([0,this.width()-this.margins().sumAxis(f.X)]);this._clearAxes();this._drawAxes(d,void 0,b.measurements().length,
5,void 0,void 0,void 0,void 0,void 0,void 0,b.measurements().map(function(a){return"name"==e?a.name():(a=a.annotation())&&e in a?a[e]:"<NA>"}),void 0,0==c.indexOf("step"));c=this._svg.selectAll(".lines");c.empty()&&(c=this._svg.append("g").attr("class","lines items"),f=c.append("g").attr("class","selected"),c.append("g").attr("class","hovered"),f.append("g").attr("class","hovered"));c.attr("transform","translate("+this.margins().left()+", "+this.margins().top()+")");return this._drawLines(a,b,d)};
epiviz.plugins.charts.StackedLinePlot.prototype._drawPlotCanvas=function(a,b,c,d){var e=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];c=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION];d=0==c.indexOf("step")?b.measurements().length:b.measurements().length-1;var f=epiviz.ui.charts.Axis;d=d3.scale.linear().domain([0,d]).range([0,this.width()-this.margins().sumAxis(f.X)]);this._container.find("svg").remove();this._container.find("#"+
this.id()+"-canvas").remove();f=document.createElement("canvas");this.chartDrawType="canvas";this.canvas=f;f.id=this.id()+"-canvas";this._container.append(f);f.width=this.width();f.height=this.height();f.style="position:absolute;top:0;left:0;width:100%;height:100%";this._container.find("#"+this.id()+"-hoverCanvas").remove();var g=document.createElement("canvas");this.hoverCanvas=g;g.id=this.id()+"-hoverCanvas";this._container.append(g);g.width=this.width();g.height=this.height();g.style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:1";
f.getContext("2d").translate(this.margins().left(),this.margins().top());g.getContext("2d").translate(this.margins().left(),this.margins().top());this._drawAxesCanvas(d,void 0,b.measurements().length,5,f,void 0,void 0,void 0,void 0,void 0,b.measurements().map(function(a){return"name"==e?a.name():(a=a.annotation())&&e in a?a[e]:"<NA>"}),void 0,0==c.indexOf("step"));return this._drawLinesCanvas(a,b,d,f)};
epiviz.plugins.charts.StackedLinePlot.prototype._drawLines=function(a,b,c){var d=epiviz.ui.charts.Axis,e=this.colors(),f=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION],g=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],h=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.OFFSET],m=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.SCALE_TO_PERCENT],
l=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.HOVER_OPACITY],p=this,n=this._svg.select(".lines"),t=b.firstSeries().globalStartIndex(),v=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>t&&(t=c);d<v&&(v=d)});for(var q=v-t,u=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type()),w,r,A=0;A<q;++A){var x=A+t,z=b.firstSeries().getRowByGlobalIndex(x);z&&(!u||void 0==a.start()||void 0==
a.end()||z.start()<a.end()&&z.end()>=a.start())&&(void 0==w&&(w=x),r=x+1)}var t=w,v=r,C=epiviz.utils.range(r-w,t);if(0==C.length)return[];var E=null;m&&(E=new epiviz.measurements.MeasurementHashtable,b.measurements().forEach(function(a){var c=C.filter(function(c){return b.getByGlobalIndex(a,c)}).map(function(c){return b.getByGlobalIndex(a,c).value}).reduce(function(a,b){return a+b});E.put(a,c)}));var D=function(a){return p._globalIndexColorLabels?p._globalIndexColorLabels[a.globalIndex()]:a.metadata(g)},
G=function(a){var c=[];"step-before"==f&&c.push({x:0,y:0});var d=b.measurements(),c=c.concat(d.map(function(d,e){var f=m?E.get(d):1,f=f||1,g=b.getByGlobalIndex(d,a);return{x:c.length+e,y:g?g.value/f:null}}));"step-after"==f&&c.push({x:c.length,y:0});return c.filter(function(a){return null!==a.y})};a=C.filter(function(a){return b.firstSeries().getRowByGlobalIndex(a)}).map(function(a){var c=b.firstSeries().getRowByGlobalIndex(a),d=b.measurements();return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",
a),c.start(),c.end(),G(a),a,d.map(function(c,d){return[b.getByGlobalIndex(c,a)]}),d,"",c.seqName())});var q=C.map(function(a){return G(a)}),B=d3.layout.stack().offset(h)(q),I=d3.scale.linear().domain([Math.min(0,d3.min(B,function(a){return d3.min(a,function(a){return a.y0+a.y})})),d3.max(B,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height()-this.margins().sumAxis(d.Y),0]),y=d3.svg.area().x(function(a){return c(a.x)}).y0(function(a){return I(a.y0)}).y1(function(a){return I(a.y0+
a.y)}).interpolate(f),d=n.selectAll(".line-series").data(a,function(a){return a.seriesIndex});d.enter().insert("path",":first-child").attr("class","line-series item").attr("d",function(a,b){return y(B[b])}).style("opacity","0").style("shape-rendering","auto").style("fill",function(a,c){return e.getByKey(D(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)))}).on("mouseover",function(a,b){p._hover.notify(new epiviz.ui.charts.VisEventArgs(p.id(),a));n.selectAll(".item").style("opacity",1-l);n.selectAll(".hovered .item").style("opacity",
l)}).on("mouseout",function(){p._unhover.notify(new epiviz.ui.charts.VisEventArgs(p.id()))});d.transition().duration(500).style("opacity","0.7").attr("d",function(a,b){return y(B[b])}).style("fill",function(a,c){return e.getByKey(D(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)))});d.exit().transition().duration(500).style("opacity","0").remove();var H={};C.forEach(function(a){b.firstSeries().getByGlobalIndex(a)&&(a=D(b.firstSeries().getRowByGlobalIndex(a)),H[a]=a)});this._svg.selectAll(".chart-title").remove();
this._svg.selectAll(".chart-title-color ").remove();d=this._svg.selectAll(".chart-title").data(Object.keys(H));d.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",p.margins().top()-5);d.attr("fill",function(a){return e.getByKey(a)}).text(function(a){return a});var F=0,M=[];this._container.find(" .chart-title").each(function(a){M.push(F);F+=this.getBBox().width+15});d.attr("x",function(a,b){return p.margins().left()+10+M[b]});this._svg.selectAll(".chart-title-color").data(Object.keys(H)).enter().append("circle").attr("class",
"chart-title-color").attr("cx",function(a,b){return p.margins().left()+4+M[b]}).attr("cy",p.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a){return e.getByKey(a)});return a};
epiviz.plugins.charts.StackedLinePlot.prototype._drawLinesCanvas=function(a,b,c,d){var e=epiviz.ui.charts.Axis,f=this.colors(),g=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION],h=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL],m=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.OFFSET],l=this.customSettingsValues()[epiviz.plugins.charts.StackedLinePlotType.CustomSettings.SCALE_TO_PERCENT];
this.customSettingsValues();var p=this;this._svg.select(".lines");var n=b.firstSeries().globalStartIndex(),t=b.firstSeries().globalEndIndex();b.foreach(function(a,b){var c=b.globalStartIndex(),d=b.globalEndIndex();c>n&&(n=c);d<t&&(t=d)});for(var v=t-n,q=epiviz.measurements.Measurement.Type.isOrdered(this.measurements().first().type()),u,w,r=0;r<v;++r){var A=r+n,x=b.firstSeries().getRowByGlobalIndex(A);x&&(!q||void 0==a.start()||void 0==a.end()||x.start()<a.end()&&x.end()>=a.start())&&(void 0==u&&
(u=A),w=A+1)}var n=u,t=w,z=epiviz.utils.range(w-u,n);if(0==z.length)return[];var C=null;l&&(C=new epiviz.measurements.MeasurementHashtable,b.measurements().forEach(function(a){var c=z.filter(function(c){return b.getByGlobalIndex(a,c)}).map(function(c){return b.getByGlobalIndex(a,c).value}).reduce(function(a,b){return a+b});C.put(a,c)}));var E=function(a){return p._globalIndexColorLabels?p._globalIndexColorLabels[a.globalIndex()]:a.metadata(h)},D=function(a){var c=[];"step-before"==g&&c.push({x:0,
y:0});var d=b.measurements(),c=c.concat(d.map(function(d,e){var f=l?C.get(d):1,f=f||1,g=b.getByGlobalIndex(d,a);return{x:c.length+e,y:g?g.value/f:null}}));"step-after"==g&&c.push({x:c.length,y:0});return c.filter(function(a){return null!==a.y})};a=z.filter(function(a){return b.firstSeries().getRowByGlobalIndex(a)}).map(function(a){var c=b.firstSeries().getRowByGlobalIndex(a),d=b.measurements();return new epiviz.ui.charts.ChartObject(sprintf("line-series-%s",a),c.start(),c.end(),D(a),a,d.map(function(c,
d){return[b.getByGlobalIndex(c,a)]}),d,"",c.seqName())});var v=z.map(function(a){return D(a)}),G=d3.layout.stack().offset(m)(v),B=d3.scale.linear().domain([Math.min(0,d3.min(G,function(a){return d3.min(a,function(a){return a.y0+a.y})})),d3.max(G,function(a){return d3.max(a,function(a){return a.y0+a.y})})]).range([this.height()-this.margins().sumAxis(e.Y),0]),I=d3.svg.area().x(function(a){return c(a.x)}).y0(function(a){return B(a.y0)}).y1(function(a){return B(a.y0+a.y)}).interpolate(g),y=d.getContext("2d");
a.forEach(function(a,c){y.globalAlpha=.8;y.beginPath();var d=new Path2D(I(G[c]));y.fillStyle=y.strokeStyle=f.getByKey(E(b.firstSeries().getRowByGlobalIndex(a.seriesIndex)));y.lineWidth=2;y.stroke(d);y.fill(d);y.beginPath()});var H={};z.forEach(function(a){a=E(b.firstSeries().getRowByGlobalIndex(a));H[a]=a});var F=0;Object.keys(H).forEach(function(a,b){var c=f.getByKey(a);y.strokeStyle=c;y.fillStyle=c;y.beginPath();y.arc(p.margins().left()+F-2,-9,4,0,2*Math.PI);y.stroke();y.fill();y.font="9px";y.beginPath();
y.textAlign="start";y.fillText(a,p.margins().left()+F+8,-12);c=y.measureText(a).width;F=F+8+c+10});return a};epiviz.plugins.charts.StackedLinePlot.prototype.colorLabels=function(){for(var a=[],b=0;b<this.colors().size()&&20>b;++b)a.push("Color "+(b+1));return a};epiviz.plugins.charts.StackedLinePlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.StackedLinePlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.StackedLinePlotType.constructor=epiviz.plugins.charts.StackedLinePlotType;epiviz.plugins.charts.StackedLinePlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.StackedLinePlot(a,b,c)};epiviz.plugins.charts.StackedLinePlotType.prototype.typeName=function(){return"epiviz.plugins.charts.StackedLinePlot"};
epiviz.plugins.charts.StackedLinePlotType.prototype.chartName=function(){return"Stacked Plot"};epiviz.plugins.charts.StackedLinePlotType.prototype.chartHtmlAttributeName=function(){return"stacked-line-plot"};epiviz.plugins.charts.StackedLinePlotType.prototype.measurementsFilter=function(){return function(a){return a.type()==epiviz.measurements.Measurement.Type.FEATURE}};epiviz.plugins.charts.StackedLinePlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};
epiviz.plugins.charts.StackedLinePlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.COL_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_METADATA,"colLabel","Color by"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Labels"),
new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.OFFSET,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"zero","Offset",["zero","wiggle"]),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.INTERPOLATION,epiviz.ui.charts.CustomSetting.Type.CATEGORICAL,"step-after","Interpolation","linear step-before step-after basis basis-open basis-closed bundle cardinal cardinal-open monotone".split(" ")),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.SCALE_TO_PERCENT,
epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!0,"Scale to Percent"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.USE_GROUP_BY,epiviz.ui.charts.CustomSetting.Type.BOOLEAN,!1,"Use Group by"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.ROW_GROUP_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Group By"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.StackedLinePlotType.CustomSettings.HOVER_OPACITY,
epiviz.ui.charts.CustomSetting.Type.NUMBER,.6,"Hover Opacity")])};epiviz.plugins.charts.StackedLinePlotType.CustomSettings={INTERPOLATION:"interpolation",OFFSET:"offset",SCALE_TO_PERCENT:"scaleToPercent",ROW_GROUP_BY:"groupBy",USE_GROUP_BY:"useGroupBy",HOVER_OPACITY:"hoverOpacity"};epiviz.ui.charts.DataStructureVisualizationType=function(a){epiviz.ui.charts.VisualizationType.call(this,a)};epiviz.ui.charts.DataStructureVisualizationType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisualizationType.prototype);epiviz.ui.charts.DataStructureVisualizationType.constructor=epiviz.ui.charts.DataStructureVisualizationType;epiviz.ui.charts.DataStructureVisualizationType.prototype.chartDisplayType=function(){return epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE};
epiviz.ui.charts.DataStructureVisualizationType.prototype.cssClass=function(){return"data-structure-container ui-widget-content"};epiviz.ui.charts.DataStructureVisualizationType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};epiviz.ui.charts.DataStructureVisualizationType.prototype.hasMeasurements=function(){return!1};epiviz.ui.charts.DataStructureVisualizationType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.VisualizationType.prototype.customSettingsDefs.call(this)};epiviz.ui.charts.tree={};epiviz.ui.charts.tree.HierarchyVisualizationType=function(a){epiviz.ui.charts.DataStructureVisualizationType.call(this,a)};epiviz.ui.charts.tree.HierarchyVisualizationType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.DataStructureVisualizationType.prototype);epiviz.ui.charts.tree.HierarchyVisualizationType.constructor=epiviz.ui.charts.tree.HierarchyVisualizationType;epiviz.ui.charts.tree.IcicleType=function(a){epiviz.ui.charts.tree.HierarchyVisualizationType.call(this,a)};epiviz.ui.charts.tree.IcicleType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.tree.HierarchyVisualizationType.prototype);epiviz.ui.charts.tree.IcicleType.constructor=epiviz.ui.charts.tree.IcicleType;epiviz.ui.charts.tree.IcicleType.prototype.createNew=function(a,b,c){return new epiviz.ui.charts.tree.Icicle(a,b,c)};epiviz.ui.charts.tree.IcicleType.prototype.typeName=function(){return"epiviz.ui.charts.tree.Icicle"};
epiviz.ui.charts.tree.IcicleType.prototype.chartName=function(){return"Icicle"};epiviz.ui.charts.tree.IcicleType.prototype.chartHtmlAttributeName=function(){return"icicle"};
epiviz.ui.charts.tree.IcicleType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.tree.HierarchyVisualizationType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.HOVER_OPACITY,epiviz.ui.charts.CustomSetting.Type.NUMBER,.9,"Hover Opacity"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.AGG_LEVEL,epiviz.ui.charts.CustomSetting.Type.STRING,"","Agg Level"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.tree.IcicleType.CustomSettings.NODE_SEL,
epiviz.ui.charts.CustomSetting.Type.STRING,"{}","Node Selection")])};epiviz.ui.charts.tree.IcicleType.CustomSettings={HOVER_OPACITY:"hoverOpacity",AGG_LEVEL:"aggLevel",NODE_SEL:"nodeSel"};epiviz.ui.charts.ChartIndexObject=function(a,b,c,d,e,f,g,h){epiviz.ui.charts.VisObject.call(this);this.id=a;this.keys=b;this.keyValues=c;this.values=d;this.seriesIndex=g;this.valueItems=e;this.measurements=f;this.cssClasses=h};epiviz.ui.charts.ChartIndexObject.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.VisObject.prototype);epiviz.ui.charts.ChartIndexObject.constructor=epiviz.ui.charts.ChartIndexObject;
epiviz.ui.charts.ChartIndexObject.prototype.getMetadata=function(a,b,c){return this.valueItems?this.valueItems[a][b][c]:null};epiviz.ui.charts.ChartIndexObject.prototype.metadataColumns=function(){return this.keys};epiviz.ui.charts.ChartIndexObject.prototype.dimensions=function(){return[1,1]};epiviz.plugins.charts.DiversityScatterPlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._dispatch=d3.dispatch("hover","click");this._legend=this._chartContent=null;this._measurementsX=[];this._measurementsY=[];var d=this;this.measurements().foreach(function(a,b){0==b%2?d._measurementsX.push(a):d._measurementsY.push(a)});this._yLabel=this._xLabel="";for(a=0;a<Math.min(this._measurementsX.length,this._measurementsY.length);++a)0<a&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=
this._measurementsX[a].name(),this._yLabel+=this._measurementsY[a].name();this._colorLabels=[];this._initialize()};epiviz.plugins.charts.DiversityScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);epiviz.plugins.charts.DiversityScatterPlot.constructor=epiviz.plugins.charts.DiversityScatterPlot;
epiviz.plugins.charts.DiversityScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("scatter-plot",!0);this._chartContent=this._svg.append("g").attr("class","chart-content");this._legend=this._svg.append("g").attr("class","chart-legend")};
epiviz.plugins.charts.DiversityScatterPlot.prototype.draw=function(){epiviz.ui.charts.Plot.prototype.draw.call(this,void 0,void 0);this.drawScatter(this._lastRange,this._lastData.data,"sample_id",this._xLabel,"alphaDiversity")};
epiviz.plugins.charts.DiversityScatterPlot.prototype.drawScatter=function(a,b,c,d,e){this.xTag=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL];a=this._measurementsX[0].annotation();this._measurementsX=[];a=new epiviz.measurements.Measurement(this.xTag,this.xTag,"feature","ihmp","ihmp","ihmp",null,null,a,-1,1,[]);this._measurementsX.push(a);return this._drawCircles(b,this.xTag,e,c)};
epiviz.plugins.charts.DiversityScatterPlot.prototype._drawCircles=function(a,b,c,d){function e(a){a.sort(d3.ascending);var b=d3.quantile(a,.25);a=d3.quantile(a,.75);return[b,a]}var f=this,g=epiviz.ui.charts.Axis,h=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),m=Math.max(Math.floor(h),1),l=this.margins(),p=this.width(),n=this.height(),t=epiviz.ui.charts.CustomSetting,v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],
q=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],u=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],w=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX];v==t.DEFAULT&&(v=this._measurementsY[0].minValue());q==t.DEFAULT&&(q=this._measurementsY[0].maxValue());var r=[];a.forEach(function(a){r.push(a[b])});var A=[];r.forEach(function(a){-1==A.indexOf(a)&&A.push(a)});console.log(A);this.xTickValues=A;a.forEach(function(a){var c=
A.indexOf(a[b]);a._xVal=c+1});var x=0,z=[];A.forEach(function(a){z[x]=[];z[x][0]=x;z[x][1]=[];x++});a.forEach(function(a){var d=A.indexOf(a[b]);z[d][1].push(a[c])});u==t.DEFAULT&&(u=0);w==t.DEFAULT&&(w=A.length+1);var t=d3.scale.linear().domain([u,w]).range([0,p-l.sumAxis(g.X)]),C=d3.scale.linear().domain([v,q]).range([n-l.sumAxis(g.Y),0]);this._clearAxes(this._chartContent);xLabelsPadded=[""];A.forEach(function(a){xLabelsPadded.push(a)});console.log(xLabelsPadded);this._drawAxes(t,C,xLabelsPadded.length,
15,this._chartContent,p,n,l,void 0,void 0,xLabelsPadded,void 0,void 0);for(var E={},D=[],G=1,B=0;B<a.length;++B){console.log(a[B]);var I=a[B]._xVal,y=a[B][c];if(I&&y){var H=sprintf("item data-series-%s",0),F=t(I),M=C(y),F=Math.floor(F/m)*m,M=Math.floor(M/m)*m,K=null;E[M]&&E[M][F]?(K=E[M][F],K.id+="_"+a[B][d],K.values[0]=(K.values[0]*K.valueItems[0].length+I)/(K.valueItems[0].length+1),K.values[1]=(K.values[1]*K.valueItems[1].length+y)/(K.valueItems[1].length+1),K.valueItems[0].push(a[B]),K.valueItems[1].push(a[B]),
K.valueItems[0].length>G&&(G=K.valueItems[0].length)):(K=new epiviz.ui.charts.ChartIndexObject(sprintf("scatter_%s_%s_%s_%s",I,y,0,a[B][d]),[d],a[B][d],[I,y],[[a[B]],[a[B]]],["_xVal",c],0,H),E[M]||(E[M]={}),E[M][F]=K,D.push(K))}}console.log("after loop");B=this._chartContent.select(".items");B.empty()&&(B=this._chartContent.append("g").attr("class","items"),a=B.append("g").attr("class","selected"),B.append("g").attr("class","hovered"),a.append("g").attr("class","hovered"));a=B.selectAll("circle").data(D,
function(a){return a.id});a.enter().insert("circle",":first-child").attr("id",function(a){return sprintf("%s-item-%s",f.id(),a.seriesIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0);a.each(function(a){var b=d3.select(this),c=f.colors().get(a.seriesIndex);b.attr("cx",l.left()+(a.values[0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("cy",n-l.bottom()-(a.values[1]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("class",a.cssClasses).style("fill",c)});a.transition().duration(1E3).style("fill-opacity",function(a){return Math.max(.6,
a.valueItems[0].length/G)}).style("opacity",null).attr("r",h);a.exit().transition().duration(1E3).style("opacity",0).attr("r",0).remove();a.on("click",function(a){console.log("click");console.log(a);f._deselect.notify(new epiviz.ui.charts.VisEventArgs(f.id()));f._select.notify(new epiviz.ui.charts.VisEventArgs(f.id(),a));f._dispatch.click(f.id(),null);d3.event.stopPropagation()});if(this._globalIndexColorLabels){h={};for(j=firstGlobalIndex;j<lastGlobalIndex;++j)h[this._globalIndexColorLabels[j]]=
this._globalIndexColorLabels[j];this._colorLabels=Object.keys(h);this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();h=this._svg.selectAll(".chart-title").data(this._colorLabels);h.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",f.margins().top()-5);h.attr("fill",function(a,b){return f.colors().getByKey(a)}).text(function(a){return a});var J=0,N=[];this._container.find(" .chart-title").each(function(a){N.push(J);J+=
this.getBBox().width+15});h.attr("x",function(a,b){return f.margins().left()+10+N[b]});this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(a,b){return f.margins().left()+4+N[b]}).attr("cy",f.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a,b){return f.colors().getByKey(a)}).style("stroke-width",0)}else{h=Math.min(this._measurementsX.length,this._measurementsY.length);
a=Array(h);for(j=0;j<h;++j)a[j]=sprintf("%s vs %s",this._measurementsX[j].name(),this._measurementsY[j].name());this._colorLabels=a}h=B;console.log(A);h.selectAll(".iqr-range").remove();h.selectAll(".whisker").remove();for(B=0;B<z.length;B++){a=z[B][1];console.log(a);d=[];d=e(a);console.log(d);m=1.5*(d[1]-d[0]);E=0;I=a.length-1;for(j=0;j<a.length;j++)if(a[j]<d[0]-m)E=j;else break;for(k=a.length-1;0<k;k--)if(a[k]>d[1]+m)I=k;else break;h.append("rect").attr("id","0").attr("class","iqr-range").style("opacity",
1).style("fill-opacity",.2).attr("x",l.left()+(.6+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y",n-l.bottom()-(d[1]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("width",t(.8)).attr("height",Math.abs(C(d[1])-C(d[0]))).attr("fill","#1E90FF");h.append("line").style("stroke","gray").attr("class","whisker").attr("x1",l.left()+(1+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y1",n-l.bottom()-(d[1]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("x2",l.left()+(1+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y2",n-l.bottom()-(a[I]-v)*(n-
l.sumAxis(g.Y))/(q-v));h.append("line").style("stroke","gray").attr("class","whisker").attr("x1",l.left()+(1+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y1",n-l.bottom()-(d[0]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("x2",l.left()+(1+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y2",n-l.bottom()-(a[E]-v)*(n-l.sumAxis(g.Y))/(q-v));h.append("line").style("stroke","gray").attr("class","whisker").attr("x1",l.left()+(.6+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y1",n-l.bottom()-(a[I]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("x2",
l.left()+(1.4+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y2",n-l.bottom()-(a[I]-v)*(n-l.sumAxis(g.Y))/(q-v));h.append("line").style("stroke","gray").attr("class","whisker").attr("x1",l.left()+(.6+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y1",n-l.bottom()-(a[E]-v)*(n-l.sumAxis(g.Y))/(q-v)).attr("x2",l.left()+(1.4+z[B][0]-u)*(p-l.sumAxis(g.X))/(w-u)).attr("y2",n-l.bottom()-(a[E]-v)*(n-l.sumAxis(g.Y))/(q-v))}return D};epiviz.plugins.charts.DiversityScatterPlot.prototype.colorLabels=function(){return this._colorLabels};
epiviz.plugins.charts.DiversityScatterPlot.prototype._drawAxesOld=function(a,b,c,d,e,f,g,h){epiviz.ui.charts.Plot.prototype._drawAxes(a,b,c,d,e,f,g,h,void 0,void 0,this.xTickValues,void 0,void 0);this._legend.selectAll("text").remove();a=this._measurementsX;var m=this;this._legend.selectAll(".x-measurement").remove();this._legend.selectAll(".x-measurement-color").remove();b=this._legend.selectAll(".x-measurement").data(a).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",
function(a,b){return m._globalIndexColorLabels?"#000000":m.colors().get(b)}).attr("y",this.height()-this.margins().bottom()+35).text(function(a,b){return a.name()});var l=0,p=[];this._container.find(" .x-measurement").each(function(a){p.push(l);l+=this.getBBox().width+15});b.attr("x",function(a,b){return.5*(m.width()-l)+7+p[b]});this._legend.selectAll(".x-measurement-color").data(a).enter().append("circle").attr("class","x-measurement-color").attr("cx",function(a,b){return.5*(m.width()-l)+1+p[b]}).attr("cy",
this.height()-this.margins().bottom()+31).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a,b){return m._globalIndexColorLabels?"#ffffff":m.colors().get(b)});a=["alphaDiversity"];this._legend.selectAll(".y-measurement").remove();this._legend.selectAll(".y-measurement-color").remove();b=this._legend.selectAll(".y-measurement").data(a).enter().append("text").attr("class","y-measurement").attr("font-weight","bold").attr("fill",function(a,b){return m._globalIndexColorLabels?
"#000000":m.colors().get(b)}).attr("y",this.margins().left()-35).attr("transform","rotate(-90)").text(function(a,b){return a});var n=0,t=[];this._container.find(" .y-measurement").each(function(a){t.push(n);n+=this.getBBox().width+15});b.attr("x",function(a,b){return-m.height()+.5*(m.height()-n)+12+m.margins().top()+t[b]});this._legend.selectAll(".y-measurement-color").data(a).enter().append("circle").attr("class","y-measurement-color").attr("cx",function(a,b){return-m.height()+.5*(m.height()-n)+
6+m.margins().top()+t[b]}).attr("cy",this.margins().left()-39).attr("transform","rotate(-90)").attr("r",4).style("shape-rendering","auto").style("stroke-width","0").style("fill",function(a,b){return m._globalIndexColorLabels?"#ffffff":m.colors().get(b)})};epiviz.plugins.charts.DiversityScatterPlot.prototype.transformData=function(a,b){void 0!=a&&(this._lastRange=a);void 0!=b&&(this._unalteredData=this._lastData=b);var c=new epiviz.deferred.Deferred;c.resolve();return c};epiviz.plugins.charts.DiversityScatterPlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.DiversityScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.DiversityScatterPlotType.constructor=epiviz.plugins.charts.DiversityScatterPlotType;epiviz.plugins.charts.DiversityScatterPlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.DiversityScatterPlot(a,b,c)};
epiviz.plugins.charts.DiversityScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.DiversityScatterPlot"};epiviz.plugins.charts.DiversityScatterPlotType.prototype.chartName=function(){return"Diversity Scatter Plot"};epiviz.plugins.charts.DiversityScatterPlotType.prototype.chartHtmlAttributeName=function(){return"diversity_scatter"};epiviz.plugins.charts.DiversityScatterPlotType.prototype.measurementsFilter=function(){return function(a){return epiviz.measurements.Measurement.Type.hasValues(a.type())}};
epiviz.plugins.charts.DiversityScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};epiviz.plugins.charts.DiversityScatterPlotType.prototype.minSelectedMeasurements=function(){return 2};
epiviz.plugins.charts.DiversityScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.ROW_LABEL,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,
"name","Row labels"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,
epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max Y")])};epiviz.plugins.charts.DiversityScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio"};epiviz.plugins.charts.CustomScatterPlot=function(a,b,c){epiviz.ui.charts.Plot.call(this,a,b,c);this._legend=this._chartContent=null;this._measurementsX=[];this._measurementsY=[];var d=this;this.measurements().foreach(function(a,b){0==b%2?d._measurementsX.push(a):d._measurementsY.push(a)});this._yLabel=this._xLabel="";for(a=0;a<Math.min(this._measurementsX.length,this._measurementsY.length);++a)0<a&&(this._xLabel+=", ",this._yLabel+=", "),this._xLabel+=this._measurementsX[a].name(),this._yLabel+=this._measurementsY[a].name();
this._colorLabels=[];this._initialize()};epiviz.plugins.charts.CustomScatterPlot.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.Plot.prototype);epiviz.plugins.charts.CustomScatterPlot.constructor=epiviz.plugins.charts.CustomScatterPlot;
epiviz.plugins.charts.CustomScatterPlot.prototype._initialize=function(){epiviz.ui.charts.Plot.prototype._initialize.call(this);this._svg.classed("scatter-plot",!0);this._chartContent=this._svg.append("g").attr("class","chart-content");this._legend=this._svg.append("g").attr("class","chart-legend")};
epiviz.plugins.charts.CustomScatterPlot.prototype.draw=function(){epiviz.ui.charts.Plot.prototype.draw.call(this,void 0,void 0);this._variance_labels=this._lastData.pca_variance_explained;this.drawScatter(this._lastRange,this._lastData.data,"sample_id","PC1","PC2")};epiviz.plugins.charts.CustomScatterPlot.prototype.drawScatter=function(a,b,c,d,e){return this._drawCircles(b,d,e,c)};
epiviz.plugins.charts.CustomScatterPlot.prototype._drawCircles=function(a,b,c,d){var e=this,f=epiviz.ui.charts.Axis,g=Math.max(1,this.customSettingsValues()[epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO]*Math.min(this.width(),this.height())),h=Math.max(Math.floor(g),1),m=this.margins(),l=this.width(),p=this.height(),n=epiviz.ui.charts.CustomSetting,t=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MIN],v=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.Y_MAX],
q=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MIN],u=this.customSettingsValues()[epiviz.ui.charts.Visualization.CustomSettings.X_MAX],w=this.customSettingsValues()[epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.COLOR_BY];q==n.DEFAULT&&(q=this._measurementsX[0].minValue());t==n.DEFAULT&&(t=this._measurementsY[0].minValue());u==n.DEFAULT&&(u=this._measurementsX[0].maxValue());v==n.DEFAULT&&(v=this._measurementsY[0].maxValue());var r=d3.scale.linear().domain([q,
u]).range([0,l-m.sumAxis(f.X)]).nice(),A=d3.scale.linear().domain([t,v]).range([p-m.sumAxis(f.Y),0]).nice();this._clearAxes(this._chartContent);this._drawAxes(r,A,15,15,this._chartContent);for(var x={},n=[],z=1,C=0;C<a.length;++C){var E=a[C][b],D=a[C][c];if(E&&D){var G=sprintf("item data-series-%s",0),B=r(E),I=A(D),B=Math.floor(B/h)*h,I=Math.floor(I/h)*h,y=null;x[I]&&x[I][B]?(y=x[I][B],y.id+="_"+a[C][d],y.values[0]=(y.values[0]*y.valueItems[0].length+E)/(y.valueItems[0].length+1),y.values[1]=(y.values[1]*
y.valueItems[1].length+D)/(y.valueItems[1].length+1),y.valueItems[0].push(a[C]),y.valueItems[1].push(a[C]),y.valueItems[0].length>z&&(z=y.valueItems[0].length)):(y=new epiviz.ui.charts.ChartIndexObject(sprintf("scatter_%s_%s_%s_%s",E,D,0,a[C][d]),[d],a[C][d],[E,D],[[a[C]],[a[C]]],[b,c],0,G),x[I]||(x[I]={}),x[I][B]=y,n.push(y))}}a=this._chartContent.select(".items");a.empty()&&(a=this._chartContent.append("g").attr("class","items"),b=a.append("g").attr("class","selected"),a.append("g").attr("class",
"hovered"),b.append("g").attr("class","hovered"));a=a.selectAll("circle").data(n,function(a){return a.id});a.enter().insert("circle",":first-child").attr("id",function(a){return sprintf("%s-item-%s",e.id(),a.seriesIndex)}).style("opacity",0).style("fill-opacity",0).attr("r",0);a.each(function(a){var b=d3.select(this),c=e.colors().getByKey(a.valueItems[0][0][w]);null!=e._globalIndexColorLabels&&-1==e._globalIndexColorLabels.indexOf(a.valueItems[0][0][w])&&e._globalIndexColorLabels.push(a.valueItems[0][0][w]);
b.attr("cx",m.left()+(a.values[0]-q)*(l-m.sumAxis(f.X))/(u-q)).attr("cy",p-m.bottom()-(a.values[1]-t)*(p-m.sumAxis(f.Y))/(v-t)).attr("class",a.cssClasses).style("fill",c)});a.transition().duration(1E3).style("fill-opacity",function(a){return Math.max(.6,a.valueItems[0].length/z)}).style("opacity",null).attr("r",g);a.exit().transition().duration(1E3).style("opacity",0).attr("r",0).remove();a.on("click",function(a){console.log("click");e._deselect.notify(new epiviz.ui.charts.VisEventArgs(e.id()));e._select.notify(new epiviz.ui.charts.VisEventArgs(e.id(),
a));d3.event.stopPropagation()});if(this._globalIndexColorLabels){g={};for(j=firstGlobalIndex;j<lastGlobalIndex;++j)g[this._globalIndexColorLabels[j]]=this._globalIndexColorLabels[j];this._colorLabels=Object.keys(g);this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();g=this._svg.selectAll(".chart-title").data(this._colorLabels);g.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",e.margins().top()-5);g.attr("fill",function(a,
b){return e.colors().getByKey(a)}).text(function(a){return a});var H=0,F=[];this._container.find(" .chart-title").each(function(a){F.push(H);H+=this.getBBox().width+15});g.attr("x",function(a,b){return e.margins().left()+10+F[b]});this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class","chart-title-color").attr("cx",function(a,b){return e.margins().left()+4+F[b]}).attr("cy",e.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width",
"0").attr("fill",function(a,b){return e.colors().getByKey(a)}).style("stroke-width",0)}else{g=Math.min(this._measurementsX.length,this._measurementsY.length);a=Array(g);for(j=0;j<g;++j)a[j]=sprintf("%s vs %s",this._measurementsX[j].name(),this._measurementsY[j].name());this._colorLabels=a}this._colorLabels=[];Object.keys(e.colors()._keyIndices).forEach(function(a){"undefined"!=a&&"Max"!=a&&e._colorLabels.push(a)});this._svg.selectAll(".chart-title").remove();this._svg.selectAll(".chart-title-color ").remove();
g=this._svg.selectAll(".chart-title").data(this._colorLabels);g.enter().append("text").attr("class","chart-title").attr("font-weight","bold").attr("y",e.margins().top()-5);g.attr("fill",function(a,b){return e.colors().getByKey(a)}).text(function(a){return a});H=0;F=[];this._container.find(" .chart-title").each(function(a){F.push(H);H+=this.getBBox().width+15});g.attr("x",function(a,b){return e.margins().left()+10+F[b]});this._svg.selectAll(".chart-title-color").data(this._colorLabels).enter().append("circle").attr("class",
"chart-title-color").attr("cx",function(a,b){return e.margins().left()+4+F[b]}).attr("cy",e.margins().top()-9).attr("r",4).style("shape-rendering","auto").style("stroke-width","0").attr("fill",function(a,b){return e.colors().getByKey(a)}).style("stroke-width",0);return n};epiviz.plugins.charts.CustomScatterPlot.prototype.colorLabels=function(){return this._colorLabels};
epiviz.plugins.charts.CustomScatterPlot.prototype._drawAxes=function(a,b,c,d,e,f,g,h){epiviz.ui.charts.Plot.prototype._drawAxes.call(this,a,b,c,d,e,f,g,h);var m=this;this._legend.selectAll("text").remove();m=this;this._legend.selectAll(".x-measurement").remove();this._legend.selectAll(".x-measurement-color").remove();a=this._legend.selectAll(".x-measurement").data(["pca1"]).enter().append("text").attr("class","x-measurement").attr("font-weight","bold").attr("fill",function(a,b){return m._globalIndexColorLabels?
"#000000":m.colors().get(b)}).attr("y",this.height()-this.margins().bottom()+35).text(function(a,b){return a+" (% Variance Explained = "+m._variance_labels[0]+")"});var l=0,p=[];this._container.find(" .x-measurement").each(function(a){p.push(l);l+=this.getBBox().width+15});a.attr("x",function(a,b){return.5*(m.width()-l)+7+p[b]});this._legend.selectAll(".y-measurement").remove();this._legend.selectAll(".y-measurement-color").remove();a=this._legend.selectAll(".y-measurement").data(["pca2"]).enter().append("text").attr("class",
"y-measurement").attr("font-weight","bold").attr("fill",function(a,b){return m._globalIndexColorLabels?"#000000":m.colors().get(b)}).attr("y",this.margins().left()-35).attr("transform","rotate(-90)").text(function(a,b){return a+" (% Variance Explained = "+m._variance_labels[1]+")"});var n=0,t=[];this._container.find(" .y-measurement").each(function(a){t.push(n);n+=this.getBBox().width+15});a.attr("x",function(a,b){return-m.height()+.5*(m.height()-n)+12+m.margins().top()+t[b]})};
epiviz.plugins.charts.CustomScatterPlot.prototype.transformData=function(a,b){void 0!=a&&(this._lastRange=a);void 0!=b&&(this._unalteredData=this._lastData=b);var c=new epiviz.deferred.Deferred;c.resolve();return c};epiviz.plugins.charts.CustomScatterPlotType=function(a){epiviz.ui.charts.PlotType.call(this,a)};epiviz.plugins.charts.CustomScatterPlotType.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.PlotType.prototype);epiviz.plugins.charts.CustomScatterPlotType.constructor=epiviz.plugins.charts.CustomScatterPlotType;epiviz.plugins.charts.CustomScatterPlotType.prototype.createNew=function(a,b,c){return new epiviz.plugins.charts.CustomScatterPlot(a,b,c)};
epiviz.plugins.charts.CustomScatterPlotType.prototype.typeName=function(){return"epiviz.plugins.charts.CustomScatterPlot"};epiviz.plugins.charts.CustomScatterPlotType.prototype.chartName=function(){return"PCA Scatter Plot"};epiviz.plugins.charts.CustomScatterPlotType.prototype.chartHtmlAttributeName=function(){return"pca_scatter"};epiviz.plugins.charts.CustomScatterPlotType.prototype.measurementsFilter=function(){return function(a){return epiviz.measurements.Measurement.Type.hasValues(a.type())}};
epiviz.plugins.charts.CustomScatterPlotType.prototype.isRestrictedToSameDatasourceGroup=function(){return!0};epiviz.plugins.charts.CustomScatterPlotType.prototype.minSelectedMeasurements=function(){return 2};
epiviz.plugins.charts.CustomScatterPlotType.prototype.customSettingsDefs=function(){return epiviz.ui.charts.PlotType.prototype.customSettingsDefs.call(this).concat([new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.CIRCLE_RADIUS_RATIO,epiviz.ui.charts.CustomSetting.Type.NUMBER,.015,"Circle radius ratio"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,
"Min X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.X_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Max X"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MIN,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,"Min Y"),new epiviz.ui.charts.CustomSetting(epiviz.ui.charts.Visualization.CustomSettings.Y_MAX,epiviz.ui.charts.CustomSetting.Type.NUMBER,epiviz.ui.charts.CustomSetting.DEFAULT,
"Max Y"),new epiviz.ui.charts.CustomSetting(epiviz.plugins.charts.CustomScatterPlotType.CustomSettings.COLOR_BY,epiviz.ui.charts.CustomSetting.Type.MEASUREMENTS_ANNOTATION,"name","Color By")])};epiviz.plugins.charts.CustomScatterPlotType.CustomSettings={CIRCLE_RADIUS_RATIO:"circleRadiusRatio",COLOR_BY:"colorBy"};epiviz.ui.charts.ChartFactory=function(a){this._config=a;this._types={};for(var b=this._size=0;b<a.chartTypes.length;++b)this.register(a.chartTypes[b])};epiviz.ui.charts.ChartFactory.prototype.size=function(){return this._size};epiviz.ui.charts.ChartFactory.prototype.registerType=function(a){a.typeName()in this._types||++this._size;this._types[a.typeName()]=a};
epiviz.ui.charts.ChartFactory.prototype.unregisterType=function(a){if(!(a.typeName()in this._types))return!1;--this._size;delete this._types[a.typeName()];return!0};epiviz.ui.charts.ChartFactory.prototype.register=function(a){a=epiviz.utils.evaluateFullyQualifiedTypeName(a);if(!a)return!1;this.registerType(new a(this._config));return!0};epiviz.ui.charts.ChartFactory.prototype.unregister=function(a){return(a=epiviz.utils.evaluateFullyQualifiedTypeName(a))?this.unregisterType(new a(this._config)):!1};
epiviz.ui.charts.ChartFactory.prototype.get=function(a){return a&&a in this._types?this._types[a]:null};epiviz.ui.charts.ChartFactory.prototype.foreach=function(a){for(var b in this._types)if(this._types.hasOwnProperty(b)&&a(b,this._types[b]))break};epiviz.ui.controls.Control=function(a,b,c){this._container=a;this._title=b||"";this._id=c||epiviz.utils.generatePseudoGUID(6)};epiviz.ui.controls.Control.prototype.initialize=function(){};epiviz.ui.controls.Control.prototype.id=function(){return this._id};epiviz.ui.controls.Control.prototype.title=function(){return this._title};epiviz.ui.controls.DataTable=function(a,b,c,d,e,f){epiviz.ui.controls.Control.call(this,a);this._columns=b;this._rows=c;this._rowsArray=[];var g=this;this._rows.foreach(function(a){g._rowsArray.push(a)});this._rowParser=d;this._multiselect=e||!1;this._showColumnSelector=f||!1;this._columnSelector=this._table=null;this._selectedIndices=[];this._selectedIndicesMap={};this._lastSelection=this._deselectList=this._selectList=null};epiviz.ui.controls.DataTable.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Control.prototype);
epiviz.ui.controls.DataTable.constructor=epiviz.ui.controls.DataTable;epiviz.ui.controls.DataTable.ColumnType={STRING:"string",NUMBER:"number",BOOLEAN:"boolean"};
epiviz.ui.controls.DataTable.prototype.initialize=function(){this._container.append('<div class="epiviz-data-table"><table style="width: 100%!important;"><thead></thead><tbody></tbody><tfoot></tfoot></table></div>');this._table=this._container.find("table");var a=this._table.find("thead"),b=this._table.find("tfoot"),c=this._table.find("tbody"),d=sprintf("<tr><th>%s</th></tr>",this._columns.join("</th><th>"));a.append(d);b.append(d);var e=this;this._rows.foreach(function(a){for(var b="",d=0;d<e._columns.length;++d)b+=
sprintf("<td>%s</td>",e._rowParser(a,e._columns[d]));c.append(sprintf("<tr>%s</tr>",b))});b=Array(this._columns.length);for(a=0;a<this._columns.length;++a)b[a]={type:"text",bRegex:!0,bSmart:!0};this._table.dataTable({bJQueryUI:!0,sDom:'<"H"lfr>Tt<"F"ip>',oTableTools:{sRowSelect:this._multiselect?"multi":"single",aButtons:["select_all"],fnPreRowSelect:function(a,b,c){return e._preRowSelect(this,a,b,c)},fnRowSelected:function(a){return e._select(this,a)},fnRowDeselected:function(a){return e._select(this,
a)}}}).columnFilter({aoColumns:b});b=-1;for(a=0;a<this._columns.length;++a)this._columns[a].isVisible&&++b,this._table.fnSetColumnVis(a,this._columns[a].isVisible),this._columns[a].defaultFilter&&(this._table.fnFilter(this._columns[a].defaultFilter,a,!0,!0),this._table.find("tfoot").find(sprintf("th:eq(%s)",b)).find("input").removeClass("search_init").val(this._columns[a].defaultFilter));this._container.find(".ui-buttonset").first().attr("style","position: absolute!important;");if(this._showColumnSelector){this._container.find(".fg-toolbar").first().append(sprintf('<div style="float: right; margin-right: 5px;"><label>Selected Columns: </label><select class="%s" multiple="multiple" style=""><option value="-1">All</option></select></div>',
"epiviz-data-table-column-selector"));this._columnSelector=this._container.find(".epiviz-data-table-column-selector");for(a=0;a<this._columns.length;++a)b=sprintf('<option value="%s"%s%s>%s</option>',a,this._columns[a].isVisible?' selected="selected"':"",this._columns[a].isFixed?' disabled="disabled"':"",this._columns[a].name),this._columnSelector.append(b);this._columnSelector.dropdownchecklist({width:"80px",firstItemChecksAll:!0,onComplete:function(a){e._selectColumns(a)}})}};
epiviz.ui.controls.DataTable.prototype.selectedIndices=function(){return this._selectedIndices||[]};epiviz.ui.controls.DataTable.prototype.selectedRows=function(){if(!this._selectedIndices)return[];for(var a=Array(this._selectedIndices.length),b=0;b<this._selectedIndices.length;++b)a[b]=this._rowsArray[this._selectedIndices[b]];return a};
epiviz.ui.controls.DataTable.prototype._preRowSelect=function(a,b,c,d){b&&(this._selectList=this._deselectList=null,b.shiftKey&&1==c.length?(this._deselectList=a.fnGetSelected(),this._lastSelection||(this._lastSelection=c[0]),this._selectList=this._getRangeOfRows(this._lastSelection,c[0])):(this._lastSelection=c[0],b.ctrlKey||b.metaKey||(this._deselectList=a.fnGetSelected(),d||(this._selectList=c))));return!0};
epiviz.ui.controls.DataTable.prototype._getRangeOfRows=function(a,b){var c=this._table.fnGetPosition(a),d=this._table.fnGetPosition(b),e=this._table.fnSettings(),c=$.inArray(c,e.aiDisplay),d=$.inArray(d,e.aiDisplay),f=[];if(0<=c&&0<=d)for(var g=Math.min(c,d);g<=Math.max(c,d);++g)f.push(e.aoData[e.aiDisplay[g]].nTr);return 0<f.length?f:null};
epiviz.ui.controls.DataTable.prototype._select=function(a,b){var c;this._deselectList&&(c=this._deselectList,this._deselectList=null,a.fnDeselect(c));this._selectList&&(c=this._selectList,!this._multiselect&&0<c.length&&(c=[c[c.length-1]]),this._selectList=null,a.fnSelect(c));c=a.fnGetSelected();var d=Array(c.length),e={},f;for(f=0;f<c.length;++f)d[f]=this._table.fnGetPosition(c[f]),e[d[f]]=!0;for(f=0;f<this._selectedIndices.length;++f)e[this._selectedIndices[f]]||(delete this._selectedIndicesMap[this._selectedIndices[f]],
this._selectedIndices.splice(f,1),--f);for(f=0;f<d.length;++f)this._selectedIndicesMap[d[f]]||(this._selectedIndicesMap[d[f]]=!0,this._selectedIndices.push(d[f]));return!0};epiviz.ui.controls.DataTable.prototype._selectColumns=function(a){var b={},c;for(c=0;c<a.options.length;++c)a.options[c].selected&&a.options[c].value&&(b[parseInt(a.options[c].value)]=!0);for(c=0;c<this._columns.length;++c)this._table.fnSetColumnVis(c,b[c]||this._columns[c].isFixed)};
epiviz.ui.controls.DataTable.Column=function(a,b,c,d,e,f){this.id=a;this.name=b;this.type=c;this.isVisible=!d;this.isFixed=e||!1;this.defaultFilter=f||""};epiviz.ui.controls.DataTable.Column.prototype.toString=function(){return this.name};epiviz.utils.IterableArray=function(a){this._array=a};epiviz.utils.IterableArray.prototype.foreach=function(a){for(var b=0;b<this._array.length&&!a(this._array[b]);++b);};epiviz.ui.controls.DatasourceGroupWizardStep=function(){this._data=this._dataTable=null};
epiviz.ui.controls.DatasourceGroupWizardStep.prototype.initialize=function(a,b){this._data=b;a.find(".epiviz-data-table").remove();var c=[new epiviz.ui.controls.DataTable.Column("datasourceGroup","Data Source Group",epiviz.ui.controls.DataTable.ColumnType.STRING)],d={};b.measurements.foreach(function(a){if(!b.dataprovider||b.dataprovider==a.dataprovider()){if(b.annotation)for(var c in b.annotation)if(b.annotation.hasOwnProperty(c)&&(!a.annotation()||a.annotation()[c]!=b.annotation[c]))return;d[a.datasourceGroup()]=
!0}});this._dataTable=new epiviz.ui.controls.DataTable(a,c,new epiviz.utils.IterableArray(Object.keys(d)),function(a){return a});this._dataTable.initialize()};
epiviz.ui.controls.DatasourceGroupWizardStep.prototype.next=function(){var a=this._dataTable?this._dataTable.selectedRows():[];if(0==a.length)return{error:"No rows selected"};this._data.datasourceGroup=a[0];return{data:new epiviz.ui.controls.VisConfigSelection(this._data.measurements.subset(function(b){return b.datasourceGroup()==a[0]}),this._data.datasource,this._data.datasourceGroup,this._data.dataprovider,this._data.annotation?epiviz.utils.mapCopy(this._data.annotation):this._data.annotation,this._data.defaultChartType,
this._data.minSelectedMeasurements,this._data.customData)}};epiviz.ui.controls.DatasourceGroupWizardStep.prototype.title=function(){return"Select Datasource Group"};epiviz.ui.controls.MeaurementsWizardStep=function(){this._measurements=this._data=this._dataTable=null};
epiviz.ui.controls.MeaurementsWizardStep.prototype.initialize=function(a,b){this._data=b;a.find(".epiviz-data-table").remove();var c=2,d=epiviz.ui.controls.DataTable.ColumnType,e=[new epiviz.ui.controls.DataTable.Column("id","Id",d.STRING,!0),new epiviz.ui.controls.DataTable.Column("name","Name",d.STRING,!1,!0),new epiviz.ui.controls.DataTable.Column("type","Type",d.STRING,!0),new epiviz.ui.controls.DataTable.Column("datasourceId","Data Source",d.STRING,!0),new epiviz.ui.controls.DataTable.Column("datasourceGroup",
"Data Source Group",d.STRING,!0),new epiviz.ui.controls.DataTable.Column("dataprovider","Data Provider",d.STRING,!0),new epiviz.ui.controls.DataTable.Column("formulaStr","Formula",d.STRING,!0)],f=[],g={};b.measurements.foreach(function(a){a=a.annotation();if(void 0!=a)for(var b in a)!a.hasOwnProperty(b)||b in g||(f.push(b),g[b]=!0)});f.sort();e=e.concat(f.map(function(a){var b=!1;0>=c&&(b=!0);c--;return new epiviz.ui.controls.DataTable.Column("[anno] "+a,a,d.STRING,b)}));this._measurements=b.measurements.subset(function(a){if(b.datasource&&
b.datasource!=a.datasourceId()||b.datasourceGroup&&b.datasourceGroup!=a.datasourceGroup()||b.dataprovider&&b.dataprovider!=a.dataprovider())return!1;if(b.annotation)for(var c in b.annotation)if(b.annotation.hasOwnProperty(c)&&(!a.annotation()||a.annotation()[c]!=b.annotation[c]))return!1;return!0});this._dataTable=new epiviz.ui.controls.DataTable(a,e,this._measurements,function(a,b){var c;if(epiviz.utils.stringStartsWith(b.id,"[anno] "))c="",void 0!=a.annotation()&&(c=a.annotation()[b.name]||"");
else switch(b.id){case "annotation":c=epiviz.utils.mapJoin(a.annotation(),": ","<br />");break;default:c=a[b.id]()}return 0===c||c?c:""},!0,!0);this._dataTable.initialize()};
epiviz.ui.controls.MeaurementsWizardStep.prototype.next=function(){var a=this._dataTable?this._dataTable.selectedRows():[];if(a.length<this._data.minSelectedMeasurements)return{error:"Minimum selected rows required is "+this._data.minSelectedMeasurements};for(var b=new epiviz.measurements.MeasurementSet,c=0;c<a.length;++c)b.add(a[c]);this._data.measurements=b;return{data:this._data}};epiviz.ui.controls.MeaurementsWizardStep.prototype.title=function(){return"Select Measurements"};epiviz.ui.controls.Wizard=function(a,b,c,d,e,f,g){epiviz.ui.controls.Dialog.call(this,a,b);this._steps=c;this._initialData=d;this._width=e;this._height=f;this._showTabs=g||!1;this._tabs=null;this._initialize()};epiviz.ui.controls.Wizard.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.Wizard.constructor=epiviz.ui.controls.Wizard;
epiviz.ui.controls.Wizard.prototype._initialize=function(){var a=this;this._dialog=$("#"+this._id);this._dialog.append('<div id="wizardDialog" class="wizard-dialog"><div class="wizard-tabs"><ul class="wizard-tabs-title-list"></ul></div></div>');this._tabs=this._dialog.find(".wizard-tabs");for(var b=this._tabs.find(".wizard-tabs-title-list"),c=0;c<this._steps.length;++c)b.append(sprintf('<li><a href="#%s-tab-%s">%s</a></li>',this._id,c,this._steps[c].title())),this._tabs.append(sprintf('<div id="%s-tab-%s"></div>',
this._id,c));this._showTabs||(b.css("visibility","hidden"),b.css("position","absolute"));this._tabs.tabs({activate:function(b,c){a._tabActivate(c)},disabled:epiviz.utils.range(this._steps.length-1,1)});this._dialog.dialog({autoOpen:!1,resizable:!0,width:this._width||void 0,height:this._height||void 0,buttons:{Back:function(){var b=a._tabs.tabs("option","active");0!=b&&(a._tabs.tabs("option","disabled",epiviz.utils.range(a._steps.length-b,b)),a._tabs.tabs("option","active",b-1))},Next:function(){var b=
a._tabs.tabs("option","active"),c=a._steps[b].next();c.error?(new epiviz.ui.controls.MessageDialog("Error",{Ok:function(){}},c.error,epiviz.ui.controls.MessageDialog.Icon.ERROR)).show():(a._steps[b+1].initialize($(sprintf("#%s-tab-%s",a._id,b+1)),c.data),a._tabs.tabs("option","disabled",epiviz.utils.range(a._steps.length-b-2,b+2)),a._tabs.tabs("option","active",b+1))},Finish:function(){var b=a._steps[a._steps.length-1].next();b.error?(new epiviz.ui.controls.MessageDialog("Error",{Ok:function(){}},
b.error,epiviz.ui.controls.MessageDialog.Icon.ERROR)).show():(a._handlers.finish&&a._handlers.finish(b.data),$(this).dialog("close"))},Cancel:function(){a._handlers.close&&a._handlers.close();$(this).dialog("close")}},modal:!0});1<this._steps.length?(this._dialog.parent().find('button:contains("Finish")').button("disable"),this._dialog.parent().find('button:contains("Next")').button("enable")):(this._dialog.parent().find('button:contains("Finish")').button("enable"),this._dialog.parent().find('button:contains("Next")').button("disable"));
this._steps[0].initialize($(sprintf("#%s-tab-0",a._id)),this._initialData);this._dialog.css("overflow","visible")};
epiviz.ui.controls.Wizard.prototype._tabActivate=function(a){a=this._tabs.tabs("option","active");var b=this._dialog.parent().find('button:contains("Finish")'),c=this._dialog.parent().find('button:contains("Next")');a==this._steps.length-1?(c.button("disable"),b.button("enable")):(c.button("enable"),b.button("disable"));this._tabs.tabs("option","disabled",epiviz.utils.range(this._steps.length-a-1,a+1))};
epiviz.ui.controls.Wizard.prototype.show=function(){var a=this;this._dialog.dialog("open");this._dialog.dialog("option","position","center");this._dialog.dialog({close:function(b,c){$(this).remove();a._dialog=null}})};epiviz.ui.controls.Wizard.Step=function(){};epiviz.ui.controls.Wizard.Step.prototype.initialize=function(a,b){};epiviz.ui.controls.Wizard.Step.prototype.next=function(){};epiviz.ui.controls.Wizard.Step.prototype.title=function(){};epiviz.ui.controls.ComputedMeasurementsDialog=function(a,b,c,d){epiviz.ui.controls.Dialog.call(this,a,b);this._measurements=c;this._chartsMeasurements=d;this._measurementsList=this._maxTextBox=this._minTextBox=this._nameTextBox=this._idTextBox=this._expressionTextBox=null;this._addButtonProperties={text:!1,icons:{primary:"ui-icon ui-icon-plus"}};this._deleteButtonsProperties={text:!1,icons:{primary:"ui-icon ui-icon-trash"}};this._datasourceGroupMeasurements=this._selectedDatasourceGroup=this._tabs=
null;this._addTabs();this._addDialogContents();this._addDatasourceGroupTable(c)};epiviz.ui.controls.ComputedMeasurementsDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.ComputedMeasurementsDialog.constructor=epiviz.ui.controls.ComputedMeasurementsDialog;
epiviz.ui.controls.ComputedMeasurementsDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var a=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(b,c){$(this).remove();a._dialog=null;a._handlers.close()}}))};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addDatasourceGroupTable=function(a){var b=this,c=$(sprintf("#datasource-group-tab-%s",this._id)),d="",e={};a.foreach(function(a){a.type()==epiviz.measurements.Measurement.Type.FEATURE&&(a.datasourceGroup()in e||(e[a.datasourceGroup()]=[]),e[a.datasourceGroup()].push(a))});for(var f in e)e.hasOwnProperty(f)&&(d+=sprintf('<tr><td class="center">%s</td></tr>',f));c.append(sprintf('<table style="border-spacing:0; border-collapse:collapse; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: moz-none; -ms-user-select: none; user-select: none; width: 100%%;" class="computed-measurements-dialog-raw-table">%s</table>',
"<thead><tr><th>Data Source Group</th></tr></thead>"+d+"<tfoot><tr><th>Data Source Group</th></tr></tfoot>"));var g=c.find(".computed-measurements-dialog-raw-table").dataTable({bJQueryUI:!0,sDom:'<"H"lfr>Tt<"F"ip>',oTableTools:{sRowSelect:"single",aButtons:[],fnPreRowSelect:function(a,b,c){return!0},fnRowSelected:function(a){a=g.fnGetData(a[0]);b._selectedDatasourceGroup=a[0];b._datasourceGroupMeasurements=e[b._selectedDatasourceGroup]},fnRowDeselected:function(a){g.fnGetData(a[0])==b._selectedDatasourceGroup&&
(b._selectedDatasourceGroup=null,b._datasourceGroupMeasurements=null)}}});c.find(".DTTT_container").css("position","absolute")};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addTabs=function(){var a=this;this._selectDialog().append('<div id="computedMeasurementsDialog" class="computed-measurements-dialog"><div class="computed-measurements-tabs"><ul>'+sprintf('<li><a href="#datasource-group-tab-%s">Data Source Group</a></li>',this._id)+sprintf('<li><a href="#formula-tab-%s">Expression</a></li>',this._id)+"</ul>"+sprintf('<div id="datasource-group-tab-%s"></div>',this._id)+sprintf('<div id="formula-tab-%s"></div>',
this._id)+"</div></div>");this._tabs=this._selectTabs();this._tabs.tabs({activate:function(b,c){a._tabActivate(c)}})};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addDialogContents=function(){var a=this;this._selectDialog().dialog({autoOpen:!1,resizable:!0,width:"600",height:"550",buttons:{Back:function(){0!=a._tabs.tabs("option","active")&&a._tabs.tabs("option","active",0)},Next:function(){1!=a._tabs.tabs("option","active")&&a._tabs.tabs("option","active",1)},Add:function(){for(var b=epiviz.utils.ExpressionParser.parse(a._selectExpressionTextBox().val().trim()),c={},d=b.variables(),e=null,f=null,g=[],
h={},m=0;m<d.length;++m){var l=d[m];if(epiviz.utils.stringStartsWith(l,"{")&&epiviz.utils.stringEndsWith(l,"}")){var p=parseInt(l.substring(1,l.length-1)),l=a._datasourceGroupMeasurements[p];c[p]=l;if(null===e||e>l.minValue())e=l.minValue();if(null===f||f<l.maxValue())f=l.maxValue();if(l.metadata())for(p=0;p<l.metadata().length;++p)h[l.metadata()[p]]||(h[l.metadata()[p]]=!0,g.push(l.metadata()[p]))}}d=a._selectMinTextBox().val().trim();h=a._selectMaxTextBox().val().trim();e=d?parseFloat(d):e;f=h?
parseFloat(h):f;d=a._selectIdTextBox().val().trim()||epiviz.utils.generatePseudoGUID(5);b=new epiviz.measurements.Measurement(d,a._selectNameTextBox().val().trim()||"Unnamed ["+d+"]",epiviz.measurements.Measurement.Type.FEATURE,null,a._selectedDatasourceGroup,null,{referredMeasurements:c,expression:b},"any",null,e,f,g);c=a._datasourceGroupMeasurements.length;$(sprintf("#computed-measurement-measurements-%s",a._id)).append(sprintf('<div style="min-height: 30px; padding: 2px;"><div style="margin: 6px; float: left;">%1$s {<b>%2$s</b>}</div><div style="float: right;"><button id="delete-button-%2$s-%3$s" data-measurement="%2$s">Delete</button><button style="" id="measurement-button-%2$s-%3$s" data-measurement="%2$s">Insert %2$s</button></div></div>',
b.name(),c,a._id));$("#measurement-button-"+c+"-"+a._id).button(a._addButtonProperties).click(function(){a._addButtonClick($(this))});$("#delete-button-"+c+"-"+a._id).button(a._deleteButtonsProperties).click(function(){a._deleteButtonClick($(this))});a._datasourceGroupMeasurements.push(b);a._handlers.add(b)},Close:function(){a._handlers.close();$(this).dialog("close")}},modal:!0})};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._addButtonClick=function(a){a=a.data("measurement");var b=this._selectExpressionTextBox();b.val(b.val().trim()+" {"+a+"}")};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._deleteButtonClick=function(a){for(var b=a.data("measurement"),c=this._datasourceGroupMeasurements[b],d=0;d<this._datasourceGroupMeasurements.length;++d){var e=this._datasourceGroupMeasurements[d];if(null!=e&&e!==c&&e.isComputed()&&e.componentMeasurements().contains(c)){a=new epiviz.ui.controls.MessageDialog("Measurement cannot be deleted",{Ok:function(){}},"There are other measurements that depend on the one selected. Please delete those before deleting this.",
epiviz.ui.controls.MessageDialog.Icon.ERROR);a.show();return}}for(var f in this._chartsMeasurements)if(this._chartsMeasurements.hasOwnProperty(f)&&this._chartsMeasurements[f].contains(c)){a=new epiviz.ui.controls.MessageDialog("Measurement cannot be deleted",{Ok:function(){}},"There are charts using the selected measurement. Remove them from the workspace and then try again.",epiviz.ui.controls.MessageDialog.Icon.ERROR);a.show();return}this._datasourceGroupMeasurements[b]=null;a.parent().parent().remove();
this._handlers.remove(c)};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._tabActivate=function(a){if(0!=this._selectTabs().tabs("option","active")&&(a.newPanel.empty(),this._measurementsList=this._maxTextBox=this._minTextBox=this._expressionTextBox=this._nameTextBox=this._idTextBox=null,this._selectedDatasourceGroup)){a.newPanel.append(sprintf('<label for="computed-measurement-key-%1$s"><b>Id:</b></label> <input id="computed-measurement-key-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/>&nbsp;<label for="computed-measurement-name-%1$s"><b>Name:</b></label> <input id="computed-measurement-name-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/><br /><br /><div id="computed-measurement-measurements-%1$s" style="overflow: auto; max-height: 200px; border-style: solid; border-width: 1px; border-color: #999999;"></div><br/><label for="computed-measurement-min-%1$s"><b>Min:</b></label> <input id="computed-measurement-min-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/>&nbsp;<label for="computed-measurement-max-%1$s"><b>Max:</b></label> <input id="computed-measurement-max-%1$s" class="ui-widget-content ui-corner-all" style="padding: 2px;" type="text"/><br/><div style="overflow: hidden; padding: 10px; padding-right: 20px; margin: 0px;"><textarea id="computed-measurement-expr-%1$s" class="ui-widget-content ui-corner-all" style="width: 100%%; height: 55px; padding: 5px; margin: 0; resize: none;"></textarea></div>',this._id));
a=this._selectMeasurementsList();for(var b="",c=0;c<this._datasourceGroupMeasurements.length;++c){var d=this._datasourceGroupMeasurements[c],e="";d.isComputed()&&(e='<button id="delete-button-%2$s-%3$s" data-measurement="%2$s">Delete %2$s</button>');b+=sprintf('<div style="min-height: 30px; padding: 2px;"><div style="margin: 6px; float: left;">%1$s {<b>%2$s</b>}</div><div style="float: right;">'+e+'<button style="" id="measurement-button-%2$s-%3$s" data-measurement="%2$s">Insert %2$s</button></div></div>',
d.name(),c,this._id)}a.append(b);for(var f=this,c=0;c<this._datasourceGroupMeasurements.length;++c)d=this._datasourceGroupMeasurements[c],d.isComputed()&&$("#delete-button-"+c+"-"+this._id).button(this._deleteButtonsProperties).click(function(){f._deleteButtonClick($(this))}),$("#measurement-button-"+c+"-"+this._id).button(this._addButtonProperties).click(function(){f._addButtonClick($(this))});this._selectIdTextBox().watermark("[auto]");this._selectNameTextBox().watermark("[auto]");this._selectMinTextBox().watermark("[auto]");
this._selectMaxTextBox().watermark("[auto]");this._selectExpressionTextBox().watermark("[expression; for example: {0} - {1}]")}};epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectDialog=function(){this._dialog||(this._dialog=$("#"+this._id));return this._dialog};epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectExpressionTextBox=function(){this._expressionTextBox||(this._expressionTextBox=$("#computed-measurement-expr-"+this._id));return this._expressionTextBox};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectIdTextBox=function(){this._idTextBox||(this._idTextBox=$("#computed-measurement-key-"+this._id));return this._idTextBox};epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectNameTextBox=function(){this._nameTextBox||(this._nameTextBox=$("#computed-measurement-name-"+this._id));return this._nameTextBox};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMinTextBox=function(){this._minTextBox||(this._minTextBox=$("#computed-measurement-min-"+this._id));return this._minTextBox};epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMaxTextBox=function(){this._maxTextBox||(this._maxTextBox=$("#computed-measurement-max-"+this._id));return this._maxTextBox};
epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectTabs=function(){this._tabs||(this._tabs=this._dialog.find(".computed-measurements-tabs"));return this._tabs};epiviz.ui.controls.ComputedMeasurementsDialog.prototype._selectMeasurementsList=function(){this._measurementsList||(this._measurementsList=$("#computed-measurement-measurements-"+this._id));return this._measurementsList};epiviz.ui.tutorials=function(){this._tutorialList=[{name:"Epiviz Overview",id:"tut_epiviz_overview",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br></p><p class='intro-text'>This tutorial will walk you through the functionality available in Epiviz.</p>",position:"center"},{target:"#intro-navigation",content:"<p class='intro-text'>The navigation section of Epiviz lets you select a chromosome and explore the genome. Options are available to move left/right and zoom in/out.</p><p class='intro-text'>The settings icon allows you to control the navigation parameters.</p>",
position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#search-box",content:"<p class='intro-header'>Use the search input to look for a specific gene or target.</p><p class='intro-text'>This will navigate Epiviz to the selected gene location and update the workspace with the new data.</p>",position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#vis-menu-button",content:'<p class="intro-text">Choose from a list of available data sources, measurements or chart types to add visualizations to the Epiviz Workspace.</p>',
position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#intro-workspace",content:'<p class="intro-header">managing workspaces.</p><p class="intro-text">If you are logged in, you will be able to save your Epiviz analysis and workspaces.You will also be able to retrieve them at a later time from your account.</p>',position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#login-link",content:'<p class="intro-text">Please login to save and manage Epiviz workspaces.</p>',
position:"left",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',position:"center"}]},{name:"Data Visualization and Controls",id:"tut_data_controls",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br><br>Data visualization tutorial<br></p><p class='intro-text'>This tutorial will help create/add new data visualizations to the Epiviz workspace and controls available for each visualization.</p>",
position:"center"},{target:"#vis-menu-button",content:'<p class="intro-text">The Data Visualizations button helps users add new charts to the workspace.</p><p>Users have the option to choose data sources and measurements to add to the workspace.</p>',position:"right",onHide:function(a,b,c,d){$("#vis-menu-button").button().trigger("click")},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#vis-menu",content:'<p class="intro-text">Choose the type of chart to add to your workspace. We choose scatter plot to continue with the tutorial</p>',
position:"right",onShow:function(a,b,c){},onHide:function(a,b,c,d){$("#plot-menu-add-scatter").trigger("click")},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){var a=$("#wizardDialog").parent().attr("id");return $("#"+a).parent()},content:'<p class="intro-text">This window lets you choose form a list of data sources and the measurements available from each data source to add to your Epiviz workspace</p><p>We selected the first data source in the table or choose a data source from the list.</p>',
showOverlay:function(){},onShow:function(a,b,c){$("#wizardDialog table tbody tr:first").trigger("click")},onHide:function(a,b,c,d){$('.ui-button:contains("Next")').trigger("click")},position:"right",buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){var a=$("#wizardDialog").parent().attr("id");return $("#"+a).parent()},content:'<p class="intro-text">After choosing a data source, the next tab lists all the measurements (or features) available from this data source. If you have any computed measurements for this data source, they will be added to this list.</p><p>To add a plot to the workspace, pick a few measurements and select finish on this window. </p>',
showOverlay:function(){},position:"right",onShow:function(a,b,c){},onHide:function(a,b,c,d){a=$("#wizardDialog").parent().attr("id");$("#"+a).dialog("close")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#feature-view",content:'<p class="intro-text">Visualizations are added to the workspace based on the type of chart. </p><p>Brushing is implemented on all the plots. When you hover over a data point, it highlight that region in the gene on all the visualizations.</p>',position:{top:"24em",
left:"14em"},showOverlay:function(){},onShow:function(a,b,c){$('button:contains("Remove"):first').css("display","block")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Remove"):first')},content:'<p class="intro-text">Removes the plot from the workspace</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(a,b,c){$('button:contains("Save"):eq(1)').css("display","block")},onHide:function(a,b,c,d){$(b).css("display",
"none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Save"):eq(1)')},content:'<p class="intro-text">Save a plot to your local machine (image, pdf)</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(a,b,c){$('button:contains("Custom settings"):first').css("display","inline-block")},onHide:function(a,b,c,d){$(b).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Custom settings"):first')},
content:'<p class="intro-text">Change chart display properties and aggregation methods for grouping.</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(a,b,c){$('button:contains("Code"):first').css("display","inline-block")},onHide:function(a,b,c,d){$(b).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Code"):first')},content:'<p class="intro-text">Edit code to redraw the chart on the workspace.</p>',
position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(a,b,c){$('button:contains("Colors"):first').css("display","inline-block")},onHide:function(a,b,c,d){$(b).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('button:contains("Colors"):first')},content:'<p class="intro-text">Choose colors for data points on the plot</p>',position:"left",showOverlay:function(){},className:"anno-width-175",onShow:function(a,b,c){$('label:contains("Toggle tooltip"):first').css("display",
"block")},onHide:function(a,b,c,d){$(b).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:function(){return $('label:contains("Toggle tooltip"):first')},content:'<p class="intro-text">Toggle tooltips for data points</p>',position:"right",showOverlay:function(){},className:"anno-width-175",onHide:function(a,b,c,d){$(b).css("display","none")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',
position:"center"}]},{name:"Computed Measurements",id:"tut_comp_measurements",tutorial:[{target:"body",content:"<p class='intro-header'>Welcome to Epiviz Genomic Browser!<br>Compute Measurements Tutorial<br></p><p class='intro-text'>This tutorial will help you create new measurements (derived from existing measurements) and generate plots to add to the workspace.</p>",position:"center"},{target:"#computed-measurements-button",content:"<p class='intro-text'>The computed measurements button helps users add new measurements to data sources</p>",
position:"right",onShow:function(a,b,c){$("#computed-measurements-button").button().trigger("click")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>This tab lets you choose a data source where you will create a new measurement.</p><p>We choose the first data source in the list or choose any data source.</p>",position:{top:"20em",left:"1em"},showOverlay:function(){},onShow:function(a,b,c){$("#computedMeasurementsDialog table tbody tr td:first").trigger("click")},
buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>The measurements tab lists all available measurements from the selected data source (including previously created computed measurements).</p><p>Use the buttons next to each measurement to add to the expression window</p>",position:{top:"20em",left:"1em"},showOverlay:function(){},onShow:function(a,b,c){$('.ui-button:contains("Next")').trigger("click")},buttons:[AnnoButton.BackButton,
AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'> After choosing measurements, use mathematical operators to evaluate the expression.</p><p><a target='_blank' href='https://silentmatt.com/javascript-expression-evaluator/'>supported operators</a> </p>",position:{top:"33em",left:"1em"},showOverlay:function(){},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"#computedMeasurementsDialog",content:"<p class='intro-text'>After adding a computed measurement, use the data visualization button to plot the measurement to your workspace.</p><p>To learn how to add new plots to the workspace, please use the Epiviz data visualization tutorial.</p>",
position:{top:"10em",left:"1em"},showOverlay:function(){},onHide:function(a,b,c,d){a=$("#computedMeasurementsDialog").parent().attr("id");$("#"+a).dialog("close")},buttons:[AnnoButton.BackButton,AnnoButton.NextButton]},{target:"body",content:'<p class=\'intro-header\'>Thank you for using Epiviz!</p><p class="intro-text">If you would like to give us some feedback or stay informed with updates, Please visit the <a target="_blank" href="http://epiviz.github.io/">Epiviz webpage</a>.</p>',position:"center"}]}]};epiviz.ui.PrintManager=function(a,b,c,d){this._containerId=a?a:"pagemain";this._fName=b?b:"epiviz_"+Math.floor($.now()/1E3);this._fType=c?c:"pdf";this._workspaceId=d};
epiviz.ui.PrintManager.prototype.print=function(){function a(a){$(a).find(".domain").each(function(){$(this).css({fill:"none","stroke-width":"1px",stroke:"#000000","shape-rendering":"crispEdges"})});$(a).find(".gene-name").each(function(){$(this).remove()});epiviz.utils.stringContains($(a).attr("id"),"track-lines")&&$(a).find(".lines path").each(function(){$(this).css({fill:"none"})});$(a).find("text").each(function(){$(this).css({"font-size":"11px"})});$(a).find(".chart-legend").each(function(){$(this).css({border:"none",
background:"transparent"})})}var b=this,c=$("#"+b._containerId),d=c.find("svg");d.each(function(){var b,c;b=document.createElement("canvas");b.className="tempCanvas";a(this);c=(new XMLSerializer).serializeToString(this);c=c.replace(/xmlns=\"http:\/\/www\.w3\.org\/2000\/svg\"/,"");canvg(b,c,{useCORS:!0,renderCallback:function(){$(b).insertAfter(this);$(this).hide()}})});html2canvas(c,{timeout:0,width:c[0].scrollWidth+200,height:c[0].scrollHeight+200,useCORS:!0}).then(function(a){var e=a.getContext("2d");
e.mozImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;var e=b._fName+"."+b._fType,g=b._fType,h=a.toDataURL("image/png");"pdf"==g?(a=new jsPDF("l","px",[.6*(1400<c[0].scrollWidth?c[0].scrollWidth:1400),.65*(1E3<c[0].scrollHeight?c[0].scrollHeight:1E3)]),g="http://epiviz.cbcb.umd.edu/4/?ws="+b._workspaceId,a.addImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOYAAAAyCAYAAABIxaeCAAASqElEQVR4nO2de5QU1Z3Hv/Wurn5M9wxvGBwGBUVF4hBFgwkaZOPukRBdGBaDkpUdY7LGaDxCEjUxehSMxizHF8QHMasug9mYaKJBRKMm7LKALwQxMCAPcXAe/Ziuqdet2j+qi+npqemZ7q7u6eH055w6Z7rurXtv99S37r2/3+/eouoa1++nYb3GmOoWXj62JV417TiGIf6WZpGtOfMCwgUu0rmqGSbFTTZpZiRtkpE662c5ImsmzXXQpn4QwE7a1LYInbs2x0fNjg1luw89s2goq69QplC1SzZYJz5ZxGIs/QPaNLbQlvEnoXPXX+KjZmtD2L6s+FuaeTJh7nxCc4tNmr+M0IKUy/WMqRmAuYkzkk/y0T0vxEfNJsVqqwesyPg74pJnJYDVpWlOhWwU+sDtLcwMGFProE3tGdoyH1S50IGCavKQquj7I5TApBsNWmgiND/KizIZUz3AEfk+vvPDJ8vkYVQPYCH6F6EbFWGWCYUKk86WSGi+WmcDN6hc4GNY5Klg8sCpBdVWOAGOyPd0VZ1xQGWDt3klSgAgtDBJ4SKPJmsa9opax1COLyMA1gLYD2AVBi/KcmUu7O9iAeiA/bCpMADs4LLRLCgsk6UJSwQjtkbs+uTOWHh6V3Gb1htBjzeqXOAXOiON6y8PYyqttGnsBqwDAN3JmIpMGJ8AIGxS9DhCcWeBYuqy1UMYXx1hfBs4I/ltXo9+O+kb/7HX3yULTbBFebIQAdCMnoeL8/lSAJtL3JZVsEcfO1L1d5a4/pwYpDBtCMXxhK26xQhNvTIgH1reJU3cUqyGOQTkwyNUvvoRlQv1edIyphZlTeUlg/H9WVTb3k6KYw+StDGADn+f8vzKsTEKXzOf0OwCAHMBmnOrV2f9F5s0926wa9/Pdv/hxz+vXbKh2PPPZgzcm2xGzw29DmV+cwFogHuP34DSC7Mpre4mlPmQP+scMysWMUU9tlqQj9wRC083PG4XAEBSWy9TufCThBbG9Jw1TcFIvgqLPEbtf+Fl5fRlar7lhzreGZesOr0JFHN9tmGxpLa+xcX3L42NvPCTfOvKQgTAq7BvGDdaYIuwrG+kfojAHsZmivOk7zELNv6c8Y37r9TZqikmRTWAYubojFSTSwEM6d4qah2NSd/4wwW1JA1/SzNLJsy9W+GqbgXFUPZZUxOMrv9kiLJaFkZ5OryU1FYfYXxNKhtYCdBj3PJwRI5yRvIaWRj5Bw+rHkiU18EW5XBmLmxRNMAWw3UANg5pi0qAF1bZEx8OP9tIn7bwsRmEYv/FpPnFhBYmDKYQxtRaBa3jSlkc89eCWgMg2LV/lOwb9zxhfBfZZ0xIavvvGC16ayJ42r5Cy8+GqHUEFL56JSxyCyhG6JPBIpZfPX7vR//9/Ts8Gtr2N3xtgf1Ub/GgjgpDgKfCTMff0kyTCV+do7P+fyc0Px+gmexFmaqoRb+r8NVP5NsYv3JshsJX/57QwsRUme/4ldabk+LYN/ItMx9EreNUnfU/TGhhnlu6pLS+TLdubew6ZUGigGpWwO5JMmkBMBPlP3+skIWiuUuS9YtMha/ZQmjxCn/3p1M5I/kEYOpZihIUPvy4YMTvOvxsI5VrQ0St/QpFGPE2oYWJsIgiGImbAXpmqUUJAApfve/gf139NcbUrgPMPuKTxdGX6eMv+VtV27ZJeVYRQe+AAYdODAOLYYXik9WP6ZD0Tdivs/7lweQn0xhTa4btk3ItTmVDt9U3PvVk6OgmV2tnJoefbaQ4o+s2hQs/TyjOz5jadlHvbFDZ4IMAzMF+Ea+pXbLBIjS/jiHqOQzp3pqZrrKhs7qqp28V9c7+5ofZyBa5MxTDVyeQwfE3ph/7U2kV/2MJGZQwHRL+SfsIzTeKWvtFjKl80F8+nZGWdY+Z/UJV27asIXKho5u4Uxeu/bXOBu4CRYEx1XsJzV+g8CN259KuYkIY3wHxkxe/zBH5XmQ8KAgtjtbZwOui1v7VHIqMoMd0n45jfS0lK2A7/ZthD6vrXfLUp9KaU3nd2p6NV9Fb6K9mpG9Pnd+eY7n9EYHdTgu9RyWrUueaB7g288E02KMD7qOgvMhJmA4KX/NX/7E3GwQj9kNYRHHLozPSP3ZFzn45FN8Tckuv6tjp7x79pd+rXHgpgChHlAWEFn4EoCiul0JI1i8ydEb6kai1L2BMLZ6eRiguqHOhP4lax2B7lIVw7y1L6Q6phy2EXCOLnKik7XAXcT4437sB/Vunc6EJdjs7UdoHXQT27znXi8LyEiYAxMfP01W2apWoR7/ImOp7bnkI4/ty0l+3JSAfHpF+PhT/qEauOv01nfVfxpjqXsFInKczkpduiKKg8DUvBmK7ZwlGYm/6eUJxvMJVPScYsW8Oohi3f1wnSudCaIAtrEJE4EUZDhvRM3z3Yrjs9OibkftcvRMAleexI1WGF79J/sJ0UPiaXYHOD84XjPgatykhYXwN3eLINyWldRwA+Ls/HZ0M1L2hM9L5HJHflLo/vVBlg38vtB2lIhaZsUdo3Xq+YMT/2CuBYhiVrVov6NFrByjC7R+Xz02UDw2wh5JuveQ6AIvQ94ZbCfeHhuOD9aLndMovVJhz0dOeUvpKG9Lq9SRwomBhAkCsZqaqsqEbRS26GBbpE0NLaPEMlY+8LSmtkylLNwBYgpF4TorunpfwT+rwog2lJD5+Xow99Mp8zkjck/EwYlQ2+CtBj17fz6URuN/IO1zOFYO16CvKHQAmo3/H/2rYgnXzqzqxr4Xi1OusqMkX59oWlE6Y9eiJB94Ij/6XngjTQeGrN0jq57MYU+kTukZofpLKh9/Suaox/rbtX9jXvPyqWM3MvMPphppk/SJTZ4M/9iut19rrOlNQDKVy4YcFPXqDy2X9zeccw0ShRzbjwwr07a03w/aZDsYSvBnu4nRiTwthB3puaC+EWcq5ZTNsce6A/XDzBE+FCQCyOOZDqfvYLMZUt2WmEVoYazDSm1r49Ia8Y3TLjKQ49klJPnw5YyrpIwVK5UJrBD36w4zsXhlM8iFTtJ2we8JccCKSMofdXlgj04ez+fxOjtEnvaxi44RTtsD+LT2bjnguTABI+Cd9JiU/uZgj8kuZafYaz9BrotZ+STHqHgoSgcmvBGIffYUzEp/1nKWhcuF7BD16fz4BFx7jZgleifxupBb0tSAXOgRFqkynPfmU5VyzGaXxBTsWWOcB52mdRREmACSCU2Qpse8bjKU/k5lGaD5guxjav16s+ktNLDJjp9T+7gWCHt+Tfl7lwj+oa1z/XCi+x4ehi33NtAQX6kpwu9YrCy2Q+9C4Hj3fsRS9ZRN6RgkrUQQbQdGECQCx8HSDfv/RazgjsT4zjVCcoHOh34pa29XFbEMx8XcfCXFGcpNgJDZw761hYqMvOih8vm22oEffSs9HGF9jt/+UvwhGvO8CUZvJyN9Mn3705wt1m1sWQif63oxe+O/SjUC5lJdu9Cn2/HIuehazryxWfUUVJgDo53yP6GzwXwUj9lhmGqE4RuEi6zkjcXOx2+E1ghGbqAij3tZZ/6Um6LFS7WwRAOLj5nawhzfNE7WOXk9unZG+qLKh1wGz1aU4T3xfWcics3nxhM8sw4stUNKHobkMZ50etti9pWOBBYq8Rrbowkxh7Wtu+o5gxH/ZJ4ViKJ0NPiAYiYe499YMsIKlPBC1tvMMRvpfQvNnc0byZSn64ddi1ecmnfRk/SLl789fv1hSjz+Y4U6pYUzdLUzRk2iRLGSKxgsjReaw3CvDltMD5RJJVQrfZfo2KZvhoQXWjZy2FimE2iUbLBW4SdCjXSoXui3zmaCywe9yZy2vFbWOqxS+uqT7CeWCYMSvUfgRjwLwCUbiN0Lr1mtj4+f1WXVTu2SDKQM3S8pnB2Vh5C9AMamHDhVwKXYh8jfGDMRQWoLzYR16gvybMPBQ0RFwusulGDTDHtk4OyC48sz/3AUAeGvyXdnKWgbglLTPd6bOrXdOlKrHPIHKhW8XtegNgNlnobHOSPN1NrBVUluHeje+PviVYyJH5LUqG1oPwCepnz+wr3n5NXEXUaYji2PWSFrbQlhEBgBC8xSAZEa2CIbf6o1MwXtl2OpEzxx4oN8kgtIYfdam6nHcIoUwA8BTAH6aOuoAhAE8mJ6p5MIEAIWvfkjUOhYzlt4nAJ7Q/FkqF/k/Ueu4bCja5kZAPjRT4cI7dEZqYiydiFrHDbIw8pbB+mJlYfTvBCNxMSxyHLD363XJNty2qsycF3tpcXZENtelnnRKEbC+IlWPV26RdAFGAdwE4EbY4jzBkAgTABR+xPOi2nYJY2qfZaYRmg8rfPVLHJHvr2rf3neLjxIRTHzMiXrnnd2+sVsJ45vGmFpcVI5frvDVD+ValsqFtzGmNosxtY8IzdcCZuZw3Vm5MRyoR1/BeDmMHGxgu5O2EcWZBixEzy4T16Hw7zgndTg4NpfvZ2YcMmECQFIcu1XQY+dxRH7XJZnWGekHXZGztola25mlbpuktn5F9te9o3CROwjFsYypfOxTW2clfeNfzrdMwvgOCFrHhRyRtzBEddvt3VmwXO64tdHroeRAge3py8SKMYytR2+3iBd1PJX290EA/wG7Bw1nZhxSYQKALIw8LMpHvsQReb1bOqHF6Qo/YidnJFdXRd93M5x4ir/76BSOyL+VhdGvE5o/EwAEI/HHQPzj87t8tXsGun4gZHFMp5TY9w+gmF8zlr7XJcsquO8FVC64xcZuhveGF2do2l9UUbrv0uutMJ2VMxF45xZZBns+6XAnbEEuc8s85MIE7CghnZG+JWrt/8ZYerdLFl5n/bd2haZ+JBiJb/pbmj23Jvu7j0zjjMTTSd/YD3VGugIAxVi6IWptK/c1L788Fp4e9aquWHi6QWj+Zto07odF3LbiXAHv1jt6SbofL51i+PPSBZdNmMWYWzqB6V65RTKNO+/CtsDW9XdBWQjTQeFrHpfkIzMZU9nplk5oYbzKBn+j1C3YK+jR71RF3xcLqc/f0syLWvuVnJHclPSN26WzwaUAzQIAY6oHReX4xQo/YnWxAu51xve4/Z4U8x2XZGcxcjOK4+d0RDZYd8pCuO9csBHF27w53QiUbhhrSrWjGEYfxwKb1S2SI5nGnZsGuqCshAkACf+k3VLy0CxBj97NWLrrW7cIzderXPjhrtDUY5J6/Olg1/75/pbmQYm06vO/jRW19kbBiD+t1C1oVfia53XWfylAOxtLgyPyE/6ulnOSvvFve/fN3FGEke8B9Lnofw6zED375ji7iRe6zCq97P2p8lfAXaQrUunp7yBx8HSpkwvOayAy90lKD1j30ujj/LbOKhovCKO3ceeN1JGVkgUY5EIiOEUHcLu/++gGjY+s1RnpQrd8hBbCsjBqKYRRSxlpgiYYsd0APqBM8ilgRQHLsihWMhgpDJhTAHpqbMT5k0C5BxgxpnZA0KPfk4VRL+mhMwbV1lz2D514VdY1xYsw8EuF0o0ubvnyfQ3fXPTsmD5YSvVyno2wf5eFsL9bsQLWnS1Fvd5CNNO4863BXFSWwnRI+sbvOvxs4+zT/vmRxTrrX0VocWJ/eQkt8IQWZsB24OYEY2px2jJ+7mvf+UB81Gy3OW6pWAe7F1iF8g442Ai7pyzFdijrYAuzAfZv4sy7vd6lwFka1wLvfLJ16G3cWQ/bGjsgZTeUzaR2yQZL4WueC3TumiIYsRsY0n3Uq7I5In8uGImfSfKROp2R7h5iUTo40SWTUbwwPSC/DcB2wG6bp4uCB1GnM4dtRs+oweu5pSPGehSwi8RVs263rpp1u/PwSHePOMEEg6Lshelg7ytU9RC961f1wa79S0WtYyusPF4fYhEiau2vBRN7rybvPlKrssGfJAL15bjzubMguRo9m2I5hxftdSJZ0st2Y0cqbWbqGIoXAi1CbwPTanhvCd4Mbx+Ec9A3mGDQlv1+310yHAjIh6Z2i2O+Dor6JwAXEopzHZozptZGm9prNMw/892fvZIITjnmVRs8nGMWi3rYBp50Toa3iJUlThA7gHfQM606COAL6CvMOQBeT/t8YqeLsp5jDkSXNHEvgPsA3Bc89KLPHHnuNItiphFWCsMyaZPmj8Ii77c0L99Xu2SDCQBq0HX/6QoVvGQZets67kQOvSUwzIWZTmLi5d3oZ+nPcB4VVBiW/CTtbyeYICdOGmFWqFAmLEDviJ6D6C3UdOoyPp/Ixxb6Hr8KFSr04pyMzwtSx2D4qfPHsLHKVqgwTOiz2Xk+VIayFSp4y3rYkT6D2Zo1jN5GojecPyrCrFDBe36JnkXQ2ZiD3u6Si50/KkPZChXKkIowK1QoQyrCrFChDKEs66R46VaFCmXBW5PPziX7HJyMIXkVKgxzouhn0fT/A3tQ05HQIpHYAAAAAElFTkSuQmCC",
"PNG",20,20,100,21),a.setFontSize(10),a.text(150,25,"Chromosome: Location"),a.setFontSize(14),a.text(150,40,$("#chromosome-selector").val()+" : "+$("#text-location").val()),a.setTextColor(0,0,0),a.setFontSize(10),null!=b._workspaceId&&(a.text(350,25,"Workspace ID"),a.setTextColor(0,0,255),a.setFontSize(16),a.text(350,45,g)),a.setFontSize(14),a.text(350,40,$("#save-workspace-text").val()),a.addImage(h,"PNG",15,55),a.save(e)):(navigator.msSaveBlob?(h=a.msToBlob(),a=new Blob([h],{type:"image/png"}),
navigator.msSaveBlob(a,e)):(a=new Blob([h],{type:"image/png"}),g=document.createElement("a"),void 0!==g.download?(URL.createObjectURL(a),g.setAttribute("href",h),g.setAttribute("download",e),g.style="visibility:hidden",g.setAttribute("target","_blank"),document.body.appendChild(g),g.click(),document.body.removeChild(g)):(e=h.replace("image/png","image/octet-stream"),window.open(e))),c.find(".tempCanvas").remove(),d.each(function(){$(this).show()}))})};epiviz.ui.ControlManager=function(a,b,c,d,e){this._config=a;this._chartFactory=b;this._chartManager=c;this._measurementsManager=d;this._locationManager=e;this._addChart=new epiviz.events.Event;this._activeWorkspaceChanged=new epiviz.events.Event;this._saveWorkspace=new epiviz.events.Event;this._deleteActiveWorkspace=new epiviz.events.Event;this._revertActiveWorkspace=new epiviz.events.Event;this._loginLinkClicked=new epiviz.events.Event;this._searchWorkspaces=new epiviz.events.Event;this._search=
new epiviz.events.Event;this._activeWorkspaceInfo=null;this._stepRatio=a.navigationStepRatio;this._zoominRatio=a.zoominRatio;this._zoomoutRatio=a.zoomoutRatio};epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS={plot:"feature-view",track:"location-view","data-structure":"data-structure-view"};epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS={plot:"Feature",track:"Location","data-structure":"Data Structure"};
epiviz.ui.ControlManager.prototype.initialize=function(){this._initializeChromosomeSelector();this._initializeLocationTextbox();this._initializeNavigationButtons();this._initializeZoomButtons();this._initializeLocationSettingsDialog();this._initializeChartMenus();this._initializeComputedMeasurementsMenu();this._initializeHelpButton();this._initializeSearchBox();this._initializeWorkspaceSaving();this._initializeTutorials();this._initializeScreenshotMenu();this._initializeLoginLink();this._initializeLayout();
this._checkBrowserCompatibility();this._registerLocationChanged();this._registerSeqInfosUpdated()};epiviz.ui.ControlManager.prototype.onAddChart=function(){return this._addChart};epiviz.ui.ControlManager.prototype.onActiveWorkspaceChanged=function(){return this._activeWorkspaceChanged};epiviz.ui.ControlManager.prototype.onSaveWorkspace=function(){return this._saveWorkspace};epiviz.ui.ControlManager.prototype.onDeleteActiveWorkspace=function(){return this._deleteActiveWorkspace};
epiviz.ui.ControlManager.prototype.onRevertActiveWorkspace=function(){return this._revertActiveWorkspace};epiviz.ui.ControlManager.prototype.onLoginLinkClicked=function(){return this._loginLinkClicked};epiviz.ui.ControlManager.prototype.onSearchWorkspaces=function(){return this._searchWorkspaces};epiviz.ui.ControlManager.prototype.onSearch=function(){return this._search};
epiviz.ui.ControlManager.prototype._updateSeqNames=function(a){var b=$("#chromosome-selector");b.empty();for(var c=0;c<a.length;++c){var d=sprintf('<option value="%s"%s>%s</option>',a[c].seqName,this._locationManager.currentLocation()&&a[c].seqName==this._locationManager.currentLocation().seqName()?'selected="selected"':"",a[c].seqName);b.append(d)}b.selectmenu()};
epiviz.ui.ControlManager.prototype._updateSelectedLocation=function(a){if(a){this._locationManager.changeCurrentLocation(a);a=this._locationManager.currentLocation();$("#text-location").val(Globalize.format(a.start(),"n0")+" - "+Globalize.format(a.end(),"n0"));var b=$("#chromosome-selector");b.val(a.seqName());b.selectmenu()}};
epiviz.ui.ControlManager.prototype.updateSelectedWorkspace=function(a){var b=this,c=$("#save-workspace-text"),d=this._activeWorkspaceInfo;c.val(a.name);this._activeWorkspaceInfo=a;this._activeWorkspaceChanged.notify({oldValue:d,newValue:a,cancel:function(){c.val(d.name);b._activeWorkspaceInfo=d}})};
epiviz.ui.ControlManager.prototype._initializeChromosomeSelector=function(){var a=$("#chromosome-selector");a.selectmenu({style:"popup",width:"90",maxHeight:"100",menuWidth:"90"});var b=this;a.change(function(){var a=b._locationManager.lastUnfilledLocationChangeRequest()||b._locationManager.currentLocation(),d=$(this).val();b._updateSelectedLocation(new epiviz.datatypes.GenomicRange(d,a.start(),a.width(),a.genome()))})};
epiviz.ui.ControlManager.prototype._initializeLocationTextbox=function(){var a=this;$("#text-location").keypress(function(b){if(13!=b.which)return!0;try{var c=$(this).val().split("-"),d=Globalize.parseInt(c[0]),e=Globalize.parseInt(c[1]),f=a._locationManager.lastUnfilledLocationChangeRequest()||a._locationManager.currentLocation();a._updateSelectedLocation(epiviz.datatypes.GenomicRange.fromStartEnd(f.seqName(),d,e,f.genome()));return!0}catch(g){return!1}})};
epiviz.ui.ControlManager.prototype._initializeNavigationButtons=function(){var a=this;$("#moveright").button({icons:{primary:"ui-icon ui-icon-seek-next"},text:!1}).click(function(){var b=a._locationManager.lastUnfilledLocationChangeRequest()||a._locationManager.currentLocation(),c=b.start()+Math.round(b.width()*a._stepRatio);a._updateSelectedLocation(new epiviz.datatypes.GenomicRange(b.seqName(),c,b.width(),b.genome()))});$("#moveleft").button({icons:{primary:"ui-icon ui-icon-seek-prev"},text:!1}).click(function(){var b=
a._locationManager.lastUnfilledLocationChangeRequest()||a._locationManager.currentLocation(),c=b.start()-Math.round(b.width()*a._stepRatio);a._updateSelectedLocation(new epiviz.datatypes.GenomicRange(b.seqName(),c,b.width(),b.genome()))})};
epiviz.ui.ControlManager.prototype._initializeZoomButtons=function(){var a=this,b=$("#zoomin");b.button({icons:{primary:"ui-icon ui-icon-zoomin"},text:!1});var c=$("#zoomout");c.button({icons:{primary:"ui-icon ui-icon-zoomout"},text:!1});var d=function(b){var c=a._locationManager.lastUnfilledLocationChangeRequest()||a._locationManager.currentLocation(),d=c.start()+.5*c.width();b=Math.round(c.width()*b);d=Math.round(d-.5*b);a._updateSelectedLocation(new epiviz.datatypes.GenomicRange(c.seqName(),d,
b,c.genome()))};b.click(function(){d(a._zoominRatio)});c.click(function(){d(a._zoomoutRatio)})};
epiviz.ui.ControlManager.prototype._initializeLocationSettingsDialog=function(){var a=this;$("#location-settings").button({text:!1,icons:{primary:"ui-icon ui-icon-gear"}}).click(function(){$("#location-settings-dialog").dialog("open")});$("#location-settings-dialog").dialog({autoOpen:!1,resizable:!1,width:"300",buttons:{Ok:function(){a._zoominRatio=$("#zoomin-ratio-text").val();a._zoomoutRatio=$("#zoomout-ratio-text").val();a._stepRatio=$("#navigation-step-ratio-text").val();$(this).dialog("close")},
Cancel:function(){$("#zoomin-ratio-text").val(Globalize.format(a._zoominRatio,"n3"));$("#zoomout-ratio-text").val(Globalize.format(a._zoomoutRatio,"n3"));$("#navigation-step-ratio-text").val(Globalize.format(a._stepRatio,"n6"));$(this).dialog("close")}},modal:!0});$("#zoomout-ratio-text").spinner({min:1.001,max:1E3,step:.001,start:1.2,numberFormat:"n3"}).val(a._zoomoutRatio);$("#zoomin-ratio-text").spinner({min:.001,max:.999,step:.01,start:.8,numberFormat:"n3"}).val(a._zoominRatio);$("#navigation-step-ratio-text").spinner({min:1E-6,
max:1,step:1E-6,start:.2,numberFormat:"n6"}).val(a._stepRatio)};
epiviz.ui.ControlManager.prototype._initializeChartMenus=function(){var a=this,b=$("#vis-menu");$("#vis-menu-button").button({text:!1,icons:{primary:"ui-icon ui-icon-scatterplot",secondary:"ui-icon-triangle-1-s"}}).click(function(){var a=b.is(":visible");$(".dropdown-menu").find(">:first-child").hide();a?b.hide():b.show().position({my:"left top",at:"left bottom",of:this});return!1});var c={},d=epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS;this._chartFactory.foreach(function(a,b){b.chartDisplayType()in
c||(c[b.chartDisplayType()]=[]);c[b.chartDisplayType()].push(b)});for(var e in c)c.hasOwnProperty(e)&&($(sprintf('<li class="ui-widget-header">%s</li>',d[e])).appendTo(b),c[e].forEach(function(c,d){var e=sprintf("%s-menu-add-%s",c.chartDisplayType(),c.chartHtmlAttributeName());b.append(sprintf('<li><a href="javascript:void(0)" id="%s">Add New %s</a></li>',e,c.chartName()));$("#"+e).click(function(){var d=[];c.isRestrictedToSameDatasourceGroup()&&d.push(new epiviz.ui.controls.DatasourceGroupWizardStep);
c.chartDisplayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&d.push(new epiviz.ui.controls.MeaurementsWizardStep);if(d.length){var e=a._measurementsManager.measurements().subset(c.measurementsFilter());e.addAll(a._measurementsManager.measurements().map(function(a){return a.datasource()}).subset(c.measurementsFilter()));(new epiviz.ui.controls.Wizard(sprintf("Add new %s",c.chartName()),{finish:function(b){a._addChart.notify({type:c,visConfigSelection:b})}},d,new epiviz.ui.controls.VisConfigSelection(e,
void 0,void 0,void 0,void 0,c.chartName(),c.minSelectedMeasurements()),"750",void 0,c.isRestrictedToSameDatasourceGroup())).show();b.hide()}else a._addChart.notify({type:c,visConfigSelection:new epiviz.ui.controls.VisConfigSelection(a._measurementsManager.measurements().subset(c.measurementsFilter()))})})}));b.hide().menu()};
epiviz.ui.ControlManager.prototype._initializeComputedMeasurementsMenu=function(){var a=this;$("#computed-measurements-button").button({text:!1,icons:{primary:"ui-icon ui-icon-calculator"}}).click(function(){(new epiviz.ui.controls.ComputedMeasurementsDialog("Computed Measurements",{add:function(b){a._measurementsManager.addMeasurement(b)},remove:function(b){a._measurementsManager.removeMeasurement(b)},close:function(){}},a._measurementsManager.measurements(),a._chartManager.chartsMeasurements())).show()})};
epiviz.ui.ControlManager.prototype._initializeHelpButton=function(){$("#help-button").button({text:!1,icons:{primary:"ui-icon ui-icon-help"}}).click(function(){window.open("http://epiviz.github.io/","_blank").focus()})};
epiviz.ui.ControlManager.prototype._initializeTutorials=function(){var a=$("#help-tutorials"),b=new epiviz.ui.tutorials,c='<div class="dropdown-menu"><ul id="tutorial-list"><li class="ui-widget-header">Tutorials</li>';0<b._tutorialList.length?b._tutorialList.forEach(function(a){c+='<li><a href="javascript:void(0);" id="'+a.id+'">'+a.name+"</a></li>"}):c+="<li>No Tutorials available</li>";c+="</ul></div>";$(sprintf(c)).insertAfter(a);var d=$("#tutorial-list");d.hide().menu();a.button({icons:{primary:"ui-icon ui-icon-info",
secondary:"ui-icon-triangle-1-s"},text:!1}).click(function(){d.is(":visible")?d.hide():d.show().position({my:"left top",at:"left bottom",of:this});return!1});0<b._tutorialList.length&&b._tutorialList.forEach(function(a){$("#"+a.id).click(function(){(new Anno(a.tutorial)).show();d.hide()})})};
epiviz.ui.ControlManager.prototype._initializeScreenshotMenu=function(){var a=this,b=$("#save-page");b.button({icons:{primary:"ui-icon ui-icon-print"},text:!1}).click(function(){var c=$("#save-workspace-text").val();a._saveWorkspace.notify({name:c,id:c==a._activeWorkspaceInfo.name?a._activeWorkspaceInfo.id:null});b.append(sprintf('<div id="loading" title="printing workspace"><p>Save/Print the existing EpiViz workspace.</p><div style="position:absolute; right:15px;"><select class="screenshot-file-format"><option value="pdf" selected="selected">PDF</option><option value="png" >PNG</option></select></div></div>'));
b.find("#loading").dialog({resizable:!1,modal:!0,title:"Print workspace as image",buttons:{Print:function(){$(this).dialog("close");var b=$(".screenshot-file-format option:selected").val(),c=Math.floor($.now()/1E3);(new epiviz.ui.PrintManager("pagemain","epiviz_"+c,b,a._activeWorkspaceInfo.id)).print();$(this).dialog("destroy").remove()},cancel:function(){$(this).dialog("destroy").remove()}}}).show()})};
epiviz.ui.ControlManager.prototype._initializeSearchBox=function(){var a=this,b=$("#search-box");b.watermark("Find Gene/Probe");b.autocomplete({source:function(b,d){a._search.notify({searchTerm:b.term,callback:function(a){for(var b=[],c=0;c<a.length;++c)b.push({value:a[c].probe||a[c].gene,label:a[c].probe||a[c].gene,html:a[c].probe?sprintf("<b>%s</b>, %s, [%s: %s - %s]",a[c].probe,a[c].gene,a[c].seqName,Globalize.format(a[c].start,"n0"),Globalize.format(a[c].end,"n0")):sprintf("<b>%s</b>, [%s: %s - %s]",
a[c].gene,a[c].seqName,Globalize.format(a[c].start,"n0"),Globalize.format(a[c].end,"n0")),range:epiviz.datatypes.GenomicRange.fromStartEnd(a[c].seqName,a[c].start,a[c].end)});d(b)}})},minLength:1,select:function(b,d){a._locationManager.lastUnfilledLocationChangeRequest()||a._locationManager.currentLocation();var c=d.item.range.seqName(),f=Math.round(d.item.range.start()-11*d.item.range.width()),g=22*d.item.range.width();a._updateSelectedLocation(new epiviz.datatypes.GenomicRange(c,f,g))},focus:function(a){a.preventDefault()},
open:function(){},close:function(){}}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append(sprintf("<a>%s</a>",b.html)).appendTo(a)}};
epiviz.ui.ControlManager.prototype._initializeWorkspaceSaving=function(){var a=this,b=$("#save-workspace-text"),c=$("#save-workspace-button"),d=$("#revert-workspace-button"),e=$("#delete-workspace-button");c.button({text:!1,icons:{primary:"ui-icon-disk"}}).click(function(){var c=null;try{var d=b.val();/[a-zA-Z0-9_\s]+/g.exec(d)==d?epiviz.workspaces.UserManager.USER_STATUS.loggedIn?a._saveWorkspace.notify({name:d,id:d==a._activeWorkspaceInfo.name?a._activeWorkspaceInfo.id:null}):(c=new epiviz.ui.controls.MessageDialog("User not logged in",
{Yes:function(){a._loginLinkClicked.notify()},No:function(){}},"You need to log in in order to save the workspace. Do you wish to log in now?",epiviz.ui.controls.MessageDialog.Icon.QUESTION),c.show()):(c=new epiviz.ui.controls.MessageDialog("Invalid workspace name",{Ok:function(){$(this).remove()}},"Invalid workspace name: "+d,epiviz.ui.controls.MessageDialog.Icon.ERROR),c.show())}catch(h){c=new epiviz.ui.controls.MessageDialog("Error",{ok:function(){$(this).remove()}},"An error occurred while trying to save workspace: "+
h.message,epiviz.ui.controls.MessageDialog.Icon.ERROR),c.show()}});e.button({text:!1,icons:{primary:"ui-icon-trash"}}).click(function(b){epiviz.workspaces.UserManager.USER_STATUS.loggedIn&&(new epiviz.ui.controls.MessageDialog("Delete active workspace",{Yes:function(){a._deleteActiveWorkspace.notify()},No:function(){}},"Are you sure you want to delete the active workspace?",epiviz.ui.controls.MessageDialog.Icon.QUESTION)).show()});d.button({text:!1,icons:{primary:"ui-icon-arrowreturnthick-1-w"}}).click(function(b){(new epiviz.ui.controls.MessageDialog("Delete active workspace",
{Yes:function(){a._revertActiveWorkspace.notify()},No:function(){}},"Are you sure you want to revert the changes on the active workspace?",epiviz.ui.controls.MessageDialog.Icon.QUESTION)).show()});b.watermark("Save Workspace Name");b.autocomplete({source:function(b,c){a._searchWorkspaces.notify({searchTerm:b.term,callback:function(a){for(var b=[],d=0;d<a.length;++d)b.push({value:a[d].id,label:a[d].name,html:sprintf("<b>%s</b> %s",a[d].name,a[d].id||"")});c(b)}})},minLength:0,select:function(c,d){c.preventDefault();
a.updateSelectedWorkspace({id:d.item.value||b.val(),name:d.item.label})},focus:function(a){a.preventDefault()},open:function(){},close:function(){}}).data("autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append(sprintf("<a>%s</a>",b.html)).appendTo(a)};b.click(function(){b.autocomplete("search","")})};epiviz.ui.ControlManager.prototype._initializeLoginLink=function(){var a=this;$("#login-link").live({click:function(){a._loginLinkClicked.notify()}})};
epiviz.ui.ControlManager.prototype._initializeLayout=function(){$("body").layout({applyDefaultStyles:!0,east__size:390,east__minSize:390,east__initHidden:!0,north__resizable:!1,north__initHidden:!1,south__initHidden:!0,east__initClosed:!0})};
epiviz.ui.ControlManager.prototype._checkBrowserCompatibility=function(){0<epiviz.utils.getInternetExplorerVersion()&&(new epiviz.ui.controls.MessageDialog("Browser compatibility warning",{Ok:function(){}},"EpiViz works best on Google Chrome, Apple Safari or Mozilla Firefox. Please open it using one of those browsers.",epiviz.ui.controls.MessageDialog.Icon.ERROR)).show()};epiviz.ui.ControlManager.prototype._registerLocationChanged=function(){var a=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(b){a._updateSelectedLocation(b.newValue)}))};
epiviz.ui.ControlManager.prototype._registerSeqInfosUpdated=function(){var a=this;this._locationManager.onSeqInfosUpdated().addListener(new epiviz.events.EventListener(function(b){a._updateSeqNames(b)}))};epiviz.ui.controls.SaveSvgAsImageDialog=function(a,b,c){epiviz.ui.controls.Dialog.call(this,"Save Chart SVG as Image",a);this._dialog=$("#"+this._id);this._dialog.append('<div class="save-svg-dialog"><label class="dialog-label">Choose file format:</label><br/><br/><div style="position:absolute; right:15px;"><select class="svg-file-format"><option value="pdf" selected="selected">PDF</option><option value="ps" >PS</option><option value="png" >PNG</option><option value="svg">SVG</option><option value="eps">EPS</option></select></div>'+
sprintf('<form name="%s-svg-save-form" method="POST">',this._id)+'<div><input type="hidden" name="svg" /><input type="hidden" name="format" /><br/><br/></div></form></div>');this._chartId=b;this._chartSaverLocation=c;var d=this;this._dialog.dialog({autoOpen:!1,resizable:!1,width:"200",buttons:{Ok:function(){var a=$("#"+d._chartId).find("svg").clone();a.attr("xmlns","http://www.w3.org/2000/svg");a.attr("version","1.1");var b=d._dialog.find(".svg-file-format"),c=document.forms[sprintf("%s-svg-save-form",
d._id)];c.action=d._chartSaverLocation;c.svg.value=$("<div>").append(a).html();c.format.value=b.val();c.submit();d._handlers.ok();$(this).dialog("close")},Cancel:function(){d._handlers.cancel();$(this).dialog("close")}},modal:!0})};epiviz.ui.controls.SaveSvgAsImageDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.SaveSvgAsImageDialog.constructor=epiviz.ui.controls.SaveSvgAsImageDialog;
epiviz.ui.controls.SaveSvgAsImageDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var a=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(b,c){$(this).remove();a._dialog=null}}))};epiviz.ui.charts.decoration={};epiviz.ui.charts.decoration.VisualizationDecoration=function(a,b,c){this._visualization=a;this._otherDecoration=b;this._config=c};epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate=function(){this._otherDecoration&&this._otherDecoration.decorate()};epiviz.ui.charts.decoration.VisualizationDecoration.prototype.visualization=function(){return this._visualization};epiviz.ui.charts.decoration.VisualizationDecoration.prototype.otherDecoration=function(){return this._otherDecoration};
epiviz.ui.charts.decoration.VisualizationDecoration.prototype.config=function(){return this._config};epiviz.ui.charts.decoration.ChartOptionButton=function(a,b,c){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b,c);this.isChartOptionButton=!0};epiviz.ui.charts.decoration.ChartOptionButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.decoration.ChartOptionButton.constructor=epiviz.ui.charts.decoration.ChartOptionButton;
epiviz.ui.charts.decoration.ChartOptionButton.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);if(this.isChartOptionButton){for(var a=0,b=this.otherDecoration();b;b=b.otherDecoration())b.isChartOptionButton&&++a;var c=$(sprintf('<button style="position: absolute; top: 5px; right: %spx">%s</button>',5+30*a,this._text())).appendTo(this.visualization().container()).button(this._renderOptions()).click(this._click());this.visualization().container().mousemove(function(){c.show()}).mouseleave(function(){c.hide()})}};
epiviz.ui.charts.decoration.ChartOptionButton.prototype._click=function(){return function(){}};epiviz.ui.charts.decoration.ChartOptionButton.prototype._renderOptions=function(){return{}};epiviz.ui.charts.decoration.ChartOptionButton.prototype._text=function(){return""};epiviz.ui.charts.decoration.RemoveChartButton=function(a,b){epiviz.ui.charts.decoration.ChartOptionButton.call(this,a,b)};epiviz.ui.charts.decoration.RemoveChartButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype);epiviz.ui.charts.decoration.RemoveChartButton.constructor=epiviz.ui.charts.decoration.RemoveChartButton;epiviz.ui.charts.decoration.RemoveChartButton.prototype._click=function(){var a=this;return function(){a.visualization().onRemove().notify(new epiviz.ui.charts.VisEventArgs(a.visualization().id()))}};
epiviz.ui.charts.decoration.RemoveChartButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-cancel"},text:!1}};epiviz.ui.charts.decoration.RemoveChartButton.prototype._text=function(){return"Remove"};epiviz.ui.charts.decoration.SaveChartButton=function(a,b){epiviz.ui.charts.decoration.ChartOptionButton.call(this,a,b)};epiviz.ui.charts.decoration.SaveChartButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype);epiviz.ui.charts.decoration.SaveChartButton.constructor=epiviz.ui.charts.decoration.SaveChartButton;epiviz.ui.charts.decoration.SaveChartButton.prototype._click=function(){var a=this;return function(){a.visualization().onSave().notify(new epiviz.ui.charts.VisEventArgs(a.visualization().id()))}};
epiviz.ui.charts.decoration.SaveChartButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-disk"},text:!1}};epiviz.ui.charts.decoration.SaveChartButton.prototype._text=function(){return"Save"};epiviz.ui.controls.CustomSettingsDialog=function(a,b,c,d){epiviz.ui.controls.Dialog.call(this,a,b);this._customSettingsDefs=c;this._customSettingsValues=epiviz.utils.mapCopy(d)};epiviz.ui.controls.CustomSettingsDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.CustomSettingsDialog.constructor=epiviz.ui.controls.CustomSettingsDialog;
epiviz.ui.controls.CustomSettingsDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var a=epiviz.ui.charts.CustomSetting.Type;if(!this._dialog){var b=this;this._dialog=$("#"+this._id);this._dialog.css("display","inline");var c,d,e,f,g="";for(c=0;c<this._customSettingsDefs.length;++c){d=sprintf("%s-%s",this._id,this._customSettingsDefs[c].id);var h=sprintf('<tr><td><label for="%s">%s</label></td><td style="text-align: right;">%%s</td></tr>',d,this._customSettingsDefs[c].label);
e=null;f=this._customSettingsValues[this._customSettingsDefs[c].id];switch(this._customSettingsDefs[c].type){case a.BOOLEAN:h=sprintf(h,sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',d,f?'checked="checked"':"",f?"":'checked="checked"'));break;case a.ARRAY:h=sprintf(h,sprintf('<input id="%s" value="%s" class="ui-widget-content ui-corner-all" style="text-align: right; padding: 5px;" />',
d,f.join(",")));break;case a.NUMBER:case a.STRING:h=sprintf(h,sprintf('<input id="%s" value="%s" class="ui-widget-content ui-corner-all" style="text-align: right; padding: 5px;" />',d,f));break;case a.CATEGORICAL:case a.MEASUREMENTS_METADATA:case a.MEASUREMENTS_ANNOTATION:var m="",l=this._customSettingsDefs[c];if(l.possibleValues)for(var p=0;p<l.possibleValues.length;++p)m+=sprintf('<option value="%1$s"%2$s>%1$s</option>',l.possibleValues[p],l.possibleValues[p]==f?'selected="selected"':"");f=sprintf('<select id="%s">%s</select>',
d,m);h=sprintf(h,f)}g+=h}g=sprintf('<div style="margin: 5px; padding: 5px; height: auto;"><table style="width: 100%%;">%s</table></div>',g);this._dialog.append(g);for(c=0;c<this._customSettingsDefs.length;++c)switch(d=sprintf("%s-%s",this._id,this._customSettingsDefs[c].id),e=$("#"+d),f=this._customSettingsValues[this._customSettingsDefs[c].id],this._customSettingsDefs[c].type){case a.BOOLEAN:e.buttonset();break;case a.NUMBER:case a.ARRAY:case a.STRING:e.watermark(this._customSettingsDefs[c].label);
break;case a.CATEGORICAL:case a.MEASUREMENTS_METADATA:case a.MEASUREMENTS_ANNOTATION:e.selectmenu()}this._dialog.dialog({autoOpen:!1,resizable:!1,buttons:{Ok:function(){for(var c=0;c<b._customSettingsDefs.length;++c){d=sprintf("%s-%s",b._id,b._customSettingsDefs[c].id);e=$("#"+d);var f=null;if(e.val()==epiviz.ui.charts.CustomSetting.DEFAULT)f=b._customSettingsDefs[c].defaultValue;else{var g=null;try{switch(b._customSettingsDefs[c].type){case a.BOOLEAN:var h=$("#"+d+" :radio:checked").attr("id"),f=
"true"==h.substr(h.lastIndexOf("-")+1);break;case a.NUMBER:f=e.val()==epiviz.ui.charts.CustomSetting.DEFAULT?b._customSettingsDefs[c].defaultValue:parseFloat(e.val());if(isNaN(f)){g=new epiviz.ui.controls.MessageDialog("Invalid property value",{Ok:function(){}},sprintf('Invalid value for setting "%s" (%s)',b._customSettingsDefs[c].label,b._customSettingsDefs[c].id),epiviz.ui.controls.MessageDialog.Icon.ERROR);g.show();return}break;case a.ARRAY:f=e.val().split(/[\s,]+/g);break;case a.STRING:case a.CATEGORICAL:case a.MEASUREMENTS_METADATA:case a.MEASUREMENTS_ANNOTATION:f=
e.val()}}catch(u){g=new epiviz.ui.controls.MessageDialog("Invalid property value",{Ok:function(){}},sprintf('Invalid value for setting "%s" (%s)',b._customSettingsDefs[c].label,b._customSettingsDefs[c].id),epiviz.ui.controls.MessageDialog.Icon.ERROR);g.show();return}}b._customSettingsValues[b._customSettingsDefs[c].id]=f}b._handlers.ok(b._customSettingsValues);$(this).dialog("close")},Cancel:function(){b._handlers.cancel();$(this).dialog("close")}},modal:!0});this._dialog.dialog({close:function(a,
c){$(this).remove();b._dialog=null}})}this._dialog.dialog("open");this._dialog.dialog("option","position","center")};epiviz.ui.charts.decoration.CustomSettingsButton=function(a,b){epiviz.ui.charts.decoration.ChartOptionButton.call(this,a,b)};epiviz.ui.charts.decoration.CustomSettingsButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype);epiviz.ui.charts.decoration.CustomSettingsButton.constructor=epiviz.ui.charts.decoration.CustomSettingsButton;
epiviz.ui.charts.decoration.CustomSettingsButton.prototype._click=function(){var a=this;return function(){(new epiviz.ui.controls.CustomSettingsDialog("Edit custom settings",{ok:function(b){a.visualization().setCustomSettingsValues(b)},cancel:function(){}},a.visualization().properties().customSettingsDefs,a.visualization().customSettingsValues())).show()}};epiviz.ui.charts.decoration.CustomSettingsButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-gear"},text:!1}};
epiviz.ui.charts.decoration.CustomSettingsButton.prototype._text=function(){return"Custom settings"};epiviz.ui.controls.CodeDialog=function(a,b,c){epiviz.ui.controls.Dialog.call(this,a,b);this._controlCreators=c;this._dialog=$("#"+this._id);this._controls=[];var d=this;this._dialog.append('<div class="code-tabs"><ul></ul></div>');var e=this._dialog.find(".code-tabs"),f=e.find("ul");this._controlCreators.forEach(function(a,b){var c=d._id+"-code-tab-"+b;e.append(sprintf('<div id="%s"></div>',c));var g=e.find("#"+c),g=a(g);f.append(sprintf('<li><a href="#%s">%s</a></li>',c,g.title()));d._controls.push(g)});
e.tabs({activate:function(a,b){d._tabActivate(e)}});this._dialog.dialog({autoOpen:!1,resizable:!1,width:"800",buttons:{Save:function(){var a=[];d._controls.forEach(function(b){b.save();a.push(b.result())});d._handlers.save(a);$(this).dialog("close")},Cancel:function(){d._controls.forEach(function(a){a.revert()});d._handlers.cancel();$(this).dialog("close")}},modal:!0});this._dialog.dialog("option","position","center")};epiviz.ui.controls.CodeDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);
epiviz.ui.controls.CodeDialog.constructor=epiviz.ui.controls.CodeDialog;epiviz.ui.controls.CodeDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);this._dialog.dialog("open");this._controls[0].initialize();this._dialog.dialog("option","position","center")};epiviz.ui.controls.CodeDialog.prototype._tabActivate=function(a){a=a.tabs("option","active");this._controls[a].initialize();this._dialog.dialog("option","position","center")};epiviz.ui.charts.decoration.CodeButton=function(a,b,c){epiviz.ui.charts.decoration.ChartOptionButton.call(this,a,b,c);this.isCodeButton=!0;this._controlCreators=[];a=!0;var d;for(b=this.otherDecoration();b;b=b.otherDecoration())b.isCodeButton&&(a=!1,d=b);d&&d._addControlCreator(this._controlCreator(),this._saveHandler(),this._cancelHandler());(this.isChartOptionButton=a)&&this._addControlCreator(this._controlCreator(),this._saveHandler(),this._cancelHandler())};
epiviz.ui.charts.decoration.CodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype);epiviz.ui.charts.decoration.CodeButton.constructor=epiviz.ui.charts.decoration.CodeButton;
epiviz.ui.charts.decoration.CodeButton.prototype._click=function(){var a=this;return function(){(new epiviz.ui.controls.CodeDialog("Chart Code",{save:function(b){b.forEach(function(b,d){a._controlCreators[d].save(b)})},cancel:function(){a._controlCreators.forEach(function(a){a.cancel()})}},a._controlCreators.map(function(a){return a.creator}))).show()}};epiviz.ui.charts.decoration.CodeButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-pencil"},text:!1}};
epiviz.ui.charts.decoration.CodeButton.prototype._text=function(){return"Code"};epiviz.ui.charts.decoration.CodeButton.prototype._addControlCreator=function(a,b,c){this._controlCreators.push({creator:a,save:b,cancel:c})};epiviz.ui.charts.decoration.CodeButton.prototype._controlCreator=function(){return null};epiviz.ui.charts.decoration.CodeButton.prototype._saveHandler=function(){return null};epiviz.ui.charts.decoration.CodeButton.prototype._cancelHandler=function(){return null};epiviz.ui.controls.CodeControl=function(a,b,c,d){epiviz.ui.controls.Control.call(this,a,b,c);this._targetObj=d;this._text="// TODO: Your code here\n"};epiviz.ui.controls.CodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Control.prototype);epiviz.ui.controls.CodeControl.constructor=epiviz.ui.controls.CodeControl;epiviz.ui.controls.CodeControl.prototype.initialize=function(){};epiviz.ui.controls.CodeControl.prototype.save=function(){};epiviz.ui.controls.CodeControl.prototype.revert=function(){};
epiviz.ui.controls.CodeControl.prototype.text=function(){return this._text};epiviz.ui.controls.CodeControl.prototype.result=function(){return null};epiviz.ui.controls.EditCodeControl=function(a,b,c,d,e,f){epiviz.ui.controls.CodeControl.call(this,a,b,c,d);this._defaultMethod=e;this._editor=null;this._methodsCode={};this._selectedMethod=null;this._hasModifiedMethods=f||!1};epiviz.ui.controls.EditCodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.CodeControl.prototype);epiviz.ui.controls.EditCodeControl.constructor=epiviz.ui.controls.EditCodeControl;
epiviz.ui.controls.EditCodeControl.prototype.initialize=function(){if(!this._editor){this._container.append('<div style="float: left; margin-right: 5px;"><select class="obj-methods"></select></div>'+sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',this.id()+"-switch",this._hasModifiedMethods?'checked="checked"':"",this._hasModifiedMethods?
"":'checked="checked"')+'<br /><div style="overflow-y: scroll; max-height: 500px;"><textarea autofocus="autofocus" class="code-edit"></textarea></div>');this._methodsSelector=this._container.find(".obj-methods");var a=this._container.find("#"+this.id()+"-switch");a.buttonset();var b=this,c=function(a){a=$("#"+b.id()+"-switch :radio:checked").attr("id");a="true"==a.substr(a.lastIndexOf("-")+1);b._editor&&b._editor.setOption("disableInput",!a);b._hasModifiedMethods=a};a.find("#"+this.id()+"-switch-true").on("change",
c);a.find("#"+this.id()+"-switch-false").on("change",c);var d=this._container.find(".code-edit"),a=[],c=this._targetObj,e;for(e in c)$.isFunction(c[e])&&a.push(e);a.sort();for(var f=0;f<a.length;++f){e=a[f];var g=0==f&&!this._defaultMethod||this._defaultMethod==e;this._methodsSelector.append(sprintf('<option value="%s"%s>%s</option>',e,g?' selected="selected"':"",e));g&&(this._text=c[e].toString(),this._selectedMethod=e)}this._methodsSelector.change(function(){b._methodsCode[b._selectedMethod]=b._editor.getValue();
var a=$(this).val(),c=b._methodsCode[a];c||(c=b._targetObj[a].toString(),b._methodsCode[a]=c);b._text=c;b._editor?b._editor.getDoc().setValue(b._text):d.val(b._text);b._selectedMethod=a});d.val(this._text);this._methodsSelector.selectmenu({style:"popup",width:"150",maxHeight:"150",menuWidth:"150"});this._editor=CodeMirror.fromTextArea(this._container.find(".code-edit")[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0});this._editor.setOption("disableInput",
!this._hasModifiedMethods)}};epiviz.ui.controls.EditCodeControl.prototype.save=function(){this._methodsCode[this._selectedMethod]=this._editor.getValue();this._text=this._editor.getValue()};epiviz.ui.controls.EditCodeControl.prototype.revert=function(){this._editor&&this._editor.setOption("value",this._text)};
epiviz.ui.controls.EditCodeControl.prototype.modifiedMethods=function(){var a={},b;for(b in this._methodsCode)this._methodsCode.hasOwnProperty(b)&&this._methodsCode[b]!=this._targetObj[b].toString()&&(a[b]=this._methodsCode[b]);return a};epiviz.ui.controls.EditCodeControl.prototype.result=function(){return{hasModifiedMethods:this._hasModifiedMethods,modifiedMethods:this._hasModifiedMethods?this.modifiedMethods():{}}};epiviz.ui.charts.decoration.EditCodeButton=function(a,b,c){epiviz.ui.charts.decoration.CodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.EditCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.CodeButton.prototype);epiviz.ui.charts.decoration.EditCodeButton.constructor=epiviz.ui.charts.decoration.EditCodeButton;
epiviz.ui.charts.decoration.EditCodeButton.prototype._controlCreator=function(){var a=this;return function(b){return new epiviz.ui.controls.EditCodeControl(b,"Edit Code",null,a.visualization(),a.visualization().lastModifiedMethod(),a.visualization().hasModifiedMethods())}};epiviz.ui.charts.decoration.EditCodeButton.prototype._saveHandler=function(){var a=this;return function(b){b.hasModifiedMethods?a.visualization().setModifiedMethods(b.modifiedMethods):a.visualization().resetModifiedMethods()}};
epiviz.ui.charts.decoration.EditCodeButton.prototype._cancelHandler=function(){return function(){}};epiviz.ui.controls.ColorPickerDialog=function(a,b,c,d){epiviz.ui.controls.Dialog.call(this,"Pick Colors",a);this._dialog=$("#"+this._id);this._dialog.append('<div class="color-picker-form" action="" style="width: 420px;"><div class="chart-picker" style="float: right;"></div></div>');var e=this._dialog.find(".color-picker-form");a="";for(var f=0;f<b.length;++f){var g=sprintf("color-%s",f);a+=sprintf('<tr><td><label>%s:&nbsp;</label></td><td><input type="text" name="%s" class="colorwell %s" value="%s" /></td></tr>',
b[f],g,g,0<=d.keyColorIndex(b[f])?d.getByKey(b[f]):d.get(f))}e.append(sprintf('<table class="color-picker-table">%s</table>',a));var h=$.farbtastic(sprintf("#%s .chart-picker",this._id)),m=$(sprintf("#%s .chart-picker",this._id)).css("opacity",.25),l;$(sprintf("#%s .colorwell",this._id)).each(function(){h.linkTo(this);$(this).css("opacity",.75)}).focus(function(){l&&$(l).css("opacity",.75).removeClass("colorwell-selected");h.linkTo(this);m.css("opacity",1);$(l=this).css("opacity",1).addClass("colorwell-selected")});
e.append('<select class="palettes-selector"></select>');var p=e.find(".palettes-selector"),n={};c&&c.forEach(function(a){p.append(sprintf('<option value="%s"%s>%s</option>',a.id(),a.id()==d.id()?' selected="selected"':"",a.name()));n[a.id()]=a});d.id()in n||(p.prepend(sprintf('<option value="%s" selected="selected">%s</option>',d.id(),d.name())),n[d.id()]=d);p.selectmenu({style:"popup",width:"200",maxHeight:"150",menuWidth:"200"});var t=function(){for(var a=e.find(".colorwell"),b=0;b<a.length;++b)h.linkTo($(a[b])),
h.setColor(d.get(b));l&&h.linkTo(l)};p.change(function(){d=n[$(this).val()];t()});var v=this;this._dialog.dialog({autoOpen:!1,resizable:!1,width:"440",buttons:{Ok:function(){var a=e.find(".colorwell"),c=!1,f=[],g;for(g=0;g<d.size();++g)f.push(d.get(g));for(g=0;g<a.length;++g){var h=a[g].value,l=d.keyColorIndex(b[g]);0>l&&(l=g);h!=f[l]&&(c=!0,f[l]=h)}c&&(d=new epiviz.ui.charts.ColorPalette(f,void 0,void 0,d.keyIndices()));v._handlers.ok(d);$(this).dialog("close")},Cancel:function(){v._handlers.cancel();
$(this).dialog("close")},Reset:function(){t();v._handlers.reset()}},modal:!0})};epiviz.ui.controls.ColorPickerDialog.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.Dialog.prototype);epiviz.ui.controls.ColorPickerDialog.constructor=epiviz.ui.controls.ColorPickerDialog;
epiviz.ui.controls.ColorPickerDialog.prototype.show=function(){epiviz.ui.controls.Dialog.prototype.show.call(this);var a=this;this._dialog&&(this._dialog.dialog("open"),this._dialog.dialog("option","position","center"),this._dialog.dialog({close:function(b,c){$(this).remove();a._dialog=null}}))};epiviz.ui.charts.decoration.ChartColorsButton=function(a,b,c){epiviz.ui.charts.decoration.ChartOptionButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartColorsButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.ChartOptionButton.prototype);epiviz.ui.charts.decoration.ChartColorsButton.constructor=epiviz.ui.charts.decoration.ChartColorsButton;
epiviz.ui.charts.decoration.ChartColorsButton.prototype._click=function(){var a=this;return function(){var b=a.visualization().colorLabels();(new epiviz.ui.controls.ColorPickerDialog({ok:function(b){a.visualization().setColors(b)},cancel:function(){},reset:function(){}},b,a.config().colorPalettes,a.visualization().colors())).show()}};epiviz.ui.charts.decoration.ChartColorsButton.prototype._renderOptions=function(){return{icons:{primary:"ui-icon ui-icon-colorpicker"},text:!1}};
epiviz.ui.charts.decoration.ChartColorsButton.prototype._text=function(){return"Colors"};epiviz.ui.charts.decoration.ChartLoaderAnimation=function(a,b){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b);this._loaderTimeout=0;this._animationShowing=!1};epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.decoration.ChartLoaderAnimation.constructor=epiviz.ui.charts.decoration.ChartLoaderAnimation;
epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);var a=this;this.visualization().onDataWaitStart().addListener(new epiviz.events.EventListener(function(){a._addLoaderAnimation()}));this.visualization().onDataWaitEnd().addListener(new epiviz.events.EventListener(function(){a._removeLoaderAnimation()}));this.visualization().onSizeChanged().addListener(new epiviz.events.EventListener(function(){a._animationShowing&&
a._addLoaderAnimation()}))};
epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype._addLoaderAnimation=function(){this._loaderTimeout&&clearTimeout(this._loaderTimeout);var a=function(){b._animationShowing=!0;var a=b.visualization(),d=a.container();d.find(".chart-loader").remove();d.append(sprintf('<div class="loader-icon %s" style="top: %spx; left: %spx;"></div>',"chart-loader",Math.floor(.5*a.height()),Math.floor(.5*a.width())));d.find(".chart-loader").activity({segments:8,steps:5,opacity:.3,width:4,space:0,length:10,
color:"#0b0b0b",speed:1})},b=this;this._animationShowing?a():this._loaderTimeout=setTimeout(a,500)};epiviz.ui.charts.decoration.ChartLoaderAnimation.prototype._removeLoaderAnimation=function(){this._loaderTimeout&&clearTimeout(this._loaderTimeout);this._animationShowing=!1;this.visualization().container().find(".chart-loader").remove()};epiviz.ui.charts.decoration.ChartResize=function(a,b){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b)};epiviz.ui.charts.decoration.ChartResize.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.decoration.ChartResize.constructor=epiviz.ui.charts.decoration.ChartResize;
epiviz.ui.charts.decoration.ChartResize.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);var a=this;this.visualization().container().resizable({stop:function(b,c){a.visualization().updateSize()}})};epiviz.ui.charts.decoration.ToggleTooltipButton=function(a,b){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b);this.isChartOptionButton=!0;this._checked=!1};epiviz.ui.charts.decoration.ToggleTooltipButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.decoration.ToggleTooltipButton.constructor=epiviz.ui.charts.decoration.ToggleTooltipButton;
epiviz.ui.charts.decoration.ToggleTooltipButton.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var a=0,b=this.otherDecoration();b;b=b.otherDecoration())b.isChartOptionButton&&++a;var c=this,b=sprintf("%s-tooltip-button",this.visualization().id());this.visualization().container().append(sprintf('<div id="%1$s-container" style="position: absolute; top: 5px; right: %2$spx"><input type="checkbox" id="%1$s" %3$s /><label for="%1$s" >Toggle tooltip</label></div>',
b,5+30*a,this._checked?'checked="checked"':""));var d=$("#"+b),e=$("#"+b+"-container");d.button({text:!1,icons:{primary:"ui-icon-comment"}}).click(function(){c._checked=d.is(":checked")});this.visualization().container().mousemove(function(){e.show()}).mouseleave(function(){e.hide()})};epiviz.ui.charts.decoration.ToggleTooltipButton.prototype.checked=function(){return this._checked};epiviz.ui.charts.decoration.ChartTooltip=function(a,b){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b)};epiviz.ui.charts.decoration.ChartTooltip.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.decoration.ChartTooltip.constructor=epiviz.ui.charts.decoration.ChartTooltip;
epiviz.ui.charts.decoration.ChartTooltip.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var a=void 0,b=this.otherDecoration();b;b=b.otherDecoration())if(b.constructor==epiviz.ui.charts.decoration.ToggleTooltipButton){a=b;break}var c=this;this.visualization().container().tooltip({items:".item",content:function(){if(!a.checked())return!1;var b=d3.select(this).data()[0];return b.valueItems[0].length>b.measurements.length+b.measurements[0].metadata().length?
c._horizontalContent(b):c._verticalContent(b)},track:!0,show:!1})};
epiviz.ui.charts.decoration.ChartTooltip.prototype._horizontalContent=function(a){for(var b=a.measurements[0].metadata(),c=sprintf("%s%s%s",void 0!=a.start&&void 0!=a.end?"<th><b>Start</b></th><th><b>End</b></th>":"",b?"<th><b>"+b.join("</b></th><th><b>")+"</b></th>":"",a.values?"<th><b>"+a.measurements.join("</b></th><th><b>")+"</b></th>":""),d="",e=0;e<a.valueItems[0].length&&10>e;++e){var f="",g=a.valueItems[0][e].rowItem,h=Globalize.format(g.start(),"n0"),m=Globalize.format(g.end(),"n0");void 0!=
h&&void 0!=m&&(f+=sprintf("<td>%s</td><td>%s</td>",h,m));g=g.rowMetadata();if(b&&g)for(h=0;h<b.length;++h)m=g[b[h]]||"",f+=sprintf("<td>%s</td>",15>=m.length?m:m.substr(0,15)+"...");if(a.values)for(g=0;g<a.measurements.length;++g)f+=sprintf("<td>%s</td>",Globalize.format(a.valueItems[g][e].value,"n3"));d+=sprintf("<tr>%s</tr>",f)}e<a.valueItems[0].length&&(d+=sprintf('<tr><td colspan="%s" style="text-align: center;">...</td></tr>',2+(b?b.length:0)+(a.values?a.measurements.length:0)));return sprintf('<table class="tooltip-table"><thead><tr>%s</tr></thead><tbody>%s</tbody></table>',
c,d)};
epiviz.ui.charts.decoration.ChartTooltip.prototype._verticalContent=function(a){var b=[],c=[0,0];if(void 0!=a.start&&void 0!=a.end){var d=["Start"],e=["End"];a.valueItems[0].every(function(a,b){d.push(Globalize.format(a.rowItem.start(),"n0"));e.push(Globalize.format(a.rowItem.end(),"n0"));return 5>b});b.push(d);b.push(e);c=[0,2]}var f=a.measurements[0].metadata(),g=[c[1],c[1]+f.length];f.forEach(function(c){var d=[c];a.valueItems[0].every(function(a,b){var e=a.rowItem.metadata(c)||"[NA]";15<e.length&&
(e=e.substr(0,15)+"...");d.push(e);return 5>b});b.push(d)});f=[g[1],g[1]];a.values&&(f=[g[1],g[1]+a.measurements.length],a.measurements.forEach(function(c,d){var e=[c.name()];a.valueItems[d].every(function(a,b){e.push(Globalize.format(a.value,"n3"));return 5>b});b.push(e)}));var h=f[1];10<h&&(c[1]=1,g[1]=Math.min(g[1],g[0]+4),h=c[1]-c[0]+g[1]-g[0]+f[1]-f[0],10<h&&(f[1]-=h-10));var h="",m;for(m=c[0];m<c[1];++m)h+="<tr><td><b>"+b[m][0]+"</b></td><td>"+b[m].slice(1).join("</td><td>")+"</td></tr>";for(m=
g[0];m<g[1];++m)h+="<tr><td><b>"+b[m][0]+"</b></td><td>"+b[m].slice(1).join("</td><td>")+"</td></tr>";for(m=f[0];m<f[1];++m)h+="<tr><td><b>"+b[m][0]+"</b></td><td>"+b[m].slice(1).join("</td><td>")+"</td></tr>";return'<table class="tooltip-table"><tbody>'+h+"</tbody></table>"};epiviz.ui.controls.MarkerCodeControl=function(a,b,c,d,e,f,g){epiviz.ui.controls.CodeControl.call(this,a,b,c,d);this._markEditor=this._editor=null;this._editorText=e;this._markText=f;this._enabled=g||!1};epiviz.ui.controls.MarkerCodeControl.prototype=epiviz.utils.mapCopy(epiviz.ui.controls.CodeControl.prototype);epiviz.ui.controls.MarkerCodeControl.constructor=epiviz.ui.controls.MarkerCodeControl;
epiviz.ui.controls.MarkerCodeControl.prototype.initialize=function(){if(!this._editor){this._container.append(sprintf('<div id="%1$s"><label for="%1$s-true">On</label><input type="radio" id="%1$s-true" name="%1$s" %2$s /><label for="%1$s-false">Off</label><input type="radio" id="%1$s-false" name="%1$s" %3$s /></div>',this.id()+"-switch",this._enabled?'checked="checked"':"",this._enabled?"":'checked="checked"')+'<br /><div><label><b>Pre-mark Method</b></label></div><br /><div style="overflow-y: scroll; max-height: 250px;"><textarea autofocus="autofocus" class="pre-filter-code"></textarea></div><br/><div><label><b>Mark Method</b></label></div><br/><div style="overflow-y: scroll; max-height: 250px;"><textarea autofocus="autofocus" class="filter-code"></textarea></div>');
var a=this._container.find("#"+this.id()+"-switch");a.buttonset();var b=this,c=function(a){a=$("#"+b.id()+"-switch :radio:checked").attr("id");a="true"==a.substr(a.lastIndexOf("-")+1);b._editor&&b._editor.setOption("disableInput",!a);b._markEditor&&b._markEditor.setOption("disableInput",!a);b._enabled=a};a.find("#"+this.id()+"-switch-true").on("change",c);a.find("#"+this.id()+"-switch-false").on("change",c);a=this._container.find(".pre-filter-code");a.val(this._editorText);c=this._container.find(".filter-code");
c.val(this._markText);this._editor=CodeMirror.fromTextArea(a[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0});this._editor.setOption("disableInput",!this._enabled);this._markEditor=CodeMirror.fromTextArea(c[0],{lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",extraKeys:{"Ctrl-Q":"toggleComment"},autofocus:!0});this._markEditor.setOption("disableInput",!this._enabled)}};
epiviz.ui.controls.MarkerCodeControl.prototype.save=function(){this._editor&&(this._editorText=this._editor.getValue(),this._markText=this._markEditor.getValue())};epiviz.ui.controls.MarkerCodeControl.prototype.revert=function(){this._editor&&this._editor.setOption("value",this._editorText);this._markEditor&&this._markEditor.setOption("value",this._markText)};
epiviz.ui.controls.MarkerCodeControl.prototype.result=function(){return{enabled:this._enabled,preMark:this._enabled?this._editorText:null,mark:this._enabled?this._markText:null}};epiviz.ui.charts.decoration.MarkerCodeButton=function(a,b,c){epiviz.ui.charts.decoration.CodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.MarkerCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.CodeButton.prototype);epiviz.ui.charts.decoration.MarkerCodeButton.constructor=epiviz.ui.charts.decoration.MarkerCodeButton;
epiviz.ui.charts.decoration.MarkerCodeButton.prototype._controlCreator=function(){var a=this;return function(b){var c=a.visualization().getMarker(a.markerId()),d,e;c&&(d=c.preMarkStr(),e=c.markStr());d=d||a.preMarkTemplate();e=e||a.markTemplate();return new epiviz.ui.controls.MarkerCodeControl(b,a.markerLabel(),null,a.visualization(),d,e,void 0!=c)}};
epiviz.ui.charts.decoration.MarkerCodeButton.prototype._saveHandler=function(){var a=this;return function(b){b.enabled?a.visualization().putMarker(a.createMarker(b.preMark,b.mark)):a.visualization().removeMarker(a.markerId())}};epiviz.ui.charts.decoration.MarkerCodeButton.prototype._cancelHandler=function(){return function(){}};
epiviz.ui.charts.decoration.MarkerCodeButton.prototype.createMarker=function(a,b){return new epiviz.ui.charts.markers.VisualizationMarker(this.markerType(),this.markerId(),this.markerLabel(),a,b)};epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerType=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerLabel=function(){throw Error("unimplemented abstract method");};
epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markerId=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.decoration.MarkerCodeButton.prototype.preMarkTemplate=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.decoration.MarkerCodeButton.prototype.markTemplate=function(){throw Error("unimplemented abstract method");};epiviz.ui.charts.decoration.ChartFilterCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.ChartFilterCodeButton.constructor=epiviz.ui.charts.decoration.ChartFilterCodeButton;epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER};
epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerLabel=function(){return"User Filter"};epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markerId=function(){return"user-filter"};epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.ChartFilterCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.datatypes.GenomicData.ValueItem} [item]\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {boolean}\n * @template InitialVars\n */\nfunction(item, data, preMarkResult) {\n  // TODO: Your code here\n  return true;\n}\n"};epiviz.ui.charts.tree.decoration={};epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton=function(a,b){epiviz.ui.charts.decoration.VisualizationDecoration.call(this,a,b);this._checked=this.isChartOptionButton=!0};epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.VisualizationDecoration.prototype);epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.constructor=epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton;
epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype.decorate=function(){epiviz.ui.charts.decoration.VisualizationDecoration.prototype.decorate.call(this);for(var a=0,b=this.otherDecoration();b;b=b.otherDecoration())b.isChartOptionButton&&++a;var c=this,b=sprintf("%s-propagate-selection-button",this.visualization().id());this.visualization().container().append(sprintf('<div id="%1$s-container" style="position: absolute; top: 5px; right: %2$spx"><input type="checkbox" id="%1$s" %3$s /><label for="%1$s" >Toggle propagate selection</label></div>',
b,5+30*a,this._checked?'checked="checked"':""));var d=$("#"+b),e=$("#"+b+"-container");d.button({text:!1,icons:{primary:"ui-icon ui-icon-refresh"}}).click(function(){c._checked=d.is(":checked");c.visualization().setAutoPropagateChanges(c._checked)});this.visualization().container().mousemove(function(){e.show()}).mouseleave(function(){e.hide()})};epiviz.ui.charts.tree.decoration.TogglePropagateSelectionButton.prototype.checked=function(){return this._checked};epiviz.ui.charts.decoration.HierarchyFilterCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.HierarchyFilterCodeButton.constructor=epiviz.ui.charts.decoration.HierarchyFilterCodeButton;epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.FILTER};
epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerLabel=function(){return"User Filter"};epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markerId=function(){return"user-filter"};epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.ui.charts.tree.Node} [root]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(root) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.HierarchyFilterCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.ui.charts.tree.Node} [node]\n * @param {epiviz.ui.charts.tree.Node} [root]\n * @param {InitialVars} [preMarkResult]\n * @returns {boolean}\n * @template InitialVars\n */\nfunction(node, root, preMarkResult) {\n  // TODO: Your code here\n  return true;\n}\n"};epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton;
epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.GROUP_BY_MEASUREMENTS};epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerLabel=function(){return"Group by"};epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markerId=function(){return"group-by-measurements"};
epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.ChartGroupByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"};epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton;
epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_MEASUREMENTS};epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerLabel=function(){return"Color by Measurements"};epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markerId=function(){return"color-by-measurements"};
epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.ChartColorByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string|number}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"};epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.constructor=epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton;
epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.ORDER_BY_MEASUREMENTS};epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerLabel=function(){return"Order By"};epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markerId=function(){return"order-by-measurements"};
epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.ChartOrderByMeasurementsCodeButton.prototype.markTemplate=function(){return"/**\n * @param {epiviz.measurements.Measurement} m\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string|number}\n * @template InitialVars\n */\nfunction(m, data, preMarkResult) {\n  // TODO: Your code here\n  return 0;\n}\n"};epiviz.ui.charts.decoration.ChartColorByRowCodeButton=function(a,b,c){epiviz.ui.charts.decoration.MarkerCodeButton.call(this,a,b,c)};epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype=epiviz.utils.mapCopy(epiviz.ui.charts.decoration.MarkerCodeButton.prototype);epiviz.ui.charts.decoration.ChartColorByRowCodeButton.constructor=epiviz.ui.charts.decoration.ChartColorByRowCodeButton;epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerType=function(){return epiviz.ui.charts.markers.VisualizationMarker.Type.COLOR_BY_ROW};
epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerLabel=function(){return"Color By"};epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markerId=function(){return"color-by"};epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.preMarkTemplate=function(){return"/**\n * This method is called once before every draw, for all data available to the visualization,\n * for initialization. Its result can be used inside the filter method.\n * @param {epiviz.datatypes.GenomicData} [data]\n * @returns {InitialVars}\n * @template InitialVars\n */\nfunction(data) {\n  // TODO: Your code here\n  return null;\n}\n"};
epiviz.ui.charts.decoration.ChartColorByRowCodeButton.prototype.markTemplate=function(){return"/**\n * This method is called for every data object. If it returns false, the object will not be drawn.\n * @param {epiviz.datatypes.GenomicData.RowItem} [row]\n * @param {epiviz.datatypes.GenomicData} [data]\n * @param {InitialVars} [preMarkResult]\n * @returns {string}\n * @template InitialVars\n */\nfunction(row, data, preMarkResult) {\n  // TODO: Your code here\n  return row.metadata('colLabel');\n}\n"};epiviz.ui.charts.ChartManager=function(a){this._config=a;this._charts={};this._chartsOrder={};this._resizeInterval=null;this._chartAdded=new epiviz.events.Event;this._chartRemoved=new epiviz.events.Event;this._chartsOrderChanged=new epiviz.events.Event;this._chartsCleared=new epiviz.events.Event;this._chartColorsChanged=new epiviz.events.Event;this._chartMethodsModified=new epiviz.events.Event;this._chartMethodsReset=new epiviz.events.Event;this._chartMarkersModified=new epiviz.events.Event;this._chartCustomSettingsChanged=
new epiviz.events.Event;this._chartSizeChanged=new epiviz.events.Event;this._chartMarginsChanged=new epiviz.events.Event;this._chartRequestHierarchy=new epiviz.events.Event;this._chartPropagateHierarchyChanges=new epiviz.events.Event;this._chartPropogateIcicleLocationChanges=new epiviz.events.Event;this._chartIcicleLocationChanges=new epiviz.events.Event;this._chartPropagateNavigationChanges=new epiviz.events.Event;this._registerWindowResize()};
epiviz.ui.charts.ChartManager.prototype.addChart=function(a,b,c,d){c=c||sprintf("%s-%s-%s",a.chartDisplayType(),a.chartHtmlAttributeName(),epiviz.utils.generatePseudoGUID(5));var e=a.cssClass(),f=$("#"+a.chartContainer()),g=f.find(".accordion"),h=g.find(".vis-container");0==g.length&&(g=$('<div class="accordion"></div>').appendTo(f),f=a.chartDisplayType(),g.append(sprintf('<h3><a href="#"><b><span style="color: #025167">Views by %s</span></b></a></h3>',epiviz.ui.ControlManager.DISPLAY_TYPE_LABELS[f])),
h=$('<div class="vis-container"></div>').appendTo(g),g.multiAccordion(),g.multiAccordion("option","active","all"));h.append(sprintf('<div id="%s" class="%s"></div>',c,e));g=h.find("#"+c);f=[];if(null!=a._defaultSettings.chartMarkers||void 0!=a._defaultSettings.chartMarkers)for(e=0;e<a._defaultSettings.chartMarkers.length;e++)h=a._defaultSettings.chartMarkers[e],f.push(new epiviz.ui.charts.markers.VisualizationMarker(h.type,h.id,h.name,h.preMark,h.mark));d=d||new epiviz.ui.charts.VisualizationProperties(a.defaultWidth(),
a.defaultHeight(),a.defaultMargins(),b,a.defaultColors(),null,a.customSettingsValues(),a.customSettingsDefs(),f);b=a.createNew(c,g,d);this._charts[c]=b;this._registerChartHover(b);this._registerChartUnhover(b);this._registerChartSelect(b);this._registerChartDeselect(b);this._registerChartColorsChanged(b);this._registerChartMethodsModified(b);this._registerChartMethodsReset(b);this._registerChartMarkersModified(b);this._registerChartCustomSettingsChanged(b);this._registerChartSizeChanged(b);this._registerChartMarginsChanged(b);
this._registerChartRemove(b);this._registerChartSave(b);this._registerChartRequestHierarchy(b);this._registerChartPropagateHierarchyChanges(b);this._registerChartPropogateIcicleLocationChanges(b);this._registerChartIcicleLocationChanges(b);this._registerChartPropagateNavigationChanges(b);if(a.decorations()){g=void 0;for(e=0;e<a.decorations().length;++e)(f=epiviz.utils.evaluateFullyQualifiedTypeName(a.decorations()[e]))&&(g=epiviz.utils.applyConstructor(f,[b,g,this._config]));g&&g.decorate()}a.chartDisplayType()in
this._chartsOrder||(this._chartsOrder[a.chartDisplayType()]=[]);this._chartsOrder[a.chartDisplayType()].push(c);this._chartAdded.notify(new epiviz.ui.charts.VisEventArgs(c,{type:a,properties:d,chartsOrder:this._chartsOrder}));return c};
epiviz.ui.charts.ChartManager.prototype.removeChart=function(a){$("#"+a).remove();var b=this._charts[a];delete this._charts[a];this._chartsOrder[b.displayType()].splice(this._chartsOrder[b.displayType()].indexOf(a),1);b=$("#"+epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS[b.displayType()]);0==b.find(".accordion").find(".vis-container").children().length&&b.empty();this._chartRemoved.notify(new epiviz.ui.charts.VisEventArgs(a,this._chartsOrder))};
epiviz.ui.charts.ChartManager.prototype.chartsMeasurements=function(){var a={},b;for(b in this._charts)this._charts.hasOwnProperty(b)&&this._charts[b].displayType()!=epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&(a[b]=this._charts[b].measurements());return a};epiviz.ui.charts.ChartManager.prototype.updateCharts=function(a,b,c){c=c||Object.keys(this._charts);for(var d=0;d<c.length;++d)if(this._charts.hasOwnProperty(c[d])){var e=this._charts[c[d]];e&&function(c){c.transformData(a,b).done(function(){c.draw()})}(e)}};
epiviz.ui.charts.ChartManager.prototype.updateDataStructureCharts=function(){for(var a=Object.keys(this._charts),b=0;b<a.length;++b)if(this._charts.hasOwnProperty(a[b])){var c=this._charts[a[b]];c&&c.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&function(a){setTimeout(function(){a.fireRequestHierarchy()},0)}(c)}};
epiviz.ui.charts.ChartManager.prototype.clear=function(){this._charts={};this._chartsOrder={};var a=epiviz.ui.ControlManager.CHART_TYPE_CONTAINERS,b;for(b in a)a.hasOwnProperty(b)&&$("#"+a[b]).empty();this._chartsCleared.notify()};epiviz.ui.charts.ChartManager.prototype.dataWaitStart=function(a,b){if(a&&this._charts[a])this._charts[a].onDataWaitStart().notify(new epiviz.ui.charts.VisEventArgs(a));else for(var c in this._charts)this._charts.hasOwnProperty(c)&&b&&b[this._charts[c]]&&this._charts[c].onDataWaitStart().notify(new epiviz.ui.charts.VisEventArgs(c))};
epiviz.ui.charts.ChartManager.prototype.onChartAdded=function(){return this._chartAdded};epiviz.ui.charts.ChartManager.prototype.onChartRemoved=function(){return this._chartRemoved};epiviz.ui.charts.ChartManager.prototype.onChartsOrderChanged=function(){return this._chartsOrderChanged};epiviz.ui.charts.ChartManager.prototype.onChartsCleared=function(){return this._chartsCleared};epiviz.ui.charts.ChartManager.prototype.onChartColorsChanged=function(){return this._chartColorsChanged};
epiviz.ui.charts.ChartManager.prototype.onChartMethodsModified=function(){return this._chartMethodsModified};epiviz.ui.charts.ChartManager.prototype.onChartMethodsReset=function(){return this._chartMethodsReset};epiviz.ui.charts.ChartManager.prototype.onChartMarkersModified=function(){return this._chartMarkersModified};epiviz.ui.charts.ChartManager.prototype.onChartCustomSettingsChanged=function(){return this._chartCustomSettingsChanged};
epiviz.ui.charts.ChartManager.prototype.onChartSizeChanged=function(){return this._chartSizeChanged};epiviz.ui.charts.ChartManager.prototype.onChartMarginsChanged=function(){return this._chartMarginsChanged};epiviz.ui.charts.ChartManager.prototype.onChartRequestHierarchy=function(){return this._chartRequestHierarchy};epiviz.ui.charts.ChartManager.prototype.onChartPropagateHierarchyChanges=function(){return this._chartPropagateHierarchyChanges};
epiviz.ui.charts.ChartManager.prototype.onChartPropogateIcicleLocationChanges=function(){return this._chartPropogateIcicleLocationChanges};epiviz.ui.charts.ChartManager.prototype.onChartIcicleLocationChanges=function(){return this._chartIcicleLocationChanges};epiviz.ui.charts.ChartManager.prototype.onChartPropagateNavigationChanges=function(){return this._chartPropagateNavigationChanges};
epiviz.ui.charts.ChartManager.prototype._registerWindowResize=function(){var a=this;$(window).resize(function(){null!==a._resizeInterval&&window.clearTimeout(a._resizeInterval);a._resizeInterval=window.setTimeout(function(){for(var b in a._charts)a._charts.hasOwnProperty(b)&&a._charts[b].updateSize();a._resizeInterval=null},500)})};
epiviz.ui.charts.ChartManager.prototype._registerChartHover=function(a){var b=this;a.onHover().addListener(new epiviz.events.EventListener(function(a){for(var c in b._charts)b._charts.hasOwnProperty(c)&&b._charts[c].doHover(a.args)}))};epiviz.ui.charts.ChartManager.prototype._registerChartUnhover=function(a){var b=this;a.onUnhover().addListener(new epiviz.events.EventListener(function(){for(var a in b._charts)b._charts.hasOwnProperty(a)&&b._charts[a].doUnhover()}))};
epiviz.ui.charts.ChartManager.prototype._registerChartSelect=function(a){var b=this;a.onSelect().addListener(new epiviz.events.EventListener(function(a){a=a.args;for(var c in b._charts)b._charts.hasOwnProperty(c)&&b._charts[c].doSelect(a)}))};epiviz.ui.charts.ChartManager.prototype._registerChartDeselect=function(a){var b=this;a.onDeselect().addListener(new epiviz.events.EventListener(function(){for(var a in b._charts)b._charts.hasOwnProperty(a)&&b._charts[a].doDeselect()}))};
epiviz.ui.charts.ChartManager.prototype._registerChartRemove=function(a){var b=this;a.onRemove().addListener(new epiviz.events.EventListener(function(a){b.removeChart(a.id)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartSave=function(a){var b=this;"default"!=b._config.configType?a.onSave().addListener(new epiviz.events.EventListener(function(a){(new epiviz.ui.PrintManager(a.id,"epiviz_"+Math.floor($.now()/1E3),"pdf")).print()})):a.onSave().addListener(new epiviz.events.EventListener(function(a){(new epiviz.ui.controls.SaveSvgAsImageDialog({ok:function(){},cancel:function(){}},a.id,b._config.dataServerLocation+b._config.chartSaverLocation)).show()}))};
epiviz.ui.charts.ChartManager.prototype._registerChartColorsChanged=function(a){var b=this;a.onColorsChanged().addListener(new epiviz.events.EventListener(function(a){b._chartColorsChanged.notify(a)}))};epiviz.ui.charts.ChartManager.prototype._registerChartMethodsModified=function(a){var b=this;a.onMethodsModified().addListener(new epiviz.events.EventListener(function(a){b._chartMethodsModified.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartMethodsReset=function(a){var b=this;a.onMethodsReset().addListener(new epiviz.events.EventListener(function(a){b._chartMethodsReset.notify(a)}))};epiviz.ui.charts.ChartManager.prototype._registerChartMarkersModified=function(a){var b=this;a.onMarkersModified().addListener(new epiviz.events.EventListener(function(a){b._chartMarkersModified.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartCustomSettingsChanged=function(a){var b=this;a.onCustomSettingsChanged().addListener(new epiviz.events.EventListener(function(a){b._chartCustomSettingsChanged.notify(a)}))};epiviz.ui.charts.ChartManager.prototype._registerChartSizeChanged=function(a){var b=this;a.onSizeChanged().addListener(new epiviz.events.EventListener(function(a){b._chartSizeChanged.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartMarginsChanged=function(a){var b=this;a.onMarginsChanged().addListener(new epiviz.events.EventListener(function(a){b._chartMarginsChanged.notify(a)}))};epiviz.ui.charts.ChartManager.prototype._registerChartRequestHierarchy=function(a){var b=this;a.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&a.onRequestHierarchy().addListener(new epiviz.events.EventListener(function(a){b._chartRequestHierarchy.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartPropagateHierarchyChanges=function(a){var b=this;a.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&a.onPropagateHierarchyChanges().addListener(new epiviz.events.EventListener(function(a){b._chartPropagateHierarchyChanges.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartPropogateIcicleLocationChanges=function(a){var b=this;a.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&a.onPropagateIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(a){b._chartPropogateIcicleLocationChanges.notify(a)}))};
epiviz.ui.charts.ChartManager.prototype._registerChartIcicleLocationChanges=function(a){this.onChartIcicleLocationChanges().addListener(new epiviz.events.EventListener(function(b){a.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.DATA_STRUCTURE&&(a._updateLocation(b.args.start,b.args.width),a._drawAxes(a._lastRoot))}))};
epiviz.ui.charts.ChartManager.prototype._registerChartPropagateNavigationChanges=function(a){var b=this;a.displayType()==epiviz.ui.charts.VisualizationType.DisplayType.TRACK&&a._propagateNavigationChanges.addListener(new epiviz.events.EventListener(function(a){b._chartPropagateNavigationChanges.notify(a)}))};epiviz.ui.charts.ChartManager.prototype.getChartSettings=function(a){a=this._charts[a];var b={};b.settings=a.customSettingsValues();b.colorMap=a.properties().colors;return b};
epiviz.ui.charts.ChartManager.prototype.setChartSettings=function(a,b,c){a=this._charts[a];if(null!=b){var d=a.customSettingsValues();Object.keys(b).forEach(function(a){d[a]=b[a]});a.setCustomSettingsValues(d)}null!=c&&a.setColors(c);a.draw()};epiviz.workspaces.WorkspaceManager=function(a,b,c,d,e){this._config=a;this._locationManager=b;this._measurementsManager=c;this._chartManager=d;this._chartFactory=e;this._workspacesByName=this._workspaces=this._unchangedActiveWorkspace=this._activeWorkspace=null;this._workspacesLoaded=new epiviz.events.Event;this._activeWorkspaceChanged=new epiviz.events.Event;this._activeWorkspaceChanging=!1;this._requestWorkspaces=new epiviz.events.Event;this._activeWorkspaceContentChanged=new epiviz.events.Event;
this._uiChartSettingsChanged=new epiviz.events.Event;var f=this;this._activeWorkspaceContentChangedListener=new epiviz.events.EventListener(function(a){f._activeWorkspaceContentChanged.notify(a)});this._registerLocationChanged();this._registerComputedMeasurementAdded();this._registerComputedMeasurementRemoved();this._registerChartAdded();this._registerChartRemoved();this._registerChartsOrderChanged();this._registerChartColorsChanged();this._registerChartMethodsModified();this._registerChartMethodsReset();
this._registerChartMarkersModified();this._registerChartSizeChanged();this._registerChartMarginsChanged();this._registerChartCustomSettingsChanged()};epiviz.workspaces.WorkspaceManager.prototype.onUiChartSettingsChanged=function(){return this._uiChartSettingsChanged};epiviz.workspaces.WorkspaceManager.prototype.activeWorkspace=function(){return this._activeWorkspace||null};epiviz.workspaces.WorkspaceManager.prototype.get=function(a){return a&&this._workspaces?this._workspaces[a]||null:null};
epiviz.workspaces.WorkspaceManager.prototype.getByName=function(a){return a&&this._workspacesByName?this._workspacesByName[a]||null:null};epiviz.workspaces.WorkspaceManager.prototype.initialize=function(){this._requestWorkspaces.notify({activeWorkspaceId:epiviz.ui.WebArgsManager.WEB_ARGS.ws||epiviz.ui.WebArgsManager.WEB_ARGS.workspace||null})};
epiviz.workspaces.WorkspaceManager.prototype.updateWorkspaces=function(a,b,c,d){if(a){this._workspaces={};this._workspacesByName={};for(var e=0;e<a.length;++e)null!==a[e].id()&&(this._workspaces[a[e].id()]=a[e],this._workspacesByName[a[e].name()]=a[e])}b||(b=a&&a.length?a[0]:epiviz.workspaces.Workspace.fromRawObject(this._config.defaultWorkspaceSettings,this._chartFactory,this._config));e=this._activeWorkspace;this._activeWorkspace=b;this._unchangedActiveWorkspace=d?d:b?b.copy(b.name(),b.id()):null;
e&&e.onContentChanged().removeListener(this._activeWorkspaceContentChangedListener);this._activeWorkspace&&this._activeWorkspace.onContentChanged().addListener(this._activeWorkspaceContentChangedListener);b=epiviz.ui.WebArgsManager.WEB_ARGS;d=void 0!=b.genome?b.genome:this._activeWorkspace.range().genome();var f=void 0!=b.seqName?b.seqName:this._activeWorkspace.range().seqName(),g=null,h=null;"undefined"!=b.start&&(g=parseInt(b.start)||this._activeWorkspace.range().start());"undefined"!=b.end&&(h=
parseInt(b.end)||this._activeWorkspace.range().end());this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(f,g,h,d));this._workspacesLoaded.notify({activeWorkspace:this._activeWorkspace,workspaces:a});this._activeWorkspaceChanged.notify({oldValue:e,newValue:this._activeWorkspace,workspaceId:this._activeWorkspace.id()||c})};epiviz.workspaces.WorkspaceManager.prototype.updateWorkspace=function(a){this._workspaces[a.id()]=a;this._workspacesByName[a.name()]=a};
epiviz.workspaces.WorkspaceManager.prototype.deleteActiveWorkspace=function(){var a=this._activeWorkspace;if(a&&a.id()){delete this._workspaces[a.id()];delete this._workspacesByName[a.name()];var b=null,c;for(c in this._workspaces)if(this._workspaces.hasOwnProperty(c)){b=this._workspaces[c];break}b||(b=epiviz.workspaces.Workspace.fromRawObject(this._config.defaultWorkspaceSettings,this._chartFactory,this._config));this._unchangedActiveWorkspace=(this._activeWorkspace=b)?b.copy(b.name(),b.id()):null;
b=a.range().genome();c=a.range().seqName();var d=a.range().start(),e=a.range().end();this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(c,d,e,b));this._activeWorkspaceChanged.notify({oldValue:a,newValue:this._activeWorkspace,workspaceId:this._activeWorkspace.id()})}};
epiviz.workspaces.WorkspaceManager.prototype.revertActiveWorkspace=function(){if(this._unchangedActiveWorkspace){var a=this._activeWorkspace,b=a.range().genome(),c=a.range().seqName(),d=a.range().start(),a=a.range().end();this._activeWorkspace=this._unchangedActiveWorkspace.copy(this._unchangedActiveWorkspace.name(),this._unchangedActiveWorkspace.id());this._activeWorkspace.locationChanged(epiviz.datatypes.GenomicRange.fromStartEnd(c,d,a,b));this._activeWorkspaceChanged.notify({oldValue:null,newValue:this._activeWorkspace,
workspaceId:this._activeWorkspace.id()})}};epiviz.workspaces.WorkspaceManager.prototype.onWorkspacesLoaded=function(){return this._workspacesLoaded};epiviz.workspaces.WorkspaceManager.prototype.onActiveWorkspaceChanged=function(){return this._activeWorkspaceChanged};epiviz.workspaces.WorkspaceManager.prototype.startChangingActiveWorkspace=function(){this._activeWorkspaceChanging=!0};epiviz.workspaces.WorkspaceManager.prototype.endChangingActiveWorkspace=function(){this._activeWorkspaceChanging=!1};
epiviz.workspaces.WorkspaceManager.prototype.activeWorkspaceChanging=function(){return this._activeWorkspaceChanging};epiviz.workspaces.WorkspaceManager.prototype.onRequestWorkspaces=function(){return this._requestWorkspaces};epiviz.workspaces.WorkspaceManager.prototype.onActiveWorkspaceContentChanged=function(){return this._activeWorkspaceContentChanged};
epiviz.workspaces.WorkspaceManager.prototype.changeActiveWorkspace=function(a,b){if((b=b||this._workspaces[a])&&b!==this._activeWorkspace){var c=this._activeWorkspace;this._unchangedActiveWorkspace=(this._activeWorkspace=b)?this._activeWorkspace.copy(this._activeWorkspace.name(),this._activeWorkspace.id()):null;this._activeWorkspaceChanged.notify({oldValue:c,newValue:this._activeWorkspace,workspaceId:a})}};
epiviz.workspaces.WorkspaceManager.prototype._registerLocationChanged=function(){var a=this;this._locationManager.onCurrentLocationChanged().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.locationChanged(b.newValue)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartAdded=function(){var a=this;this._chartManager.onChartAdded().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartAdded(b.id,b.args.type,b.args.properties,b.args.chartsOrder)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartRemoved=function(){var a=this;this._chartManager.onChartRemoved().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartRemoved(b.id,b.args)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartsOrderChanged=function(){var a=this;this._chartManager.onChartsOrderChanged().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartsOrderChanged(b)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartColorsChanged=function(){var a=this;this._chartManager.onChartColorsChanged().addListener(new epiviz.events.EventListener(function(b){!a._activeWorkspaceChanging&&a._activeWorkspace&&(a._activeWorkspace.chartColorsChanged(b.id,b.args),a.onUiChartSettingsChanged().notify({chartId:b.id,colorMap:b.args}))}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartMethodsModified=function(){var a=this;this._chartManager.onChartMethodsModified().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartMethodsModified(b.id,b.args)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartMethodsReset=function(){var a=this;this._chartManager.onChartMethodsReset().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartMethodsReset(b.id)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartMarkersModified=function(){var a=this;this._chartManager.onChartMarkersModified().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartMarkersModified(b.id,b.args)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartCustomSettingsChanged=function(){var a=this;this._chartManager.onChartCustomSettingsChanged().addListener(new epiviz.events.EventListener(function(b){!a._activeWorkspaceChanging&&a._activeWorkspace&&(a._activeWorkspace.chartCustomSettingsChanged(b.id,b.args),a.onUiChartSettingsChanged().notify({chartId:b.id,settings:b.args}))}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartSizeChanged=function(){var a=this;this._chartManager.onChartSizeChanged().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartSizeChanged(b.id,b.args.width,b.args.height)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerChartMarginsChanged=function(){var a=this;this._chartManager.onChartMarginsChanged().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.chartMarginsChanged(b.id,b.args)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerComputedMeasurementAdded=function(){var a=this;this._measurementsManager.onComputedMeasurementsAdded().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.computedMeasurementsAdded(b)}))};
epiviz.workspaces.WorkspaceManager.prototype._registerComputedMeasurementRemoved=function(){var a=this;this._measurementsManager.onComputedMeasurementsRemoved().addListener(new epiviz.events.EventListener(function(b){a._activeWorkspaceChanging||a._activeWorkspace&&a._activeWorkspace.computedMeasurementsRemoved(b)}))};epiviz.workspaces.UserManager=function(a){this._config=a};epiviz.workspaces.UserManager.USER_STATUS=epiviz.workspaces.UserManager.USER_STATUS||{loggedIn:!1,userData:null,oauthProvider:null};epiviz.workspaces.UserManager.prototype.toggleLogin=function(){epiviz.workspaces.UserManager.USER_STATUS.loggedIn?this._logout():this._login()};
epiviz.workspaces.UserManager.prototype._login=function(){var a=window.location.toString();0<a.length&&(a=encodeURIComponent(a));window.location=this._config.dataServerLocation+"login.php?location="+a};epiviz.workspaces.UserManager.prototype._logout=function(){var a=window.location.toString();0<a.length&&(a=encodeURIComponent(a));window.location=this._config.dataServerLocation+"logout.php?logout&location="+a};epiviz.main=function(){var a=new epiviz.Config(epiviz.Config.SETTINGS),b=new epiviz.ui.LocationManager(a),c=new epiviz.measurements.MeasurementsManager,d=new epiviz.ui.charts.ChartFactory(a),e=new epiviz.ui.charts.ChartManager(a),f=new epiviz.ui.ControlManager(a,d,e,c,b),g=new epiviz.data.DataProviderFactory(a),g=new epiviz.data.DataManager(a,g),h;"false"==a.useCookie?(h=new epiviz.localstorage.LocalStorageManager(epiviz.localstorage.LocalStorageManager.MODE.INCOGNITO_MODE),h.clearWorkspace(),a.defaultWorkspaceSettings.content.charts=
null):h=new epiviz.localstorage.LocalStorageManager(epiviz.localstorage.LocalStorageManager.MODE.COOKIE_MODE);var m=new epiviz.workspaces.WorkspaceManager(a,b,c,e,d),l=new epiviz.workspaces.UserManager(a),p=new epiviz.ui.WebArgsManager(b,m),b=new epiviz.EpiViz(a,b,c,f,g,d,e,m,l,p,h);epiviz.ui.charts.transform.clustering.ClusteringAlgorithmFactory.initialize(a);b.start()};goog.exportSymbol("epiviz",epiviz);
